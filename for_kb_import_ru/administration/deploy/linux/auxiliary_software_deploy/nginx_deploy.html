<body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="comindware" dir="ltr"> <div class="md-container" data-md-component="container"> <main class="md-main" data-md-component="main"> <div class="md-main__inner md-grid"> <nav aria-label="Содержание" class="md-nav md-nav--secondary"> <div class="mce-toc"> <h2 class="toc-heading"> Содержание </h2> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#введение"> <span class="md-ellipsis"> Введение </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#1-установка-nginx"> <span class="md-ellipsis"> 1. Установка NGINX </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#2-настройка-сервера-nginx"> <span class="md-ellipsis"> 2. Настройка сервера NGINX </span> </a> <nav aria-label="2. Настройка сервера NGINX" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#21-пример-конфигурации-прокси-сервера"> <span class="md-ellipsis"> 2.1. Пример конфигурации прокси-сервера </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#22-настройка-ufw"> <span class="md-ellipsis"> 2.2. Настройка UFW </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#23-отключение-команды-server_tokens"> <span class="md-ellipsis"> 2.3. Отключение команды server_tokens </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#24-контроль-ресурсов-и-ограничения"> <span class="md-ellipsis"> 2.4. Контроль ресурсов и ограничения </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#25-настройка-nginx-для-включения-заголовков-безопасности"> <span class="md-ellipsis"> 2.5. Настройка NGINX для включения заголовков безопасности </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#26-настройка-ssl-и-наборов-шифров-cipher-suite"> <span class="md-ellipsis"> 2.6. Настройка SSL и наборов шифров Cipher Suite </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#27-регулярное-обновление-сервера"> <span class="md-ellipsis"> 2.7. Регулярное обновление сервера </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#28-проверка-состояния-сервера"> <span class="md-ellipsis"> 2.8. Проверка состояния сервера </span> </a> </li> </ul> </nav> </li> </ul> </div> </nav> <div class="md-content" data-md-component="content"> <article class="md-content__inner md-typeset">  <h2 id="введение">Введение</h2> <p>В настоящем документе представлена краткая инструкция по установке и настройке конфигурации HTTP-сервера NGINX в ОС Ubuntu 20.04 для использования NGINX в сочетании с Comindware Business Application Platform.</p> <p>Подробные сведения по установке и настройке NGINX представлены на следующих сайтах:</p> <ul> <li><a class="mkdocs_imported_link" href="http://nginx.org/ru/docs/beginners_guide.html">http://NGINX.org/ru/docs/beginners_guide.html</a></li> <li><a class="mkdocs_imported_link" href="https://ruvds.com/ru/helpcenter/kak-nastroit-nginx-na-ubuntu-20-04/">https://ruvds.com/ru/helpcenter/kak-nastroit-NGINX-na-ubuntu-20-04/</a></li> <li><a class="mkdocs_imported_link" href="https://webdevblog.ru/bezopasnost-nginx-kak-uluchshit-konfiguraciju-vashego-servera/">https://webdevblog.ru/bezopasnost-NGINX-kak-uluchshit-konfiguraciju-vashego-servera/</a></li> </ul> <h2 id="1-установка-nginx">1. Установка NGINX</h2> <p>Войдите в систему под учётной записью, имеющей разрешение на запуск команды <code>sudo</code>, и выполните следующие команды:</p> <ul> <li><code>$ sudo apt update</code></li> <li><code>$ sudo apt install NGINX</code></li> </ul> <p>Первая команда обновляет базу данных пакетов, доступных для установки. Вторая — устанавливает компоненты NGINX.</p> <p>После установки NGINX настройте его конфигурацию.</p> <h2 id="2-настройка-сервера-nginx">2. Настройка сервера NGINX</h2> <p>Конфигурация NGINX хранится в файле <code>NGINX.conf</code>. По умолчанию файл <code>NGINX.conf</code> находится в следующей папке:</p> <ul> <li><code>/etc/NGINX</code> или <code>/usr/local/etc/NGINX</code> — в системах Linux;</li> <li><code>[папка установки NGINX]/conf</code> — в системах Windows.</li> </ul> <h3 id="21-пример-конфигурации-прокси-сервера">2.1. Пример конфигурации прокси-сервера</h3> <table style="width: 100%;"> <thead> <tr> <th>server {     server_name  domain.com;     reset_timedout_connection  on;     listen 80;       location /robots.txt { root /var/www/html; }     return 301 https://$host$request_uri; }   server {     server_name  domain.com;     reset_timedout_connection  on;        listen 443 ssl;       location / {     proxy_pass http://backend-server:8081/;     proxy_next_upstream error timeout invalid_header http_500 http_503;       # do not set HOST header     proxy_set_header  Host                $host;     proxy_set_header  X-Forwarded-For     $proxy_add_x_forwarded_for;     proxy_set_header  X-Forwarded-Proto   $scheme;     proxy_set_header  X-Real-IP           $remote_addr;       proxy_connect_timeout     90;     proxy_send_timeout        1000;     proxy_read_timeout        1000;       # enable WebSockets     proxy_http_version 1.1;     proxy_set_header Upgrade $http_upgrade;     proxy_set_header Connection "upgrade";       client_max_body_size 100m;       error_log /var/log/NGINX/domain-error.log error;     access_log /var/log/NGINX/domain-access.log;   } }</th> </tr> </thead> <tbody> <tr> <td></td> </tr> </tbody> </table> <h3 id="22-настройка-ufw">2.2. Настройка UFW</h3> <p>Для защиты подключений рекомендуется настроить межсетевой экран с помощью утилиты Uncomplicated Firewall (UFW).</p> <p>Просмотреть профили приложений можно с помощью команды: <code>$ sudo ufw app list</code></p> <p>Для просмотра и изменения параметров используйте соответствующие команды. Например, команда для подключения к NGINX посредством HTTP: <code>$ sudo ufw allow 'NGINX HTTP'</code></p> <p>Команда для проверки статуса: <code>$ sudo ufw status</code></p> <h3 id="23-отключение-команды-server_tokens">2.3. Отключение команды server_tokens</h3> <p>По умолчанию команда <code>server_tokens</code>возвращает номер версии NGINX.</p> <p>Чтобы скрыть версию NGINX, отключите команду <code>server_tokens</code>, добавив в файле конфигурации NGINX следующую директиву: <code>server_tokens off</code></p> <h3 id="24-контроль-ресурсов-и-ограничения">2.4. Контроль ресурсов и ограничения</h3> <p>Для предотвращения DoS-атак на NGINX можно установить ограничения на размер буфера для всех клиентов. Для это в разделе <code>server</code> файла конфигурации NGINX используйте следующие директивы:</p> <ul> <li><code>client_body_buffer_size</code> — размер буфера тела запроса клиента. Типовое значение — 8 или 16 КБ, но рекомендуется установить его равным 1 КБ с помощью следующей директивы: <code>client_body_buffer_size 1k</code>.</li> <li><code>client_header_buffer_size</code> — размер буфера заголовка запроса клиента. Размер буфера 1 КБ подходит для большинства запросов, например: <code>client_header_buffer_size 1k</code></li> <li><code>client_max_body_size</code> — максимально допустимый размер тела клиентского запроса, например: <code>client_max_body_size</code>. Размера 1 КБ должно быть достаточно, но его следует увеличить, если загрузка файлов осуществляется методом POST.</li> <li><code>large_client_header_buffers</code> —максимальное количество и размер буферов, которые будут использоваться для чтения больших заголовков клиентских запросов. Например, чтобы установить максимальное количество буферов равным 2, каждый с максимальным размером 1 КБ, и разрешить прием URI-данных размером 2 КБ, используйте следующую директиву: <code>large_client_header_buffers 2 1k</code></li> </ul> <h3 id="25-настройка-nginx-для-включения-заголовков-безопасности">2.5. Настройка NGINX для включения заголовков безопасности</h3> <p>Чтобы дополнительно защитить веб-сервер NGINX, можно добавить определенные заголовки HTTP. Ниже приведены рекомендованные варианты таких заголовков.</p> <p><strong>X-Frame-Options</strong></p> <p>Заголовок HTTP-ответа <code>X-Frame-Options</code> используется чтобы указать, разрешено ли браузеру отображать страницу в фреймах <code>&lt;frame&gt;</code>, <code>&lt;iframe&gt;</code>, <code>&lt;embed&gt;</code> и <code>&lt;object&gt;</code>. Чтобы разрешить отображение страниц во фреймах только с того же домена, на котором размещен веб-сайт, добавьте следующую директиву в раздел server файла конфигурации NGINX: <code>add_header X-Frame-Options "SAMEORIGIN";</code></p> <p><strong>Strict-Transport-Security</strong></p> <p><a class="mkdocs_imported_link" href="https://www.acunetix.com/blog/articles/what-is-hsts-why-use-it/">HTTP Strict Transport Security (HSTS)</a> — это механизм, позволяющий веб-сайту сообщать браузеру, что доступ к нему разрешен только через безопасное соединение (HTTPS). Если веб-сайт объявил политику HSTS, браузер должен отклонять все HTTP-соединения и запретить пользователям принимать незащищенные SSL-сертификаты. Чтобы сервер NGINX возвращал заголовок HSTS, добавьте следующую директиву в раздел <code>server</code>: <code>add_ header Strict-Transport-Security "max-age=31536000; includeSubdomains; preload";</code></p> <p><strong>Политика CSP</strong></p> <p>Политика безопасности контента (CSP) защищает веб-сервер от определенных типов атак, включая атаки с использованием <a class="mkdocs_imported_link" href="https://www.acunetix.com/websitesecurity/cross-site-scripting/">Cross-site Scripting</a> (XSS) и атаки с использованием data injection. Чтобы реализовать CSP, добавьте заголовок Content-Security-Policy, как показано в следующем примере (фактический заголовок должен быть настроен в соответствии с вашими уникальными требованиями) в раздел <code>server</code>: <code>add_header Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'" always;</code> </p> <p><strong>Заголовок X-XSS-Protection</strong></p> <p>Заголовок HTTP X-XSS-Protection поддерживают браузеры IE и Safari. Он не требуется для современных браузеров, если используется строгая политика безопасности содержимого. Однако, чтобы предотвратить атаки типа XSS при использовании старых браузеров (которые не поддерживают CSP), добавьте заголовок X-XSS Protection в раздел <code>server</code>: <code>add_header X-XSS-Protection "1; mode=block”;</code></p> <h3 id="26-настройка-ssl-и-наборов-шифров-cipher-suite">2.6. Настройка SSL и наборов шифров Cipher Suite</h3> <p>Конфигурация NGINX по умолчанию позволяет использовать небезопасные старые версии протокола TLS, которые н рекомендуется применять. Следует изменить конфигурацию для поддержки только новых, безопасных версий TLS. Для этого добавьте следующую директиву в раздел <code>server</code> файла конфигурации NGINX: <code>ssl_protocols TLSv1.2 TLSv1.3;</code></p> <p>Укажите конкретные наборы шифров (криптографических алгоритмов), чтобы предотвратить использование уязвимых наборов не поддерживаются. Либо для автоматического выбора шифра на стороне сервера добавьте следующую директиву в раздел <code>server</code>: <code>ssl_prefer_server_ciphers on;</code></p> <h3 id="27-регулярное-обновление-сервера">2.7. Регулярное обновление сервера</h3> <p>Следует регулярно устанавливать последние обновления NGINX с официального сайта: <a class="mkdocs_imported_link" href="http://nginx.org/en/security_advisories.html">http://NGINX.org/en/security_advisories.html</a></p> <h3 id="28-проверка-состояния-сервера">2.8. Проверка состояния сервера</h3> <p>Команда проверки статуса веб-сервера NGINX: <code>$ systemctl status NGINX</code></p> <p><img alt="Статус веб-сервера NGINX" src="https://kb.comindware.ru/assets/Picture_10.png"/></p> <p>Статус веб-сервера NGINX</p> </article> </div> </div> <a class="md-top md-icon mkdocs_imported_link" data-md-component="top" href="#"> <i class="fa-light fa-arrow-up">&zwnj;<!--icon--></i> К началу </a> </main> </div> <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": true, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>