<body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="comindware" dir="ltr"> <div class="md-container" data-md-component="container"> <main class="md-main" data-md-component="main"> <div class="md-main__inner md-grid"> <nav aria-label="Содержание" class="md-nav md-nav--secondary"> <div class="mce-toc"> <h2 class="toc-heading"> Содержание </h2> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#введение"> <span class="md-ellipsis"> Введение </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#подготовка-к-резервному-копированию-и-восстановлению-данных"> <span class="md-ellipsis"> Подготовка к резервному копированию и восстановлению данных </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#порядок-резервного-копирования-данных-экземпляра-продукта"> <span class="md-ellipsis"> Порядок резервного копирования данных экземпляра продукта </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#выполнение-резервного-копирования"> <span class="md-ellipsis"> Выполнение резервного копирования </span> </a> <nav aria-label="Выполнение резервного копирования" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#регистрация-репозитория-и-создание-снимка-elasticsearch"> <span class="md-ellipsis"> Регистрация репозитория и создание снимка Elasticsearch </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#сохранение-резервной-копии-базы-данных-экземпляра-продукта"> <span class="md-ellipsis"> Сохранение резервной копии базы данных экземпляра продукта </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#порядок-восстановления-данных-экземпляра-продукта"> <span class="md-ellipsis"> Порядок восстановления данных экземпляра продукта </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#выполнение-восстановления"> <span class="md-ellipsis"> Выполнение восстановления </span> </a> <nav aria-label="Выполнение восстановления" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#восстановление-снимка-elasticsearch"> <span class="md-ellipsis"> Восстановление снимка Elasticsearch </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#восстановление-базы-данных-экземпляра-продукта"> <span class="md-ellipsis"> Восстановление базы данных экземпляра продукта </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#проверка-конфигурации-экземпляра-по"> <span class="md-ellipsis"> Проверка конфигурации экземпляра ПО </span> </a> </li> </ul> </div> </nav> <div class="md-content" data-md-component="content"> <article class="md-content__inner md-typeset">  <h2 id="введение">Введение</h2> <p>Здесь представлены инструкции по резервному копированию и восстановлению данных <strong>Comindware Business Application Platform</strong> в ОС Windows.</p> <div class="notice notice-success"> <p class="admonition-title">Определения</p> <p><strong>Elasticsearch</strong> — система журналирования в составе <strong>Comindware Business Application Platform</strong>.</p> <p><strong>Снимок</strong> — набор данных, сохранённый на определённый момент времени.</p> </div> <h2 id="подготовка-к-резервному-копированию-и-восстановлению-данных">Подготовка к резервному копированию и восстановлению данных</h2> <p>Для создания резервных копий и восстановления из них данных Comindware Business Application Platform необходимо подготовить конфигурацию резервного копирования, как указано ниже.</p> <p><a class="mkdocs_imported_link" id="P1.1"></a> 1. Подготовьте следующие данные о конфигурации экземпляра продукта:</p> <ul> <li>Название экземпляра продукта — <code>InstanceId</code>(например, <code>CBAP4.2</code>).</li> <li>Путь к папке с базой данных экземпляра продукта, например <code>DatabasePath</code> (по умолчанию: <code>C:\ProgramData\Comindware\Instances\InstanceId\Data</code>).</li> <li>Путь к папке резервных копий базы данных — <code>DatabaseBackupPath</code> (например, <code>С:\DatabaseBackups</code>).</li> <li>Имя репозитория снимков Elasticsearch — <em><code>repository_name</code></em> (например, <code>elastic_backup</code>).</li> <li>Путь к репозиторию снимков Elasticsearch — <code>elastic_backup_path</code>(например, <code>e:\elastic_backup</code>).</li> <li>Имя снимка Elasticsearch — <code>snapshot_name</code> (например, <code>InstanceId01022022080800</code> — в формате <code>&lt;InstanceId&gt;&lt;Date&gt;&lt;Time&gt;</code>). См. инструкции Elasticsearch по формированию имён снимков с использованием текущей даты  (на английском языке): <a class="mkdocs_imported_link" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/api-conventions.html#api-date-math-index-names">https://www.elastic.co/guide/en/elasticsearch/reference/current/api-conventions.html#api-date-math-index-names</a>.</li> </ul> <ol class="colored_numbers_list" start="2"> <li> <p>Настройте конфигурацию репозитория снимков сервера Elasticseach.</p> <ol class="colored_numbers_list"> <li>Откройте файл <code>elasticsearch.yml</code> в папке с данными конфигурации Elasticseach (например: <code>C:\ElasticsearchData</code>)</li> </ol> <p><a class="mkdocs_imported_link" id="P1.2.2"></a> 2. В файле <code>elasticsearch.yml</code> и добавьте директиву <code>path.repo</code> и через двоеточие укажите путь к репозиторию снимков (папке с резервными копиями), например: </p> <p><code>path.repo: elastic_backup_path</code></p> </li> </ol> <h2 id="порядок-резервного-копирования-данных-экземпляра-продукта">Порядок резервного копирования данных экземпляра продукта</h2> <p>Данные экземпляра продукта хранятся в двух независимых друг от друга хранилищах: на сервере Elasticsearch и в папке с базой данных экземпляра продукта — <code>DatabasePath</code> (<a class="mkdocs_imported_link" href="#P1.1">см. параграф 1.1</a>).</p> <p>Так как осуществить одновременное резервное копирование двух хранилищ не представляется возможным, резервное копирование данных из каждого хранилища выполняется отдельно в два этапа и в отдельные папки:</p> <ol class="colored_numbers_list"> <li><a class="mkdocs_imported_link" href="#31-регистрация-репозитория-и-создание-снимка-elasticsearch">Создание снимка сервера Elasticsearch</a> — данные истории и мониторинга копируются в отдельную папку.</li> <li><a class="mkdocs_imported_link" href="#32-сохранение-резервной-копии-базы-данных-экземпляра-продукта">Сохранение резервной копии базы данных экземпляра продукта</a> в папку <em><code>DatabaseBackupPath</code></em> (<a class="mkdocs_imported_link" href="#P1.1">см. параграф 1.1</a>).</li> </ol> <h2 id="выполнение-резервного-копирования">Выполнение резервного копирования</h2> <h3 id="регистрация-репозитория-и-создание-снимка-elasticsearch">Регистрация репозитория и создание снимка Elasticsearch</h3> <ol class="colored_numbers_list"> <li>Чтобы зарегистрировать репозиторий, выполните следующую команду, указав в URL имя репозитория <code>repository_name</code> (<a class="mkdocs_imported_link" href="#P1.1">см. параграф 1.1</a>), а в параметре <code>location</code> — путь к репозиторию из директивы <code>path.repo</code> в файле конфигурации сервера Elasticsearch <a class="mkdocs_imported_link" href="#P1.2.2">(см. параграф 1.2.2</a>:</li> </ol> <p><code>curl -X PUT "localhost:9200/_snapshot/repository_name?pretty" -H 'Content-Type: application/json' -d' {"type": "fs", "settings": {"location": "elastic_backup_path"}}'</code></p> <p>Подробные сведения о регистрации репозитория Elasticsearch см. в официальной документации (на английском языке): <a class="mkdocs_imported_link" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/snapshots-register-repository.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/snapshots-register-repository.html</a></p> <ol class="colored_numbers_list" start="2"> <li>Чтобы создать снимок Elasticsearch, выполните следующую команду, указав имя снимка <code>snapshot_name</code> (<a class="mkdocs_imported_link" href="#P1.1">см. параграф 1.1</a>), а в параметре <code>indices</code> — индексы, которые требуется включить в снимок (индексы Comindware Business Application Platform имеют префикс, например, <code>cmw_&lt;InstanceId&gt;_</code>):</li> </ol> <p><code>curl -X PUT "localhost:9200/_snapshot/repository_name/snapshot_name?wait_for_completion=true&amp;pretty" -H 'Content-Type: application/json' -d' {"indices": "cmw_&lt;InstanceId&gt;_*", "ignore_unavailable": true, "include_global_state": false}'</code></p> <p>Подробные сведения о создании снимка Elasticsearch см. в официальной документации (на английском языке): <a class="mkdocs_imported_link" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/snapshots-take-snapshot.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/snapshots-take-snapshot.html</a></p> <h3 id="сохранение-резервной-копии-базы-данных-экземпляра-продукта">Сохранение резервной копии базы данных экземпляра продукта</h3> <p>1. В экземпляре продукта откройте раздел «<strong>Администрирование</strong>» — «<strong>Инфраструктура</strong>» — «<strong>Резервное копирование</strong>».</p> <p>2. Нажмите кнопку «<strong>Создать</strong>» в списке конфигураций резервного копирования.</p> <figure class="screenshot_with_caption"> <p><img alt="Создание новой конфигурации резервного копирования" src="https://kb.comindware.ru/assets/img_6321d80a2b32d.png"/><figcaption class="caption">Создание новой конфигурации резервного копирования</figcaption></p> </figure> <p><a class="mkdocs_imported_link" id="P3.2.3"></a> 3. В окне «<strong>Новая конфигурация резервного копирования</strong>»:</p> <div class="highlight"><code><pre><span></span><code>1. В поле «**Название**» укажите наглядное название конфигурации (например, «`Резервная копия InstanceId`»).</code><br/>
<code>2. В поле «**Путь к файлу**» укажите путь к файлу резервной копии в папке `DatabaseBackupPath` на сервере ([см. параграф 1.1](#P1.1)).</code><br/>
<code>3. &lt;a id="P3.2.3.3"&gt;&lt;/a&gt;В поле «**Имя файла**» укажите имя файла резервной копии (например, `Backup`).</code><br/>
<code>4. Установите флажки «**С файлами**» и «**Со скриптами**».</code><br/>
<code>5. Нажмите кнопку «**Сохранить**».</code><br/>
</pre></code></div> <figure class="screenshot_with_caption"> <p><img alt="Настройка новой конфигурации резервного копирования" src="https://kb.comindware.ru/assets/img_6321d7573245a.png"/><figcaption class="caption">Настройка новой конфигурации резервного копирования</figcaption></p> </figure> <p>4. Запустите резервное копирование:</p> <ol class="colored_numbers_list"> <li>В списке конфигураций резервного копирования с помощью флажка выбора выберите созданную на <a class="mkdocs_imported_link" href="#P3.2.3">шаге 3.2.3</a> конфигурацию.</li> <li> <p>Нажмите кнопку «<strong>Запустить копирование</strong>».</p> <p><figure class="screenshot_with_caption" markdown=""><img alt="Запуск резервного копирования" src="https://kb.comindware.ru/assets/img_6321d902288c2.png"/><figcaption class="caption">Запуск резервного копирования</figcaption></figure></p> </li> <li> <p>В фоновом режиме начнется процесс резервного копирования.</p> </li> <li>Прогресс и результат резервного копирования можно просмотреть в журнале резервного копирования, выбрав вкладку «<strong>Журнал</strong>» над списком конфигураций резервного копирования.</li> <li> <p>В процессе резервного копирования к имени файла, указанному <a class="mkdocs_imported_link" href="#P3.2.3.3">на шаге 3.2.3.3</a> будут добавлена метка времени в формате <code>ГГГГММДДЧЧММ</code> и расширение <code>CDBBZ</code>, например для имени файла <code>Backup</code>: <code>Backup``.202202161625.cdbbz</code></p> <p><figure class="screenshot_with_caption" markdown=""><img alt="Переход к журналу резервного копирования" src="https://kb.comindware.ru/assets/img_6321dbd1da164.png"/><figcaption class="caption">Переход к журналу резервного копирования</figcaption></figure></p> </li> </ol> <h2 id="порядок-восстановления-данных-экземпляра-продукта">Порядок восстановления данных экземпляра продукта</h2> <p>Данные экземпляра продукта хранятся в трех независимых друг от друга хранилищах:  сервере Apache Ignite, сервере Elasticsearch и папке <code>DatabaseBackupPath</code> (<a class="mkdocs_imported_link" href="#P1.1">см. параграф 1.1</a>). Поэтому восстановление осуществляется последовательно для каждого хранилища.</p> <div class="notice notice-warning"> <p class="admonition-title">Важно</p> <p>Восстановление следует выполнять при остановленном экземпляре продукта.</p> </div> <p>Восстановление данных из резервных копий выполняется в два этапа:</p> <ol class="colored_numbers_list"> <li><a class="mkdocs_imported_link" href="#52-восстановление-снимка-elasticsearch">Восстановление снимка сервера Elasticsearch</a>.</li> <li><a class="mkdocs_imported_link" href="#53-восстановление-базы-данных-экземпляра-продукта">Восстановление базы данных экземпляра продукта</a> из папки <code>DatabaseBackupPath</code> (<a class="mkdocs_imported_link" href="#P1.1">см. параграф 1.1</a>).</li> </ol> <h2 id="выполнение-восстановления">Выполнение восстановления</h2> <h3 id="восстановление-снимка-elasticsearch">Восстановление снимка Elasticsearch</h3> <ol class="colored_numbers_list"> <li>Выполните следующую команду, указав имя репозитораия <code>repository_name</code> и имя снимка <code>snapshot_name</code> (<a class="mkdocs_imported_link" href="#P1.1">см. параграф 1.1</a>):</li> </ol> <p><code>curl -X POST "localhost:9200/_snapshot/repository_name/snapshot_name/_restore?pretty"</code></p> <p>Подробные сведения о восстановлении снимков Elasticsearch см. в официальной документации (на английском языке): <a class="mkdocs_imported_link" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/snapshots-restore-snapshot.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/snapshots-restore-snapshot.html</a></p> <h3 id="восстановление-базы-данных-экземпляра-продукта">Восстановление базы данных экземпляра продукта</h3> <ol class="colored_numbers_list"> <li>Восстановите базу данных экземпляра продукта согласно инструкциям в статье «<a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=2038">Восстановление экземпляра продукта из резервной копии</a>».</li> </ol> <h2 id="проверка-конфигурации-экземпляра-по">Проверка конфигурации экземпляра ПО</h2> <ol class="colored_numbers_list"> <li>Запустите экземпляр ПО.</li> </ol> <p>2. При необходимости откроется страница настройки подключения к службе Elasticsearch.</p> <p>3. В поле «URI» введите адрес автоматически своего сервера Elasticsearch.</p> <p>4. Введите <strong>префикс индекса</strong>, <strong>имя пользователя</strong> и <strong>пароль сервера Elasticsearch</strong>. .</p> <ol class="colored_numbers_list" start="5"> <li> <p>Нажмите кнопку «<strong>Далее</strong>».</p> <p><figure class="screenshot_with_caption" markdown=""><img alt="Настройка подключения к Elasticsearch" src="https://kb.comindware.ru/assets/Picture16.png"/><figcaption class="caption">Настройка подключения к Elasticsearch</figcaption></figure></p> </li> </ol> <p>6. При необходимости откроется страница инициализации данных в Elasticsearch.</p> <p>7. Нажмите кнопку «<strong>Обновить</strong>».</p> <div class="highlight"><code><pre><span></span><code>&lt;figure markdown&gt;![Страница инициализации данных в Elasticsearch](https://kb.comindware.ru/assets/Picture17.png)&lt;figcaption&gt;Страница инициализации данных в Elasticsearch&lt;/figcaption&gt;&lt;/figure&gt;</code><br/>
</pre></code></div> <p>8. Дождитесь открытия начальной страницы <strong>Comindware Business Application Platform</strong>.</p> <p>9. Откройте страницу «<strong>Администрирование</strong>» — «<strong>Подключения</strong>».</p> <div class="highlight"><code><pre><span></span><code>&lt;figure markdown&gt;![Переход к свойства подключения к Elasticsearch](https://kb.comindware.ru/assets/img_64d09fd6ec3ba.png)&lt;figcaption&gt;Переход к свойства подключения к Elasticsearch&lt;/figcaption&gt;&lt;/figure&gt;</code><br/>
</pre></code></div> <p>10. Откройте подключение к серверу Elasticsearch.</p> <p>11. Удостоверьтесь, что корректно указаны <strong>префикс индекса</strong> и <strong>URL подключения</strong> к серверу Elasticsearch.</p> <div class="highlight"><code><pre><span></span><code>&lt;figure markdown&gt;![Свойства подключения к серверу Elasticsearch](https://kb.comindware.ru/assets/img_64d0a41fc5e0b.png)&lt;figcaption&gt;Свойства подключения к серверу Elasticsearch&lt;/figcaption&gt;&lt;/figure&gt;</code><br/>
</pre></code></div> <p>12. Откройте страницу «<strong>Администрирование</strong>» — «<strong>Глобальная конфигурация</strong>».</p> <p>13. Удостоверьтесь, что указан корректный <strong>URL-адрес сервера</strong>.</p> <div class="highlight"><code><pre><span></span><code>&lt;figure markdown&gt;![URL-адрес сервера в глобальной конфигурации](https://kb.comindware.ru/assets/img_64d0a4feebc80.png)&lt;figcaption&gt;URL-адрес сервера в глобальной конфигурации&lt;/figcaption&gt;&lt;/figure&gt;</code><br/>
</pre></code></div> <p>14. Откройте страницу «<strong>Администрирование</strong>» — «<strong>Резервное копирование</strong>».</p> <p>15. Удостоверьтесь, что в конфигурациях резервного копирования правильно указаны пути для сохранения резервных копий.</p> <div class="highlight"><code><pre><span></span><code>&lt;figure markdown&gt;![Путь к папке резервных копий в конфигурации резервного копирования](https://kb.comindware.ru/assets/img_64d0a5817d06a.png)&lt;figcaption&gt;Путь к папке резервных копий в конфигурации резервного копирования&lt;/figcaption&gt;&lt;/figure&gt;</code><br/>
</pre></code></div> <p>16. При необходимости измените конфигурации резервного копирования, указав корректные пути к файлам.</p> <div class="highlight"><code><pre><span></span><code>&lt;figure markdown&gt;![Настройка пути к файлам резервной копии](https://kb.comindware.ru/assets/img_64d0a5f075838.png)&lt;figcaption&gt;Настройка пути к файлам резервной копии&lt;/figcaption&gt;&lt;/figure&gt;</code><br/>
</pre></code></div> </article> </div> </div> <a class="md-top md-icon mkdocs_imported_link" data-md-component="top" href="#"> <i class="fa-light fa-arrow-up">&zwnj;<!--icon--></i> К началу </a> </main> </div> <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": true, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>