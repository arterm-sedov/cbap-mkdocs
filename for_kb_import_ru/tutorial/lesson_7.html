<div class="md-body" data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="comindware" dir="ltr" kb-id="4872">
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<nav aria-label="Содержание" class="md-nav md-nav--secondary">
<div class="mce-toc">
<h2 class="toc-heading">
      Содержание
      </h2>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#введение">
<span class="md-ellipsis">
      Введение
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#автоматическое-вычисление-значений-атрибутов">
<span class="md-ellipsis">
      Автоматическое вычисление значений атрибутов
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#отображение-ф-и-о-заказчика-и-даты-создания-заявки">
<span class="md-ellipsis">
      Отображение Ф. И. О. заказчика и даты создания заявки
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#вычисление-суммы-затрат">
<span class="md-ellipsis">
      Вычисление суммы затрат
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#тестирование-вычисления-суммы-затрат">
<span class="md-ellipsis">
      Тестирование вычисления суммы затрат
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#формирование-номера-заявки">
<span class="md-ellipsis">
      Формирование номера заявки
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#настройка-отображения-номера-заявки">
<span class="md-ellipsis">
      Настройка отображения номера заявки
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#тестирование-формирования-номера-заявки">
<span class="md-ellipsis">
      Тестирование формирования номера заявки
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#статус-заявки">
<span class="md-ellipsis">
      Статус заявки
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#настройка-отображения-статуса-и-номера-заявки">
<span class="md-ellipsis">
      Настройка отображения статуса и номера заявки
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#тестирование-изменения-статуса-заявки">
<span class="md-ellipsis">
      Тестирование изменения статуса заявки
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#настройка-заголовка-задачи">
<span class="md-ellipsis">
      Настройка заголовка задачи
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#тестирование">
<span class="md-ellipsis">
      Тестирование
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#результаты">
<span class="md-ellipsis">
      Результаты
    </span>
</a>
</li>
</ul>
</div>
</nav>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h2 id="введение">Введение</h2>
<p>В ходе этого урока вы научитесь настраивать вычисляемые атрибуты и использовать язык формул, чтобы сделать данные в заявках более наглядными и повысить эффективность бизнес-процессов.</p>
<p><strong>Предусловие:</strong> пройден <a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=4870">Урок 6. Усовершенствованный процесс</a>.</p>
<p><strong>Расчётная продолжительность:</strong> 20 мин.</p>
<div class="notice notice-info">
<p class="admonition-title">Примечание</p>
<p>В данном уроке представлен продукт <strong>Comindware Platform</strong> версии 5.0, внешний вид страниц и меню в других версиях продукта может отличаться.</p>
</div>
<h2 id="автоматическое-вычисление-значений-атрибутов">Автоматическое вычисление значений атрибутов</h2>
<p>У заявок обычно есть номер и дата. Также в ходе рассмотрения заявки интересно знать, кто является <em>Заказчиком</em> — в том числе исходя из этого будет приниматься решение, выделять машину или нет. Дата заявки — это дата запуска процесса, системный атрибут, значение которому присваивается автоматически. Имя <em>Заказчика</em> также является системным атрибутом, нам надо только вынести эти атрибуты на форму. Для номера же заявки мы определим шаблон, по которому он будет формироваться автоматически.</p>
<h2 id="отображение-ф-и-о-заказчика-и-даты-создания-заявки">Отображение Ф. И. О. заказчика и даты создания заявки</h2>
<p>Участникам процесса было бы полезно знать, кто является <em>Заказчиком</em> и когда была подана заявка. Эта информация сохраняется автоматически при создании заявки в системных атрибутах «<strong>Создатель</strong>» и «<strong>Дата создания</strong>».</p>
<ol class="colored_numbers_list">
<li>Перейдите на вкладку «<strong>Формы</strong>» шаблона записи <em>«Заявки на автомобили».</em></li>
<li>Откройте конструктор формы <em>«Заявки на автомобили - Основная форма».</em></li>
<li>Разверните атрибут «<strong>Создатель</strong>» на панели элементов и перетащите на макет формы атрибут «<strong>Ф. И. О.</strong>».</li>
<li>Перетащите на макет формы атрибут «<strong>Дата создания</strong>».</li>
<li>Сохраните форму.</li>
</ol>
<figure class="screenshot_with_caption">
<p><img alt="Добавление атрибутов на форму заявки на автомобиль" src="https://kb.comindware.ru/assets/img_624451d18750c.png"/><figcaption class="caption">Добавление атрибутов на форму заявки на автомобиль</figcaption></p>
</figure>
<h2 id="вычисление-суммы-затрат">Вычисление суммы затрат</h2>
<p>Настроим автоматическое вычисление итоговой суммы затрат. Для этого мы изменим свойства атрибута «Итоговая сумма затрат», установив флажок «<strong>Вычислять по выражению</strong>», затем добавим формулу для автоматического вычисления значения атрибута. Для составления формулы мы воспользуемся редактором выражений и предиктивным вводом…</p>
<div class="notice notice-warning">
<p class="admonition-title">Внимание!</p>
<p>В формулах необходимо указывать те системные имена, которые вы фактически использовали в своём приложении.</p>
<p>Например, если вы присвоили шаблону <em>«Затраты»</em> системное имя <code>Затраты123</code>, то именно это имя следует использовать в формуле.</p>
<p>То есть, если системные имена, приведённые в уроках, не совпадают с фактическими системными именами в вашем приложении, используйте фактические системные имена, а не копируйте их из текста уроков.</p>
</div>
<ol class="colored_numbers_list">
<li>Перейдите к диаграмме бизнес-процесса <em>«Заказ автотранспорта»</em> и нажмите кнопку «<strong>Редактировать</strong>».</li>
<li>Выберите задачу <em>«Выполнить рейс».</em></li>
<li>В меню элемента нажмите кнопку «<strong>Форма</strong>» <i class="fa-light fa-newspaper">&zwnj;<!--icon--></i>.</li>
<li>В конструкторе формы разверните элемент <em>«Заявки на автомобили»</em> на панели элементов.</li>
<li>Нажмите кнопку «<strong>Редактировать</strong>» <i class="fa-light fa-pencil">&zwnj;<!--icon--></i> у атрибута <em>«Итоговая сумма затрат».</em></li>
<li>В окне свойств атрибута установите флажок «<strong>Вычислять по автоматически</strong>».</li>
<li>В поле «<strong>Вычисляемое выражение</strong>» нажмите кнопку «<strong>Открыть в редакторе</strong>»  <i class="fa-light fa-pencil">&zwnj;<!--icon--></i>.</li>
<li>В редакторе выражений введите функцию: <code>SUM()</code>.</li>
<li>Установив курсор внутри скобок функции <code>SUM()</code>, нажмите клавиши <span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-space">Пробел</kbd></span> (Windows и Linux) или <span class="keys"><kbd class="key-command">Cmd</kbd><span>+</span><kbd class="key-space">Пробел</kbd></span> (macOS).</li>
<li>
<p>В отобразившемся раскрывающемся списке дважды нажмите пункт <code>Затраты</code> со значком <i class="fa-light fa-list-alt">&zwnj;<!--icon--></i>.</p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Вставка заготовки запроса from-where-select для шаблона «Затраты» в качестве аргумента функции SUM()" src="https://kb.comindware.ru/assets/img_6475bdea9fe53.png"/><figcaption class="caption">Вставка заготовки запроса from-where-select для шаблона «Затраты» в качестве аргумента функции SUM()</figcaption></figure></p>
</li>
<li>
<p>В формулу будет вставлена заготовка запроса записей из шаблона <em>«Затраты»</em>: <code>from a in db-&gt;Затраты where Ваше условие select a-&gt;id</code>.</p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Заготовки запроса from-where-select для шаблона «Затраты»" src="https://kb.comindware.ru/assets/img_6475be3fe5eb3.png"/><figcaption class="caption">Заготовки запроса from-where-select для шаблона «Затраты»</figcaption></figure></p>
</li>
<li>
<p>Замените строку <code>Ваше условие</code> на <code>a-&gt;</code> и нажмите клавиши <span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-space">Пробел</kbd></span> (Windows и Linux) или <span class="keys"><kbd class="key-command">Cmd</kbd><span>+</span><kbd class="key-space">Пробел</kbd></span> (macOS).</p>
</li>
<li>
<p>В отобразившемся раскрывающемся списке дважды нажмите пункт <code>Заявка</code>. В формулу будет вставлено системное имя атрибута <code>Заявка</code> шаблона <em>«Затраты».</em></p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Вставка в выражение системного имени атрибута «Заявка» шаблона «Затраты»" src="https://kb.comindware.ru/assets/img_6475c309be5f9.png"/><figcaption class="caption">Вставка в выражение системного имени атрибута «Заявка» шаблона «Затраты»</figcaption></figure></p>
</li>
<li>
<p>После системного имени <code>Заявка</code> введите строку <code>== $</code>.</p>
</li>
<li>
<p>В отобразившемся раскрывающемся списке дважды нажмите пункт <code>id</code>. в формулу будет вставлено системное имя <code>id</code> атрибута <em>«ID»</em> текущего шаблона <em>«Заявки на автомобили».</em></p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Вставка в выражение системного имени атрибута «ID» шаблона «Заявки на автомобили»" src="https://kb.comindware.ru/assets/img_6475c34222af8.png"/><figcaption class="caption">Вставка в выражение системного имени атрибута «ID» шаблона «Заявки на автомобили»</figcaption></figure></p>
</li>
<li>
<p>Удалите строку <code>id</code> после оператора <code>a-&gt;</code> и нажмите клавиши  ++ctr+space++.</p>
</li>
<li>
<p>В отобразившемся раскрывающемся списке дважды нажмите пункт <code>Сумма</code>. в формулу будет вставлено системное имя атрибута <code>Сумма</code> шаблона <em>«Затраты»</em>.</p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Вставка в выражение системного имени атрибута «Сумма» шаблона «Затраты»" src="https://kb.comindware.ru/assets/img_6475c37aca216.png"/><figcaption class="caption">Вставка в выражение системного имени атрибута «Сумма» шаблона «Затраты»</figcaption></figure></p>
</li>
<li>
<p>Получится формула <code>SUM(from a in db-&gt;Затраты where a-&gt;Заявка == $id select a-&gt;Сумма)</code>.</p>
<p>Здесь <code>Затраты</code> — шаблон записи «Затраты»; <code>Заявка</code> — атрибут типа «<strong>Запись</strong>» шаблона «Затраты», <code>$id</code> — идентификатор заявки, <code>Сумма</code> — атрибут шаблона «Затраты».</p>
</li>
<li>
<p>Нажмите кнопку «<strong>Применить</strong>» и кнопку ‌.</p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Формула для вычисляемого числового атрибута" src="https://kb.comindware.ru/assets/img_6475c4ba0c537.png"/><figcaption class="caption">Формула для вычисляемого числового атрибута</figcaption></figure></p>
</li>
<li>
<p>В окне свойств атрибута <em>«Итоговая сумма затрат»</em> нажмите кнопку «<strong>Сохранить</strong>».</p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Сохранение атрибута «Итоговая сумма затрат»" src="https://kb.comindware.ru/assets/img_6475c693a645c.png"/><figcaption class="caption">Сохранение атрибута «Итоговая сумма затрат»</figcaption></figure></p>
</li>
<li>
<p>Вернитесь к диаграмме бизнес-процесса и нажмите кнопку «<strong>Опубликовать</strong>».</p>
</li>
</ol>
<div class="notice notice-success">
<p class="admonition-title">Определения</p>
<ul>
<li>Для вычисления итоговой суммы затрат мы использовали функцию — <code>SUM()</code>:<ul>
<li><code>SUM(from a in db-&gt;Затраты where b-&gt;Заявка == $id select a-&gt;Сумма)</code></li>
<li>Функция <code>SUM()</code> принимает в качестве аргумента список значений и возвращает сумму их значений (число).</li>
</ul>
</li>
<li>В функцию <code>SUM()</code> мы передаём список значений атрибута <em>«Сумма»</em> шаблона записи <em>«Затраты»</em>, сформированный с помощью следующего запроса:<ul>
<li><code>from a in</code> — объявление локальной переменной <code>a</code>;</li>
<li><code>db-&gt;Затраты</code> — объявление шаблона записи «Затраты» в качестве источника данных;</li>
<li><code>where a-&gt;Заявка == $id</code> — выбор записи, у которой значение атрибута «Заявка» типа «<strong>Запись</strong>» равно идентификатору текущей заявки, то есть выбор только тех затрат, которые относятся к данной заявке;</li>
<li><code>select a-&gt;Сумма</code> — выбор значений атрибута «Сумма».</li>
</ul>
</li>
<li>Данную формулу можно составить двумя другими способами:<ul>
<li><code>SUM(from a in $Затраты select a-&gt;Сумма)</code> — здесь в качестве источника данных запроса указан атрибут «Затраты» типа «<strong>Запись</strong>», который содержит идентификаторы записей шаблона <em>«Затраты»</em>, связанные с текущей заявкой;</li>
<li><code>SUM($Затраты-&gt;Сумма)</code> — здесь мы напрямую передаем в функцию <code>SUM()</code> значения атрибута <em>«Сумма»</em>, записей шаблона <em>«Затраты»</em>, связанных с текущей заявкой.</li>
</ul>
</li>
</ul>
</div>
<div class="notice notice-info">
<p class="admonition-title">Примечание</p>
<p>Подробные сведения о составлении формул см. в разделе <em>«<a class="mkdocs_imported_link" href="https://kb.comindware.ru/category.php?id=880">Язык формул</a>».</em></p>
</div>
<h2 id="тестирование-вычисления-суммы-затрат">Тестирование вычисления суммы затрат</h2>
<ol class="colored_numbers_list">
<li>Перейдите к списку экземпляров шаблона процесса <em>«Заказ автотранспорта»</em> и нажмите кнопку «<strong>Создать</strong>».</li>
<li>Пройдите процесс до задачи <em>«Выполнить рейс»</em>.</li>
<li>Откройте задачу <em>«Заказ автотранспорта — Выполнить рейс»</em> и заполните таблицу затрат — укажите различные суммы и типы затрат.</li>
</ol>
<p>Поле «Итоговая сумма затрат» должно вычисляться автоматически:</p>
<figure class="screenshot_with_caption">
<p><img alt="Автоматическое вычисление итоговой суммы затрат" src="https://kb.comindware.ru/assets/img_62445bc9bea52.png"/><figcaption class="caption">Автоматическое вычисление итоговой суммы затрат</figcaption></p>
</figure>
<h2 id="формирование-номера-заявки">Формирование номера заявки</h2>
<p>Настроим автоматическую нумерацию заявок…</p>
<ol class="colored_numbers_list">
<li>Перейдите на вкладку «<strong>Атрибуты</strong>» шаблона записи <em>«Заявки на автомобили».</em></li>
<li>Добавьте новый текстовый атрибут <em>«Номер заявки»</em>. Установите флажок «<strong>Использовать как заголовок записей</strong>». Сохраните атрибут.</li>
<li>Перейдите к диаграмме процесса <em>«Заказ автотранспорта»</em> и нажмите кнопку «<strong>Редактировать</strong>».</li>
<li>
<p>Выберите начальное событие и с помощью меню элемента откройте «<strong>Сценарий на выходе</strong>».</p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Переход к сценарию на выходе начального события с диаграммы бизнес-процесса" src="https://kb.comindware.ru/assets/img_6311e7a1f306c.png"/><figcaption class="caption">Переход к сценарию на выходе начального события с диаграммы бизнес-процесса</figcaption></figure></p>
</li>
<li>
<p>Отобразится конструктор сценария.</p>
</li>
<li>
<p>Внутри действия «<strong>Сменить контекст</strong>» нажмите кнопку «Добавить действие» <em>‌</em>  и в раскрывающемся меню выберите пункт «<strong>Изменить значения атрибутов</strong>».</p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Создание действия «Изменить значения» в сценарии" src="https://kb.comindware.ru/assets/img_6311e89d84bc5.png"/><figcaption class="caption">Создание действия «Изменить значения» в сценарии</figcaption></figure></p>
</li>
<li>
<p>Внутри действия «<strong>Сменить контекст</strong>» будет создано действие «<strong>Изменить значения атрибутов</strong>».</p>
</li>
<li>
<p>В правой части заголовка элемента «<strong>Изменить значения атрибутов</strong>» нажмите кнопку «<strong>Изменить</strong>».</p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Переход к настройке действия «Изменить значения атрибутов»" src="https://kb.comindware.ru/assets/img_63ff0a6613aae.png"/><figcaption class="caption">Переход к настройке действия «Изменить значения атрибутов»</figcaption></figure></p>
</li>
<li>
<p>Отобразится окно «<strong>Действие: Изменить значения атрибутов</strong>».</p>
</li>
<li>Нажмите кнопку «<strong>Создать</strong>».</li>
<li>В столбце «<strong>Атрибут</strong>» выберите атрибут «<strong>Номер заявки».</strong></li>
<li>В столбце «<strong>Операция со значениями</strong>» выберите пункт «<strong>Заменить</strong>».</li>
<li>
<p>В столбце «<strong>Значение</strong>» выберите пункт «<strong>Формула</strong>».</p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Добавление операции с атрибутом для действия «Изменить значения»" src="https://kb.comindware.ru/assets/img_6311e9c30eab5.png"/><figcaption class="caption">Добавление операции с атрибутом для действия «Изменить значения»</figcaption></figure></p>
</li>
<li>
<p>Нажмите поле в столбце «<strong>Значение</strong>». Отобразится компактный редактор формулы.</p>
</li>
<li>
<p>Ведите формулу: <code>FORMAT("ЗA-{0}",LIST(COUNT(from b in db-&gt;Заявкинаавтомобили select b-&gt;id)))</code>. Нажмите кнопку с зеленым флажком.</p>
<p>Здесь:</p>
<ul>
<li><code>FORMAT()</code> — функция, которая принимает в качестве аргументов строку и список, подставляет в первый аргумент значения из второго аргумента и возвращает строку.</li>
<li><code>COUNT()</code> — функция, которая принимает аргумент-список и возвращает количество элементов в нём.</li>
<li><code>Заявкинаавтомобили</code> — это системное имя шаблона записи <em>«Заявки на автомобили».</em></li>
</ul>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Формула для вычисления номера заявки" src="https://kb.comindware.ru/assets/img_6311eaa77ae77.png"/><figcaption class="caption">Формула для вычисления номера заявки</figcaption></figure></p>
</li>
<li>
<p>Нажмите кнопку «<strong>Сохранить</strong>», чтобы сохранить действие  «<strong>Изменить значения атрибута</strong>».</p>
</li>
<li>
<p>Вернитесь к диаграмме процесса и опубликуйте её.</p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Добавление выражения для изменения значения атрибута «Номер заявки» при выходе из начального события" src="https://kb.comindware.ru/assets/img_6311ea7e9db00.png"/><figcaption class="caption">Добавление выражения для изменения значения атрибута «Номер заявки» при выходе из начального события</figcaption></figure></p>
</li>
</ol>
<h2 id="настройка-отображения-номера-заявки">Настройка отображения номера заявки</h2>
<p>Настроим отображение номера заявки на форме заявки…</p>
<ol class="colored_numbers_list">
<li>Перейдите на вкладку «<strong>Формы</strong>» шаблона записи <em>«Заявки на автомобили».</em></li>
<li>Откройте конструктор формы <em>«Заявки на автомобили — Основная форма»</em> и добавьте на нее поле «Номер заявки».</li>
<li>
<p>Укажите для этого поля режим <strong>доступа</strong> «<strong>Только чтение</strong>» и сохраните форму.</p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Добавление атрибута «Номер заявки» только для чтения на форму заявки на автомобиль" src="https://kb.comindware.ru/assets/img_6311edd5e3b9f.png"/><figcaption class="caption">Добавление атрибута «Номер заявки» только для чтения на форму заявки на автомобиль</figcaption></figure></p>
</li>
</ol>
<h2 id="тестирование-формирования-номера-заявки">Тестирование формирования номера заявки</h2>
<ol class="colored_numbers_list">
<li>Перейдите к списку экземпляров шаблона процесса <em>«Заказ автотранспорта».</em></li>
<li>Создайте новую заявку на автомобиль.</li>
<li>Перейдите в раздел «<strong>Мои задачи</strong>» и откройте форму задачи <em>«Заказ автотранспорта — Рассмотреть заявку»</em>. Поле <em>«Номер заявки»</em> должно быть заполнено автоматически:</li>
</ol>
<figure class="screenshot_with_caption">
<p><img alt="Автоматически сформированный с помощью выражения номер заявки" src="https://kb.comindware.ru/assets/img_6311fce3e2454.png"/><figcaption class="caption">Автоматически сформированный с помощью выражения номер заявки</figcaption></p>
</figure>
<h2 id="статус-заявки">Статус заявки</h2>
<p>Настроим автоматическое изменение статуса заявки. Статусы заявок будут храниться в справочнике, поэтому сначала мы создадим справочник статусов заявок…</p>
<ol class="colored_numbers_list">
<li>На панели навигации выберите пункты «<strong>Настройки</strong>» — «<strong>Диаграммы</strong>».</li>
<li>Откройте диаграмму <em>«Модель данных — Заказ автотранспорта».</em></li>
<li>Перетащите на диаграмму элемент «<strong>Новый шаблон записи</strong>» и создайте шаблон записи <em>«Статус заявки».</em></li>
<li>Выберите созданный шаблон <em>«Статус заявки»</em> и добавьте атрибут <em>«Название»</em> с установленным флажком <em>«</em><em>Использовать как заголовок записей</em><em>»</em>.</li>
<li>
<p>С помощью меню элемента перейдите на вкладку «<strong>Таблицы</strong>» шаблона <em>«Статус заявки».</em></p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Диаграмма модели данных — создание нового шаблона записи, добавление в него атрибута и переход к настройке таблиц" src="https://kb.comindware.ru/assets/img_6244771f73e47.png"/><figcaption class="caption">Диаграмма модели данных — создание нового шаблона записи, добавление в него атрибута и переход к настройке таблиц</figcaption></figure></p>
</li>
<li>
<p>Откройте конструктор таблицы «<strong>Все записи</strong>» и настройте отображение в ней только столбца <em>«Название».</em></p>
</li>
<li>
<p>Сохраните таблицу.</p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Настройка отображения справочника «Статус заявки»" src="https://kb.comindware.ru/assets/img_6311ee3a25a37.png"/><figcaption class="caption">Настройка отображения справочника «Статус заявки»</figcaption></figure></p>
</li>
<li>
<p>Откройте конструктор формы шаблона <em>«Статус заявки»</em> и настройте её так, чтобы она содержала поле <em>«Название».</em></p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Настройка формы «Статус заявки»" src="https://kb.comindware.ru/assets/img_6311ee9f0a26c.png"/><figcaption class="caption">Настройка формы «Статус заявки»</figcaption></figure></p>
</li>
<li>
<p>Перейдите к списку экземпляров шаблона <em>«Статус заявки»</em> и создайте записи со следующими названиями: <em>«Создана», «На рассмотрении», «Завершена», «Отклонена», «Выполняется».</em></p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Заполненный справочник «Статус заявки»" src="https://kb.comindware.ru/assets/img_6244792133664.png"/><figcaption class="caption">Заполненный справочник «Статус заявки»</figcaption></figure></p>
</li>
<li>
<p>Вернитесь к диаграмме модели данных и выберите шаблон <em>«Заявки на автомобили».</em></p>
</li>
<li>
<p>С помощью меню элемента создайте атрибут <em>«Статус»</em> типа «<strong>Запись</strong>», укажите <strong>связанный шаблон</strong> <em>«Статус заявки»</em>. Сохраните атрибут.</p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Представление связей на диаграмме модели данных" src="https://kb.comindware.ru/assets/img_62447a31402e8.png"/><figcaption class="caption">Представление связей на диаграмме модели данных</figcaption></figure></p>
</li>
</ol>
<p><strong>Теперь настроим автоматическое изменение статуса заявки…</strong></p>
<ol class="colored_numbers_list">
<li>Перейдите к диаграмме бизнес-процесса <em>«Заказ автотранспорта»</em> и нажмите кнопку «<strong>Редактировать</strong>».</li>
<li>Выберите начальное событие и с помощью меню элемента откройте «<strong>Сценарий на выходе</strong>».</li>
<li>
<p>Внутри действия «<strong>Сменить контекст</strong><em>»</em> нажмите кнопку «<strong>Изменить</strong>» в заголовке действия «<strong>Изменить значения атрибутов</strong>»,  <a class="mkdocs_imported_link" href="#Step6ChangeAttributeValues">созданного ранее</a>.</p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Переход к настройке действия «Изменить значения атрибутов»" src="https://kb.comindware.ru/assets/img_63ff0873b8edd.png"/><figcaption class="caption">Переход к настройке действия «Изменить значения атрибутов»</figcaption></figure></p>
</li>
<li>
<p>Создайте операцию «<strong>Заменить</strong>» с атрибутом <em>«Статус»</em>.</p>
</li>
<li>В столбце «<strong>Значение</strong>» выберите пункт «<strong>Формула</strong>».</li>
<li>Нажмите поле в столбце «<strong>Выражение</strong>». Отобразится компактный редактор формулы.</li>
<li>
<p>Введите формулу: <code>OBJECT("Управлениеавтопарком","Статусзаявки","Название","Создана")</code>. Нажмите кнопку с зеленым флажком.</p>
<p>Здесь:</p>
<ul>
<li><code>OBJECT()</code>— функция, возвращающая ID записи по указанному пути к ней.</li>
<li><code>Управлениеавтопарком</code>— системное имя приложения <em>«Управление автопарком».</em></li>
<li><code>Статусзаявки</code>— системное имя шаблона записи <em>«Статус заявки».</em></li>
<li><code>Название</code>— это системное имя атрибута <em>«Название»</em> в шаблоне записи <em>«Статус заявки».</em></li>
<li><code>Создана</code>— искомое значение атрибута <em>«Название»</em> в шаблоне записи <em>«Статус заявки».</em></li>
</ul>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Настройка операции изменения атрибута «Статус» при выходе из начального события" src="https://kb.comindware.ru/assets/img_6311f70a13643.png"/><figcaption class="caption">Настройка операции изменения атрибута «Статус» при выходе из начального события</figcaption></figure></p>
</li>
<li>
<p>Нажмите кнопку «<strong>Сохранить</strong>», чтобы сохранить действие  «<strong>Изменить значения атрибутов</strong>».</p>
</li>
<li>Вернитесь к диаграмме процесса, но не публикуйте её.</li>
<li>Теперь после создания заявки она получит статус <em>«Создана».</em></li>
</ol>
<p><strong>Аналогичным образом настройте автоматическое изменение статуса для других элементов процесса…</strong></p>
<p>Если диаграмма бизнес-процесса открыта не в режиме редактирования нажмите кнопку «<strong>Редактировать</strong>».</p>
<ol class="colored_numbers_list">
<li>Выберите задачу <em>«Рассмотреть заявку»</em> и с помощью меню элемента откройте «<strong>Сценарий на выходе</strong>».</li>
<li>Добавьте действие «<strong>Изменить значения атрибутов</strong>» внутри действия «<strong>Сменить контекст</strong>».</li>
<li>В действии «<strong>Изменить значения атрибутов</strong>» создайте операцию «<strong>Заменить</strong>» для атрибута «Статус» и формулой: <strong><code>OBJECT("Управлениеавтопарком","Статусзаявки","Название","На рассмотрении")</code>.</strong></li>
<li>Выберите задачу «Отменить поездку» и с помощью меню элемента откройте «<strong>Сценарий на входе</strong>».</li>
<li>Добавьте действие «<strong>Изменить значения атрибутов</strong>» внутри действия «<strong>Сменить контекст</strong>»   с операцией «  <strong><em>Заменить</em></strong>» для атрибута «Статус» и формулой: <strong><code>OBJECT("Управлениеавтопарком","Статусзаявки","Название","Отклонена")</code>.</strong></li>
<li>Выберите <strong>развилку «и»</strong> перед событиями <em>«Совершить поездку»</em> и <em>«Выполнить рейс»</em> и настройте для нее «<strong>Сценарий на выходе</strong>»: статус заявки должен принимать значение <em>«Выполняется».</em></li>
<li>Настройте «<strong>Сценарий на входе</strong>» для конечного события после выполнения рейса так, чтобы статус заявки принимал значение <em>«Завершена».</em></li>
<li>Опубликуйте диаграмму бизнес-процесса, чтобы изменения вступили в силу.</li>
</ol>
<h2 id="настройка-отображения-статуса-и-номера-заявки">Настройка отображения статуса и номера заявки</h2>
<p>Мы добавили новый атрибут <em>«Статус»,</em> теперь необходимо настроить его отображение в списке записей и на экранной форме…</p>
<ol class="colored_numbers_list">
<li>Перейдите на вкладку «<strong>Формы</strong>» шаблона записи <em>«Заявки на автомобили».</em></li>
<li>Откройте конструктор формы <em>«Заявки на автомобили — Основная форма».</em></li>
<li>Упорядочьте поля на форме с помощью столбцов.</li>
<li>Перетащите на форму поле <em>«Статус»</em> и укажите <strong>режим доступа</strong> « <strong>Только чтение</strong>».</li>
<li>
<p>Сохраните форму.</p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Добавление атрибута «Статус» на форму заявки на автомобиль" src="https://kb.comindware.ru/assets/img_6244b24153def.png"/><figcaption class="caption">Добавление атрибута «Статус» на форму заявки на автомобиль</figcaption></figure></p>
</li>
</ol>
<p>Настроим отображение реестра (шаблона записи) <em>«Заявки на автомобили»</em>…</p>
<ol class="colored_numbers_list">
<li>Перейдите на вкладку «<strong>Таблицы</strong>» шаблона «Заявки на автомобили» и добавьте в таблицу «<strong>Все записи</strong>» столбцы <em>«Номер заявки»</em> и <em>«Статус»</em>.</li>
<li>Сохраните таблицу.</li>
</ol>
<figure class="screenshot_with_caption">
<p><img alt="Добавление в таблицу столбцов с атрибутами шаблона записи" src="https://kb.comindware.ru/assets/img_6311f7d4466fd.png"/><figcaption class="caption">Добавление в таблицу столбцов с атрибутами шаблона записи</figcaption></p>
</figure>
<h2 id="тестирование-изменения-статуса-заявки">Тестирование изменения статуса заявки</h2>
<ol class="colored_numbers_list">
<li>Перейдите к списку экземпляров шаблона процесса <em>«Заказ автотранспорта»</em> и создайте новую заявку на автомобиль.</li>
<li>Перейдите в раздел «<strong>Мои задачи</strong>» и откройте форму задачи <em>«Заказ автотранспорта — Рассмотреть заявку»</em>. Поле <em>«Статус»</em> должно быть заполнено автоматически.</li>
</ol>
<figure class="screenshot_with_caption">
<p><img alt="Автоматическое заполненное с помощью справочника поле статуса заявки" src="https://kb.comindware.ru/assets/img_6311fa07dd4e7.png"/><figcaption class="caption">Автоматическое заполненное с помощью справочника поле статуса заявки</figcaption></p>
</figure>
<h2 id="настройка-заголовка-задачи">Настройка заголовка задачи</h2>
<p>По умолчанию заголовки задач недостаточно информативны — они содержат только названия процесса и задачи, но никакой конкретной информации по заявке:</p>
<figure class="screenshot_with_caption">
<p><img alt="Представление списка задач по умолчанию" src="https://kb.comindware.ru/assets/img_6244b8f8f059a.png"/><figcaption class="caption">Представление списка задач по умолчанию</figcaption></p>
</figure>
<p>Настроим заголовки задач, чтобы в списке задач отображались не названия процессов, а содержательная информация — маршрут и Ф. И. О. создателя.</p>
<ol class="colored_numbers_list">
<li>Перейдите к диаграмме бизнес-процесса и нажмите кнопку «<strong>Редактировать</strong>».</li>
<li>Выберите задачу <em>«Рассмотреть заявку».</em></li>
<li>
<p>В меню элемента нажмите кнопку «<strong>Свойства</strong>» <i class="fa-light fa-gear">&zwnj;<!--icon--></i>.</p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Переход к свойствам задачи с диаграммы бизнес-процесса" src="https://kb.comindware.ru/assets/img_6244b9fae6bf1.png"/><figcaption class="caption">Переход к свойствам задачи с диаграммы бизнес-процесса</figcaption></figure></p>
</li>
<li>
<p>В окне «<strong>Свойства пользовательской задачи</strong>» на вкладке «<strong>Дополнительные</strong>» выберите пункт «<strong>Формула</strong>» в поле «<strong>Заголовок задачи</strong>».</p>
</li>
<li>
<p>Введите формулу: <code>FORMAT("Рассмотреть заявку ({0} — {1})",LIST($Маршрут,$_creatorRef-&gt;fullName))</code>.</p>
<p>Здесь:</p>
<ul>
<li><code>$Маршрут</code> — системное имя атрибута <em>«Маршрут».</em></li>
<li><code>$_creatorRef-&gt;fullName</code> — имя пользователя, создавшего заявку.</li>
<li><code>$FORMAT</code> — функция, подставляющая в строку в первом параметре значения из последующих параметров.</li>
<li><code>$LIST</code>— функция, возвращающая массив значений атрибутов, указанных во входных параметрах.</li>
</ul>
</li>
<li>
<p>Нажмите кнопку «<strong>Сохранить</strong>».</p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Ввод выражения для вычисляемого заголовка задачи" src="https://kb.comindware.ru/assets/img_6475d2aaba009.png"/><figcaption class="caption">Ввод выражения для вычисляемого заголовка задачи</figcaption></figure></p>
</li>
<li>
<p>Аналогичным образом введите формулы для заголовков остальных задач процесса:</p>
<ul>
<li><code>FORMAT("Принять заявку ({0} — {1})",LIST($Маршрут,$_creatorRef-&gt;fullName))</code></li>
<li><code>FORMAT("Отменить поездку, заявка отклонена ({0} — {1})",LIST($Маршрут,$_creatorRef-&gt;fullName))</code></li>
<li><code>FORMAT("Выполнить рейс ({0} — {1})",LIST($Маршрут,$_creatorRef-&gt;fullName))</code></li>
<li><code>FORMAT("Совершить поездку, машина выделена ({0} — {1})",LIST($Маршрут,$_creatorRef-&gt;fullName))</code></li>
</ul>
</li>
<li>
<p>Опубликуйте диаграмму бизнес-процесса.</p>
</li>
</ol>
<h2 id="тестирование">Тестирование</h2>
<p>Посмотрим, как теперь задачи отображаются в списке…</p>
<ol class="colored_numbers_list">
<li>Перейдите к экземплярам шаблона процесса <em>«Заказ автотранспорта»</em> и запустите процесс, создав новую заявку на автомобиль и заполнив стартовую форму.</li>
<li>Перейдите в раздел «<strong>Мои задачи</strong>» и откройте задачу <em>«Рассмотреть заявку».</em> Теперь заголовок задачи в списке и в форме содержит название маршрута и Ф. И. О. создателя заявки:</li>
</ol>
<figure class="screenshot_with_caption">
<p><img alt="Сформированный с помощью выражения наглядный заголовок задачи" src="https://kb.comindware.ru/assets/img_631205abbb1d4.png"/><figcaption class="caption">Сформированный с помощью выражения наглядный заголовок задачи</figcaption></p>
</figure>
<figure class="screenshot_with_caption">
<p><img alt="Сформированный с помощью выражения наглядный заголовок задачи" src="https://kb.comindware.ru/assets/img_6312052ae43a9.png"/><figcaption class="caption">Сформированный с помощью выражения наглядный заголовок задачи</figcaption></p>
</figure>
<h2 id="результаты">Результаты</h2>
<p>Вы научились делать автоматические вычисления в ходе процесса.</p>
<p>В  <a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=4867">следующем уроке</a>  вы настроите пользователей, роли и права доступа для вашего бизнес-приложения.</p>
</article>
</div>
</div>
<a class="md-top md-icon mkdocs_imported_link" data-md-component="top" href="#">
<i class="fa-light fa-arrow-up">&zwnj;<!--icon--></i>
            К началу
          </a>
</main>
</div>
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": true, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></div>