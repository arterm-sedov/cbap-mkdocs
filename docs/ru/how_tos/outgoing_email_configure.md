---
title: Отправка эл. писем из процесса
tags:
  - настройка отправки эл. почты
  - электронные письма
  - отправка электронных писем
  - отправка писем из процесса
  - событие-отправка сообщения
  - промежуточное событие-отправка сообщения
  - конечное событие-отправка сообщения
  - процесс
  - уведомления эл. почтой
  - процессные уведомления
  - отправка эл. почты
  - подключение
  - путь передачи данных
hide:
  - tags
---

# Настройка отправки эл. писем с помощью события на диаграмме процесса

На диаграмме процесса можно использовать [промежуточные](send_message_intermediate_event.md) и [конечные](send_message_end_event.md) события отправки для отправки электронных писем с данными бизнес-процесса. Эти письма могут содержать произвольные бизнес-данные, в отличие от системных уведомлений о задачах.

## Порядок настройки отправки эл. почты

1. [Настройте подключение](#настройка-подключения-типа-отправка-эл-почты-из-процесса) типа «**Отправка эл. почты из процесса**».

2. [Настройте путь передачи данных](#настройка-пути-передачи-данных-типа-отправка-эл-почты-из-процесса) типа «**Отправка эл. почты из процесса**».

3. [Настройте событие-отправку сообщения](#настройка-события-отправки-сообщения) на диаграмме процесса.

## Настройка подключения типа «Отправка эл. почты из процесса»

1. На странице «**Администрирование**» — «**[Подключения][connections]**» создайте или откройте подключение типа «**Отправка эл. почты из процесса**».
2. Настройте свойства подключения:

      - **Отключить** — установите этот флажок, чтобы временно деактивировать подключение.
      - **Использовать по умолчанию** — установите этот флажок, чтобы использовать подключение для отправки системных уведомлений о задачах.
      - **Название** — введите наименование подключения.
      - **Протокол** — выберите протокол и параметры соединения с почтовым сервером:
        - **SMTP**
            - **Порт** — поле для ввода номера порта.
            - **Защита данных** — выберите протокол шифрования, который поддерживает почтовый сервер:
                - **Нет** — не использовать шифрование;
                - **SSL**;
                - **TLS**.
        - **Microsoft Exchange**
            - **Домен** — укажите домен для доступа к серверу Exchange.
            - **Версия** — выберите версию сервера Exchange.
      - **Адрес почтового сервера** — введите адрес почтового сервера.

        !!! Note "Примечание"
            Не указывайте протокол (`SMTP`, `HTTPS`, `HTTP`) в адресе почтового сервера.

      - **Имя пользователя** — введите имя пользователя для подключения к почтовому серверу.
      - **Пароль** — введите пароль для подключения к почтовому серверу.
      - **Адрес отправителя** — введите адрес, с которого будут отправляться письма.
      - **Имя отправителя** — введите имя, от которого будут отправляться письма.

        !!! Note "Примечание"
            Если **адрес** или **имя отправителя** не совпадает с адресом и именем, указанным в учётной записи, используемой для подключения к почтовому серверу, сервер должен поддерживать замену данных отправителя. В противном случае, почта не будет отправляться.

      - **Подтверждать адрес эл. почты** — установите этот флажок, чтобы почтовый сервер проверял существование адресов получателей эл. писем перед их отправкой. Почтовый сервер должен поддерживать данную функцию, в противном случае подключение не будет работать, если установлен этот флажок.

3. При необходимости проверьте соединение с сервером.

      - В разделе «**Тестовое соединение**» в поле «**Получатели**» введите адреса эл. почты через запятую.
      - Нажмите кнопку «**Отправить тестовое сообщение**».
      - Удостоверьтесь, что получателям пришло тестовое сообщение от настроенного отправителя.

4. Сохраните подключение.

    *![Свойства подключения для отправки эл. почты](outgoing_email_configure_connection.png)*

## Настройка пути передачи данных типа «Отправка эл. почты из процесса»

1. На странице «**Администрирование**» — «**[Пути передачи данных](communication_routes.md)**» создайте или откройте путь передачи данных типа «**Отправка эл. почты из процесса**».
2. Настройте свойства пути передачи данных.

      - **Основные свойства** — настройте параметры использования пути передачи данных.

          - **Отключить** — установите этот флажок, чтобы временно деактивировать путь передачи данных.
          - **Название** — введите наименование пути передачи данных.
          - **Подключение** — выберите подключение для отправки почты.
          - **Имя сообщения** — введите _уникальное_ наименование сообщения, проходящего по данному пути передачи данных.
          - **Приложение** — выберите приложение, в котором будет использоваться данный путь передачи данных.

      *![Основные свойства — путь передачи данных для отправки эл. почты из процесса](outgoing_email_configure.png)*

      - **Атрибуты сообщения** — настройте атрибуты, которые будут использоваться для передачи данных из процесса в эл.  письмо. Эти атрибуты необходимо будет указать на вкладке «**[Свойства сообщения](#message-properties)**» пути передачи данных, а также настроить на вкладке «**Данные сообщения**» в свойствах [события-отправки сообщения](#настройка-события-отправки-сообщения).
      {:#message-attributes}
          - Нажмите кнопку «**Создать**», чтобы добавить атрибут.
          - Введите наглядное **название** атрибута.
          - Введите **системное имя** атрибута, оно будет использоваться в шаблоне эл. письма на вкладке «**Свойства сообщения**».
          - Укажите **тип данных** атрибута в соответствии с данными, которые в него будут передаваться из процесса.
          - Чтобы удалить атрибут, установите рядом с ним флажок, и нажмите кнопку «**Удалить**».

      *![Атрибуты сообщения — путь передачи данных для отправки эл. почты из процесса](outgoing_email_configure_message_attributes.png)*

      - **Свойства сообщения** — настройте шаблон эл. письма с использованием атрибутов с вкладки «**Атрибуты сообщения**».
      {:#message-properties}
          - **Список атрибутов, которые можно использовать при написании эл. письма**, содержит атрибуты с вкладки «**[Атрибуты сообщения](#message-attributes)**».

            !!! Tip "Совет"
                * Чтобы поместить значение атрибута сообщения в эл. письмо, введите его системное имя в фигурных скобках `{ }` в соответствующее поле письма.
                * В текстовые поля письма (адреса и имена отправителей и получателей, тема, текст сообщения, место встречи) можно вводить произвольный текст и несколько **атрибутов сообщений**.
                * Например, в поле «**Тема**» можно ввести строку:
                  ```
                  Уведомление «{Title}» от {Date}
                  ```
                  Здесь: `{Title}` — атрибут сообщения, содержащий название уведомления, а `{Date}` — дата формирования уведомления.

          - **Электронное письмо** содержит шаблон, в поля которого можно ввести статические значения и системные имена **атрибутов сообщения**. В шаблоне эл. письма предусмотрены перечисленные ниже поля.
              - **Адрес отправителя** — в этом поле можно указать адрес эл. почты отправителя, отличный от адреса отправителя, указанного в [свойствах подключения](#настройка-подключения-типа-отправка-эл-почты-из-процесса). Если оставить это поле пустым, то будет использоваться адрес отправителя, указанный в свойствах подключения.
              - **Имя отправителя** — в этом поле можно указать имя отправителя, отличное от адреса отправителя, указанного в [свойствах подключения](#настройка-подключения-типа-отправка-эл-почты-из-процесса).
                  
                !!! Note "Примечание"
                    Если **адрес** или **имя отправителя** не совпадает с адресом и именем, указанным в учётной записи, используемой на [почтовом сервере для отправки почты](#настройка-подключения-типа-отправка-эл-почты-из-процесса), сервер должен поддерживать замену данных отправителя. В противном случае, почта не будет отправляться.

              - **Кому** — нажмите кнопку «**Создать**», чтобы добавить получателя письма.
                  - **Для пользователя** — выберите **атрибут сообщения** типа «**Аккаунт**» или аккаунт получателя письма. Если заполнено поле «**Для пользователя**», **адрес получателя** и **имя получателя** заполняются автоматически.
                  - **Адрес получателя** — введите адрес электронной почты или укажите **атрибут сообщения** типа «**Текст**», содержащий адрес эл. почты.
                  - **Имя получателя** — введите имя получателя или укажите **атрибут сообщения** типа «**Текст**», содержащий имя получателя.
                  - **Адрес для отправки копии**, **Адрес для отправки скрытой копии** — введите через точку с запятой адреса эл. почты получателей или укажите **атрибуты сообщения** типа «**Текст**», содержащие адреса эл. почты.
                  - **Имя для отправки копии**, **Имя для отправки скрытой копии** — введите через точку с запятой имена получателей или укажите **атрибуты сообщения** типа «**Текст**», содержащие имена получателей.
                  - **Тема** — введите тему письма или укажите **атрибут сообщения** типа «**Текст**», содержащий тему письма.
                  - **Формат сообщения** — выберите формат тела эл. письма:
                    - **Простой** — текст без форматирования (`Content-Type: text/plain`);
                    - **Размеченный** — текст с HTML-разметкой (`Content-Type: text/html`);
                    - **Простой и размеченный** — в тело письма будут включены и простой, и размеченный текст (`Content-Type: multipart/alternative`).
                  - **Сообщение** — введите текст письма или укажите **атрибут сообщения** типа «**Текст**», содержащий текст письма.
                  - **Прикрепленные файлы** — выберите **атрибут сообщения** типа «**Документ**», содержащий вложения в эл. письмо.
                  - **Отправлять встречу** — установите этот флажок, чтобы отправлять вместе с эл. письмом встречу Outlook.
                      - **Начало встречи** — выберите **атрибут сообщения** типа «**Дата и время**», содержащий дату и время начала встречи.
                      - **Окончание встречи** — выберите **атрибут сообщения** типа «**Дата и время**», содержащий дату и время окончания встречи.
                      - **Место встречи** — введите текст или укажите **атрибут сообщения** типа «**Текст**», содержащий название или, например, адрес места встречи.

      *![Свойства сообщения — путь передачи данных для отправки эл. почты из процесса](outgoing_email_configure_message_properties.png)*

3. Сохраните путь передачи данных.

## Настройка события-отправки сообщения

1. Поместите на диаграмму процесса [промежуточное](send_message_intermediate_event.md) или [конечное](send_message_end_event.md) событие-отправку сообщения.

    *![События отправки сообщения на диаграмме процесса](outgoing_email_configure_send_message_event.png)*

2. В [меню элемента][вызов-меню-элемента] события нажмите кнопку «**Свойства**» <i class="fa-light fa-gear"></i>.
3. На вкладке «**Основные**» настройте [общие свойства элемента](process_diagram_element_common_properties.md).
4. На вкладке «**Дополнительные**» выберите путь передачи данных.

      - В разделе «**Место назначения**» выберите пункт «**Внешний сокет**».
      - С помощью раскрывающегося списка «**Использовать путь передачи данных**» выберите или создайте **[путь передачи данных](#настройка-пути-передачи-данных-типа-отправка-эл-почты-из-процесса)** типа «**Отправка эл. почты из процесса**».

    *![Выбор пути передачи данных для события-отправки сообщения](outgoing_email_configure_send_message_event_advanced_properties.png)*

5. На вкладке «**Данные сообщения**» сопоставьте **[атрибуты сообщения](#message-attributes)** с атрибутами **[шаблона записи](record_templates.md)**, связанного с шаблоном процесса, к которому относится диаграмма.

      - В столбце **Значение** укажите атрибут такого же типа, как **атрибут сообщения**, либо формулу, возвращающую значение соответствующего типа.
      - Значения указанных атрибутов **шаблона записи** будут присвоены **атрибутам сообщения** и переданы в [эл. письмо](#message-properties).

    *![Сопоставление атрибутов сообщения из пути передачи данных с данными процесса](outgoing_email_configure_send_message_event_message_data.png)*

4. Опубликуйте процесс.

--8<-- "related_topics_heading.md"

**[Подключения][connections]**

**[Пути передачи данных](communication_routes.md)**

**[Диаграмма процесса][process_diagram_view]**

**[Промежуточное событие-отправка сообщения](send_message_intermediate_event.md)**

**[Конечное событие-отправка сообщения](send_message_end_event.md)**
