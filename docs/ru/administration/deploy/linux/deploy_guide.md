---
title: Установка, запуск, инициализация и остановка ПО
kbId: 2344
---

# Установка, запуск, инициализация и остановка ПО {: #deploy_guide_linux}

## Введение

Для работы **{{ productName }}** требуются операционная система, сервер базы данных, веб-сервер, обратный прокси-сервер и сервер журналов.

Для быстрого развёртывания **{{ productName }}** в Linux компания **{{ companyName }}** предоставляет дистрибутив с установщиком, настраивающим необходимое программное обеспечение. См. _[{{ productName }} {{ productVersion }}. Перечень стороннего программного обеспечения для Linux][auxiliary_software_list]_.

Здесь представлены инструкции по развёртыванию и инициализации **{{ productName }}** из дистрибутива в ОС Linux.

## Установка {{ productName }} {: #deploy_guide_linux_install_sw }

1. Перейдите в режим суперпользователя:

    --8<-- "linux_sudo.md"

2. Скачайте и распакуйте дистрибутив **{{ productName }}** по ссылке, предоставленной компанией **{{ companyName }}** (`X.X.XXXX.X` — номер версии ПО, `<osname>` — название операционной системы):

    ``` sh
    tar -xf X.X-release-ru-X.X.XXXX.X.<osname>.tar.gz
    ```

    По завершению распаковки архив можно удалить:

    ``` sh
    rm -f X.X-release-ru-X.X.XXXX.X.<osname>.tar.gz
    ```

3. Перейдите в распакованную папку:

    ``` sh
    cd CMW_<osname>/
    ```

4. Установите ПО из дистрибутива:
{: #install.sh}

    ``` sh
    sh install.sh -p [-k] [-i=<instanceName>] [-e] [-d=demo] [-u=www-data] [-g=www-data]
    ```

    Скрипт `install.sh` поддерживает следующие ключи:
    {: .pageBreakBefore }

    - `p` — установить ПО {{ productName }}.
    - `k` — установить ПО Kafka.
    - `e` — установить ПО Elasticsearch.
    - `d=demo` — создать экземпляр ПО {{ productName }} c демонстрационной базой данных (необязательный ключ).
    - `d=clear` — создать экземпляр ПО {{ productName }} без демонстрационной базы данных (необязательный ключ, демобаза по умолчанию не создаётся).
    - `h` — вызов краткой справки по использованию скрипта (указывать только без остальных ключей).
    - `kh=hostname` — использовать указанный хост для подключения к ПО Kafka (необязательный ключ).
    - `kp=portnumber` — использовать указанный порт для подключения к ПО Kafka (необязательный ключ).
    - `i` — создать экземпляр ПО с именем по умолчанию: `cmwdata` (необязательный ключ).
    - `i=<instanceName>` — создать экземпляр ПО с указанным именем.
    - `ip=<portNumber>` — порт для экземпляра ПО, по умолчанию: 80 (необязательный ключ).

    !!! tip "Вызов справки для скриптов"

        Для ознакомления с ключами и назначением любого скрипта используйте ключ `-h` без каких-либо других ключей, например:

        ``` sh
        sh install.sh -h
        ```

5. Если отобразится запрос на перезагрузку ОС, выполните перезагрузку:

    ``` sh
    reboot
    ```

    После перезагрузки ОС заново запустите [установку ПО из дистрибутива (шаг 4)](#install.sh).

6. Дождитесь завершения установки ПО.
7. После успешного завершения установки подождите 3–5 минут. Этого времени обычно достаточно для автоматического запуска и инициализации установленных служб (в зависимости от конфигурации машины).
8. Удостоверьтесь, что ПО установлено, просмотрев список установленных версий ПО:

    ``` sh
    ls /var/www/.cmw_version/
    ```

## Создание экземпляра ПО

1. Перейдите в режим суперпользователя:

    --8<-- "linux_sudo.md"

2. Перейдите в папку со скриптами для развёртывания ПО **{{ productName }}**:

    ``` sh
    cd <path>/CMW_<osname>/scripts/instance
    ```

    Здесь:  `<path>/CMW_<osname>/` — путь к распакованному дистрибутиву ПО.

3. Разверните экземпляр ПО:

    ``` sh
    sh create.sh -n=<instanceName> [-p=<portNumber>] -v=<versionNumber>
    ```

    Скрипт `create.sh` поддерживает следующие ключи:

    - `-n=<instanceName>` — имя экземпляра ПО (**обязательный** ключ).
    - `-p=<portNumber>` — порт для экземпляра ПО, по умолчанию: 80 (необязательный ключ).
    - `-v=<versionNumber>` — номер версии ПО вида `X.X.XXXX.X` (например: 4.7.2222.0). Версия должна быть установлена, см. _«[Установка {{ productName }}](#deploy_guide_linux_install_sw)»_.
    - `-h` — вызов краткой справки по использованию скрипта (указывать только без остальных ключей).

4. Удостоверьтесь, что была создана директория с файлами конфигурации экземпляра ПО.

    ``` sh
    ls -lhF /var/www/<instanceName>/
    ```

5. По ответ команды `ls` удостоверьтесь, что в путях указана верная версия ПО, например `4.7.3084.0`:

    ``` sh
    lrwxrwxrwx. 1 nginx nginx   36 Oct 11 17:54 bin -> /var/www/.cmw_version/4.7.3084.0/bin/
    lrwxrwxrwx. 1 nginx nginx   41 Oct 11 17:54 compiled -> /var/www/.cmw_version/4.7.3084.0/compiled/
    lrwxrwxrwx. 1 nginx nginx   37 Oct 11 17:54 data -> /var/www/.cmw_version/4.7.3084.0/data/
    lrwxrwxrwx. 1 nginx nginx   44 Oct 11 17:54 favicon.ico -> /var/www/.cmw_version/4.7.3084.0/favicon.ico
    lrwxrwxrwx. 1 nginx nginx   44 Oct 11 17:54 Global.asax -> /var/www/.cmw_version/4.7.3084.0/Global.asax
    lrwxrwxrwx. 1 nginx nginx   39 Oct 11 17:54 mobile -> /var/www/.cmw_version/4.7.3084.0/mobile/
    lrwxrwxrwx. 1 nginx nginx   46 Oct 11 17:54 redirect.aspx -> /var/www/.cmw_version/4.7.3084.0/redirect.aspx
    lrwxrwxrwx. 1 nginx nginx   42 Oct 11 17:54 resources -> /var/www/.cmw_version/4.7.3084.0/resources/
    lrwxrwxrwx. 1 nginx nginx   43 Oct 11 17:54 robots.txt -> /var/www/.cmw_version/4.7.3084.0/robots.txt
    lrwxrwxrwx. 1 nginx nginx   45 Oct 11 17:54 unauthorized -> /var/www/.cmw_version/4.7.3084.0/unauthorized/
    ```

## Установка дополнительного экземпляра ПО

**{{ productName }}** позволяет развернуть несколько экземпляров ПО на одном сервере. Чтобы развернуть дополнительный экземпляр ПО, воспользуйтесь следующими инструкциями:

1. Перейдите в режим суперпользователя:

    --8<-- "linux_sudo.md"

2. Просмотрите список созданных экземпляров ПО на сервере:

    ``` sh
    ls /var/lib/comindware/
    ```

3. Просмотрите список используемых портов:

    ``` sh
    ss -tunlp
    ```

    Вы также можете просмотреть, используется ли определённый порт:

    ``` sh
    ss -tunlp | grep :<portNumber>
    ```

4. Просмотрите список установленных версий ПО:

    ``` sh
    ls /var/www/.cmw_version/
    ```

5. Установите новый экземпляр ПО согласно [инструкциям](#создание-экземпляра-по), указав уникальное имя и порт для него.
6. Откройте для редактирования три службы каждого из установленных экземпляров ПО (`<instanceName>`):

    ``` sh
    nano /lib/systemd/system/comindware<instanceName>.service
    nano /lib/systemd/system/apigateway<instanceName>.service
    nano /lib/systemd/system/adapterhost<instanceName>.service
    ```

7. Если используются локальные службы Kafka и Elasticsearch, откройте их для редактирования:

    ``` sh
    nano /lib/systemd/system/kafka.service
    nano /lib/systemd/system/elasticsearch.service
    ```

8. В каждом файле службы установите следующие директивы:

    ``` cs
    # Макс. количество открытых файлов
    LimitNOFILE=200000
    # Макс. количество процессов
    LimitNPROC=8192
    ```

## Запуск экземпляра ПО

1. Перейдите в режим суперпользователя:

    --8<-- "linux_sudo.md"

2. Удостоверьтесь, что основные сервисы установлены, запущены и имеют статус `Active (running)`:

    ``` sh
    systemctl status comindware<instanceName>
    systemctl status kafka
    systemctl status nginx
    systemctl status elasticsearch
    ```

    Здесь `<instanceName>` — имя экземпляра ПО.

3. Если какой-либо сервис не работает, запустите его:

    ``` sh
    systemctl start comindware<instanceName>
    systemctl start kafka
    systemctl start nginx
    systemctl start elasticsearch
    ```

## Остановка экземпляра ПО {: .pageBreakBefore }

1. Перейдите в режим суперпользователя:

    --8<-- "linux_sudo.md"

2. Перед тем как выполнять любые действия с файлами ПО и базы данных, остановите службы, поддерживающие работу ПО:

    ``` sh
    systemctl stop comindware<instanceName>
    systemctl stop kafka
    systemctl stop nginx
    systemctl stop elasticsearch
    ```

3. Удостоверьтесь, что службы остановлены:

    ``` sh
    systemctl status comindware<instanceName>
    systemctl status kafka
    systemctl status nginx
    systemctl status elasticsearch
    ```

## Инициализация {{ productName }} {: #deploy_guide_linux_initialize}

1. Запустите веб-браузер и в адресной строке введите: `localhost`
2. Дождитесь запуска и отображения веб-сайта **{{ productName }}**, что может занять примерно 5 минут.
3. Откроется страница создания аккаунта администратора **{{ productName }}**.

    _![Страница создания аккаунта администратора](img/deploy_guide_admin_account_create.png)_

4. Введите учётные данные аккаунта администратора и нажмите кнопку «**Создать аккаунт**».

    !!! warning "Внимание!"

        - В экземпляре ПО всегда должен оставаться хотя бы один аккаунт администратора. Он может потребоваться для восстановления системы.
        - Аккаунт администратора, созданный при инициализации экземпляра ПО, не следует удалять, даже если впоследствии аккаунты будут синхронизироваться с Active Directory.

5. Если при установке продукта был указан ключ `-d=demo`, откроется страница инициализации системы.

    _![Страница инициализации системы](img/deploy_guide_system_initialize.png)_

6. Если при установке продукта был указан ключ `-d=clear` или этот ключ был опущен, откроется страница активации ПО.

    _![Страница активации продукта](img/deploy_guide_product_activate.png)_

7. Для первоначального ознакомления с ПО этап активации можно пропустить, нажав кнопку «**Пропустить**».
8. При необходимости откроется страница настройки подключения к службе Elasticsearch.

    _![Настройка подключения к Elasticsearch](img/deploy_guide_elasicsearch_connect.png)_

9. В поле «**URI**» введите адрес сервера Elasticsearch, например: `http://localhost:9200`
10. Оставьте **имя пользователя** и **пароль** Elasticsearch пустыми. Или введите их, если в конфигурации Elasticsearch включена аутентификация.
11. Установите уникальный **префикс индекса**. Он служит для идентификации в Elasticsearch данных экземпляра ПО. Поэтому во избежание конфликтов данных для каждого экземпляра ПО следует указывать собственный префикс индекса.
12. Нажмите кнопку «**Далее**».
13. При необходимости откроется страница инициализации данных в Elasticsearch.

    _![Страница инициализации данных в Elasticsearch](img/deploy_guide_elasticsearch_initialize.png)_

14. Нажмите кнопку «**Обновить**».
15. Дождитесь открытия начальной страницы **{{ productName }}**.

    _![Начальная страница {{ productName }}](img/deploy_guide_desktop.png)_

16. На этом этапе развертывание экземпляра **{{ productName }}** завершено и можно приступать к созданию и использованию бизнес-приложений.

## Удаление экземпляра ПО

1. Перейдите в режим суперпользователя:

    --8<-- "linux_sudo.md"

2. Остановите экземпляр ПО согласно [инструкции](#остановка-экземпляра-по).
3. Перейдите в папку со скриптами для развёртывания ПО **{{ productName }}**:

    ``` sh
    cd CMW_<osname>/scripts/instance
    ```

4. Запустите удаление экземпляра ПО:

    ``` sh
    sh delete.sh -n=<instanceName>
    ```

    Скрипт `delete.sh` поддерживает следующие ключи:

    - `-n=<instanceName>` — создать экземпляр ПО с указанным именем (**обязательный** ключ).
    - `-h` — вызов краткой справки по использованию скрипта (указывать только без остальных ключей).

## Удаление версии ПО

1. Перейдите в режим суперпользователя:

    --8<-- "linux_sudo.md"

2. Просмотрите список экземпляров ПО с указанием версии:

    ``` sh
    cat /usr/share/comindware/configs/instance/* | grep -e instanceName -e version
    ```

3. Удалите все экземпляры с версией ПО, которую требуется удалить, или обновите их до другой версии. Удалить версию ПО, которая используется в каких-либо экземплярах, не удастся. См. _«[Удаление экземпляра ПО](#удаление-экземпляра-по)»_.
4. Удалите версию ПО:

    ``` sh
    rm -r /var/www/.cmw_version/<versionNumber>
    ```

    Здесь: `<versionNumber>` — номер версии ПО вида `X.X.XXXX.X` (например: `4.7.2222.0`).

{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
