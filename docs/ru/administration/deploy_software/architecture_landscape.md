---
title: Развертывание {{ productName }}. Архитектура и ландшафт
kbId: 2085
---

# Развертывание {{ productName }}. Архитектура, ландшафт, программное и техническое обеспечение

## Введение

Продукт ****{{ productName }}**** представляет собой целостный программный комплекс на базе стека современных технологий.

В настоящем руководстве представлено краткое описание архитектуры ****{{ productName }}****, а также даны рекомендации по выбору ландшафта и конфигурации программного и аппаратного обеспечения для развертывания системы на основе ****{{ productName }}****.

## Определения

**Продукт** — программное обеспечение ****{{ productName }}****.

**Система** — развернутый программно-аппаратный комплекс на основе продукта ****{{ productName }}****.

**Сервер приложений** — установленный экземпляр продукта **{{ productName }}**.

**Приложение** — обособленное бизнес-решение, реализованное на сервере приложений.

**Активные пользователи** — пользователи, регулярно генерирующие данные на сервере приложений.

**DAS** — запоминающее устройство, непосредственно подключенное к серверу приложений.

**SAN** — сетевая система хранения (СХД, сеть хранения данных).

**IOPS** — количество операций ввода-вывода в секунду.

## 1. Архитектура Системы

В основе Системы лежит клиент-серверная компонентно-многослойная сервисно-ориентированная архитектура, расширяемая плагинами и адаптерами.

В состав Системы входят перечисленные ниже подсистемы.

- *Веб-приложение*: одностраничное приложение (SPA) на основе Marionette, Backbone, React, Redux.
- *Мобильное приложение*: React Native on Expo.
- *Бэкенд*: компоненты-сервисы на основе .NET 6.0, .NET Framework 4.8 (Windows), Mono 6.12 (Linux), JDK 17.
- *СУБД*: фирменная патентованная СУБД Comindware Elastic Data, с хранением данных в Apache Ignite.
- *Подсистема полнотекстового поиска*: Lucene.Net.
- *Подсистема сбора и анализа журналов транзакционных данных и данных мониторинга Системы*: Elasticsearch, Kibana.
- *Подсистема файловых журналов*: NLog.
- *Модули для интеграции*: см. раздел «[Интеграция с внешними системами](#mcetoc_1g7eann3f2)».

Полный перечень стороннего ПО, входящего в состав и необходимого для работы Системы, см. в статьях: [{{ productName }} 4.7. Перечень стороннего программного обеспечения для Linux](https://kb.comindware.ru/article.php?id=2398)   , [Перечень стороннего ПО для Windows](https://kb.comindware.ru/article.php?id=2092).

![Диаграмма архитектуры <strong>{{ productName }}</strong>](https://kb.comindware.ru/assets/Picture1.png)

Диаграмма архитектуры **{{ productName }}**

### 1.1. Безопасность и отказоустойчивость Системы

В Системе предусмотрены перечисленные ниже механизмы обеспечения безопасности и отказоустойчивости.

- Внешняя безопасность — реализуется за посредством:
	- механизма аутентификации пользователей Kerberos и OpenID;
	- сетевого экрана;
	- обратного прокси-сервера.
- Внутренняя безопасность — реализуется за посредством ролевой модели безопасности.
- Отказоустойчивость — реализуется посредством использованием резервных серверов и дополнительных узлов хранения и обработки данных;
- Масштабируемость — реализуется за счет увеличения количества серверов, обрабатывающих запросы.

### 1.2. Интеграция с внешними системами

В Системе предусмотрены перечисленные ниже механизмы интеграции с внешними системами.

- Git —контроль версий приложений, создаваемых с помощью Системы.
- OData — обмен данными с внешними системами посредством REST API.
- OpenLDAP (Active Directory) — аутентификация, управление аккаунтами и единый вход.
- SMTP/IMAP/Exchange — получение и отправка электронных писем.
- ESB (RabbitMQ / MSMQ) — обмен сообщениями с внешними системами в распределенных и федеративных конфигурациях.

 

## 2. Ландшафт развертывания Системы

Для обеспечения бесперебойной работы Систему необходимо развернуть в окружении, обеспечивающем достаточную производительность и отказоустойчивость.

Систему можно развернуть для доступа через интернет и интранет:

- *в минимальной конфигурации* — на одной виртуальной или физической машине заказчика.
- *в продуктовой конфигурации*— на мощностях заказчика в отказоустойчивой конфигурации в соответствии с требованиями заказчика.

### 2.1. Рекомендуемые варианты развертывания Системы

#### 2.1.1. Минимальная конфигурация

Ниже перечислены компоненты типовой минимальной конфигурации Системы, предназначенной для демонстраций и реализации пилотных проектов.

1. ***{{ productName }}***: установленный экземпляр Продукта.
2. *СУБД* *Comindware Elastic Data*.
3. *Сервер Elasticsearch* — в конфигурации с одним узлом.

![Минимальная конфигурация Системы](https://kb.comindware.ru/assets/Picture2_2.png)

Минимальная конфигурация Системы

#### 2.1.2. Продуктовая конфигурация

Ниже перечислены компоненты типовой продуктовой конфигурации, обеспечивающей дублирование и резервирование ресурсов, а также отказоустойчивость Системы.

1. ***{{ productName }}***: установленный экземпляр Продукта.
2. *СУБД Comindware Elastic Data*.
3. *Сервер Elasticsearc**h*.
4. *Обратный прокси-сервер**NGINX* для фильтрации нежелательных запросов и ретрансляции допустимых запросов во внутреннюю сеть.
5. *Сервер Zabbix* для мониторинга доступности служб и свободного пространства на дисках.
6. *Почтовый сервер (SMTP/IMAP)* (необязательно) для передачи уведомлений.
7. *Сервер LDAP* (необязательно) для централизованного управления инфраструктурой сети.
8. *Сервер Git* (необязательно) для контроля версий приложений, создаваемых с помощью **{{ productName }}**.

![Продуктовая конфигурация: ландшафт подсистем](https://kb.comindware.ru/assets/Picture3_3.png)

Продуктовая конфигурация: ландшафт подсистем

Продуктовое использование накладывает требования на следующие характеристики Системы:

- *безопасность* — реализуется за счет настройки сетевого экрана и обратного прокси-сервера;
- *отказоустойчивость* — реализуется за счет использования резервных серверов и дополнительных узлов на серверах, хранящих данные;
- *масштабируемость* — реализуется за счет добавления дополнительных серверов, обрабатывающих запросы.

![Типовой ландшафт сервисом в составе Системы](https://kb.comindware.ru/assets/Picture4_4.png)

Типовой ландшафт сервисов в составе Системы

### 2.2. Рекомендуемый набор серверов приложений

Для повышения эффективности разработки и тестирования приложений, а также отказоустойчивости и безопасности эксплуатации приложений рекомендуется развернуть несколько серверов приложений (необходимость использования каждого из этих серверов определяется при составлении технических требований):

1. *сервер разработки* (development), на котором осуществляется разработка приложений;
2. *сервер тестирования* (pre-production), на котором осуществляется тестирование приложений;
3. *основной сервер* (production), на котором осуществляется эксплуатация приложений;
4. *резервный сервер* (standby), который используется в случае перегрузки или выхода из строя основного сервера.

 

## 3. Техническое обеспечение Системы

В данной статье представлены рекомендуемые характеристики технического обеспечения для развёртывания Системы на мощностях заказчика под управлением операционной системы Windows или Linux.

### 3.1. Конфигурация серверов приложений

Сервер приложений размещается на физической или виртуальной машине, обеспечивая взаимодействие с пользователями, сторонними системами, ввод, обработку и хранение таких данных, как файлы базы данных, файлы конфигурации, загружаемые пользователями файлы, файлы журналов,  файлы резервных копий.

Следующие рекомендации позволят определить необходимую конфигурацию технического обеспечения для работы серверов приложений.

В минимальной конфигурации достаточно развернуть один сервер приложений для разработки, тестирования и эксплуатации приложений.

Приведенные ниже требования носят рекомендательный характер и позволяют обеспечить комфортную работу конечных пользователей, гражданских разработчиков и тестировщиков приложений **{{ productName }}**.

Фактические требования к техническому обеспечению могут значительно отличаться и зависят от следующих факторов:

- количества активных пользователей в Системе;
- количества приложений в Системе;
- количества запускаемых процессов;
- количества настроенных вычислений, правил, условий и зависимостей данных;
- объема хранимой информации и документов.

Подсистемы (см. раздел «[Конфигурация подсистем](#mcetoc_1g7ebvhdq0)») и виртуальные машины с Продуктом рекомендуется размещать на нескольких физических машинах.

Каналы связи между узлами Системы должны обеспечивать пропускную способность не менее 10 Гбит/с.

#### 3.1.2. Пример расчёта системных ресурсов отказоустойчивой системы

В таблице ниже представлена конфигурация системы для следующего количества пользователей:

- 500 зарегистрированных;
- 200 активных;
- 25 постоянных.

| **Имя сервера** | **Описание** | **Кол-во логи­­ческих ядер ЦП от 3,0 ГГц** | **ОЗУ, ГБ** | **Хранение данных** | | | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| **Раздел с ПО,**   **ГБ**   **SSD** | **База данных,**   **ГБ**   **Высоко­­надеж­­ный высоко­скорост­­ной SSD** | **Загру­­­жаемые файлы,**   **ГБ**   **СХД HDD** | **Жур­налы,**   **ГБ**   **HDD** | **Резерв­­ные копии,**   **ГБ**   **СХД HDD** |
| **Инфраструктурные сервисы** | | | | | | | | |
| Nginx reverse proxy1 | Обратный прокси (VPS) | 2 | 2 | 24 |  |  |  |  |
| Nginx reverse proxy2 | Обратный прокси (VPS) | 2 | 2 | 24 |  |  |  |  |
| Zabbix1 | Cистема монито­ринга и отслеживания (VPS) | 2 | 4 | 24 | 128 |  |  |  |
| Zabbix2 | Cистема мониторинга и отсле­живания (VPS) | 2 | 4 | 24 | 128 |  |  |  |
|  |  |  |  |  |  |  |  |  |
| **Продуктовый ландшафт** | | | | | | | | |
| CBAP-node1\* | Сервер прило­жений (VPS) | 8 | 32 | 64 | 128 | 1024 | 16 | 512 |
| CBAP-node2\* | Сервер прило­жений (VPS) | 8 | 32 | 64 | 128 | 16 |
| CBAP-node3\* | Сервер прило­жений (VPS) | 8 | 32 | 64 | 128 | 16 |
| Elasticsearch-node1\* | Сервер журналов Elasticsearch (VPS) | 4 | 16 | 24 | 128 |  | 16 | 512 |
| Elasticsearch-node2\* | Сервер журналов Elasticsearch (VPS) | 4 | 16 | 24 | 128 |  | 16 |
| Elasticsearch-node3\* | Сервер журналов Elasticsearch (VPS) | 4 | 16 | 24 | 128 |  | 16 |
| \* Виртуальные серверы одного сервиса должны быть размещены на разных физических серверах. | | | | | | | | |
| Скорость соединения между серверами должна быть не менее 10 Гб/с. | | | | | | | | |
|  | | | | | | | | |
| **Ландшафт тестирования и разработки** | | | | | | | | |
| git-server | GitLab | 2 | 4 | 24 | 128 |  |  |  |
| CBAP-test | Сервер прило­жений (VPS) | 8 | 24 | 64 | 128 | 32 | 16 | 128 |
| CBAP-dev | Сервер прило­жений (VPS) | 8 | 24 | 64 | 128 | 32 | 16 | 128 |
| Elasticsearch | Сервер журналов Elasticsearch (VPS) | 4 | 16 | 24 | 128 |  | 16 | 128 |
|  |  |  |  |  |  |  |  |  |
| **Сумма по типам ресурсов** | | **66** | **224** | **536** | **1536** | **1088** | **144** | **1408** |

#### 3.1.3. Минимальная конфигурация основного и резервного серверов приложений

| **Кол-во польз.** | **ЦП** | **ОЗУ** | **HDD** | **SSD** |
| --- | --- | --- | --- | --- |
| **Основной сервер приложений** | | | | |
| 1–200 активных | 4 ядра от 3,7 ГГц + (1 ядро × 100 акт. польз. × кол-во приложений) | 16 ГБ + (4 ГБ × 100 акт. польз. × кол-во приложений) | 16 ГБ | 16 ГБ |
| 200 активных | 4 ядра + (2 ядра × кол-во прил.) | 16 ГБ + (8 ГБ × кол-во прил.) | 16 ГБ × кол-во прил. | 16 ГБ × кол-во прил. |
| 300 активных | 4 ядра + (3 ядра × кол-во прил.) | 16 ГБ + (12 ГБ × кол-во прил.) | 16 ГБ × кол-во прил. | 16 ГБ × кол-во прил. |
| 400 активных | 4 ядра + (4 ядра × кол-во прил.) | 16 ГБ + (16 ГБ × кол-во прил.) | 16 ГБ × кол-во прил. | 16 ГБ × кол-во прил. |
| **Резервный сервер приложений** | | | | |
| 1­– 200 | 4 ядра от 3,7 ГГц + (1 ядро × 100 польз. × кол-во приложений) | 16 ГБ + (4 ГБ × 100 польз. × кол-во приложений) | 16 ГБ × кол-во прил. | 8 ГБ × кол-во прил. |
| 200 | 4 ядра + (2 ядра × кол-во прил.) | 16 ГБ + (8 ГБ × кол-во прил.) | 16 ГБ × кол-во прил. | 8 ГБ × кол-во прил. |
| 300 | 4 ядра + (3 ядра × кол-во прил.) | 16 ГБ + (12 ГБ × кол-во прил.) | 16 ГБ × кол-во прил. | 8 ГБ × кол-во прил. |
| 400 | 4 ядра + (4 ядра × кол-во прил.) | 16 ГБ + (16 ГБ × кол-во прил.) | 16 ГБ × кол-во прил. | 16 ГБ × кол-во прил. |

#### 3.1.4. Минимальная конфигурация серверов разработки и тестирования

| **Кол-во польз.** | **ЦП** | **ОЗУ** | **HDD** | **SSD** |
| --- | --- | --- | --- | --- |
| **Сервер разработки** | | | | |
| 1–100 | 4 ядра от 3,7 ГГц | 16 ГБ | 16 ГБ | 16 ГБ |
| **Сервер тестирования** | | | | |
| 1–100 | 4 ядра от 3,7 ГГц | 16 ГБ | 16 ГБ | 16 ГБ |

### 3.2. Конфигурация системы хранения данных

В минимальной конфигурации все папки данных сервера приложений могут храниться в одном разделе на высокопроизводительном SSD-накопителе.

Высокопроизводительные системы хранения (SSD DAS/SAN) должны обеспечивать производительность не меньше 100 000 IOPS на 1 сервер приложений.

Объем выделяемого пространства на высокопроизводительных (SSD DAS/SAN) и низкопроизводительных системах хранения (HDD DAS/SAN) следует определить в ходе составления технических требований.

Для оптимизации обработки, хранения и резервного копирования папки данных сервера приложений можно разместить в отдельных хранилищах:

- *файлы базы данных и конфигурации* — SSD DAS/SAN (эти данные сервер приложений обрабатывает постоянно в оперативном режиме, что создает высокую нагрузку на подсистему хранения);
- *загруженные пользователями файлы* — HDD DAS/SAN (такие файлы хранятся долговременно, не в базе данных и запрашиваются по ссылке, поэтому для их обработки и хранения высокопроизводительная подсистема хранения не требуется);
- *журнал Системы* — HDD DAS/SAN (запись файлов журнала создает минимальную нагрузку на подсистему хранения);
- *резервные копии* — HDD DAS/SAN (резервные копии формируются периодически, используются редко, для их хранения важнее объем, а не производительность хранилища; тем не менее, скорость резервного копирования может снижаться в случае наличия большого количества мелких файлов, загруженных пользователями, в таком случае можно разместить папку резервных копий на высокопроизводительном накопителе);
- *временная папка* — SSD DAS/SAN (нагрузка при хранении и обработке временных файлов может возрастать при большом количестве активных пользователей и транзакций, загрузке пользователями множества файлов и под влиянием прочих факторов).

## 4. Конфигурация подсистем

### 4.1. Конфигурация сервера Apache Ignite

Apache Ignite в минимально необходимой конфигурации устанавливается автоматически при развертывании **{{ productName }}**.

**Требования к конфигурации**

См. статью [Apache Ignite. Установка и настройка. Краткое руководство](https://kb.comindware.ru/article.php?id=2093).

**Примеры конфигураций**

См. статью [Apache Ignite. Установка и настройка. Краткое руководство](https://kb.comindware.ru/article.php?id=2093).

### 4.2. Конфигурация сервера Elasticsearch

Elasticsearch в минимально необходимой конфигурации устанавливается автоматически при развертывании **{{ productName }}**.

**Требования к конфигурации**

1. Должна быть включена аутентификация.
2. Должна быть разрешена работа под любым аккаунтом, кроме стандартного: elastic.
3. Номер порта должен отличаться от стандартного 9200.
4. В конфигурации должно быть задано достаточное количество шардов: минимум 3000.

**Примеры конфигураций**

1. Развертывание одного узла в Windows: см. статью [Установка Elasticsearch. Краткое руководство для Windows](https://kb.comindware.ru/article.php?id=2094).
2. Развертывание кластера в Linux: см. статью [Установка Elasticsearch и настройка кластера Elasticsearch без сертификатов подлинности](https://kb.comindware.ru/article.php?id=2095).

### 4.3. Конфигурация обратного прокси-сервера

NGINX в минимально необходимой конфигурации устанавливается автоматически при развертывании **{{ productName }}**.

**Требования к конфигурации**

1. сервер NGINX;
2. модуль ModSecurity;
3. модуль GeoIP.

**Примеры конфигураций**

1. Развертывание сервера NGINX: cм. статью [NGINX. Установка и настройка. Краткое руководство](https://kb.comindware.ru/article.php?id=2096).
2. Развертывание модуля GeoIP: см. статью [Модуль GeoIP для NGINX. Установка и настройка. Краткое руководство](https://kb.comindware.ru/article.php?id=2097).

### 4.4. Конфигурация сервера Zabbix

**Требования к конфигурации**

Конфигурация сервера Zabbix должна обеспечивать мониторинг работоспособности Системы, как указано ниже.

1. Мониторинг доступности сервера Apache Ignite
	1. Сервер может быть недоступен из-за проблем с сетью.
	2. На сервере может закончиться свободное место на диске.
	3. Конфигурация сервера может не позволять обработать запросы, например, ввиду невозможности создания нового индекса или соответствующего ему шарду.
2. Мониторинг доступности сервера Elasticsearch
	1. Сервер может быть недоступен из-за проблем с сетью.
	2. На сервере может закончиться свободное место на диске.
	3. Конфигурация сервера может не позволять обработать запросы, например, ввиду невозможности создания нового индекса или соответствующего ему шарда.
3. Мониторинг места на дисках с базой данных, журналами, резервными копиями и т. п.
4. Мониторинг ошибок в процессе работы Системы
	1. Ошибки конфигурации Системы.
	2. Ошибки в процессе эксплуатации Системы.
	3. Ошибки, связанные с обновлением окружения, в котором работает Система, или компонентов самой Системы.

**Примеры конфигураций**

См. статью [Zabbix. Установка и настройка. Краткое руководство](https://kb.comindware.ru/article.php?id=2098).



