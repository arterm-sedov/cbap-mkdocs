---
title:
kbId:
tags:
    - интеграции
    - интеграция
hide: tags
---

# Интеграции. С чего начать?

<!-- возможно, придумать простейший сквозной сценарий отправки и получения запросов, чтобы ссылаться на бизнес-сущности -->

<div class="admonition question" markdown="block">
## Определения {: .admonition-title #definitions}

**Интеграция** — это автоматизированный процесс взаимодействия **{{ productName }}** с внешними системами, направленный на двусторонний обмен данными и синхронизацию процессов. Реализуется через REST API, OData, адаптеры или пользовательские решения, что позволяет:

- Настраивать подключения и маршруты передачи данных.
- Использовать стандартные методы (GET, POST, PUT, DELETE) для управления данными.
- Применять готовые решения или разрабатывать специализированные сценарии.
- Определять роли систем и направление интеграции.

Интеграция обеспечивает гибкость за счёт поддержки разных форматов, преобразования данных и транзакционной обработки, что упрощает совместное использование функционала между системами.

</div>

<!-- Общая статья для понимания, как подступиться к интеграции, с чего начать. -->

1. Определить, какая система в какой момент передает данные.
2. Какие данные? 
3. Как сформировать запрос (рекомендации) если много данных, и если всего один параметр (если есть различия).
4. Упомянуть, что в продукте есть API.
5. Как протестировать сформированный запрос.
6. Настройка интеграции в системе.

Разъяснить варианты интеграций:
- подключение, путь передачи данных, сценарий; в том числе адаптеры, шины данных и прочее
- подключение, путь передачи данных, процесс;
- кастомные адаптеры, в том числе описать, что они позволяют интеграцию с проприетарными протоколами и аппаратными комплексами, например принтеры этикеток;
- интеграция по OData (сценарий не требуется, процесс не требуется, происходит полная синхронизация данных шаблонов по расписанию)
- интеграция по API docs и через слушающие подключения (принимаем запросы от других систем), пояснить, что если мы делаем листнер, то в пути передачи данных мы по сути проектируем новый интерфейс апи. Путь передачи данных - лоу-код-конструктор спецификации апи, сценарий или бизнес-процесс - реализация бизнес-логики апи, а подключение - реализация эндпоинта апи.

Разъяснить разницу возможностей и направления

## Типы API в {{ productName }}

<!-- постараться избежать дублирования информации из других статей, при необходимости заимствовать инклюдами, предпочтительно давать генерализованные формулировки и давать ссылки на статьи со специфичной информацией -->

**{{ productName }}** поддерживает методы **REST API**. Платформа может как получать, так и передавать любые данные в формате JSON или XML.

Чтобы посмотреть доступные методы для взаимодействия с платформой, введите URL в своём браузере:

```
http://your-host/docs
```

Здесь `your-host` — адрес сервера **{{ productName }}**.

См. также _«[Введение в API][api_intro]»_.

## Возможности интеграций

<!-- попросить БЯМ расширить -->

**{{ productName }}** предоставляет гибкие инструменты для автоматизации обмена данными с внешними системами. Вот ключевые возможности:

- Поддержка стандартных протоколов и форматов
- Готовые решения для популярных систем
- Гибкая настройка кастомных сценариев
- Направления интеграций (импорт, экспорт, двусторонняя синхронизация)
- Инструменты для разработки

При помощи интеграций можно передавать и получать различные данные:

- текстовые данные;
- числовые показатели;
- файлы различных форматов.

С помощью интеграций можно решить ряд бизнес-задач:

- обмен данными с системами;
- синхронизация данных;
- загрузка исторических данных.

Использование интеграций предоставляет преимущества:

- Минимизация ручного ввода данных.
- Снижение ошибок за счет автоматизации.
- Возможность масштабирования бизнес-процессов.

## Готовые интеграции

**{{ productName }}** позволяет настроить интеграцию с рядом внешних систем, в том числе:

<!-- дать ссылку на статью с полным перечнем, объединить два списка -->

- электронная почта
- HTTP-запросы
- «СФЕРА Курьер»
- СУБД
- 1С
- СберКорус
- Bitrix24
- Телфин
- Novofon
- OnlinePBX
- Megaplan
- Telegram
- SAP
- DocuSign
- Private Branch Exchange
- MS Dynamics
- MailChimp
- Unisender
- UiPath
- Viber

## Общий порядок настройки

<!-- уточнить порядок, разъяснить логику и причинно-следственную связь, но кратко -->

Чтобы настроить интеграцию, выполните следующие шаги:

<!-- определите, кто, куда и откуда и какие данные передает, см. наброски выше и ниже -->

1. Определите, какая система является отправителем данных, а какая получателем.

    !!! tip ""

        **{{ productName }}** может выступать в обеих ролях одновременно.

2. Определите структуру передаваемых данных для интеграции и отформатируйте для передачи в нужном формате.
3. Сопоставьте полученные данные со структурой данных в системе-получателе (проведите маппинг данных).
4. Создайте шаблон записи и атрибуты в нём в соответствии со структурой запроса.
5. Настройте интеграцию в приложении.
    - для OData:
        - настройте подключение тип «**Подключения REST и OData**» — «**Синхронизация с веб-сервисом**».
        - настройте подключение к OData на странице «**Интеграции**» <i class="fal  fa-sync-alt"></i> приложения.
    - для стандартных подключений:
        - настройте подключение необходимого типа.
        - настройте путь передачи данных необходимого типа.
        - настройте сценарий для обработки и преобразования данных в требуемый формат.
    - для пользовательских адаптеров:
        - добавьте адаптер в разделе «**Адаптеры**» <i class="fa-light fa-puzzle-piece-simple">‌</i>.
        - настройте пользовательское подключение для адаптера.
        - настройте пользовательский путь передачи данных для адаптера.
        - настройте сценарий для обработки и преобразования данных в требуемый формат.

!!! tip "Подключение и пути передачи данных"

    К одному подключению могут относиться несколько путей передачи данных.

## Примеры настроек интеграций

- Для работы с электронной почтой:
    - _[Отправка эл. почты из сценариев по SMTP/Exchange][scenario_send_email]_
    - _[Получение эл. почты с помощью сценариев через IMAP и Exchange][scenario_receive_email]_
    - _[Отправка почты из процесса][process_sending_connection]_
    - _[Получение эл. почты и веб-запросов в процессе][process_receiving_connection]_
- Для работы с HTTP-запросами:
    - _[HTTP-запросы типа GET. Отправка запроса и обработка ответа в формате JSON][http_send_example]_
    - _[HTTP-запросы. Получение JSON-данных в сценарии][http_receive_example]_
    - _[HTTP-запросы. Получение и обработка данных с помощью JSONPath][http_receive_jpath]_
    - _[HTTP-запросы типа POST. Отправка и получение ответа][http_send_post]_
    - _[HTTP-запросы типа POST. Отправка составного содержимого и файлов][http_send_file]_
    - _[HTTP-запросы с составным содержимым. Получение файлов в сценарии][http_receive_file]_
- Для работы с СУБД:
    - _[Внешняя СУБД (MySQL, MSSQL, Oracle, PostgreSQL). Отправка SQL-запроса. Настройка подключения, пути передачи данных и сценария][sql_send_connection]_
    - _[Внешняя СУБД (MySQL, MSSQL, Oracle, PostgreSQL). Получение данных по таймеру. Настройка подключения, пути передачи данных и сценария][sql_receive_connection]_
- Для работы с различными сервисами:
    - _[Синхронизация с веб-сервисом. Интеграция по OData][odata_integration]_
    - _[Интеграция с 1С по OData. Настройка для импорта данных][1c_integrations]_
    - _[Collabora Online. Настройка подключения][collabora_connection]_
    - _[Р7 Офис. Настройка сервера и подключения][r7_connection]_
    - _[Отправка запросов данных в «СФЕРА Курьер»][esphere_send_configure]_
    - _[Получение документов из «СФЕРА Курьер»][esphere_receive_configure]_
    - _[Отправка уведомлений с помощью Telegram-бота][telegram_send_notification]_

## Типичные проблемы

- Неправильно написана формула в сценарии;
- Отсутствие данных в запросе;
- Неправильно обозначено поле в адаптере (узнать достаточно проблематично);
- Отсутствие кода в справочнике;
- Неправильное заполнение данных (в поле число пытаемся записать строку);
- Неправильный маппинг;
- Неправильная структура сценария;
- Неправильные условия в сценарии;
- Неправильное сопоставление названий полей с атрибутами, в случае если в адаптере название полей не совпадает с названиями в XML.

# Какие данные?

Во время интеграции с comindware application platform существует возможность выгружать данные из существующих шаблон записи. Во время такой загрузки будут загружены все записи выбранного шаблона записи, а также соответствующие значения атрибутов ШЗ для данной записи.

# Формат передаваемых данных

Если система выступает в роли передатчика данных, то она может передавать существующие в ней данные в формате XML или JSON. Формат передаваемых данных можно выбрать на странице API платформы.

Если же система выступает в роли приемника данных, то запросы к API выполняются в формате JSON.

# Как сформировать запрос (рекомендации), если много данных и если один (есть ли различия)

<!-- вероятно, надо перенести в руководство по апи и в раздел про докс, но теорию оставить  -->

Для формирования запроса вам нужно перейти Comindware Business Application Platform API путем написания в поисковой строке браузера после вашего доменного имени /docs.

![](file:///C:/Users/emar/AppData/Local/Temp/msohtmlclip1/01/clip_image004.png)

Далее вам нужно выбрать Solution Api и в списке шаблонов записи выбрать вас интересующий. Стоить заметить, что все шаблоны здесь представлены по их системным именам, которые были прописаны либо автоматически, либо вручную, при создании шаблона записи. Теперь вы должны выбрать тип запроса, который будет выполнен к данному шаблону записи, выбирать можно только те запросы, которые не стоят вместе с префиксом id.

![](file:///C:/Users/emar/AppData/Local/Temp/msohtmlclip1/01/clip_image006.png)

Далее вам нужно будет нажать на кнопку «Try it out!». После нажатия данной кнопки вам станет доступно следующее окно:

![](file:///C:/Users/emar/AppData/Local/Temp/msohtmlclip1/01/clip_image008.png)

- _Curl_ - в данном поле представлен запрос curl, который вы можете написать в командной строке, если у вас установлен curl;
- _Request URL_ - в данном поле представлен URL, который вы можете скопировать и вставить в поисковую строку браузера, либо в excel, либо в power bi.

# Как протестировать сформированный запрос

<!-- привести примеры российских аналогов и работы с курл в общих чертах -->

Протестировать запросы вы можете с помощью программы Postman.

# Настройка интеграции в системе

<!-- повтор, объединить с параграфом выше -->

Если вы напишите в адресной строке вашего браузера после доменного имени вашего приложения «/docs», то вы попадете на страницу «Comindware Business Application Platform API».

Также вы можете сделать интеграцию какой-то системы в вашу систему «напрямую». Для этого вам нужно зайти в пункт бокового меню «Бизнес-приложения» и в списке бизнес-приложений выбрать то, где вы хотите сделать интеграцию.

<!-- это про одата, присоединить к статьям и разделам про одата, теория здесь, практика туда -->

В окне «Администрирование» вам нужно будет выбрать пункт «Интеграции».

![](file:///C:/Users/emar/AppData/Local/Temp/msohtmlclip1/01/clip_image010.png)

При нажатии этой кнопки вы перейдете на страницу интеграций, где вы сможете увидеть уже существующие, создать новые, а ещё и просмотреть журнал с работой существующих интеграций.

![](file:///C:/Users/emar/AppData/Local/Temp/msohtmlclip1/01/clip_image012.png)

Для создания новой интеграции вам нужно нажать «Создать», после нажатия которой у вас откроется окно создания и настройки новой интеграции:

![](file:///C:/Users/emar/AppData/Local/Temp/msohtmlclip1/01/clip_image014.png)

- _Название_ - здесь вы должны дать название для вашей новой интеграции;
- _Канал OData_ - в этом поле вы должны выбирать канал связи для связи с нужной вам системой;
- _Тип_ - Вы должны выбрать тип вашей интеграции. Вам предстоит выбрать из двух значений: «Импорт» и «Экспорт». Здесь вы выбираете, какая система будет являться «приемником», а какая «передатчиком»;
- _Запуска по расписанию_ - Если вы оставите в поле значение «Вручную», то взаимодействие систем будет происходить только по инициативе пользователя. Если же выбрать значение «По расписанию», то вы сможете настроить запуск интеграции автоматически.

**Документация по настройке интеграций с использованием кастомных адаптеров**
<!-- Привязать понятия к терминам и сущностям платформы, сторонние термины сохранить как часть определений и синонимы, сохранить информацию, но генерализовать, возможно, эту информацию надо перенести в статью про адаптеры, а здесь оставить генерализованное описание -->
<!-- теорию про кастомные адаптеры остаивть генерализованную часть, здесь только методика разработки с точки зрения бизнеса, а в статье про адаптеры с точки зрения разработки, соединить статьи перекрестными ссылками -->
## Оглавление

1. [Создание адаптера на основе vsdl](#_Toc173744313)
2. [Маппинг](#_Toc173744314)
3. [Настройка и проработка подключений](#_Toc173744315)
4. [Настройка триггера](#_Toc173744316)
5. [Тестирование](#_Toc173744317)
    - [Тестирование принятия](#_Toc173744318)
    - [Тестирование отправки](#_Toc173744319)
    - [Основные проблемы, которые могут возникнуть и их решение](#_Toc173744320)

# 1. Создание кастомных адаптера на основе vsdl

Описать, для чего нужны кастомные адаптеры, чтобы преобразовать данные к виду систем с нетипичными протоколами (нестандартные физические датчики, платы). Взять пример адаптера для qr-кодов у Солониченко для принтеров, сходить и попробовать. 

## 1.1. Устройство адаптера

Адаптер состоит из следующих блоков:

1. Блок сериализации и десериализации данных.
2. Блок описания модели данных и преобразование данной модели во внутреннюю модель адаптера. Структура модели данных должна совпадать с внутренней моделью адаптера, но может отличаться по названием полей.
3. Блок endpoint или методов адаптера. Данный блок необходим для распределения запросов между разными моделями данных, хранящихся в адаптере. В одном адаптере может быть описано более 1 модели (клиенты\договоры\продукты).
4. Блок служб, который отвечает за поднятие kestrel на порту, отправки сообщений, таймаутов и тд.

## 1.2. Процесс создания адаптера

1. Заказчик предоставляет структуру данных в стандартизированном формате или в виде таблицы.
2. На основе структуры модели данных, описанной в xsd или vsdl, генерируется классовая структура модели данных адаптера. Для этого используются парсеры и автогенераторы, например [https://json2csharp.com/code-converters/xml-to-csharp](https://json2csharp.com/code-converters/xml-to-csharp).
3. Программист, разрабатывающий адаптер, может модифицировать некоторые параметры модели данных, например изменять названия полей, делать преобразования данных (конвертировать строки в число) или даже изменять модель данных, которую он передает в свою систему (добавлять верхнеуровневые объекты и тд).

Кастомные адаптеры имеют целый ряд преимуществ:

- быстрота реализации;
- возможность обрабатывать и преобразовывать данные на уровне адаптера, видоизменять структуру данных;
- слитые адаптеры;
- отказоустойчивость.

Основным недостатком адаптеров является большее количество шагов для обновления, в случае внесения изменений.

# 2. Маппинг

1. Заказчик предоставляет пример запроса:  
```json
{
    "EntitytItems": [{
        "UniqueObjectCode": "8092374509234785",
        "Contract": "НТ-132-МН-493",
        "Status": 1,
        "UniqueCustomerCode": "8999000221",
        "StartDate": "2024-07-27T12:00:00+03:00",
        "EndDate": "2024-07-28T12:00:00+03:00",
        "Currency": "RUB",
        "CodeOrganization": "8829"
    }]
}
```
Для нас данный запрос не имеет никакой смысловой нагрузки. Не понятно, что означают эти поля, для чего они нужны и вообще нужны ли?  
Но, зная, что это за интеграция, и зная, какая сущность передается, мы можем понять, с чем сопоставлять данные поля.

К примеру, заказчик объяснил нам, что в запросе содержится информация о Договоре.

2. Далее необходимо узнать легенду каждого необходимого для нас поля. Заказчик сообщает, что ему необходимы следующие поля: EntitytItems, так как в этом массиве объекта хранятся все остальные поля, UniqueObjectCode, Contract, Status, UniqueCustomerCode, StartDate, EndDate, CodeOrganization, а Currency не нужен.

| Название поля      | Тип    | Описание           |
| ------------------ | ------ | ------------------ |
| UniqueObjectCode   | String | Код договора       |
| Contract           | String | Название контракта |
| Status             | Int    | Код статуса        |
| UniqueCustomerCode | String | Код юрлица         |
| StartDate          | Date   | Дата заключения    |
| EndDate            | Date   | Дата завершения    |
| CodeOrganization   | String | Код организации    |

3. Для корректной отработки запросов требуется запросить необходимые справочники (на практике они состоят из названий и кодов) и создать их в нашей системе.

4. После необходимо подготовить шаблон ответных данных нашего приложения или системы, например шаблон записи «Договоры» со следующими атрибутами:  

| Название поля    | Системное имя                       | Тип          | Описание           |
| ---------------- | ----------------------------------- | ------------ | ------------------ |
| Внешний id       | Contract_ExternalId                 | Текст        | Код договора       |
| Заголовок        | Contract_Title                      | Текст        | Название контракта |
| Статус           | Contract_Status                     | Запись       | Статус             |
| Юрлицо           | Contract_PartyInvolved_Legalentity  | Запись       | Юрлицо             |
| Дата регистрации | Contract_RegistrationDate           | Дата и время | Дата Регистрации   |
| Дата окончания   | Contract_EndDate                    | Дата и время | Дата завершения    |
| Организация      | Contract_PartyInvolved_Organisation | Запись       | Организация        |

<!-- начало настройки обычных хттп интеграций, здесь оставить генерализованное понятие с точки зрения бизнеса, практические инструкции перенести в отдельные статьи, соединить статьи перекрестными ссылками -->

# 3. Настройка и проработка подключений

## 3.1 Настройка подключения для отправки запросов

Для начала нужно создать подключение:

1. Переходим в «Администрирование»→«Подключения».
2. Нажимаем кнопку «Создать»→«Подключения REST и OData»→«Отправка HTTP-запросов».

![](file:///D:/Temp/msohtmlclip1/01/clip_image002.jpg)

3. Указываем следующие данные:
- Системное имя
- Описание
- Запись в файловые журналы: Полные сведения об обработке сообщения
- URI
- Так как запрос без аутентификации, оставляем остальные поля пустыми.

Настроим путь передачи данных:

1. Переходим «Администрирование»→Пути передачи данных».
2. Нажимаем кнопку «Создать»→«Подключения REST и OData»→«Отправка HTTP-запросов».

![](file:///D:/Temp/msohtmlclip1/01/clip_image004.jpg)

3. Настраиваем основные свойства:
- Выбираем ранее настроенное подключение.
- Указываем системное имя.
- Указываем описание пути передачи данных.

4. Настриваем «Атрибуты сообщений»:
- Запрос оставляем пустым, так как наш URI уже содержит в себе атрибуты для передачи.

![](file:///D:/Temp/msohtmlclip1/01/clip_image006.png)

- В ответе нам необходимо получить код статуса запроса, как при ответе с ошибкой, так и при корректном запросе. Получаем тип токена и сам токен.

![](file:///D:/Temp/msohtmlclip1/01/clip_image008.png)

<!-- собрать генерализованную статью по настройке подключений -->

5. Настриваем «Интеграцию»:
- Метод запроса – POST
- Шаблон пути запроса – здесь указывается переменная часть запроса.  
Если у нас есть несколько запросов, но один запрашивает, другой отправляет туда же, а третий удаляет, то мы можем создать одно подключение и несколько путей передачи данных, с разными наборами настроек.
- Атрибуты для сериализации в тело запроса – указываются атрибуты из таблицы «Запрос», которые находятся на верхнем уровне (сверните атрибуты, если есть вложенность и все, что будут видны), они должны указываться в данном поле, через запятую и без пробелов (также важны заглавные или строчные буквы).
- Укажите атрибуты для десериализации ответа без ошибки – здесь в хороших условиях просто указывается ‘$’, если совпадают атрибуты JSON и настроенные «Атрибуты сообщений». Если атрибуты отличаются, то можно воспользоваться JPath для соотношения атрибутов.
- Укажите атрибуты для десериализации ответа с ошибкой.

![](file:///D:/Temp/msohtmlclip1/01/clip_image010.png)

![](file:///D:/Temp/msohtmlclip1/01/clip_image012.png)

## 3.2 Настройка подключения для получения запросов

Для начала нужно создать подключение:

1. Переходим в «Администрирование»→«Подключения».
2. Нажимаем кнопку «Создать»→«Подключения REST и OData»→«Получение HTTP-запросов».
3. Указываем следующие данные:
- Системное имя
- Описание
- Запись в файловые журналы: Полные сведения об обработке сообщения
- URI
- Формат данных: JSON

Настроим путь передачи данных:

1. Переходим «Администрирование»→Пути передачи данных».
2. Нажимаем кнопку «Создать»→«Подключения REST и OData»→«Получение HTTP-запросов».
3. Настраиваем основные свойства:
- Выбираем ранее настроенное подключение.
- Указываем системное имя.
- Указываем описание пути передачи данных.

4. Настриваем «Атрибуты сообщений»:
- Запрос.
- Ответ.

5. Настриваем «Интеграцию»:
- Указываем путь URI
- Указываем атрибуты для десериализации данных

# 4. Настройка сценария

Сценарий для получения данных выглядит следующим образом:

![](file:///D:/Temp/msohtmlclip1/01/clip_image014.png)

Стартовым событием является получение сообщения, в котором указана переменная. На скриншоте данная переменная названа var:

![](file:///D:/Temp/msohtmlclip1/01/clip_image016.png)

В данной переменной содержатся все данные, которые нам приходят.

<!-- преобразовать в генерализованную бизнес-инструкцию -->

Проверка на уникальное значение.

- Формирование ключей, преобразовывание типов данных (по необходимости), написание формул и создание связных сущностей.
- Обновление данных.
- Дозаполнение сущностей в случае отсутствия. У договора нет клиента, записываем в тех атрибут. При создании клиента ищем договор у которого был не найден данный клиент.
- Транзакционная сущность. Формирование записей о полученных или отправленных запросах
- Когда использовать триггер, когда процесс.
- Преимущества триггера и процесса.

# 5. Тестирование

Тестирование бывает 2 видов:

- тестирование отправки;
- тестирование принятия.

ВНИМАНИЕ!

Перед тестированием следует обязательно проверить, включены ли подключения и пути передачи данных, которые указаны в стартовом событии.  

## 5.1. Тестирование принятия

<!-- описать контекст, почему упоминаются номера клиентов, генерализовать, оставив необходимую информацию -->

После отправки данных в нашу систему необходимо выполнить следующие шаги.

1. Открываем в администрировании Журналы событий→вкладка «Трассировка событий» и ставим фильтр по событию «Получен запрос». Сравниваем дату с текущим временем. Если будут строчки с вашим сценарием и будет указан шаблон записи «Договоры», значит, запрос получен.

Запрос не будет получен, если не работает ElasticSearch.

2. Переходим в Администрирование→Подключения и выбираем подключение, указанное в стартовом событии. Чтобы получить журнал событий, нажимаем кнопку «Скачать журнал».

![](file:///D:/Temp/msohtmlclip1/01/clip_image018.png)

3. В скачанном архиве открываем файл без тега error и спускаемся в самый конец файла.

![](file:///D:/Temp/msohtmlclip1/01/clip_image020.png)

4. Ищем строку после тега Result request.

![](file:///D:/Temp/msohtmlclip1/01/clip_image022.png)

5. Копируем данную строку, вставляем на сайте [https://jsonlint.com/](https://jsonlint.com/) и нажимаем кнопку «Validate Json».

![](file:///D:/Temp/msohtmlclip1/01/clip_image024.png)

Получаем удобочитаемую структуру наших данных:

![](file:///D:/Temp/msohtmlclip1/01/clip_image026.png)

Данную структуру можно скопировать себе отдельно в блокнот или смотреть через сайт.

6. Так как сценарий создает запись в договорах, необходимо открыть шаблон «Договоры» и найти новый экземпляр.

В случае если он не создался, дело может быть как в запросе, так и в выключенных подключениях и путях передачи данных. Перепроверяем стартовое событие и указанные там подключения. Если все выглядит правильно, обращаемся ко мне. Нужно будет отправить запрос заново.

7. Открываем созданную запись и открываем действие «Изменить значения атрибутов»:

![](file:///D:/Temp/msohtmlclip1/01/clip_image028.png)

![](file:///D:/Temp/msohtmlclip1/01/clip_image030.png)

Возможно, в журнале изменений отобразятся атрибуты, которые изменились, однако информация в нем может быть неточной. Например, атрибуты, которые являются числом, в журнале будут указаны измененными, но в самой записи их поля будут пустые. Такие атрибуты нужно выписывать и узнавать, какие типы данных они содержат.

К примеру, «Сумма без НДС» в запросе приходит как строка, в журнале изменений отображается, что атрибут заполнен, но на деле он хранил пустое значение. В данном случае, в триггере необходимо обернуть переменную в функцию DECIMAL(), которая конвертирует строку в число.

![](file:///D:/Temp/msohtmlclip1/01/clip_image032.png)

8. После того как будет получен список атрибутов, которые не заполнились, открываем образец запроса, который был получен в п.5.

9. Сравниваем, какие данные есть в запросе из тех, которые не проставились, и выписываем их. Если в запросе не оказалось данных, которые прописываются, их нужно выписать отдельно для дополнения запроса и полной отладки триггера.

10. Отладка атрибута типа запись требует дополнительных шагов:
- Проверяем, какой код указан в запросе.
- Заходим в шз «Договоры» и переходим в справочник, на который ссылается атрибут.
- Пытаемся найти в данном справочнике полученный код.
- Если такого кода нет или он другой формы, выписываем пример существующего кода или записываем, что он отсутствует, для дальнейшего запроса актуального справочника от заказчика. Также выписываем любой код, который можно подставить в запрос, для тестирования работы сценария.

11. В случае, если код есть и в справочнике, и в запросе, но он не проставился при добавлении записи, перепроверяем формулу в сценарии.

Возможные проблемы работы сценария, выявленные на данный момент:
- Неправильно написана формула в сценарии;
- Отсутствие данных в запросе;
- Неправильно обозначено поле в адаптере (узнать достаточно проблематично);
- Отсутствие кода в справочнике;
- Неправильное заполнение данных (в поле число пытаемся записать строку);
- Неправильный маппинг;
- Неправильная структура сценария;
- Неправильные условия в сценарии;
- Неправильное сопоставление названий полей с атрибутами, в случае если в адаптере название полей не совпадает с названиями в XML;
- Черная магия (любой лаг).

## 5.2. Тестирование отправки

Первичное тестирование заключается в сравнении данных которые мы пытаемся отправить и примером запроса.

1. Переходим в Администрирование→Подключения и выбираем подключение, указанное в стартовом событии. Чтобы получить журнал событий, нажимаем кнопку «Скачать журнал».

![](file:///D:/Temp/msohtmlclip1/01/clip_image033.png)

2. В скачанном архиве открываем файл без тега error и спускаемся в самый конец файла.

![](file:///D:/Temp/msohtmlclip1/01/clip_image034.png)

3. Ищем строку после тега Result request.

![](file:///D:/Temp/msohtmlclip1/01/clip_image035.png)

4. Копируем данную строку, вставляем на сайте [https://jsonlint.com/](https://jsonlint.com/) и нажимаем кнопку «Validate Json».

![](file:///D:/Temp/msohtmlclip1/01/clip_image036.png)

Получаем удобочитаемую структуру наших данных:

![](file:///D:/Temp/msohtmlclip1/01/clip_image037.png)

5. Данную структуру можно скопировать себе отдельно в блокнот или смотреть через сайт.

Скачиваем логи как в пункте 2 и сравниваем запрос с примером. Сопоставляем наши данные и которые в примере. В случае подозрительных значений уточняем либо мапинг либо формулы в триггере.

Вопросы или ситуации не описанные в данной документации будут дополнятся в документ после уточнения причины данного поведения.

## 5.3. Основные проблемы, которые могут возникнуть и их решение

1. Отключение клиентов или других интеграций. Заходим в пути передачи данных и выключаем конкретный путь. Ориентируемся по таблице Настройки всех интеграций. ![](file:///D:/Temp/msohtmlclip1/01/clip_image039.png)

2. Проверка интеграций после перезагрузки\обновления: Открываем подключения и ожидаем загрузки, если в колонке «Тип» есть пустые значения, значит они сломались. Пишем Гришину, что отвалились линки у подключений на адаптеры.

![](file:///D:/Temp/msohtmlclip1/01/clip_image041.png)

3. Проверка «Не пришел клиент»: смотрим журнал подключения, есть ли там данный клиент, ищем поиском его внешний id. Если такого нет, то просим отправить еще раз. Еще раз проверяем. Если он есть, но в транзакциях его нет, проверяем какой объем интеграций заходит, если они идут без конца, значит, он где-то в очереди. Иначе отправляем его сами в систему, как я объяснял.

4. Заливкой новых адаптеров лучше пусть занимается Максим, https://t.me/Napiform_Goose. Если срочно нужно, пишешь ему, он заливает. Предварительно тебе нужно во всех действиях сценария поставить заглушки. Одно подключение = 1 адаптер. Идем по табличке в каждое действие и меняем подключение и путь на заглушку. Далее удаляем пути и подключения по списку. Маякуем о том, что все готово для перезаливу адаптеров, Макс заливает, создаем подключение и необходимые пути и меняем в триггерах подключения и пути. Тестируем либо сами, либо при помощи Макса (отправляем запросы в CRM).

