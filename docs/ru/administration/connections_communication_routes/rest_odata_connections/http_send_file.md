---
title: Отправка запросов с составным содержимым с помощью HTTP-запросов типа POST
kbId:
tags:
hide:
    - tags
---

# Отправка запросов с составным содержимым с помощью HTTP-запросов типа POST {: #http_send_file}

## Введение

**{{ productName }}** позволяет отправлять HTTP-запросы типов `GET`, `POST`, `PUT`, `DELETE` для взаимодействия с внешними системами.

Здесь представлены настройки подключения, пути передачи данных, шаблона записи и сценария для отправки запросов типа `POST` с составным содержимым с помощью встроенного HTTP-адаптера.

## Настройка подключения

1. Откройте страницу «**Администрирование**» — «**Подключения**».
2. Откройте двойным нажатием или создайте «**Подключения REST и OData**» — «**Отправка HTTP-запросов**».
3. Настройте подключение к серверу:

    - **Системное имя** — введите уникальное имя подключения. Рекомендуются буквы латинского алфавита, цифры и символ «_».
    - **Отключить** — установите этот флажок, если требуется временно деактивировать данное подключение.
    - **Описание** — введите наглядное описание подключения.
    - **Запись в файловые журналы** — выберите, какие события следует записывать в журналы:
        - **Полные сведения об обработке сообщения**;
        - **Только ошибки**;
        - **Отключить** — не регистрировать в журнале события получения писем.
    - **URI** — укажите адрес сервера, на который будут отправляться запросы.
    - **Формат данных** — выберите формат **JSON** для отправки данных.
    - **Кодировка данных** — укажите формат кодировки. По умолчанию выбрана кодировка **utf-8**.
    - **Тип аутентификации** — выберите способ проверки подлинности, используемый сервером:
        - **Отсутствует**;
        - **Базовая**;
        - **Аутентификация Windows**.
    - **Имя пользователя** — укажите учётную запись для подключения к серверу.
    - **Пароль** — введите пароль к учётной записи для подключения к серверу.
    - **Домен** — укажите домен пользователя сервера.

4. Нажмите кнопку «**Проверить соединение**», чтобы проверить соединение с сервером.
5. При необходимости нажмите кнопку «**Скачать журнал**», чтобы просмотреть журнал событий получения писем.
6. Сохраните подключение.

## Настройка пути передачи данных

1. Откройте страницу «**Администрирование**» — «**Архитектура**» или страницу «**Администрирование**» приложения.
2. Выберите пункт «[**Пути передачи данных**][communication_routes]» <i class="fa-light fa-route " aria-hidden="true"></i>.
3. Откройте двойным нажатием в списке или создайте путь передачи данных типа «**Подключения REST и OData**» — «**Отправка HTTP-запросов**».
4. Настройте свойства пути передачи данных на следующих вкладках:

     - [**Основные свойства**](#основные-свойства)
     - [**Атрибуты сообщений**](#атрибуты-сообщений)
     - [**Интеграция**](#интеграция)

5. Сохраните путь передачи данных.

### Основные свойства

На вкладке «**Основные свойства**» настройте параметры использования пути передачи данных:

- **Подключение** — выберите [подключение для отправки HTTP-запросов](#настройка-подключения).
- **Системное имя** — введите уникальное имя пути передачи данных. Рекомендуются буквы латинского алфавита, цифры и символ «_».
- **Отключить** — установите этот флажок, если требуется временно деактивировать путь передачи данных.
- **Описание** — введите наглядное описание пути передачи данных, например _«Отправка вложений через HTTP»_.
- **Номер шины данных** — выберите номер от 0 до 3, если требуется распределить потоки данных нескольких путей для повышения производительности.

### Атрибуты сообщений

!!! warning "Составление атрибутов сообщения типа «Объект»"

    Чтобы составить атрибут сообщения типа «**Объект**», необходимо создать переменную с такой же структурой, как у атрибута сообщения, создав дочерние переменные:

    - Создайте переменную, оставив её значение пустым.
    - Установите флажок у имени родительской переменной в списке и нажмите кнопку «**Создать**».
    - Дважды нажмите значок <i class="fa-light fa-angle-down anchor"></i> рядом с родительской переменной.
    - В таблице отобразится дочерняя переменная.

1. Выберите тип сообщения «**Отправка HTTP-запросов с составным содержимым**».
2. В таблицу «**Запрос**» добавьте атрибут _File_ типа «**Объект**».
3. Добавьте дочерние атрибуты _Name_ и _Content_ типа «**Строка**».

### Интеграция

На вкладке «**Интеграция**» настройте дополнительные свойства пути передачи данных:

1. В **методе запроса** выберите «**POST**».
2. В поле «**Возвращаемый формат данных**» выберите формат данных для ответа.
3. В таблицу «**Атрибуты для формирования тела запроса (POST, PUT)**» добавьте атрибут _File_ с форматом данных «**Файловая структура**».

## Настройка шаблона записи

1. Создайте шаблон записи _«Реестр документов»_.
2. Создайте атрибут _«Вложения»_ типа «**Документ**» и установите флажок «**Хранить несколько значений**».
3. Создайте кнопку _«Отправить вложения»_ со следующими свойствами:

    - **Контекст операции: запись**
    - **Операция: вызвать событие «Нажата кнопка»**
    - **Результат выполнения: обновить данные**

4. Добавьте атрибут _«Вложения»_ и кнопку _«Отправить вложения»_ на форму.

## Настройка сценария

1. Создайте новый сценарий _«Отправка документов через HTTP»_.
2. В свойствах события «**Нажатие кнопки**» выберите **контекстный шаблон** _«Реестр документов»_ и **кнопку** _«Отправить вложения»_.
3. Добавьте действие «**Повторять по количеству объектов**» со следующими свойствами:

    - **Объект для поиска: атрибут** _«Вложения»_

4. Добавьте действие «**Проверить результат выражения**» внутрь действия «**Повторять по количеству объектов**» со следующими свойствами:

    - На вкладке «**Основные**»:
        - **Сообщение об ошибке:** _Ошибка отправки вложения_
        - **Выражение: N3**

            ``` turtle
            # Импортируем функции для работы с данными текущего сеанса и переменными
            @prefix document: <http://comindware.com/ontology/document#>.
            @prefix variable: <http://comindware.com/ontology/session/variable#>.
            @prefix operator: <http://comindware.com/ontology/session/operator#>.
            @prefix session: <http://comindware.com/ontology/session#>.

            {
                # Находим локальную переменную Doc и помещаем её в ?Doc
                session:context variable:Doc ?Doc.
                # Достаём из ?Doc содержимое файла в ?Content
                ?Doc document:content ?Content.
                # Достаём из ?Doc содержимое файла в ?Name
                ?Doc document:title ?Name.
            
                # Создаём локальную переменную Content и помещаем в неё ?Content
                variable:Content operator:replace ?Content.
                # Создаём локальную переменную Name и помещаем в неё ?Name
                variable:Name operator:replace ?Name.
                
                true -> ?value.
            }
            ```

    - На вкладке «**Дополнительно**»:
        - **Сбрасывать кэш значений:** флажок установлен

5. Добавьте действие «**Изменить значение переменных**» внутрь действия «**Повторять по количеству объектов**» со следующими свойствами:

    - На вкладке «**Основные**»:
        - **Операция со значениями переменных: заменить**
        - **Набор переменных:** _Message_
    - На вкладке «**Дополнительно**»:
        - **Сбрасывать кэш значений:** флажок установлен

6. В действии «**Изменить значение переменных**» внутрь действия «**Повторять по количеству объектов**» добавьте переменные:

    - На вкладке «**Основные**»:
        - _File_ — с дочерними переменными:
            - _Content_ — **значение: формула**

                ``` cs
                $$Content
                ```

            - _Name_ — **значение: формула**

                ``` cs
                $$Name
                ```

    - На вкладке «**Дополнительно**»:
        - **Сбрасывать кэш значений:** флажок установлен

7. Добавьте действие «**Отправить сообщение**» внутрь действия «**Повторять по количеству объектов**» со следующими свойствами:

    - На вкладке «**Основные**»:
        - **Подключение:** выберите [подключение для отправки документов по HTTP](#настройка-подключения).
        - **Путь передачи данных:** выберите [путь передачи данных для отправки документов по HTTP](#настройка-пути-передачи-данных).
        - **Переменная с сообщением:** _Message_
    - На вкладке «**Дополнительно**»:
        - **Сбрасывать кэш значений:** флажок установлен

8. Добавьте действие «**Проверить результат выражения**» внутрь действия «**Повторять по количеству объектов**» со следующими свойствами:

    - На вкладке «**Основные**»:
        - **Сообщение об ошибке:** _Ошибка очистки переменных_
        - **Выражение: N3**

            ``` turtle
            # Импортируем функции для работы с переменными
            @prefix var: <http://comindware.com/ontology/session/variable#>.
            @prefix operator: <http://comindware.com/ontology/session/operator#>.
            {
                # Очищаем локальную переменную Message
                var:Message operator:clear ?item.

                # Возвращаем значение true
                true -> ?value.
            }
            ```

    - На вкладке «**Дополнительно**»:
        - **Сбрасывать кэш значений:** флажок установлен

_![Сценарий отправки вложения с помощью HTTP-запросов](img/http_send_file_scenario.png)_

## Тестирование

1. Создайте запись в шаблоне _«Реестр документов»_.
2. Загрузите файлы в поле _«Вложения»_.
3. Сохраните запись.
4. Нажмите кнопку _«Отправить вложения»_.
5. На URL-адрес сервера, указанного в [подключении](#настройка-подключения), придут отправленные вложения.

--8<-- "related_topics_heading.md"
