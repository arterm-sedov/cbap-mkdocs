---
title: Обработка данных в формате JSONPath
kbId:
---

# Обработка данных с помощью JSONPath. Пример: настройка подключения, пути передачи данных и сценария для обработки запросов в формате JSON

## Введение

JSONPath — язык запросов к базам данных и информационно-поисковым системам для работы с данными в формате JSON. Аналогичен XPath для работы с данными в формате XML. **{{ productName }}** позволяет использовать данные языки для обработки полученных HTTP-запросов в соответствующем формате.

Здесь представлен пример настройки подключения, пути передачи данных и сценария для обработки запроса с помощью JSONPath и записи данных в атрибуты шаблона записи.

Настройка для обработки данных в формате XPath будет аналогичной.

## Прикладная задача

Имеется шаблон _«Реестр книг»_, в котором хранятся данные о книгах. Требуется настроить подключение, путь передачи данных и сценарий, с помощью которых обрабатываются сведения о поступлениях.

Данные о книгах приходят в формате JSON:

``` js
{
    "Date": "17.10.2024",
    "Book": [
        { "Author": "Толстой Л. Н.",
            "Title": "Война и мир",
            "Price": 895
        },
        { "Author": "Пушкин А. С.",
            "Title": "Капитанская дочка",
            "Price": 499
        },
        { "Author": "Лермонтов М. Ю.",
            "Title": "Мцыри",
            "Price": 372
        }
        ]
}
```

## Настройка подключения

1. Откройте раздел «**Администрирование**» — «**Подключения**».
2. В меню «**Создать**» выберите пункт «**Подключения REST и OData**» — «**Отправка HTTP-запросов**».
3. Настройте свойства подключения:

    - **Системное имя** — введите уникальное имя подключения.
    --8<-- "system_name_requirements.md:no_autofill"
    - **Отключить** — установите этот флажок, если требуется временно деактивировать данное подключение.
    - **Описание** — введите наглядное описание подключения, например _«Подключение для отправки HTTP-запросов»_.
    - **Запись в файловые журналы** — выберите, какие события следует записывать в журналы:
        - **Полные сведения об обработке сообщения**;
        - **Только ошибки**;
        - **Отключить** — не регистрировать в журнале события отправки писем.
    - **URI** — введите URL-адрес сервера, принимающего HTTP-запросы, например `http://example.com/api`. Символ `/` в конце URL не требуется.
    - **Формат данных** — выберите формат данных для обработки:
        - **JSON** — используется в данном примере;
        - **XML**;
        - **Простой текст**.
    - **Кодировка данных** — укажите стандарт кодирования символов. По умолчанию: **utf-8**.
    - **Тип аутентификации** — выберите способ проверки подлинности, используемый сервером:
        - **Отсутствует**;
        - **Базовая**;
        - **Аутентификация Windows**.
    - **Имя пользователя** — укажите учетную запись для подключения к серверу.
    - **Пароль** — введите пароль для подключения к серверу.
    - **Домен** — укажите домен пользователя почтового сервера.

4. Нажмите кнопку «**Проверить соединение**».
5. Чтобы просмотреть журнал событий отправки писем, нажмите кнопку «**Скачать журнал**».
6. Сохраните подключение.

## Настройка пути передачи данных

1. Откройте раздел «**Администрирование**» — «**Пути передачи данных**».
2. В меню «**Создать**» выберите пункт «**Подключения REST и OData**» — «**Отправка HTTP-запросов**».
3. Настройте путь передачи данных для отправки HTTP-запросов на вкладках «**Основные свойства**», «**Атрибуты сообщений**», «**Интеграция**».

### Основные свойства

На вкладке «**Основные свойства**» настройте параметры использования пути передачи данных.

- **Подключение** — выберите ранее созданное [подключение для отправки HTTP-запросов](#настройка-подключения).
- **Системное имя** — введите уникальное имя пути передачи данных.
--8<-- "system_name_requirements.md:no_autofill"
- **Отключить** — установите этот флажок, если требуется деактивировать путь передачи данных.
- **Описание** — введите наглядное описание назначения пути передачи данных.
- **Номер шины данных** — выберите номер от 0 до 3, если требуется распределить потоки данных нескольких путей для повышения производительности.

### Атрибуты сообщений

На вкладке «**Атрибуты сообщения**» настройте атрибуты, значения которых требуется извлечь из полученных данных в формате JSON.

!!! warning "Внимание"

    Для атрибутов сообщения типа «**Объект**» необходимо создать дочерние атрибуты:

    - Создайте родительский атрибут.
    - Установите флажок у имени родительского атрибута в списке и нажмите кнопку «**Создать**».
    - Дважды нажмите значок <i class="fa-light fa-angle-down anchor"></i> рядом с родительским атрибутом.
    - В таблице отобразится дочерний атрибут.

1. Укажите **тип сообщения** «**Отправка HTTP-запросов**».
2. В таблице «**Ответ**» добавьте атрибут _Book_ со следующими свойствами:

    - **Тип: объект**
    - **Массив:** флажок установлен

3. К атрибуту _Book_ добавьте следующие дочерние атрибуты:

    - _Author_ типа **строка**;
    - _Title_ типа **строка**;
    - _Price_ типа **число**.

### Интеграция

На вкладке «**Интеграция**» укажите атрибут **для десериализации ответа без ошибки**:

- **Путь к атрибуту:** _Book_
- **Выражение на языке запросов:**

    ``` js
    $.Book[*]
    ```

!!! tip "Обращение к данным с помощью JSONPath"

    Чтобы обратиться к определённым сегментам данных, полученных из JSON, требуется составить определённый вариант запроса с помощью JSONPath:

    - `$` — обращение ко всему JSON.
    - `.object` — обращение к сегменту `object`.
    - `[X, Y]` — обращение к определённым элементам сегмента, где `X` и `Y` номера элементов сегмента.
    - `[*]` — обращение ко всем элементам сегмента.

    Примеры запросов, составленных с помощью JSONPath, и возвращаемых значений:

    <table>
    <tbody>
    <tr markdown="block">
    <td markdown="block">**Запрос**</td>
    <td markdown="block">**Возвращаемое значение**</td>
    </tr>
    <tr markdown="block">
    <td markdown="block">
    ``` js
    $
    ```
    </td>
    <td markdown="block">
    ``` js
    {
    "Date": "17.10.2024",
    "Book": [
        { "Author": "Толстой Л. Н.",
            "Title": "Война и мир",
            "Price": 895
        },
        { "Author": "Пушкин А. С.",
            "Title": "Капитанская дочка",
            "Price": 499
        },
        { "Author": "Лермонтов М. Ю.",
            "Title": "Мцыри",
            "Price": 372
        }
        ]
    }
    ```
    </td>
    </tr>
    <tr markdown="block">
    <td markdown="block">
    ``` js
    $.Date
    ```
    </td>
    <td markdown="block">
    ``` js
    "17.10.2024"
    ```
    </td>
    </tr>
    <tr markdown="block">
    <td markdown="block">
    ``` js
    $.Book[0,2]
    ```
    </td>
    <td markdown="block">
    ``` js
    {
        "Author": "Толстой Л. Н.",
        "Title": "Война и мир",
        "Price": 895
    },
    {
        "Author": "Лермонтов М. Ю.",
        "Title": "Мцыри",
        "Price": 372
    }
    ```
    </td>
    </tr>
    <tr markdown="block">
    <td markdown="block">
    ``` js
    $.Book[1].Title
    ```
    </td>
    <td markdown="block">
    ``` js
    "Капитанская дочка"
    ```
    </td>
    </tr>
    </tbody>
    </table>

### Настройка шаблона записи

1. Создайте шаблон записи _«Реестр книг»_.
2. Создайте следующие атрибуты:

    - _«Автор»_ типа «**Текст**»;
    - _«Название»_ типа «**Текст**»;
    - _«Цена»_ типа «**Число**».

3. Добавьте кнопку _«Получить данные о книгах»_ со следующими свойствами:

    - **Контекст операции: запись**
    - **Операция: вызвать событие «Нажата кнопка»**
    - **Результат выполнения: обновить данные**

4. Поместите созданные атрибуты и кнопку на **основную форму**.

### Настройка сценария

1. Создайте сценарий _«Получение данных о книгах»_.
2. В свойствах события «**Нажатие кнопки**» выберите **контекстный шаблон** _«Реестр книг»_ и **кнопку** _«Получить данные о книгах»_.
3. Добавьте действие «**Отправить сообщение**» со следующими свойствами:

    - **Подключение:** выберите [подключение для отправки HTTP-запросов](#настройка-подключения).
    - **Путь передачи данных:** выберите [путь передачи данных для отправки HTTP-запросов](#настройка-пути-передачи-данных).
    - **Переменная для успешного ответа**: _Response_

4. Добавьте и настройте действие «**Повторять по количеству объектов**»:

    - **Переменная**: _Book_
    - **Атрибут или выражение для поиска объектов**: формула

        ``` cs
        $$Response->Book
        ```

5. Внутри действия «**Повторять по количеству объектов**» добавьте действие «**Создать запись**».
6. Внутри действия «**Создать запись**» добавьте действие «**Изменить значения атрибутов**».
7. В действии «**Изменить значения атрибутов**» на вкладке «**Дополнительно**» установите флажок «**Сбрасывать кэш значений**».
8. На вкладке «**Основные**» добавьте атрибуты, значения которых требуется изменить:

    | Атрибут    | Операция со значениями | Значение                      |
    | ---------- | ---------------------- | ----------------------------- |
    | _Автор_    | **Заменить**           | **Формула:** `$$Book->Author` |
    | _Название_ | **Заменить**           | **Формула:** `$$Book->Title`  |
    | _Цена_     | **Заменить**           | **Формула:** `$$Book->Price`  |

_![Сценарий обработки данных из запроса с помощью JSONPath](img/jpath_example_scenario.png)_

### Тестирование

1. Отправьте структуру JSON, которая указана в [прикладной задаче](#прикладная-задача).
2. Нажмите кнопку _«Получить данные о книгах»_.
3. В таблице записей шаблона _«Реестр книг»_ отобразятся новые записи.
4. Откройте новые записи и просмотрите полученные данные.

<div class="relatedTopics" markdown="block">

--8<-- "related_topics_heading.md"

- _[Отправка HTTP-запросов. Настройка подключения][send_http_connection]_
- _[Отправка HTTP-запросов типа GET. Пример: настройка подключения, пути передачи данных и сценария для обработки запросов в формате JSON][send_http_example]_
- _[Событие и действия сценария. Определения, типы, свойства, настройка][scenario_elements]_

</div>

{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
