---
title:
kbId:
---

# Использование JSONPath

## Введение

JSONPath — язык запросов к базам данных и информационно-поисковым системам для работы с данными в формате JSON. Аналогичен XPath для работы с данными в формате XML.

Здесь представлен пример настройки подключения, пути передачи данных и [сценария][scenarios] для обработки данных в формате JSONPath и записи данных из ответа сервера в атрибуты шаблона записи.

Настройка для обработки данных в формате XPath будет аналогичной.

## Прикладная задача

``` js
"book": [
      { "author": "Толстой Л. Н.",
        "title": "Война и мир",
        "price": 895
      },
      { "author": "Пушкин А. С.",
        "title": "Капитанская дочка",
        "price": 499
      }
    ]
```

## Настройка подключения

1. Откройте раздел «**Администрирование**» — «**Подключения**».
2. В меню «**Создать**» выберите пункт «**Подключения REST и OData**» — «**Отправка HTTP-запросов**».
3. 3. Настройте подключение для отправки HTTP-запросов со следующими параметрами:

    - **URI** — http://example.com/api. Символ `/` в конце URI не требуется.
    - **Формат данных** — **JSON**. Также поддерживаются **XML** и **простой текст**, но здесь рассматривается обработка данных в формате JSON.

4. Остальные параметры подключения настройте в соответствии с используемым сервером. См. статью «_[Отправка HTTP-запросов. Настройка подключения][send_http_connection]_».

## Настройка пути передачи данных

1. Откройте раздел «**Администрирование**» — «**Пути передачи данных**».
2. В меню «**Создать**» выберите пункт «**Подключения REST и OData**» — «**Отправка HTTP-запросов**».
3. Настройте путь передачи данных для отправки HTTP-запросов на вкладках «**Основные свойства**», «**Атрибуты сообщений**», «**Интеграция**».

### Основные свойства

- **Подключение** — выберите ранее созданное [подключение для отправки HTTP-запросов](#настройка-подключения).
- **Системное имя** — введите системное имя пути передачи данных латинскими буквами.
- **Отключить** — установите этот флажок, если требуется деактивировать путь передачи данных.
- **Описание** — введите наглядное описание назначения пути передачи данных.

### Атрибуты сообщений

На вкладке «**Атрибуты сообщения**» настройте атрибуты, значения которых требуется десерилиазовать.

!!! warning "Внимание"

    Для атрибутов сообщения типа «**Объект**» необходимо создать родительски атрибут с дочерними:

    - Создайте родительский атрибут.
    - Установите флажок у имени родительского атрибута в списке и нажмите кнопку «**Создать**».
    - Дважды нажмите значок <i class="fa-light fa-angle-down anchor"></i> рядом с родительским атрибутом.
    - В таблице отобразится дочерний атрибут.

1. Укажите **тип сообщения** «**Отправка HTTP-запросов**».
2. В таблице «**Ответ**» добавьте атрибут _Book_ со следующими свойствами:

    - **Тип: объект**
    - **Массив:** флажок установлен

3. К атрибуту _Book_ добавьте следующие дочерние атрибуты:

    - _Author_ типа **строка**;
    - _Title_ типа **строка**;
    - _Price_ типа **число**.

### Интеграция

На вкладке «**Интеграция**» укажите атрибуты для десериализации ответа без ошибки:

- Путь к атрибуту: Book
- Выражение на языке запросов:

    ``` js
    $.[X, Y]
    ```

    где:

    - `X` — первый элемент массива для десериализации.
    - `Y` — последний элемент массива для десериализации.

!!! note "Примечание"

    Чтобы десериализовать все элементы массива, вставьте следующее выражение:

    ``` js
    $.[*]
    ```

### Настройка шаблона записи

1. Создайте шаблон записи _«Реестр книг»_.
2. Создайте следующие атрибуты:

    - _«Автор»_ типа «**Текст**»;
    - _«Название»_ типа «**Текст**»;
    - _«Цена»_ типа «**Число**».

3. Добавьте кнопку _«Получить данные о книгах»_ со следующими свойствами:

    - **Контекст операции: запись**
    - **Операция: вызвать событие «Нажата кнопка»**
    - **Результат выполнения: обновить данные**

4. Поместите атрибуты и кнопку на **основную форму**.

### Настройка сценария

1. Создайте сценарий _«Отправка писем»_.
2. В свойствах события «**Нажатие кнопки**» выберите **контекстный шаблон** _«Реестр книг»_ и **кнопку** _«Получить данные о книгах»_.
3. Создайте действие «**Отправить сообщение**» со следующими свойствами:

    - **Подключение:** выберите [подключение для отправки HTTP-запросов](#настройка-подключения).
    - **Путь передачи данных:** выберите [путь передачи данных для отправки HTTP-запросов](#настройка-пути-передачи-данных).
    - **Переменная для успешного ответа** — введите системное имя переменной, в которую будет помещён ответ сервера на HTTP-запрос, эта переменная будет использоваться в последующем действии «**Повторять по количеству объектов**».
    - **Переменная для ответа с ошибкой** — введите системное имя переменной, в которую будет помещён ответ сервера в случае ошибки.

4. Добавьте и настройте действие «**Повторять по количеству объектов**»:

    - **Переменная** — введите имя переменной, в которую будут помещены объекты, полученные из ответа на HTTP-запрос. Эта переменная будет использоваться для обращения к объектам в ответе от сервера в последующем действии «**Изменить значения атрибутов**».
    - **Атрибут или выражение для поиска объектов** — введите **формулу** вида `$$response->orders`, где `response` — имя **переменной для успешного ответа**, указанное в свойствах действия «**Отправить сообщение**», `orders` — системное имя атрибута **ответа**, указанное на вкладке «[**Атрибуты сообщений**](#атрибуты-сообщений)» в свойствах пути передачи данных.

6. Внутри действия «**Повторять по количеству объектов**» добавьте и настройте действие «**Изменить значения атрибутов**».

    - В таблице атрибутов добавьте атрибуты, значения которых следует заполнить из полученного ответа от сервера.
    - В столбце «**Значение**» для каждого атрибута введите **формулу** вида `$$loopiterator->objectName`, где `loopiterator` — имя **

### Тестирование

1. Отправьте структуру JSONPath, как указано в [прикладной задаче](#прикладная-задача).
2. Нажмите кнопку.
3. В экземплярах шаблона отобразятся новые записи.
4. Откройте новые записи.
5. Отобразятся данные.