---
kbId:
title: Отправка HTTP-запросов типа POST
---

# Отправка HTTP-запросов типа POST. Пример: настройка подключения, пути передачи данных и сценария для отправки запросов {: #http_send_post}

## Введение

**{{ productName }}** позволяет отправлять HTTP-запросы типов `POST` для взаимодействия с внешними системами.

Здесь представлен пример настройки подключения, пути передачи данных и [сценария][scenarios] для отправки HTTP-запросов типа `POST` и записи данных из ответа сервера в атрибуты шаблона записи.

## Прикладная задача

Имеется шаблон _«Контакты клиентов»_. Требуется настроить кнопку, которая будет обновлять данные на сервере при их изменении в записях шаблона.

## Настройка подключения

1. На странице **Администрирование**» выберите пункт «**Инфраструктура**» — «**Подключения**».
2. Откройте двойным нажатием или создайте подключение типа «**Подключения REST и OData**» — «**Отправка HTTP-запросов**».
3. Настройте подключение к серверу:

    - **Системное имя** — введите уникальное имя подключения.
    --8<-- "system_name_requirements.md:no_autofill"
    - **Отключить** — установите этот флажок, если требуется временно деактивировать данное подключение.
    - **Описание** — введите наглядное описание подключения, например _«Подключение для отправки запросов по HTTP»_.
    - **Запись в файловые журналы** — выберите, какие события следует записывать в журналы:
        - **Полные сведения об обработке сообщения**;
        - **Только ошибки**;
        - **Отключить** — не регистрировать в журнале события отправки запросов.
    - **URI** — укажите адрес сервера, на который будут отправляться запросы.
    - **Формат данных** — выберите **JSON**.
    - **Кодировка данных** — укажите формат кодировки данных, используемый сервером, по умолчанию: **UTF-8**.
    - **Тип аутентификации** — выберите способ проверки подлинности, используемый сервером:
        - **Отсутствует**;
        - **Базовая**;
        - **Аутентификация Windows**.
    - **Имя пользователя** — укажите учётную запись для подключения к серверу.
    - **Пароль** — введите пароль к учётной записи для подключения к серверу.
    - **Домен** — укажите домен пользователя сервера.

4. Проверьте соединение с сервером, нажав соответствующую кнопку.
5. При необходимости нажмите кнопку «**Скачать журнал**», чтобы просмотреть журнал событий получения запросов.
6. Сохраните подключение.

## Настройка пути передачи данных

1. На странице «**Администрирование**» в разделе «**Архитектура**» выберите пункт «[**Пути передачи данных**][communication_routes]» <i class="fa-light fa-route " aria-hidden="true"></i>.
2. Откройте двойным нажатием в списке или создайте путь передачи данных типа «**Подключения REST и OData**» — «**Отправка HTTP-запросов**».
3. Настройте свойства пути передачи данных на следующих вкладках:

    - [**Основные свойства**](#основные-свойства)
    - [**Атрибуты сообщений**](#атрибуты-сообщений)
    - [**Интеграция**](#интеграция)

4. Сохраните путь передачи данных.

### Основные свойства

На вкладке «**Основные свойства**» настройте параметры использования пути передачи данных:

- **Подключение** — выберите [подключение для отправки HTTP-запросов](#настройка-подключения).
- **Системное имя** — введите уникальное имя пути передачи данных.
--8<-- "system_name_requirements.md:no_autofill"
- **Отключить** — установите этот флажок, если требуется временно деактивировать путь передачи данных.
- **Описание** — введите наглядное описание пути передачи данных, например _«Путь передачи данных для отправки файлов по HTTP»_.
- **Номер шины данных** — выберите номер от 0 до 3, если требуется распределить потоки данных нескольких путей для повышения производительности.

### Атрибуты сообщения

!!! warning "Составление атрибута сообщения типа «Объект»"

    Чтобы составить **атрибут сообщения** типа «**Объект**» для хранения имени и содержимого файла, необходимо создать структуру из родительского и дочерних атрибутов:

      - Создайте атрибут типа «**Объект**», задайте его имя, но оставьте значение пустым.
      - Установите флажок у имени родительского атрибута в таблице и нажмите кнопку «**Создать**».
      - Дважды нажмите значок <i class="fa-light fa-angle-down anchor"></i> рядом с родительским атрибутом.
      - В таблице отобразится строка дочернего атрибута.
      - Задайте системное имя и тип дочернего атрибута.

1. Выберите тип сообщения «**Отправка HTTP-запросов**».
2. В таблицу «**Запрос**» добавьте атрибут типа «**Строка**», например _ID_.
3. В таблицу «**Запрос**» добавьте атрибут типа «**Объект**», например _Contact_.
4. Добавьте дочерние атрибуты типа «**Строка**», например _Fullname_ и _PhoneNumber_.
5. В таблицу «**Ответ**» добавьте атрибут типа «**Логический**», например _Success_.

### Интеграция

 1. Выберите **метод запроса POST**.
 2. В поле «**Атрибуты для сериализации в тело запроса**» укажите _ID, Contact_.
 3. Заполните таблицы «**Укажите атрибуты для десериализации ответа без ошибки**» и «**Укажите атрибуты для десериализации ответа с ошибкой**»:

    - **Путь к атрибуту:** _$_
    - **Выражение на языке запросов:** _$_

## Настройка шаблона записи

1. Создайте шаблон _«Контакты клиентов»_.
2. Создайте следующие атрибуты:

    | Название | Системное имя | Тип |
    |---|---|---|
    | _ID_ | _ID_ | **Текст** |
    | _Ф. И. О._ | _Fullname_ | **Текст** |
    | _Телефон_ | _PhoneNumber_ | **Текст** |
    | _Данные обновлены_ | _DataUpdated_ | **Логический** |

3. Создайте кнопку _«Отправить контакт на сервер»_ со следующими свойствами:

    - **Контекст операции: запись**
    - **Операция: вызвать событие «Нажата кнопка»**
    - **Результат выполнения: обновить данные**

4. Поместите атрибуты _«ID»_, _«Ф. И. О.»_, _«Телефон»_, _«Данные обновлены»_ и кнопку _«Отправить контакт на сервер»_ на форму.

## Настройка сценария

1. Создайте сценарий _«Отправка контактов на сервер»_.
2. В свойствах события «**Нажатие кнопки**» выберите **контекстный шаблон** _«Контакты клиентов»_ и **кнопку** _«Отправить контакт на сервер»_.
3. Добавьте действие «**Изменить значение переменных**» со следующими свойствами:

    - **Операция со значениями переменных: заменить**
    - **Набор переменных:** _Message_

4. В свойствах действия «**Изменить значения переменных**» настройте перечисленные ниже переменные.

    !!! warning "Сопоставление переменных-объектов с атрибутами сообщения"

        Имена переменных, значения которых передаются в [**атрибуты сообщения**](#атрибуты-сообщения) с помощью действия сценария «**Отправить сообщение**», должны совпадать с системными именами атрибутов сообщения.

        Для передачи значения переменной в атрибут сообщения типа «**Объект**», необходимо создать переменную с такой же структурой, как у атрибута сообщения, создав дочерние переменные:

        - Создайте переменную, оставив её значение пустым.
        - Установите флажок у имени родительской переменной в списке и нажмите кнопку «**Создать**».
        - Дважды нажмите значок <i class="fa-light fa-angle-down anchor"></i> рядом с родительской переменной.
        - В таблице отобразится дочерняя переменная.

    - _ID_ — **значение: формула**

        ``` cs
        $ID
        ```

    - _Contact_ — с дочерними переменными:
        - _Fullname_ — **значение: формула**

            ``` cs
            $Fullname
            ```

        - _PhoneNumber_ — **значение: формула**

            ``` cs
            $PhoneNumber
            ```

5. Создайте действие «**Отправить сообщение**» со следующими свойствами:

    - **Подключение:** выберите [подключение для отправки HTTP-запросов](#настройка-подключения).
    - **Путь передачи данных:** выберите [путь передачи данных для отправки HTTP-запросов](#настройка-пути-передачи-данных).
    - **Переменная с сообщением:** _Message_
    - **Переменная для успешного ответа:** _Response_

6. Создайте действие «**Изменить значения атрибутов**» со следующими свойствами:

    - **Атрибут:** _Данные обновлены_
    - **Операция со значениями: заменить**
    - **Значение: формула**

        ``` cs
        $$Response->Success
        ```

_![Сценарий отправки HTTP-запроса методом POST](img/http_send_post.png)_

## Тестирование

1. Создайте запись в шаблоне _«Контакты клиентов»_.
2. Заполните поля атрибутов данными и нажмите кнопку «**Сохранить**».
3. Нажмите кнопку _«Отправить контакт на сервер»_.
4. При успешном выполнении запроса у атрибута _«Данные обновлены»_ будет установлен флажок.

--8<-- "related_topics_heading.md"

- _[HTTP-запросы типа POST. Отправка составного содержимого и файлов][http_send_file]_
- _[Отправка HTTP-запросов. Настройка подключения][send_http_connection]_
- _[Отправка HTTP-запросов типа GET. Пример: настройка подключения, пути передачи данных и сценария для обработки запросов в формате JSON][send_http_example]_
- _[Подключения. Типы, создание, настройка, удаление][connections]_
- _[Пути передачи данных. Типы, создание, настройка, удаление][communication_routes]_

</div>

{%
include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md"
%}
