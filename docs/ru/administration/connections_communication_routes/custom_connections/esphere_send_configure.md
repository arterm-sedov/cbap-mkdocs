---
title: Отправка документов через «СФЕРА Курьер»
kbId:
tags:
hide: tags
---

# Отправка документов через «СФЕРА Курьер». Настройка подключения, пути передачи данных и сценария

## Введение

В **{{ productName }}** можно настраивать подключение к системе электронного документооборота «СФЕРА Курьер». С помощью интеграции с «СФЕРА Курьер» можно:

- осуществлять поиск контрагентов по реквизитам и проверять их корректность;
- настроить обмен документами с контрагентами;
- производить возможные действия с документами и квитанциями;
- подписывать документы квалифицированной электронной подписью;
- контролировать сроки подписания документов.

Здесь приведён пример настройки подключения, пути передачи данных, шаблона и сценария для синхронизации данных о контрагенте с системой «СФЕРА Курьер».

## Порядок настройки

1. Настройте пользовательское подключение типа «**Отправка сообщений в систему «СФЕРА Курьер**».
2. Настройте путь передачи данных «**Отправка сообщений в «СФЕРА Курьер**», использующий созданное подключение.
3. Настройте шаблон с данными контрагентов.
4. Настройте сценарий для получения данных о контрагенте из системы «СФЕРА Курьер».

## Настройка подключения

1. Откройте страницу «**Администрирование**» — «**Подключения**».
2. Откройте двойным нажатием в списке или создайте подключение типа «**Пользовательские подключения**» — «**Отправка сообщений в систему «СФЕРА Курьер**».
3. Настройте свойства подключения:

    - **Системное имя** — введите уникальное имя подключения. Рекомендуется использовать буквы латинского алфавита, цифры и символ «_».
    - **Отключить** — установите этот флажок, если требуется временно деактивировать данное подключение.
    - **Описание** — введите наглядное описание подключения, например _«Подключение для отправки сообщений в систему «СФЕРА Курьер»_.
    - **Запись в файловые журналы** — выберите, какие события следует записывать в журналы:
         - **Полные сведения об обработке сообщения**;
         - **Только ошибки**;
         - **Отключить** — не регистрировать в журнале события отправки сообщений.
    - **Тестовый сервер** — установите этот флажок, если настраиваете тестовое подключение.
    - **Интервал запроса данных, в минутах** — укажите интервал запроса к серверу.
    - **ApiKey** — введите ключ API для подключения к «СФЕРА Курьер».
    - **Имя пользователя** — укажите учетную запись для подключения к «СФЕРА Курьер».
    - **Пароль** — введите пароль для подключения к «СФЕРА Курьер».
    - **Идентификатор участника ЭДО получателя документа** — укажите идентификатор, присвоенный участнику «СФЕРА Курьер».

4. Нажмите кнопку «**Проверить соединение**».
5. Чтобы просмотреть журнал событий отправки сообщений, нажмите кнопку «**Скачать журнал**».
6. Сохраните подключение.

## Настройка пути передачи данных

1. Откройте страницу «**Администрирование**» — «**Пути передачи данных**».
2. Откройте двойным нажатием в списке или создайте подключение типа «**Пользовательские подключения**» — «**Отправка сообщений в «СФЕРА Курьер**».
3. Настройте свойства пути передачи данных на следующих вкладках:

    - [**Основные свойства**](#основные-свойства)
    - [**Атрибуты сообщения**](#атрибуты-сообщения)
    - [**Интеграция**](#интеграция)

4. Сохраните путь передачи данных.

### Основные свойства

На вкладке «**Основные свойства**» настройте параметры использования пути передачи данных.

- **Подключение** — выберите [подключение для отправки сообщений в систему «СФЕРА Курьер»](#настройка-подключения).
- **Системное имя** — введите уникальное имя пути передачи данных. Рекомендуются буквы латинского алфавита, цифры и символ «_».
- **Отключить** — установите этот флажок, если требуется временно деактивировать данный путь передачи данных.
- **Описание** — введите наглядное описание пути передачи данных, например _«Путь для отправки сообщений в «СФЕРА Курьер»_.
- **Номер шины данных** — выберите номер от 0 до 3, если требуется распределить потоки данных нескольких путей для повышения производительности.

### Атрибуты сообщений

На вкладке «**Атрибуты сообщения**» настройте атрибуты, значения которых будут подставляться в содержимое сообщений в зависимости от его типа.

Имеются следующие **типы сообщений**:

- Добавить новый документ;
- Отправить подпись для документа;
- Получить документ;
- Поиск документов;
- Изменение стадий документооборота;
- Отклонить документ;
- Зачитывает данные об организации.

Значения атрибутов сообщения необходимо присвоить с помощью [сценария](#настройка-сценария).

В таблицах «**Запрос**», «**Ответ**» и «**Ответ с ошибкой**» содержатся готовые атрибуты для разных типов сообщения.

Подробнее см. _[«Справочное руководство API СФЕРА Курьер»](https://www.esphere.ru/assets/download/integration/ws-courier.pdf)_.

## Настройка шаблона записи и сценария

### Настройка шаблона записи

1. Создайте шаблон записи _«Реестр контрагентов»_.
2. Создайте следующие атрибуты:

    - _Код участника ЭДО_ типа «**Текст**»
    - _ИНН_ типа «**Текст**»
    - _КПП_ типа «**Текст**»

3. Создайте кнопк _«Синхронизировать данные контрагента»_ со следующими свойствами:

    - Контекст операции: запись
    - Операция: вызвать событие «Нажата кнопка»
    - Результат выполнения: обновить данные

4. Добавьте атрибуты _«Код участника ЭДО»_, _«ИНН»_, _«КПП»_ на форму.
5. Добавьте кнопку _«Синхронизировать данные контрагента»_ на форму.

### Настройка сценария

1. Создайте новый сценарий:

    - **Название:** _Синхронизация контрагента со СФЕРА Курьер_
    - **Контекст выполнения: от инициатора**

2. Отобразится конструктор сценария.
3. Настройте событие «Нажата кнопка»:

    - **Контекстный шаблон:** _Реестр контрагентов_
    - **Кнопка:** _Синхронизировать данные контрагента_

4. Создайте и настройте действие «Изменить значение переменных»:

    - **Операция со значениями переменных: добавить**
    - **Набор переменных:** _Request_

5. В свойствах действия «Изменить значения переменных» настройте переменную:

    - **Имя переменной:** _CompanyCode_
    - **Значение: атрибут** _Код участника ЭДО_

6. Добавьте действие «Отправить сообщение» со следующими свойствами:

    - **Подключение:** выберите [подключение для отправки сообщения в систему «СФЕРА Курьер»](#настройка-подключения)
    - **Путь передачи данных:** выберите [путь передачи данных для отправки сообщений в СФЕРА Курьер типа «Зачитывает данные об организации»](#настройка-пути-передачи-данных)
    - **Переменная с сообщением:** _Request_
    - **Переменная для успешного ответа:** _Response_
    - **Переменная для ответа с ошибкой:** _Error_

7. Добавьте действие «Изменить значение атрибутов» со следующими свойствами:

    | Атрибут      | Операция со значениями     | Значение                       |
    |---           |---                         |---                             |
    | _ИНН_        | **Заменить**               | **Формула:** `$$Response->Inn` |
    | _КПП_        | **Заменить**               | **Формула:** `$$Response->Kpp` |

_![Сценарий отправки запроса в систему «СФЕРА Курьер» для синхронизации данных контрагента](esphere_send_configure_scenario.png)_

## Тестирование

1. Создайте новую запись в шаблоне _«Реестр контрагентов»_.
2. Введите в поле _«Код участника ЭДО»_ действительный код контрагента.
3. Нажмите кнопку _«Синхронизировать данные контрагента»_.
4. В полях _«ИНН»_ и _«КПП»_ отобразятся данные.