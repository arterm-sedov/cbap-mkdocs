---
tags:
  - приложение
  - интеграции
  - интеграция по OData
  - OData
  - подключения
  - подключение
  - синхронизация
hide:
  - tags
---

# Интеграции

## Настройка интеграции с внешним сервисом посредством OData

**{{ productName }}** поддерживает автоматический и ручной импорт и экспорт данных посредством подключения к внешнему OData-сервису.

Подробные сведения о формате данных см. в статье  «**[URI Conventions (OData Version 2.0)](https://www.odata.org/documentation/odata-version-2-0/uri-conventions/)**» (официальное руководство OData, английский язык).

1. Создайте или настройте [подключение к OData-сервису](odata_connection.md).
2. Откройте приложение из [списка приложений][разработка-приложений].
3. Откройте раздел «**Администрирование**» — «**Интеграции**» приложения.
    *![Переход к разделу «Интеграции» приложения](odata_integration_list.png)*

4. В списке конфигураций интеграции, нажмите кнопку «**Создать**».
    *![Создание конфигурации интеграции](odata_integration_configuration_create.png)*

5. Настройте новую конфигурацию интеграции.

     - **Включить** — установите этот флажок, чтобы задействовать данную конфигурацию интеграции.
     - **Название** — наглядное название конфигурации интеграции.
     - **Подключение по OData** — выберите ранее созданное [подключение к OData-сервису](odata_connection.md).
     - **Тип** — выберите тип интеграции:
       - **Импорт**;
       - **Экспорт**.
     - **Шаблон записи** — выберите шаблон, в который будут импортироваться или из которого будут экспортироваться данные.
     - **Внешняя сущность** — укажите сущность, из которой будут импортироваться или в которую будут экспортироваться данные.
     - **Синхронизируемые объекты** — выберите, следует ли импортировать все данные или только изменённые:  
       - **Все**;
       - **По изменению полей объекта**.
     - **Режим запуска**:
       - **Вручную**;
       - **По расписанию**:
         - **Первый запуск**;
         - **Периодичность**;
         - **Дни запуска**;
         - **Интервал запуска**.
     - **Сопоставление данных** — задайте соответствие внешних атрибутов и атрибутов шаблона записи, укажите ключевой атрибут. Для точной синхронизации необходимо создать атрибут, содержащий уникальные значения, который будет идентификатором внешнего первичного ключа. В столбце «**Внешний атрибут**» в квадратных скобках указаны свойства атрибутов:
       - **[Primary key]** — первичный ключ;
       - **[Not null]** — атрибуты, которые не могут быть пустыми (при экспорте данных необходимо установить соответствие всех внешних и внутренних атрибутов с данным свойством).

    *![Настройка свойств интеграции](odata_integration_configuration_properties.png)*

6. Настройте конфигурацию импорта данных.

     - **Зависит от** — укажите интеграцию, синхронизацию по которой необходимо запускать перед запуском синхронизации по данной интеграции.
     - **Фильтр** — задайте фильтр данных посредством выражений OData. Подробную информацию см. в статье «**[Using Filter Expressions in OData URIs](https://msdn.microsoft.com/ru-ru/library/hh169248(v=nav.90).aspx)**» (учебник Microsoft, английский язык).
     - **Количество объектов в одном запросе** — укажите максимальное количество данных, передаваемых в одном запросе. При превышении этого количества будет формироваться новый запрос к внешнему сервису.
     - **Сортировка** — укажите атрибуты и порядок сортировки записей по ним.
     - **Динамический фильтр** — настройте фильтрацию данных по времени, указав атрибут типа «Дата и время», значение которого будет проверяться на соответствие указанному интервалу фильтра.
     - **Интервал фильтра** — интервал времени, который будет отсчитываться от даты запуска синхронизации.
     - **Удалить несуществующие записи** — установите этот флажок, чтобы при синхронизации удалять записи, которые отсутствуют на внешнем сервере.
     - **Удалить по условию** — укажите атрибуты и значения, чтобы при синхронизации удалять записи, соответствующие заданным условиям.

    *![Настройки импорта](odata_integration_configuration_import_settings.png)*

7. При необходимости настройте постпроцессинг.

     - **Целевой атрибут** — атрибут типа «**Запись**», связанный с исходным шаблоном
     - **Атрибут в выбранном шаблоне** — укажите ключевой атрибут в выбранном шаблоне для синхронизации
     - **Атрибут в связанном шаблоне** — укажите ключевой атрибут шаблона, связанного с целевым атрибутом.

    При импорте данных будут связываться между собой записи, в которых значения указанных атрибутов совпадают.
    *![Настройка постпроцессинга](odata_integration_configuration_postprocessing_settings.png)*

8. Настройте конфигурацию экспорта данных

     - **Удалить записи после экспорта** — установите этот флажок, чтобы при синхронизации удалять экспортированные записи.
     - **Экспортировать архивные записи** — установите этот флажок, чтобы при синхронизации экспортировать архивные записи.
     - **Фильтр** — укажите атрибуты и значения, чтобы при синхронизации экспортировать только записи, соответствующие заданному фильтру.

    *![Настройка экспорта](odata_integration_configuration_export_settings.png)*

## Запуск синхронизации посредством интеграции

1. Установите один или несколько флажков в списке интеграций.
2. Нажмите кнопку «**Запустить синхронизацию**».
3. Будет запущена синхронизация посредством выбранных интеграций.
4. Результаты синхронизации можно просмотреть в журналах интеграции.
    *![Запуск синхронизации](odata_integration_syncronyzation_start.png)*

## Журналирование интеграции

### Журнал событий

Журнал сеансов синхронизации посредством интеграций отображается на вкладке «**Интеграция по OData**» в разделе «**Администрирование**» — «**Инфраструктура**» — «**Журналы событий**».

*![Журнал сеансов синхронизации данных по OData](odata_integration_session_log.png)*

### Сведения в журнале «Интеграция по OData»

- **Без ошибок** — в этом столбце отображается флажок, если синхронизация выполнена без ошибок.
- **Сеанс** — идентификатор сеанса синхронизации.
- **Событие** — описание события синхронизации. Для просмотра цепочки событий, приведших к событию в журнале, дважды нажмите строку в журнале.
- **Дата** — дата запуска синхронизации.
- **Подключение** — подключение, использованное для синхронизации. Перейдите по этой гиперссылке для просмотра свойств подключения.
- **Конфигурация** — идентификатор конфигурации интеграции. Перейдите по этой гиперссылке для просмотра свойств интеграции.
- **Инициатор** — аккаунт, запустивший синхронизацию. Перейдите по этой гиперссылке для просмотра свойств аккаунта.

### Файловый журнал

При синхронизации посредством интеграции соответствующие события записываются в файл журнала с именем вида: `integration_raw_ГГГГ-ММ-ЧЧ.log`.

*![Файл integration_raw_ГГГГ-ММ-ЧЧ.log в папке журналов](odata_integration_log_file.png)*

При успешной синхронизации в этом файле будут указаны все синхронизированные объекты. При сбое синхронизации в файл записывается ИД записи, на которой была обнаружена ошибка, и описание ошибки.

*![Содержимое файла integration_raw.log](odata_integration_log_content.png)*

--8<-- "related_topics_heading.md"

**[Подключение для синхронизации с веб-сервисом](odata_connection.md)**

**[Журнал сеансов синхронизации данных по OData][интеграция-по-odata]**
