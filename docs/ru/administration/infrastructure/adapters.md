---
title: Адаптеры
tags:
    - адаптеры
    - создание адаптера
    - подключения
    - создание подключения
hide:
    - tags
kbId: 4672
---

# Адаптеры. Определения, настройка, удаление {: #adapters}

<div class="admonition question" markdown="block">
## Определения {: .admonition-title}

- **Адаптеры** — это заказные модули для подключения **{{ productName }}** к внешним системам.
- Для использования адаптера необходимо загрузить и скомпилировать его исходный код на стороне сервера **{{ productName }}**.
- После компиляции адаптера для него необходимо настроить соответствующие подключения, пути передачи данных и сценарий для взаимодействия с внешней системой.

</div>

## Преимущества и недостатки адаптеров

Заказные адаптеры имеют целый ряд преимуществ:

- быстрота реализации;
- возможность обрабатывать и преобразовывать данные на уровне адаптера;
- объединение нескольких моделей данных в одном адаптере;
- отказоустойчивость.

Основным недостатком адаптеров является большее количество шагов для обновления, в случае внесения изменений.

<!-- описать, как взять шаблон для адаптера, кто за это отвечает -->

## Порядок настройки адаптеров

1. Определите модель данных, передаваемых через адаптер.
2. Полученную модель данных преобразуйте в модель классов на языке C#.
3. Опишите методы адаптера для отправки и получения данных.
4. Подготовьте решение Visual Studio с исходным кодом адаптера.
5. Загрузите адаптер на сервер **{{ productName }}**.
6. Настройте подключение согласно протоколу соединения с внешней системой.
7. Настройте путь передачи данных согласно модели данных и логике взаимодействия с внешней системой.
8. Настройте шаблоны и сценарий для обработки запросов с помощью адаптера.

## Построение модели данных

1. Подготовьте структуру данных в стандартизированном формате или в виде таблицы.
2. На основе структуры модели данных создайте модель класса для адаптера. Для этого можно использовать автогенератор, например [https://json2csharp.com/code-converters/xml-to-csharp](https://json2csharp.com/code-converters/xml-to-csharp).
3. Программист, разрабатывающий адаптер, может модифицировать некоторые параметры модели данных, например изменять названия полей, делать преобразования данных (конвертировать строки в число) или даже изменять модель данных, которую он передает в свою систему (добавлять верхнеуровневые объекты и тд).

## Устройство адаптера

Адаптер состоит из следующих блоков:

- Блок сериализации и десериализации данных.
- Блок описания модели данных и преобразование данной модели во внутреннюю модель адаптера. Структура модели данных должна совпадать с внутренней моделью адаптера, но может отличаться по названием полей.
- Блок endpoint или методов адаптера. Данный блок необходим для распределения запросов между разными моделями данных, хранящихся в адаптере. В одном адаптере может быть описано более 1 модели (клиенты\договоры\продукты).
- Блок служб, который отвечает за поднятие kestrel на порту, отправки сообщений, таймаутов и тд.

## Состав решения Visual Studio

Образец решения можно запросить у представителя **{{ companyName }}**.

Готовое решение состоит из следующих элементов:

- проект с исходным кодом адаптера;
- проекты, содержащие интерфейсы для разработки и последующей компиляции адаптера;
- необходимые дополнительные проекты для адаптера, например проект локализации;
- папку с подключаемыми библиотеками;
- файл решения (.sln) в одном экземпляре в корневой папке архива.

_![Пример содержимого архива с исходным кодом адаптера](adapter_archive_content.png)_
{% include-markdown ".snippets/pdfEndOfBlockHack.md" %}

## Просмотр списка адаптеров и настройка адаптера

1. На странице [«**Администрирование**» — «**Инфраструктура**»][administration] выберите пункт «**Адаптеры**» <i class="fa-light fa-puzzle-piece-simple">‌</i>.
2. Отобразится список адаптеров.

    _![Список адаптеров](adapter_list.png)_

3. Нажмите кнопку «**Создать**» или дважды нажмите строку имеющегося адаптера.
4. Отобразится страница свойств адаптера.

    _![Страница свойств адаптера](adapter_properties.png)_

    {% include-markdown ".snippets/pdfPageBreakHard.md" %}

5. В поле «**Исходный код адаптера**» загрузите ZIP-архив с исходным кодом адаптера. Архив должен содержать подготовленное решение Visual Studio. См. [Устройство адаптера]()
6. Нажмите кнопку «**Сохранить**».
7. Нажмите кнопку «**Опубликовать**», чтобы скомпилировать адаптер.
8. В случае успешной компиляции адаптера его название отобразится в списке адаптеров и свойствах адаптера.
9. После компиляции просмотрите **журнал компиляции**.

    _![Пример журнала компиляции](adapter_compilation_log.png)_

10. При необходимости скачайте архив с журналами работы адаптера (вида `_CBAP.adapters.20221026.logs.zip_`), нажав кнопку «**Скачать журнал работы**».

    _![Пример журнала работы адаптера](adapter_execution_log.png)_

    {% include-markdown ".snippets/pdfPageBreakHard.md" %}

11. Пункт с названием подключения для скомпилированного адаптера будет отображаться в подменю «**Пользовательские подключения**» при создании подключения и пути передачи данных.

_![Создание подключения с использованием адаптера](adapter_custom_connection_create_menu.png)_

_![Создание пути передачи данных с использованием адаптера](adapters_custom_communication_route_create_menu.png)_

## Удаление адаптера {: .pageBreakBefore }

!!! warning "Внимание!"

    Пути передачи данных и подключения, сгенерированные для удаленного адаптера, станут неактивны и перестанут работать.

1. Откройте [список адаптеров](#просмотр-списка-адаптеров-и-настройка-адаптера).
2. Установите флажок в первом столбце для адаптера, подлежащего удалению.
3. Нажмите кнопку «**Удалить**».
4. Подтвердите удаление адаптера.

<div class="relatedTopics" markdown="block">

--8<-- "related_topics_heading.md"

- _[Подключения. Определения, типы, создание, настройка, удаление][connections]_

</div>

{%
include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md"
%}
