---
title: Адаптеры
tags:
    - адаптеры
    - создание адаптера
    - подключения
    - создание подключения
hide:
    - tags
kbId: 4672
---

# Адаптеры. Определения, настройка, удаление {: #adapters}

<div class="admonition question" markdown="block">
## Определения {: .admonition-title}

- **Адаптер** — это заказной модуль для подключения **{{ productName }}** к внешним системам.
- Адаптер собирается на стороне **{{ productName }}** из исходного кода.
- Адаптер включает в себя модель данных и методы отправки или получения запросов.
- Для использования адаптера необходимо загрузить и скомпилировать его исходный код на стороне сервера **{{ productName }}**.
- После компиляции адаптера для него необходимо настроить соответствующие подключения, пути передачи данных и сценарий для взаимодействия с внешней системой.

</div>

## Преимущества использования адаптеров

Адаптеры дают следующие преимущества:

- быстрота и гибкость реализации необходимых бизнесу способов обмена данными;
- возможность обрабатывать и преобразовывать данные на уровне специализированных протоколов;
- обработка различных моделей данных с помощью одного адаптера;
- повышенная отказоустойчивость благодаря обмену данными с **{{ productName }}** через брокер сообщений.

## Порядок настройки адаптера

!!! warning "Внимание"

    Для успешной компиляции адаптера должны быть установлены библиотеки .NET на машине, на которой развёрнут экземпляр ПО.

1. [Определите модель данных](#построение-модели-данных), передаваемых через адаптер.
2. [Определите методы](#устройство-адаптера) адаптера на C# для отправки и получения данных.
3. [Подготовьте решение](#состав-решения-visual-studio) Visual Studio с исходным кодом адаптера.
4. [Загрузите и скомпилируйте адаптер](#просмотр-списка-адаптеров-и-настройка-адаптера) на сервере **{{ productName }}**.
5. Настройте подключение согласно протоколу соединения с внешней системой.
6. Настройте путь передачи данных согласно модели данных и логике взаимодействия с внешней системой.
7. Настройте шаблоны и сценарий для обработки запросов с помощью адаптера.

## Построение модели данных

Для разработки адаптера сформируйте модель данных:

1. Подготовьте описание структуры данных в стандартизированном формате (например, XML, JSON) или в виде таблицы.
2. Преобразуйте описание структуры данных в модель классов C# адаптера, например с помощью автогенератора <https://json2csharp.com/code-converters/xml-to-csharp>.
3. Модифицируйте полученную модель в соответствии с необходимой бизнес-логикой.

## Устройство адаптера

Адаптер должен состоять из следующих компонентов:

- блок сериализации или десериализации данных;
- блок описания моделей данных и их преобразования во внутренние модели адаптера;
- блок конечных точек адаптера (эндпоинтов), распределяющий запросы между методами согласно модели данных адаптера;
- блок служб, который отвечает за работу Kestrel, отправку сообщений, таймауты, проверку данных и т. д.

## Состав решения Visual Studio

Образец решения запросите у представителя **{{ companyName }}**.

- Соберите решение из следующих компонентов:
    - проект с исходным кодом адаптера, включая один файл решения (`.sln`) в корневой папке;
    - подпроекты, содержащие интерфейсы для разработки и последующей компиляции адаптера;
    - дополнительные подпроекты, например для локализации;
    - папка с подключаемыми библиотеками.
- Готовое решение упакуйте в ZIP-архив для компиляции в **{{ productName }}**.

_![Пример содержимого архива с исходным кодом адаптера](adapter_archive_content.png)_
{% include-markdown ".snippets/pdfEndOfBlockHack.md" %}

## Просмотр списка адаптеров и настройка адаптера

1. На странице [«**Администрирование**» — «**Инфраструктура**»][administration] выберите пункт «**Адаптеры**» <i class="fa-light fa-puzzle-piece-simple">‌</i>.
2. Отобразится список адаптеров.

    _![Список адаптеров](adapter_list.png)_

3. Нажмите кнопку «**Создать**» или дважды нажмите строку имеющегося адаптера.
4. Отобразится страница свойств адаптера.

    _![Страница свойств адаптера](adapter_properties.png)_

    {% include-markdown ".snippets/pdfPageBreakHard.md" %}

5. В поле «**Исходный код адаптера**» загрузите ZIP-архив с исходным кодом адаптера. Архив должен содержать подготовленное решение Visual Studio. См. [Устройство адаптера](#состав-решения-visual-studio).
6. Нажмите кнопку «**Сохранить**».
7. Нажмите кнопку «**Опубликовать**», чтобы скомпилировать адаптер.
8. В случае успешной компиляции адаптера его название отобразится в списке адаптеров и свойствах адаптера. Название берётся из файлов решения Visual Studio.
9. После компиляции просмотрите **журнал компиляции**.

    _![Пример журнала компиляции](adapter_compilation_log.png)_

10. При необходимости скачайте архив с журналами работы адаптера (вида `_CBAP.adapters.20221026.logs.zip_`), нажав кнопку «**Скачать журнал работы**».

    _![Пример журнала работы адаптера](adapter_execution_log.png)_

    {% include-markdown ".snippets/pdfPageBreakHard.md" %}

11. Пункт с названием подключения для скомпилированного адаптера появится в меню «**Создать**» — «**Пользовательские подключения**» на страницах «**[Подключения][connections]**» и «**[Пути передачи данных][communication_routes]**». При этом для каждой модели данных в пути передачи данных будет предусмотрен соответствующий **тип сообщения**.

_![Создание подключения с использованием адаптера](adapter_custom_connection_create_menu.png)_

_![Создание пути передачи данных с использованием адаптера](adapters_custom_communication_route_create_menu.png)_

## Мониторинг работы адаптера

Для проверки работы адаптера можно воспользоваться встроенными инструментами мониторинга:

- На странице адаптера можно скачать журнал, в котором фиксируется вся информация о работе адаптера, в том числе:
    - статус служб адаптера;
    - статус подключения адаптера;
    - доступность методов;
    - объём выделенной памяти;
    - информация о созданных путях передачи данных;
    - взаимодействие адаптера со службой Kafka.
    - Откройте страницу свойств адаптера и скачайте архив с журналами его работы, нажав кнопку «**Скачать журнал работы**».
    - См. также _«[Журналы адаптеров][logging_engine_adapter_logs]»_ и _«[Событие в адаптере][log_files_event_examples_adapter_event]»_.
- В свойствах подключения имеется журнал, в котором фиксируются следующие события:
    - статус подключения;
    - получение или отправка сообщений;
    - запуск сценария обработки сообщения;
    - использование методов адаптера.
    - Откройте **[подключение][connections]** адаптера и скачайте журнал работы подключения, нажав кнопку «**Скачать журнал**».
    - См. также _«[Статус подключения][log_files_event_examples_connection_status]»_
- При получении или отправке запросов **{{ productName }}** регистрирует их в журнале событий и создаёт связанную цепочку событий обработки запроса на стороне ПО.
    - Откройте страницу «**Администрирование**» — «**[Журналы событий][logs]**».
    - Перейдите на вкладку «**Трассировка событий**».
    - Просмотрите события типа «**Получен запрос**» и «**Запрос отправлен**», связанные с работой адаптера, дважды нажав строку события.
    - См. также _«[Просмотр цепочки событий][logs_event_chain_view]»_.

## Удаление адаптера {: .pageBreakBefore }

!!! warning "Внимание!"

    Пути передачи данных и подключения, сгенерированные для удаленного адаптера, станут неактивны и перестанут работать.

1. Откройте [список адаптеров](#просмотр-списка-адаптеров-и-настройка-адаптера).
2. Установите флажок в первом столбце для адаптера, подлежащего удалению.
3. Нажмите кнопку «**Удалить**».
4. Подтвердите удаление адаптера.

<div class="relatedTopics" markdown="block">

--8<-- "related_topics_heading.md"

- _[Подключения. Определения, типы, создание, настройка, удаление][connections]_
- _[Журналы событий. Типы, просмотр, цепочки событий][logs]_
- _[Примеры событий в файловых журналах][log_files_event_examples]_
- _[Подсистема журналирования][logging_engine]_

</div>

{%
include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md"
%}
