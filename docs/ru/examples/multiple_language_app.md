---
title: Настройка интерфейса приложения на разных языках
kbId:
---

# Настройка интерфейса приложения на разных языках

## Введение

**{{ productName }}** позволяет реализовывать интерфейс на различных языках. В системе можно менять отображаемые названия шаблонов и атрибутов, настроить формы на разных языках, а также дать возможность пользователем переключаться между доступными языками.

Здесь представлена инструкция по настройке шаблонов записи на русском и английском языках, настройке мультиязычной ролевой модели, а также описан процесс добавления кнопки для изменения языка интерфейса.

## Прикладная задача

Требуется настроить шаблон _«Заявки»_, связанный с ним шаблон _«Тип автомобиля»_ и форму, которая будет поддерживать два языка. Интерфейс пользователя должен быть на одном определённом языке.

Также требуется настроить кнопку смены языка для пользователя.

## Настройка шаблонов записи

### Настройка шаблона записи «Тип автомобиля»

1. Создайте шаблон _«Тип автомобиля»_.
2. Добавьте текстовые атрибуты _«Название RU»_ `<NameRU>`, _«Название EN»_ `<NameEN>`.
3. Добавьте вычисляемый текстовый атрибут _«Отображаемое название»_:

    - **Использовать как заголовок записей:** флажок установлен
    - **Вычислять автоматически:** флажок установлен
    - **Вычисляемое выражение: формула**

        ``` cs
        IF (USER()->language=='ru', VALUE($NameRU, $NameEN), VALUE($NameEN, $NameRU))
        ```

4. Добавьте атрибуты на **форму**.
5. Создайте записи со следующими значениями:

    | _Название RU_ | _Название EN_ |
    |---|---|
    | _легковой_ | _car_ |
    | _автобус_ | _bus_ |
    | _грузовой_ | _truck_ |

### Настройка шаблона записи «Заявки»

!!! tip "Название атрибута на разных языках"

    Чтобы создавать одинаковые формы на разных языках и унифицировать наименование шаблонов и атрибутов, рекомендуется задавать им название на требуемых языках через `/`.

    Чтобы на форме отображалось название только на одном языке, следует её отредактировать:

    1. Добавьте атрибут на форму.
    2. Нажмите поле или название атрибута.
    3. Отредактируйте **отображаемое название** атрибута.
    4. Сохраните форму.

1. Создайте шаблон записи _«Заявки / Requests»_.
2. Добавьте атрибуты _«Номер заявки / Request Number»_ и _«Количество пассажиров / Amount of passengers»_ типа «**Число**».
3. Добавьте атрибут _«Тип автомобиля / Vehicle Type»_ типа «**Запись**», связанный с шаблоном _«Тип автомобиля»_.
4. Создайте новую форму _«Форма на русском»_ и добавьте на неё атрибуты.
5. Отредактируйте названия полей атрибутов так, чтобы они отображались только на русском.
6. Сохраните форму.
7. Создайте новую форму _«Форма на английском»_ и добавьте на неё атрибуты.
8. Отредактируйте названия полей атрибутов так, чтобы они отображались только на английском.
9. Сохраните форму.
10. На **основную форму** добавьте _«Форму на русском»_ и _«Форму на английском»_.
11. Добавьте **правило** для основной формы со следующим **действием**:

    - **Элемент формы:** _Форма на русском_
    - **Действие: изменить доступ**
    - **Новое значение: скрыть**
    - **Условие выполнения: формула**

        ``` cs
        EQUALS(USER()->language,"en")
        ```

12. Добавьте к **правилу** дополнительное **действие**:

    - **Элемент формы:** _Форма на английском_
    - **Действие: изменить доступ**
    - **Новое значение: скрыть**
    - **Условие выполнения: формула**

        ``` cs
        OR(EQUALS(USER()->language,"ru"),EMPTY(USER()->language))
        ```

13. Сохраните форму.

## Настройка групп, ролей, навигации и кнопки переключения языка

## Настройка групп, ролей и навигации

1. Создайте группу _«Пользователи RU»_ и добавьте в неё аккаунты.
2. Создайте роль _«Пользователь RU»_ и добавьте в неё группу _«Пользователи RU»_.
3. Настройте права доступа для роли.
4. Создайте группу _«Пользователи EN»_ и добавьте в неё аккаунты.
5. Создайте роль _«Пользователь EN»_ и добавьте в неё группу _«Пользователи EN»_.
6. Настройте права доступа для роли.
7. Создайте раздел навигации _«Управление автопарком»_ и назначьте его роли _«Пользователь RU»_.
8. Добавьте в навигацию шаблон записи _«Заявки / Requests»_ и отредактируйте его отображаемое название.
9. Создайте раздел навигации _«Motor Pool Management»_ и назначьте его роли _«Пользователь EN»_.
10. Добавьте в навигацию шаблон записи _«Заявки / Requests»_ и отредактируйте его отображаемое название.

## Настройка кнопки переключения языка

1. Создайте шаблон аккаунтов _«Пользователи»_.
2. Перейдите на вкладку «**Кнопки**».
3. Создайте кнопку _«Change language»_ со следующими свойствами:

    - **Контекст операции: аккаунт**
    - **Операция: C#-скрипт**
    - **Результат выполнения: обновить данные**

4. На вкладке «**Скрипт**» добавьте C#-скрипт по следующему образцу:

    ``` cs
    using System; 
    using System.Collections.Generic;
    using System.Linq;
    using Comindware.Data.Entity;
    using Comindware.TeamNetwork.Api.Data.UserCommands;
    using Comindware.TeamNetwork.Api.Data;
    using Comindware.Data;
    class Script
    {
        public static UserCommandResult Main(UserCommandContext userCommandContext, Comindware.Entities entities)
        { 
            var id = userCommandContext.ObjectIds[0];
                // group.1 — ID группы «Пользователи RU».
            Api.Base.AccountGroupService.ExcludeMembers( "group.1", new List<string>(){id});
                // group.2 — ID группы «Пользователи EN».
            Api.Base.AccountGroupService.IncludeMembers( "group.2", new List<string>(){id});
            
            var account =  Api.Base.AccountService.Get(id);
                // Укажите код языка (ru/en), который требуется установить в интерфейсе пользователя.
            account.Language = "en";
            Api.Base.AccountService.Edit(account);
            var result = new UserCommandResult
            {
                Success = true,
                Commited = true,
                ResultType = UserCommandResultType.Notificate,
                Messages = new[]
                {
                    new UserCommandMessage
                    {
                        Severity = SeverityLevel.Normal,
                            // Укажите текст для всплывающего уведомления.
                        Text = "Language was changed to English."
                        }
                }
            };
            return result;
        }
    }
    ```

5. На вкладке «**Условия отображения**» добавьте формулу:

    ``` cs
    OR(EQUALS(USER()->language,"ru"),EMPTY(USER()->language))
    ```

6. Сохраните кнопку.
7. Создайте кнопку _«Сменить язык»_ со следующими свойствами:

    - **Контекст операции: аккаунт**
    - **Операция: C#-скрипт**
    - **Результат выполнения: обновить данные**

8. На вкладке «**Скрипт**» добавьте C#-скрипт по следующему образцу:

    ``` cs
    using System; 
    using System.Collections.Generic;
    using System.Linq;
    using Comindware.Data.Entity;
    using Comindware.TeamNetwork.Api.Data.UserCommands;
    using Comindware.TeamNetwork.Api.Data;
    using Comindware.Data;
    class Script
    {
        public static UserCommandResult Main(UserCommandContext userCommandContext, Comindware.Entities entities)
        { 
            var id = userCommandContext.ObjectIds[0];
                // group.2 — ID группы «Пользователи EN».
            Api.Base.AccountGroupService.ExcludeMembers( "group.2", new List<string>(){id});
                // group.1 — ID группы «Пользователи RU».
            Api.Base.AccountGroupService.IncludeMembers( "group.1", new List<string>(){id});
            
            var account =  Api.Base.AccountService.Get(id);
                // Укажите код языка (ru/en), который требуется установить в интерфейсе пользователя.
            account.Language = "en";
            Api.Base.AccountService.Edit(account);
            var result = new UserCommandResult
            {
                Success = true,
                Commited = true,
                ResultType = UserCommandResultType.Notificate,
                Messages = new[]
                {
                    new UserCommandMessage
                    {
                        Severity = SeverityLevel.Normal,
                            // Укажите текст для всплывающего уведомления.
                        Text = "Язык изменён на русский."
                        }
                }
            };
            return result;
        }
    }
    ```

9. На вкладке «**Условия отображения**» добавьте формулу:

    ``` cs
    EQUALS(USER()->language,"en") 
    ```

10. Сохраните кнопку.
11. Добавьте обе кнопки на форму шаблона _«Пользователи»_.
12. Добавьте пользователей в экземпляры записи шаблона _«Пользователи»_.

## Тестирование

1. Создайте запись в шаблоне _«Заявки / Requests»_.
2. Форма и данные атрибута _«Тип автомобиля / Vehicle Type»_ отобразятся на языке, который установлен у пользователя.
3. Перейдите к шаблону _«Пользователи»_ и дважды нажмите строку с данными текущего пользователя.
4. Нажмите кнопку _«Сменить язык»_ или _«Change language»_.
5. Отобразится интерфейс на другом языке.
6. Перейдите к записи шаблона _«Заявки / Requests»_.
7. Форма и данные атрибута _«Тип автомобиля / Vehicle Type»_ отобразятся на другом языке.

--8<-- "related_topics_heading.md"

**[Список функций языка формул Comindware][formula_function_list]**

**[Написание скриптов на языке C#][manual_csharp]**

{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
