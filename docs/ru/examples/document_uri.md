---
kbId:
title:
---

# Атрибут «Документ». Формирование ссылки на файл

## Введение

**{{ productName }}** позволяет прикрепить любые файлы к атрибуту типа «**Документ**». При этом создаются прямые ссылки, по которым можно скачать эти файлы. Атрибут типа «**Документ**» хранит не сами файлы непосредственно, а ссылки на них. Тем не менее эти файлы доступны для скачивания без предоставления доступа к атрибуту.

Здесь представлена настройка текстового атрибута, в который помещаются ссылки на документы, с помощью выражения N3.

## Прикладная задача

Имеется шаблон, к которому прикрепляются различные файлы. Требуется создать атрибут, в котором будут перечислены названия документов с ссылками на их скачивание.

## Исходные данные

Имеется шаблон _«Заявки»_ (системное имя _Requires_). В нём имеется атрибут _«Вложения»_ со следующими свойствами:

    - **Тип: документ**
    - **Системное имя:** _Files_
    - **Хранить несколько значений: флажок установлен**

## Настройка шаблона

1. Создайте текстовый атрибут со следующими настройками:

    - **Название:** _Ссылки на вложения_
    - **Формат отображения: HTML-текст**
    - **Вычислять автоматически: флажок установлен**
    - **Вычисляемое значение: N3**

        ``` turtle
        # Импортируем функции для работы
        # с документами и строками
        @prefix object: <http://comindware.com/ontology/object#>.
        @prefix document: <http://comindware.com/ontology/document#>.
        @prefix cmwstring: <http://comindware.com/logics/string#>.
        @prefix string: <http://www.w3.org/2000/10/swap/string#>.
        {
            # Находим атрибут «Вложения» и помещаем в ?filesAttribute
            ("Requires" "Files") object:findProperty ?filesAttribute.
            # Запускаем цикл
            from {
                # Находим содержимое ?filesAttribute в текущей
                # записи и помещаем в ?file
                ?item ?filesAttribute ?file.
                # Получаем текущую ревизию документа и
                # помещаем в ?fileRevision
                ?file document:currentRevision ?fileRevision.
                # Получаем ссылку на файл без имени хоста
                # и помещаем в ?fileUri
                ?fileRevision document:httpUri ?fileUri.
                # Помещаем имя файла в ?fileName
                ?fileRevision document:name ?fileName.
                # Формируем строки с именами файлов и ссылками на них
                # и помещаем в ?formatUri
                # 'http://<hostName>' — имя хоста **{{ productName }}**
                ("<a href='http://<hostName>{0}'>{1}</a><br>" ?fileUri ?fileName) string:format ?formatUri.
                }
            # Формируем ?uriList из ?formatUri.
            select ?formatUri -> ?uriList.
            # Формируем из ?uriList одну большую строку
            # и возвращаем её в значение атрибута
            ("" ?uriList) cmwstring:join ?value.
        }
        ```

2. Создайте **форму** _«Скачивание вложений»_.
3. Поместите атрибут _«Ссылки на вложения»_ на форму _«Скачивание вложений»_.

## Тестирование

1. Создайте запись в шаблоне _«Заявки»_.
2. Прикрепите несколько файлов к атрибуту _«Вложения»_.
3. С помощью селектора <em class="fa-light fa-angle-down anchor">‌</em> перейдите к форме _«Скачивание вложений»_.
4. В поле атрибута _«Ссылки на вложения»_ отобразится список с ссылками на скачивание прикреплённых файлов.

<div class="relatedTopics" markdown="block">

--8<-- "related_topics_heading.md"

- _[Атрибут типа «Документ»][attribute_document]_
- _[Атрибут типа «Документ». Скачивание архива с файлами из выбранных строк таблицы и записи][example_document_download_archive_csharp]_
- _[Атрибут типа «Документ». Скачивание архива с файлами из всех строк таблицы с прикреплением архива к атрибуту][example_document_download_archive_related_records_csharp]_
- _[Атрибут типа «Документ». Скачивание файлов в папку на сервере][example_document_download_to_server_csharp]_
- _[Атрибут типа «Документ». Клонирование записи вместе с прикреплёнными файлами][example_document_clone_scenario_n3]_

</div>

{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}