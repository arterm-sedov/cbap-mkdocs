# Атрибут типа «Список значений». Вычисление значения с помощью N3 и формул

## Введение

Атрибут [типа «Список значений»][attribute_enum] содержит в себе перечень значений на нескольких языках — русском, английском и немецком. При этом, нельзя напрямую получить текстовое значение атрибута. Получить значение атрибута на определённом языке можно с помощью выражения на N3. Кроме того, в логических операциях используются только системные имена значений атрибута.

Здесь представлен пример настройки приложения для передачи текстового значения атрибута на требуемом языке и условного перехода в процессе по значению атрибута типа «Список значений».

## Прикладная задача

Имеются шаблон записи _«Заявки на перевозку»_ и процесс обработки заявок.
В нём содержится атрибут *«Тип ТС»* типа «**Список значений**».

Требуется распределять заявки в процессе в зависимости от _типа ТС_, выбранного в заявке, и отправлять задачи диспетчерам с указанием типа заказанного ТС.
## Распределение заявок по значению атрибута список значений

1. В шаблоне *«Заявка»* создайте атрибут *«Тип ТС»* типа «**Список значений**».
2. Укажите следующие параметры для списка значений:

| Системное имя | EN      | RU                    |
| ------------- | ------- | --------------------- |
| *bus*         | *Bus*   | *автобус*             |
| *car*         | *Car*   | *легковой автомобиль* |
| *truck*       | *Truck* | *грузовой автомобиль* |
3. Создайте следующий **атрибут**:

| Название               | Тип       | Свойства                                                                        |
| ---------------------- | --------- | ------------------------------------------------------------------------------- |
| *Наименование типа ТС* | **Текст** | **Вычислять автоматически:** флажок установлен<br>**Вычисляемое выражение: N3** |
4. Добавьте следующее выражение N3:

    ``` turtle
    # Импортируем функции для работы с записями, строками и базой данных
    @prefix object: <http://comindware.com/ontology/object#>.  
    @prefix cmw: <http://comindware.com/logics#>.  
    @prefix l10n: <http://comindware.com/ontology/l10n#>.  
    @prefix string: <http://www.w3.org/2000/10/swap/string#>.  
    @prefix cmwentity: <http://comindware.com/ontology/entity#>.
    {  
        # Находим атрибут TipTS  (Тип ТС) в шаблоне Zayavki (Заявка на перевозку).
        ("Zayavki" "TipTS") object:findProperty ?TipTSAttribute.
        # Присваиваем переменной ?TipavtotransportaAttributeValues объект со списком значений атрибута «Тип автотранспорта».
        ?item ?TipavtotransportaAttribute ?TipTSAttributeValues.
        # Присваиваем переменной ?SelectedValue объект с выбранным значением атрибута. 
        ?TipavtotransportaAttributeValues cmw:variantName ?SelectedValue.
        # Присваиваем переменной ?names массив объектов с заполненными названиями значения атрибута на всех языках.
        ?SelectedValue l10n:text ?names.
        # Начинаме цикл по ?names
            # Присваиваем переменной ?langCodeStr код языка названия значения атрибута на текущей итерации цикла.
            ?names l10n:lang ?langCode.
            ("{0}" ?langCode) string:format ?langCodeStr.
            # Сравниваем код языка для значения атрибута с желаемым. 
            # "ru" — код русского языка, "en" — английского, "de" — немецкого.
            ?langCodeStr cmwentity:contains "ru".
                # Если предыдущее предложение возвращает true, записываем значение на русском языке в вычисляемый атрибут.       
                ?names l10n:data ?value. 
        # переходим к следующей итерации по ?names.
    }
    ```

4. Создайте процесс *«Обработка заявок»*, связанный с шаблоном *«Заявка»*.
5. Вынесите атрибуты *«Тип ТС»* и *«Наименование типа ТС»* на форму начального события. 
6. После начального события добавьте **развилку «или/или»**.
7. Добавьте три потока управления и присоедините к ним пользовательские задачи *«Обработать заявку на автобус»*, *«Обработать заявку на легковой автомобиль»*, *«Обработать заявку на грузовой автомобиль»*.
8. В дополнительных свойствах всех задач задайте формулу для заголовка задачи:

    ```
    FORMAT( "Обработайте заявку на перевозку: {0}", LIST($NaimenovanietipaTS))
    ```

1.  После каждой пользовательской задачи добавьте конечное событие.
2.  Настройте **исходящие потоки** в **дополнительных** свойствах **развилки «или/или»** следующим образом:

| Поток «Иначе»     | Конечная точка                             | Условие                                                                       |
| ----------------- | ------------------------------------------ | ----------------------------------------------------------------------------- |
|                   | *Обработать заявку на автобус*             | **Формула:** `$TipTS == "bus"`<br>`TipTS` — системное имя атрибута *«Тип ТС»* |
|                   | *Обработать заявку на легковой автомобиль  | **Формула:** `$TipTS == "car"`<br>`TipTS` — системное имя атрибута *«Тип ТС»* |
| Флажок установлен | *Обработать заявку на грузовой автомобиль* |                                                                               |
11. Опубликуйте процесс.

![Диаграмма процесса «Обработка заявок»](Pasted%20image%2020240724155836.png)
## Тестирование

1. Создайте новую заявку и выберите вид транспорта *«автобус»*.
2. Заявка перейдёт на пользовательскую задачу *«Обработать заявку на автобус»*.
3. Создайте ещё заявку и выберите вид транспорта *«легковой автомобиль»*.
4. Заявка перейдёт на пользовательскую задачу *«Обработать заявку на легковой автомобиль»*.
5. Создайте третью заявку и выберите *«грузовой автомобиль»*.
6. Заявка перейдёт на пользовательскую задачу *«Обработать заявку на грузовой автомобиль»*.
