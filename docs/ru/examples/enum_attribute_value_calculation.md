---
title: Атрибут типа «Список значений». Вычисление с помощью N3 и формул
kbId:
tags:
    - N3
    - выражение на N3
    - формулы
    - формула
    - тройки
    - тройка
    - список значений
hide:
    - tags
kbId: 2624
---

# Атрибут типа «Список значений». Вычисление значения с помощью N3 и формул {: enum_attribute_value_calculation }

## Введение

Атрибут [типа «**Список значений**»][attribute_enum] содержит в себе перечень значений на нескольких языках — русском, английском и немецком. При этом, нельзя напрямую получить текстовое значение атрибута.

Получить значение атрибута на определённом языке можно с помощью выражения на N3.

Кроме того, в логических операциях используются только системные имена значений атрибута.

Здесь представлен пример настройки приложения для передачи текстового значения атрибута на требуемом языке и условного перехода в процессе по значению атрибута типа «Список значений».

## Прикладная задача

Имеются шаблон записи _«Заявки на перевозку»_ и связанный с ним процесс _«Обработка заявок»_.
В шаблоне _«Заявки на перевозку»_ есть атрибут _«Тип ТС»_ типа «**Список значений**».

Требуется распределять заявки в процессе обработки в зависимости от выбранного _типа ТС_ и отправлять задачи диспетчерам с указанием типа заказанного ТС.

## Распределение заявок по значению атрибута список значений

1. Создайте шаблон процесса _«Обработка заявок»_ и связанный с ним шаблон записи _«Заявки на перевозку»_.
2. В шаблоне _«Заявки на перевозку»_ создайте атрибут _«Тип ТС»_ типа «**Список значений**».
3. Укажите следующие параметры для списка значений:

    | Системное имя |  RU                    |
    | ------------- |  --------------------- |
    | _bus_         |  _автобус_             |
    | _car_         |  _легковой автомобиль_ |
    | _truck_       |  _грузовой автомобиль_ |

3. Создайте **атрибут** с указанными значениями:

    | Название               | Тип       | Свойства                                                                        |
    | ---------------------- | --------- | ------------------------------------------------------------------------------- |
    | _Наименование типа ТС_ | **Текст** | <p>**Вычислять автоматически:** флажок установлен</p><p>**Вычисляемое выражение: N3**</p> |

4. Добавьте следующее выражение N3:

    ``` turtle
    # Импортируем функции для работы с записями, строками и базой данных
    @prefix object: <http://comindware.com/ontology/object#>.
    @prefix cmw: <http://comindware.com/logics#>.
    @prefix l10n: <http://comindware.com/ontology/l10n#>.
    @prefix string: <http://www.w3.org/2000/10/swap/string#>.
    @prefix cmwentity: <http://comindware.com/ontology/entity#>.
    {
        # Находим атрибут TipTS  (Тип ТС) в шаблоне Zayavki (Заявка на перевозку).
        ("Zayavki" "TipTS") object:findProperty ?TipTSAttribute.
        # Присваиваем переменной ?TipTSAttributeValues объект со списком значений атрибута «Тип автотранспорта».
        ?item ?TipTSAttribute ?TipTSAttributeValues.
        # Присваиваем переменной ?SelectedValue объект с выбранным значением атрибута.
        ?TipTSAttributeValues cmw:variantName ?SelectedValue.
        # Присваиваем переменной ?names массив объектов с заполненными названиями значения атрибута на всех языках.
        ?SelectedValue l10n:text ?names.
        # Начинаем цикл по ?names
            # Присваиваем переменной ?langCodeStr код языка названия значения атрибута на текущей итерации цикла.
            ?names l10n:lang ?langCode.
            ("{0}" ?langCode) string:format ?langCodeStr.
            # Сравниваем код языка для значения атрибута с желаемым.
            # "ru" — код русского языка, "en" — английского, "de" — немецкого.
            ?langCodeStr cmwentity:contains "ru".
                # Если предыдущее предложение возвращает true, записываем значение на русском языке в вычисляемый атрибут.     
                ?names l10n:data ?value.
        # переходим к следующей итерации по ?names.
    }
    ```

5. Поместите атрибуты _«Тип ТС»_ и _«Наименование типа ТС»_ на форму начального события.
6. После начального события добавьте **развилку «или/или»**.
7. Добавьте три потока управления и присоедините к ним **пользовательские задачи** _«Обработать заявку на автобус»_, _«Обработать заявку на легковой автомобиль»_, _«Обработать заявку на грузовой автомобиль»_.
8. В дополнительных свойствах всех задач задайте формулу для заголовка задачи:

    ``` csharp
    FORMAT("Обработайте заявку на перевозку: {0}", LIST($NaimenovanietipaTS))
    ```

9. После каждой пользовательской задачи добавьте **конечное событие**.
10. Настройте **исходящие потоки** в **дополнительных** свойствах **развилки «или/или»** следующим образом:

    | Поток «Иначе»     | Конечная точка                             | Условие                                                                       |
    | ----------------- | ------------------------------------------ | ----------------------------------------------------------------------------- |
    |                   | _Обработать заявку на автобус_             | **Формула:** `$TipTS == "bus"`<br>`TipTS` — системное имя атрибута _«Тип ТС»_ |
    |                   | _Обработать заявку на легковой автомобиль_  | **Формула:** `$TipTS == "car"`<br>`TipTS` — системное имя атрибута _«Тип ТС»_ |
    | Флажок установлен | _Обработать заявку на грузовой автомобиль_ |             |

11. Опубликуйте процесс.

_![Диаграмма процесса «Обработка заявок»](enum_attribute_value_calculation_diagram.png)_

## Тестирование

1. Создайте заявку и выберите _тип ТС_ _«автобус»_.
2. На странице «**Мои задачи**» должна появиться задача с заголовком _«Обработайте заявку на перевозку: автобус»_.
3. Создайте вторую заявку и выберите _тип ТС_ _«легковой автомобиль»_.
4. На странице «**Мои задачи**» должна появиться с заголовком _«Обработайте заявку на перевозку: легковой автомобиль»_.
5. Создайте третью заявку и выберите _тип ТС_ _«грузовой автомобиль»_.
6. На странице «**Мои задачи**» должна появиться задача с заголовком _«Обработайте заявку на перевозку: грузовой автомобиль»_.

<div class="relatedTopics">

--8<-- "related_topics_heading.md"

- *[Атрибут типа «Список значений»][attribute_enum]*
- *[Написание выражений на языке N3][manual_n3]*
- *[Список функций языка формул Comindware][formula_function_list]*

</div>

{%
include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md"
%}
