---
title: Отправка почты SMTP
kbId:
---

# Отправка почты SMTP

## Введение

## Настройка подключения и путей передачи данных

1. Создайте новое подключение типа «**Отправка эл. почты через SMTP**» со следующими настройками:

    - **Системное имя:** _smtp_connection_
    - **Название:** _Отправка уведомлений через SMTP_
    - **Хост:** _smtp.test.ru_
    - **Порт:** _465_
    - **Тип аутентификации: Базовая**
    - **Имя пользователя:** _test_
    - **Пароль:** _Пароль_
    - **Шифрование: SSL**
    - **Адрес эл. почты отправителя:** _test@test.ru_

2. Создайте новый путь передачи данных со следующими свойствами:

    - **Подключение:** _Отправка уведомлений через SMTP_
    - **Системное имя:** _smtp_route_
    - **Описание:** _Отправка уведомлений по эл. почте через SMTP_

3. На вкладке «**Атрибуты сообщений**» добавьте в «**Запрос**» следующие атрибуты:

    - _Body_ типа «**Строка**»
    - _Subject_ типа «**Строка**»

4. На вкладке «**Интеграция**» задайте следующие параметры:

    - **Шаблон темы:** _{Subject}_
    - **Шаблон текста сообщения:** _{Body}_

## Настройка шаблона записи

1. Создайте шаблон записи _«Уведомления»_.
2. Создайте следующие атрибуты:

    - _Получатель_ типа «**Аккаунт**»;
    - _Тема уведомления_ типа «**Текст**»;
    - _Текст уведомления_ типа «**Текст**»;
    - _Вложение_ типа «**Документ**».

3. Создайте кнопку _«Отправить уведомление»_ со следующими свойствами:

    - **Контекст операции: запись**
    - **Операция: вызвать событие «Нажата кнопка»**
    - **Результат выполнения: обновить данные**

4. Добавьте атрибуты на форму.
5. Добавьте кнопку _«Отправить уведомление»_ на форму.

## Настройка сценария

1. Создайте сценарий _«Отправка уведомления»_.
2. В свойствах события «**Нажатие кнопки**» выберите **контекстный шаблон** _«Уведомления»_ и **кнопку** _«Отправить уведомление»_.
3. Создайте следующее действие «**Сменить контекст**»:

    - **Целевой шаблона записи:** _«Уведомления»_
    - **Атрибут или выражение для поиска объектов: Атрибут** `ID`

4. Создайте вложенное действие «**Изменить значения переменных**»:

    - **Операция со значениями переменных: заменить**
    - **Набор переменных:** _notification_
    - **Переменные:**
        - _To_
            - вложенная в _To_ переменная _Address_ со значением **формула**: `$Poluchatel->mbox`
        - _Body_ со значением _Текст уведомления_ типа **атрибут**
        - _Subject_ со значением _Тема уведомления_ типа **атрибут**
        - _Attachments_
            - вложенная в _Attachments_ переменная _Name_ со значением **N3**:
            
            ```turtle
            # Импортируем функции для работы с записями и документами
            @prefix object: <http://comindware.com/ontology/object#>.
            @prefix document: <http://comindware.com/ontology/document#>.

            {
                # Находим атрибут Vlozhenie  (Вложение) в шаблоне Uvedomleniya (Уведомления).
                ("Uvedomleniya" "Vlozhenie") object:findProperty ?VlozhenieAttribute.
                # Присваиваем переменной ?Vlozhenie объект из атрибута «Вложение».
                ?item ?VlozhenieAttribute ?Vlozhenie.
                # В переменную ?currentDocument помещаем последнюю добавленную версию документа.
                ?Vlozhenie document:currentRevision ?currentDocument.
                # Помещаем в переменную value название текущего документа.
                ?currentDocument document:name ?value.
            }
            ```

            - вложенная в _Attachments_ переменная _Extension_ со значением **N3**:

            ```turtle
            # Импортируем функции для работы с записями и документами
            @prefix object: <http://comindware.com/ontology/object#>.
            @prefix document: <http://comindware.com/ontology/document#>.

            {
                # Находим атрибут Vlozhenie  (Вложение) в шаблоне Uvedomleniya (Уведомления).
                ("Uvedomleniya" "Vlozhenie") object:findProperty ?VlozhenieAttribute.
                # Присваиваем переменной ?Vlozhenie объект из атрибута «Вложение».
                ?item ?VlozhenieAttribute ?Vlozhenie.
                # В переменную ?currentDocument помещаем последнюю добавленную версию документа.
                ?Vlozhenie document:currentRevision ?currentDocument.
                # Помещаем в переменную value расширение текущего документа.
                ?currentDocument document:revisionExtension ?value.
            }
            ```

            - вложенная в _Attachments_ переменная _Extension_ со значением **N3**:

            ```turtle
            # Импортируем функции для работы с записями и документами
            @prefix object: <http://comindware.com/ontology/object#>.
            @prefix document: <http://comindware.com/ontology/document#>.

            {
                # Находим атрибут Vlozhenie  (Вложение) в шаблоне Uvedomleniya (Уведомления).
                ("Uvedomleniya" "Vlozhenie") object:findProperty ?VlozhenieAttribute.
                # Присваиваем переменной ?Vlozhenie объект из атрибута «Вложение».
                ?item ?VlozhenieAttribute ?Vlozhenie.
                # В переменную ?currentDocument помещаем последнюю добавленную версию документа.
                ?Vlozhenie document:currentRevision ?currentDocument.
                # Помещаем в переменную value содержимое текущего документа.
                ?content document:content ?value.
            }
            ```

5. Добавьте вложенное действие «**Отправить сообщение**» со следующими свойствами:

    - **Подключение:** _smtp_connection_
    - **Путь передачи данных:** _smtp_route_
    - **Переменная с сообщением:** _notification_

_![Сценарий для кнопки «Отправить уведомление»](smtp_send_example_scenario.png)_

## Тестирование

1. Создайте запись в шаблоне _«Уведомления»_.
2. Выберите аккаунт, на эл. почту которого требуется отправить уведомление.
3. Заполните поля _«Тема уведомления»_, _«Текст уведомления»_ и _«Вложение»_.
4. Сохраните запись.
5. Нажмите кнопку _«Отправить уведомление»_.
6. На эл. почту, выбранного аккаунта, придёт сформированное уведомление.