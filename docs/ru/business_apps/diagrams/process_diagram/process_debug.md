---
title: Отслеживание ошибок в экземплярах процесса
kbId: 
tags:
hide:
    - tags
---

# Отслеживание ошибок в экземплярах процесса

## Введение

## Создание таблицы для отслеживания ошибок в процессах

1. Перейдите на вкладку «**Таблицы**» процесса.
2. Откройте двойным нажатием в списке или создайте новую таблицу «**Процессы с ошибками**».
3. В поле «**Системный фильтр**» добавьте следующее выражение N3:

    ``` turtle
    # Импортируем функции для работы с процессами
    @prefix process: <http://comindware.com/ontology/process#>.
    @prefix cmw: <http://comindware.com/logics#>.
    {
    
    # Собираем данные по всем экземпляра процесса
    ?item process:businessObject ?.
    # Фильтруем экземпляры процесса по наличию ошибок в них
    ?item process:hasTokenError true.

    }
    ```

4. Сохраните таблицу.
5. Перейдите к списку экземпляров процесса.
6. Откройте вкладку «Процессы с ошибками».
7. Отобразится список процессов, при выполнении которых произошли ошибки.

## Отслеживание ошибок

1. Создайте атрибут «Отслеживание ошибок» в шаблоне, связанным с процессом.
2. Добавьте скрипт по следующему образцу:

    ``` cs
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using Comindware.Data.Entity;
    using Comindware.TeamNetwork.Api.Data.UserCommands;
    using Comindware.TeamNetwork.Api.Data;

    class Script
    {
        public static string Main(Comindware.Process.Api.Data.ScriptContext context, Comindware.Entities entities)
        {
            // Добавьте входные данные.
            int Result = 0;
            try
            {
                // Добавьте код, который должен работать в штатном режиме.
                Result = 1;
            }
            catch
            {
                // Добавьте код, который должен отработать в случае ошибки.
            Result = -1;
                // op.1 — ID атрибута шаблона записи, в который будет выводится текст об ошибке
            var data = new Dictionary<string, object>{{"op.1", "Ошибка процесса"}};
            Api.TeamNetwork.ObjectService.Edit(context.BusinessObjectId, data);
            }
            // Эта строка отобразится в поле «Выходные данные» в событии «Скрипт выполнен» в цепочке событий для задачи-выполнения сценария.
            return string.Format("Результат: {0}", Result);
        }
    }
    ```

3. Добавьте задачу «Посмотреть ошибку задаче-выполнения сценария» и добавьте на неё атрибут «Отслеживание ошибок».
4. После задачи-выполнения сценария добавьте развилку «или/или».
5. Соедините развилку «или/или» с задачей-выполнением сценария.
6. Настройте исходящие потоки на развилке «или/или»:

| Поток «иначе» | Конечная точка | Условие|
|---|---|---|
| Флажок установлен | Пользовательская задача «Посмотреть ошибку задаче-выполнения сценария» ||
||||