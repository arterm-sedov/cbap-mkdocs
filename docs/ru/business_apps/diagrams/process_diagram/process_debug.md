---
title: Отслеживание ошибок в экземплярах процесса
kbId: 
tags:
    - процесс
    - ошибка процесса
    - ошибка задачи-выполнении сценария
    - ошибка C#-скрипта
hide:
    - tags
---

# Отслеживание ошибок в экземплярах процесса

## Введение

**{{ productName }}** предоставляет возможность моделирования бизнес-процессов и их реализации с назначением задач исполнителям, выполнением сценариев, отправкой внутренних и внешних сообщений, просмотром журнала действий. В ходе выполнения процесса могут возникнуть ошибки различного рода.

Здесь представлены некоторые инструменты, которые помогают отследить ошибки, возникающие в процессах:

- настройка таблицы экземпляров процесса с фильтром по наличию ошибок;
- просмотр журнала изменений;
- использование вспомогательного атрибута для отслеживания ошибок при исполнении C#-скрипта в процессе.

## Настройка таблицы для отслеживания ошибок в экземплярах процесса

Чтобы отслеживать процессы, в которых произошла ошибка, настройте таблицу экземпляров процесса и задайте фильтр по наличию ошибок:

1. Перейдите на вкладку «**Таблицы**» процесса.
2. Откройте двойным нажатием в списке или создайте новую таблицу «**Процессы с ошибками**».
3. В поле «**Системный фильтр**» добавьте следующее выражение N3:

    ``` turtle
    # Импортируем функции для работы с процессами
    @prefix process: <http://comindware.com/ontology/process#>.
    @prefix cmw: <http://comindware.com/logics#>.
    {
    
    # Собираем данные по всем экземпляра процесса
    ?item process:businessObject ?.
    # Фильтруем экземпляры процесса по наличию ошибок в них
    ?item process:hasTokenError true.

    }
    ```

4. Сохраните таблицу.
5. Перейдите к списку экземпляров процесса.
6. Откройте вкладку _«Процессы с ошибками»_.
7. Отобразится список процессов, при выполнении которых произошли ошибки.

## Журнал изменений

Чтобы просмотреть подробную информацию об ошибке, которая произошла при выполнении процесса, воспользуйтесь **журналом изменений**:

1. Откройте диаграмму экземпляра процесса, в котором произошла ошибка.
2. Откройте **журнал изменений**.
3. Нажмите значок <i class="fa-light fa-circle-exclamation"></i> рядом с событием, в котором произошла ошибка.
4. Откроется **цепочка событий** и отобразится информация об ошибке в панели «**Выполнение элемента процесса**».

См. также _[«Просмотр цепочки событий»][events_chain_view]_.

## Отслеживание ошибок при выполнении задач-выполнении сценария

Для поиска ошибок в C#-скриптах можно воспользоваться конструкцией `try..catch`, которая позволяет перехватить исключения. См. подробнее _[«Отладка формул, выражений N3, сценариев и C#-скриптов»][expression_debug]_.

Чтобы оперативно отслеживать ошибки, которые возникли при выполнении задачи-выполнении сценария, следует поместить сообщение об ошибке в текстовый атрибут и вывести его в отдельной задаче.

1. Создайте атрибут _«Отслеживание ошибок»_ (системное имя _«ErrorMonitoring»_) в шаблоне, связанным с процессом.
2. Добавьте на процесс задачу-выполнение сценария со скриптом по следующему образцу:

    ``` cs
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using Comindware.Data.Entity;
    using Comindware.TeamNetwork.Api.Data.UserCommands;
    using Comindware.TeamNetwork.Api.Data;

    class Script
    {
        public static string Main(Comindware.Process.Api.Data.ScriptContext context, Comindware.Entities entities)
        {
            // Добавьте входные данные.
            int Result = 0;
            try
            {
                // Добавьте код, который должен работать в штатном режиме.
                Result = 1;
                    // ErrorMonitoring — системное имя атрибута «Отслеживание ошибок»
                var data = new Dictionary<string, object>{{"ErrorMonitoring", "Нет ошибок выполнения скрипта"}};
                Api.TeamNetwork.ObjectService.EditWithAlias(context.BusinessObjectId, data);
            }
            catch
            {
                // Добавьте код, который должен отработать в случае ошибки.
                Result = -1;
                    // ErrorMonitoring — системное имя атрибута «Отслеживание ошибок»
                var data = new Dictionary<string, object>{{"ErrorMonitoring", "Ошибка выполнения скрипта"}};
                Api.TeamNetwork.ObjectService.EditWithAlias(context.BusinessObjectId, data);
            }
            // Эта строка отобразится в поле «Выходные данные» в событии «Скрипт выполнен» в цепочке событий для задачи-выполнения сценария.
            return string.Format("Результат: {0}", Result);
        }
    }
    ```

3. Создайте задачу _«Ошибка выполнения скрипта»_ и добавьте на её форму атрибут _«Отслеживание ошибок»_.
4. После задачи-выполнения сценария добавьте развилку «**или/или**».
5. Соедините развилку «**или/или**» с задачей _«Ошибка выполнения скрипта»_ и следующим этапом процесса.
6. Настройте исходящие потоки на развилке «**или/или**»:

    <table block="markdown">
    <tbody block="markdown">
    <tr block="markdown">
    <th block="markdown">
    Поток «иначе»
    </th>
    <th block="markdown">
    Конечная точка
    </th>
    <th block="markdown">
    Условие
    </th>
    </tr>
    <tr block="markdown">
    <td block="markdown">
    Флажок установлен
    </td>
    <td block="markdown">
    Пользовательская задача _«Ошибка выполнения скрипта»_
    </td>
    <td block="markdown">
    </td>
    </tr>
    <tr block="markdown">
    <td block="markdown">
    </td>
    <td block="markdown">
    Следующий этап процесса
    </td>
    <td block="markdown">
    **Формула:**

    ``` cs
    $ErrorMonitoring == "Нет ошибок выполнения скрипта"
    ```

    </td>
    </tr>
    </tbody>
    </table>

7. Настройте остальные действия процесса.

_![Диаграмма процесса с использованием задачи «Ошибка выполнения скрипта»](img/process_debug_process_diagram.png)_

### Тестирование

1. Запустите экземпляр процесса.
2. Дождитесь завершения выполнения задачи-выполнения сценария.
3. При возникновении ошибок отобразится задача  _«Ошибка выполнения скрипта»_.
4. Перейдите к диаграмме процесса и откройте журнал изменений.
5. Нажмите значок <i class="fa-light fa-circle-exclamation"></i> рядом с событием, в котором произошла ошибка.
6. Откроется **цепочка событий** и отобразится информация об ошибке в панели «**Выполнение элемента процесса**».

--8<-- "related_topics_heading.md"

**[Использование диаграммы экземпляра процесса][process_diagram_view_instance]**

**[Отладка формул, выражений N3, сценариев и C#-скриптов][expression_debug]**

{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
