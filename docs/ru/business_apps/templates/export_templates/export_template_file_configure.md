---
tags:
  - шаблон экспорта
  - создание файла шаблона экспорта
  - настройка файла шаблона экспорта
  - настройка шаблона экспорта
  - файл шаблона экспорта
  - DOCX
  - Word
  - XLSX
  - Excel
  - поля-заполнители
  - поля шаблона экспорта
  - синтаксис полей шаблона экспорта
  - экспорт данных
  - атрибут-заголовок записи
  - экспорт с помощью C#
  - Экспорт в Word
  - Экспорт в Excel
hide:
  - tags
---

# Подготовка файла шаблона экспорта

!!! Question "Определения"

    * **Файл шаблона экспорта** представляет собой макет для выгрузки данных записи с требуемым визуальным оформлением.
    * Файл шаблона можно сформировать в формате `DOCX` или `XLSX`.
    * В файл шаблона экспорта необходимо вставить поля согласно определённому [синтаксису](#синтаксис-полей-шаблона-экспорта). Эти поля будут заменены на экспортируемые данные.

## Создание файла шаблона экспорта

1. Создайте документ Excel (`XLSX`) или Word (`DOCX`).
2. Введите в документ требуемые сведения.
3. Отформатируйте документ обычным образом.
4. Введите [поля](#синтаксис-полей-шаблона-экспорта) в те места документа, куда требуется экспортировать данные записи.
5. Должен получиться документ следующего вида (см. [пример](export_template_file_example.md)):

    *![Пример простейшего файла шаблона экспорта](export_template_file_example.png)*

## Синтаксис полей шаблона экспорта

В файле шаблона экспорта используются поля-заполнители. При экспорте данных записи поля заменяются значениями атрибутов, а остальной текст остаётся без изменений.

Синтаксис полей зависит от того, используется ли для экспорта данных [скрипт C#](#синтаксис-для-экспорта-с-использованием-c).

### Синтаксис для экспорта без использования C\#

{% raw %}

* В документ введите поля вида `{AttributeSystemName}` (_без пробелов_ в фигурных скобках), где `AttributeSystemName` — системное имя атрибута, значение которого необходимо экспортировать в файл. Значение атрибута будет экспортировано в формате отображения, заданном в свойствах атрибута.
* `{RecordAttribute.LinkedTemplateAttribute}` — чтобы экспортировать значение атрибута связанного шаблона, укажите его системное имя через точку _без пробела_ после системного имени атрибута типа «**Запись**». 
* `{#LinkedTemplateAttribute}` — чтобы экспортировать значение атрибута типа «**Запись**» в виде гиперссылки на запись связанного шаблона, укажите системное атрибута с префиксом `#`. Гиперссылка будет содержать идентификатор или заголовок записи (если в шаблоне указан [атрибут-заголовок](displayed_attribute.md)).
* `{foreach:RecordAttribute} {#LinkedAttribute1} {LinkedAttribute2} {end:RecordAttribute}` —
для экспорта данных из нескольких записей связанного шаблона используйте операторы `foreach` и `end` в строке таблицы:

    * Строка таблицы с операторами `foreach` и `end` будет преобразована в несколько строк с данными записей связанного шаблона.
    * В первом столбце строки введите в фигурных скобках оператор `foreach` и через двоеточие _без пробела_ системное имя атрибута типа «**Запись**».
    * В последнем столбце строки введите в фигурных скобках оператор `end` и через двоеточие _без пробела_ системное имя атрибута типа «**Запись**»;
    * Между операторами `foreach` и `end` введите системные имена атрибутов связанного шаблона в фигурных скобках.

* **`{AttributeSystemName} полужирный текст`**_`{AttributeSystemName2} курсив`_ — между полями можно располагать произвольный текст. Текст и поля можно форматировать (курсивом, полужирным шрифтом и т. п.). Экспортируемые данные будут отформатированы соответствующим образом.
* `{ImageAttributeSystemName}` — если в поле указано системное имя атрибута типа «**[Изображение](attribute_image.md)**», поле будет заменено на изображение, хранящееся в атрибуте.

* `{QRCodeAttributeSystemName:200:100}` — если в поле указано системное имя атрибута типа «**[Штрихкод](attribute_barcode.md)**», поле будет заменено на изображение штрихкода, сформированного по значению атрибута. Для штрихкода можно указать ширину и высоту через двоеточие после системного имени атрибута. Если указать только ширину, то штрихкод будет квадратным. Если не указывать ширину и высоту, то будет использоваться стандартный размер штрихкода.

{% endraw %}

*![Пример синтаксиса полей шаблона экспорта](export_template_file_advanced_syntax_example.png)*
{{ pdfEndOfBlockHack }}

### Синтаксис для экспорта с использованием C\#

Экспортировать данные посредством шаблона экспорта можно с помощью скрипта C#. Это позволяет более гибко настроить параметры экспорта, например с дополнительной фильтрацией, заменой информации, форматированным выводом [атрибутов типа «**Запись**»](attribute_record.md) с несколькими значениями (коллекций).

Скрипт C# для шаблона экспорта следует ввести на вкладке «**Скрипт**» [кнопки экспорта](export_template_button_configure.md), которая автоматически создаётся для каждого шаблона экспорта.

Примеры скриптов C# для экспорта данных см. в статьях _«[Настройка шаблона экспорта с использованием C#]({{ kbArticleURLPrefix }}1942)»_, и _«[Настройка выгрузки нескольких коллекций и изображений]({{ kbArticleURLPrefix }}1944)»_

При экспорте данных с помощью С# синтаксис полей шаблона экспорта различается в зависимости от формата файла шаблона экспорта:
  
#### Синтаксис для XLSX-файлов

* Скрипт C# должен передавать данные в функцию:

    ```C#
    Api.TeamNetwork.ObjectAppExportService.ExecuteExcelExportTemplate("exportTemplate.N", dataToExport)
    ```

    Здесь:

    * `exportTemplate.N` — ID шаблона экспорта;
    * `dataToExport` — массив объектов с экспортируемыми данными.

* В ячейки введите поля вида `&=data.propertyName`.
  
    * Здесь `data` — массив экспортируемых данных, переданный скриптом C#.
    * `propertyName` — имя свойства элемента массива `data`, значение которого необходимо поместить в ячейку.

*  В одной ячейке может быть только одно поле.
* Для корректного экспорта данных необходимо указать формат ячейки, соответствующий типу экспортируемого значения.
* Объявлять циклы `foreach` не требуется: для массивов строки на листе формируются автоматически.

    !!! Warning "Внимание!"

        * Если поле обращается к свойству, имеющему тип массива (например, `LIST<T>`), то это свойство не может быть `null` и `undefined` (то есть массив обязательно должен быть объявлен), _в противном случае экспорт не будет выполнен_.

        * Например, если `&=data.Contract` имеет тип `LIST<T>`, то у каждого объекта в массиве `data` должно быть объявлено свойство `Contract`.

    *![Пример XSLX-файла шаблона экспорта для C#](export_template_file_c_syntax_example_xlsx.png)*

#### Синтаксис для DOCX-файлов

* Скрипт C# должен передавать данные в функцию:

    ```
    Api.TeamNetwork.ObjectAppExportService.ExecuteWordExportTemplate("exportTemplate.N", dataToExport)
    ```

    Здесь:

    * `exportTemplate.N` — ID шаблона экспорта;
    * `dataToExport` — объект класса `RESULT`, содержащий экспортируемые данные.

* В документ введите поля вида `<<[propertyName]>>`, где `propertyName` — имя свойства объекта `dataToExport`, значение которого необходимо поместить в текст.
* Чтобы экспортировать массив данных, используйте в строке таблицы или абзаце следующую конструкцию:
    ```
    <<foreach [row in dataArray]>><<[row.property0]>> <<[row.property1]>> ... <<[row.propertyN]>><</foreach>>
    ```
    или
    ```
    <<foreach [in dataArray]>><<[property0]>> <<[property1]>> ... <<[propertyN]>><</foreach>>
    ``` 
    Здесь:
    *  `foreach` — оператор цикла по массиву `dataArray`
    *  `row` — переменная-итератор цикла (_необязательная_);
    *  `dataArray` — имя массива, переданного в объекте `dataToExport`.
    *  `property0`...`propertyN` — имена свойств элементов массива `dataArray`, значения которых необходимо поместить в текст.

* Чтобы экспортировать изображение, введите поле вида `<<image [imageData]>>`, где `imageData` — имя массива типа `byte` с данными изображения, переданного в объекте `dataToExport`.

    *![Пример DOCX-файла шаблона экспорта для C#](export_template_file_c_syntax_example_docx.png)*

--8<-- "related_topics_heading.md"

**[Пример настройки и использования шаблона экспорта авансового отчёта](export_template_file_example.md)**

**[Настройка простого шаблона экспорта]({{ kbArticleURLPrefix }}1767)**

**[Настройка выгрузки нескольких коллекций и изображений]({{ kbArticleURLPrefix }}1944)**

**[Настройка шаблона экспорта с использованием C#]({{ kbArticleURLPrefix }}1942)**

**[Настройка шаблона экспорта](export_template_configure.md)**

**[Настройка кнопки экспорта](export_template_button_configure.md)**
