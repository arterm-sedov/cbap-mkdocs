---
title: Использование переменных в сценарии
tags:
  - сценарии
  - сценарий
  - действие сценария
  - шаги сценария
  - действия
  - триггеры
  - переменные
  - системные переменные
  - локальные переменные
  - переменные в сценарии
hide:
  - tags
kbId: 2399
---

# Использование переменных в сценарии {: #scenario_variables}

Для передачи данных между сценарием, записями и процессами можно использовать переменные.

Для обращения к переменным в формулах используйте префикс `$$`.

В выражениях N3 к переменным следует обращаться как к атрибутам.

**Системные переменные**

* `BusinessObject` — ID записи, связанной с текущим экземпляром шаблона процесса в сценариях по событиям «**Вход токена**» и «**Выход токена**».
* `origin` — значение зависит от типа события, вызвавшего сценарий:
    - событие «**Нажатие кнопки**» — ID записи, экземпляра процесса, задачи или аккаунта, для которого была нажата кнопка;
    - события «**Создание записи**», «**Изменение записи**» — ID записи;
    - события «**Запуск процесса**», «**Вход токена**», «**Выход токена**» — ID экземпляра процесса.
* `ProcessObject` — ID экземпляра процесса в сценариях по событиям «**Запуск процесса**», «**Вход токена**», «**Выход токена**».
* `dialogVariables` — локальные переменные кнопки, которая вызвала сценарий по событию «**Нажатие кнопки**». Значения локальных переменных кнопки задаются в диалоговом окне для кнопки. См. [пример](#практический-пример).
* `IncomingMessage` — в эту переменную можно поместить значения атрибутов ответа на HTTP-запрос в сценариях по событию «**Получено сообщение**».
    - Атрибуты ответа настраиваются в свойствах пути передачи данных «**Получение HTTP-запросов**».
    - Чтобы изменить значения  атрибутов ответа, используйте действие «**Изменить значения переменных**»: в поле «**Набор переменных**» укажите `IncomingMessage`, добавьте переменные в таблицу и задайте их значения.
* `timeZoneOffset` — смещение часового пояса сервера в минутах, тип данных — «**Длительность**».
* `requestTime` — текущее время, тип данных «**Дата и время**».

**Локальные переменные**

* Переменная, хранящая ID объекта, используемого для текущей итерации, в действии «**Повторять по количеству объектов**».
* Переменная, хранящая номер текущей итерации в действии «**Повторять по числовому счётчику**».
* Набор переменных, заданных в действии «**Изменить значения переменных**».
* Переменные для успешного ответа и ответа с ошибкой в действии «**Отправить сообщение**».
* Переменная, хранящая ID документа, в действии «**Создать документ по шаблону**».

## Практический пример

!!! example "Корректировка времени в табеле трудозатрат"

    **Конфигурация приложения**

    - Шаблон _«Трудозатраты»_
        -  Атрибут _«Затраченное время»_
            - **Тип данных**: **длительность**.
    - Шаблон _«Табели трудозатрат»_
        -  Атрибут _«Записи трудозатрат»_
            - **Тип данных**: **запись**.
            - **Связанный шаблон**: _Трудозатраты_.
            - **Хранить несколько значений**: флажок установлен.
        - Кнопка _«Скорректировать время»_
            - **Контекст операции**: **запись**.
            - **Операция**: **вызвать событие «Нажата кнопка»**.
            - **Сохранять запись после выполнения**: флажок установлен.
            - **Результат выполнения**: **обновить данные**.
            - **Локальная переменная** _«Новое время»_ 
                - **Тип данных**: **длительность**.
                - **Системное имя**: `newTime`
            - **Отображать диалоговое окно**: флажок установлен.
              - **Диалоговое окно для кнопки «Скорректировать время»**
                  - **Отображаемое название**: _Введите затраченное время_
                  - Переменная _«Новое время»_  вынесена на форму.
        - Форма «Табель»
            - Атрибут _«Записи трудозатрат»_ вынесен на форму как таблица.
            - На область кнопок таблицы _«Записи трудозатрат»_ вынесена кнопка _«Скорректировать время»_.
            - В таблицу _«Записи трудозатрат»_ вынесены столбцы _«ID»_ и _«Затраченное время»_
    - Сценарий _«Нажата кнопка «Скорректировать время» для записей «Табель времени»_
        - Действие «Повторять по количеству объектов»
            - **Переменная** — `rec`.
            - **Атрибут или выражение для поиска объектов**: атрибут _«Записи трудозатрат»_.
        - Действие «**Сменить контекст**» внутри действия «**Повторять по количеству объектов**».
            - **Целевой шаблон записи**: _Трудозатраты_.
            - **Атрибут или выражение для поиска объектов**: формула `$$rec`.
        - Действие «**Изменить значения атрибутов**» внутри действия «**Сменить контекст**».
            - **Атрибут** _«Затраченное время»_
                - **Операция со значениями**: **Заменить**.
                - **Значение**: формула `$$dialogVariables->newTime`.
      
    _![Пример сценария с использованием переменных](scenario_with_variables.png)_
    
    **Результирующее поведение**

    1. Создайте запись в шаблоне _«Табели трудозатрат»_.
    2. На форме _«Табель»_ создайте несколько записей в таблице _«Записи трудозатрат»_ и не заполняйте поле «**Затраченное время**».
    3. Сохраните запись.
    4. Нажмите кнопку _«Скорректировать время»_.
    5. Отобразится диалоговое окно _«Введите затраченное время»_.
    6. В поле _«Новое время»_ введите желаемое значение.
    7. Во всех записях в таблице _«Записи трудозатрат»_ будет установлено затраченное время, которое вы ввели в диалоговом окне.

--8<-- "related_topics_heading.md"

**[Сценарии. Определение, создание, настройка, использование][scenarios]**

**[Настройка действий сценария][scenario_actions]**

{%
include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md"
%}
