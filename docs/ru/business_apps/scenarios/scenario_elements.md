---
title: Событие и действия сценария
tags:
  - сценарии
  - сценарий
  - событие
  - событие сценария
  - триггеры
hide:
  - tags
kbId: 2346
---

# Событие и действия сценария. Определения, типы, свойства, настройка {: #scenario_elements}

## Введение

Каждый сценарий включает в себя одно событие, которое запускает его, и последовательность действий, которые выполняются друг за другом.

Здесь перечислены типы **[событий](#события-сценария)** и **[действий](#действия-сценария)** и их свойства.

## Событие сценария {: #scenario_event}

!!! question "Событие сценария"

    **Событие** — это элемент, наступление которого запускает сценарий.

    При создании нового сценария автоматически добавляется событие «**Нажата кнопка**», кроме сценариев на входе и выходе токена.
    
    Для сценариев предусмотрены следующие **типы событий**:

    - **[Нажатие кнопки](#нажатие-кнопки)**;
    - **[Создание записи](#создание-записи)**;
    - **[Изменение записи](#изменение-записи)**;
    - **[Запуск процесса](#запуск-процесса)**;
    - **[Получение сообщения](#получение-сообщения)**;
    - **[Вход токена](#вход-токена)**;
    - **[Выход токена](#выход-токена)**.

    У событий можно настроить [общие](#общие-свойства-событий) и [специфические свойства](#свойства-событий-по-типам).

### Общие свойства событий

У событий всех типов предусмотрены перечисленные ниже свойства:

- **Описание** — введите краткий комментарий о событии сценария.
- **Тип** — укажите [тип события](#свойства-событий-по-типам), запускающего сценарий.
- **Контекстный шаблон** — укажите шаблон записи или процесса, в контексте которого будет запускаться сценарий по указанному событию.

_![Окно свойств события сценария](scenario_event_properties.png)_

### Свойства событий по типам

#### Нажатие кнопки

Сценарий будет запускаться при нажатии указанной кнопки в **[контекстном шаблоне](#общие-свойства-событий)**.

- **Кнопка** — укажите кнопку при нажатии, которой будет запущен сценарий.

!!! note "Примечание"

    Сценарий может быть запущен при нажатии любой кнопки, кроме кнопки «**Создать**».

#### Создание записи

Сценарий будет запускаться при создании записи в **[контекстном шаблоне](#общие-свойства-событий)**.

#### Изменение записи

Сценарий будет запускаться при изменении значений указанных атрибутов записи в **[контекстном шаблоне](#общие-свойства-событий)**. Если атрибуты не указаны, то сценарий будет запускаться при изменении значения любого атрибута в **контекстном шаблоне**.

- **Атрибуты** — укажите список атрибутов **контекстного шаблона**, при изменении значений которых будет запускаться сценарий.

#### Запуск процесса

Сценарий будет запускаться при запуске процесса по **[контекстному шаблону](#общие-свойства-событий)**.

#### Получение сообщения

Сценарий будет запускаться при получении сообщения через указанные подключение и путь передачи данных.

- **Подключение** — укажите подключение для получения сообщений, инициирующих запуск сценария.
- **Путь передачи данных** — укажите путь передачи данных для обработки сообщения.
- **Имя переменной** — укажите переменную, в которую будет помещено содержимое сообщения, обработанное посредством пути передачи данных.

#### Вход токена

Сценарий будет запускаться при входе токена в выбранный элемент диаграммы **[контекстного шаблона](#общие-свойства-событий)** процесса.

- **Элемент диаграммы** — [элемент диаграммы процесса][process_diagram_elements], при входе токена в который будет запускаться сценарий.

#### Выход токена

Сценарий будет запускаться при выходе токена из выбранного элемента диаграммы **[контекстного шаблона](#общие-свойства-событий)** процесса.

- **Элемент диаграммы** — [элемент диаграммы процесса][process_diagram_elements], при выходе токена из которого будет запускаться сценарий.

## Действия сценария {: #scenario_actions}

!!! question "Действия сценария"

    **Действия сценария** — это элементы последовательности сценария, которые выполняются по порядку при наступлении определённого события.

    В **{{ productName }}** предусмотрены следующие **типы действий** сценария:

    - **[создать запись](#создать-запись)**;
    - **[дублировать запись](#дублировать-запись)**;
    - **[сменить контекст](#сменить-контекст)**;
    - **[изменить значения атрибутов](#изменить-значения-атрибутов)**;
    - **[создать документ по шаблону](#создать-документ-по-шаблону)**;
    - **[прикрепить документ к атрибуту](#прикрепить-документ-к-атрибуту)**;
    - **[запустить процесс](#запустить-процесс)**;
    - **[отправить сообщение](#отправить-сообщение)**;
    - **[проверить результат выражения](#проверить-результат-выражения)**;
    - **[проверить результат скрипта](#проверить-результат-скрипта)**;
    - **[выполнить по условиям](#выполнить-по-условиям)**;
    - **[повторять по числовому счётчику](#повторять-по-числовому-счётчику)**;
    - **[повторять по количеству объектов](#повторять-по-количеству-объектов)**;
    - **[изменить значения переменных](#изменить-значения-переменных)**;
    - **[изменить значения скриптом](#изменить-значения-скриптом)**.

    Внутри действий «**Создать запись**», «**Дублировать запись**», «**Сменить контекст**», «**Выполнить по условиям**», «**Повторять по числовому счётчику**», «**Повторять по количеству объектов**» можно создать вложенные действия.

    У действий можно настроить [общие](#общие-свойства-действий) и [специфические](#свойства-действий-по-типам) свойства.

### Общие свойства действий

У всех действий предусмотрены перечисленные ниже свойства.

- Вкладка «**Основные**»
    - **Описание** — комментарий о назначении действия.
- Вкладка «**Дополнительно**»
    - **Тип** — наименование типа действия.
    - **Контекстный шаблон** — шаблон, в котором будет выполняться действие.
    - **Игнорировать все ошибки** — если установлен этот флажок, данное действие сценария будет выполняться несмотря на любые ошибки: исключения, недопустимые данные и т. п.
    - **Выполнять отдельно от сценария** — если установлен этот флажок, данное действие и все вложенные в него действия будут выполняться асинхронно с последующими действиями в сценарии.

_![Общие свойства действий на вкладке «Дополнительно»](scenario_actions_common_properties.png)_

### Свойства действий по типам

#### Создать запись

Это действие создаёт запись в указанном шаблоне. Оно приводит к смене контекста.

**Свойства**

- **Целевой шаблон записи** — шаблон, в котором будет создана запись.
- **Ссылка на новую запись** — атрибут типа «**Запись**» контекстного шаблона (указан на вкладке «**Дополнительно**»), в который будет помещена ссылка на созданную запись. Это поле можно задать, если контекстный шаблон связан с целевым шаблоном.
- **Операция со значениями** — доступно, если выбрана ссылка на новую запись:
    - **Добавить** — добавление ссылки на созданную запись в указанный атрибут (если для него установлен флажок «**Хранить несколько записей**»).
    - **Заменить** — замена имеющихся ссылок в указанном атрибуте ссылкой на созданную запись.

_![Свойства действия «Создать запись»](scenario_actions_create_record.png)_

#### Дублировать запись

Это действие дублирует указанные записи. Целевой шаблон должен совпадать с контекстным шаблоном (указан на вкладке «**Дополнительно**»). Данное действие приводит к смене контекста.

**Свойства**

- **Целевой шаблон записи** — шаблон, в котором будет создан дубликат записи.
- **Ссылка на новую запись** — атрибут типа «**Запись**» контекстного шаблона (указан на вкладке «**Дополнительно**»), в который будет помещена ссылка на дублированную запись. Это поле можно задать, если контекстный шаблон связан с целевым шаблоном записи.
- **Атрибут или выражение для поиска объектов** — атрибут типа «**Запись**», ссылающийся на дублируемые записи, или выражение (формулу, N3 или DMN), возвращающее идентификатор дублируемых записей.
- **Операция со значениями** — доступно, если выбрана ссылка на новую запись:
    - **Добавить** — добавление ссылки на созданную запись в указанный атрибут (если у него установлен флажок «**Хранить несколько значений**»).
    - **Заменить** — замена имеющихся ссылок в указанном атрибуте ссылкой на созданную запись.
- **Дублировать дочерние записи** — установите этот флажок, чтобы дублировать запись вместе с записями, на которые она ссылается. При этом дублироваться будут только те дочерние записи, на которые ссылаются атрибуты с установленным флажком «**Удалять связанные записи**».
    - **Глубина дублирования** — количество уровней дочерних записей, подлежащих дублированию.

_![Свойства действия «Дублировать запись»](scenario_actions_clone_record.png)_

#### Сменить контекст

Это действие меняет контекст исполнения сценария на указанные записи в целевом шаблоне. По этим записям будут выполняться действия, вложенные в действие «**Сменить контекст**».

**Свойства**

- **Целевой шаблон записи** — шаблон записи, на который следует сменить контекст выполнения сценария.
- **Атрибут или выражение для поиска объектов** — выберите атрибут типа «**Запись**» или введите выражение (формулу, N3 или DMN), возвращающее идентификатор одной или нескольких записей,  к которым требуется перейти. Если атрибут или выражение указывают на несколько записей, будет запущен цикл из действий, вложенных в действие «**Сменить контекст**», по каждой из записей, попавших в выборку.

_![Свойства действия «Сменить контекст»](scenario_actions_change_context.png)_

#### Изменить значения атрибутов

Это действие изменяет значение указанных атрибутов определённым способом в записи контекстного шаблона (указан на вкладке «**Дополнительно**»).

На вкладке «**Основные**» предусмотрены перечисленные ниже свойства и кнопки.

- **Атрибут** — подлежащий изменению атрибут контекстного шаблона записи (указан на вкладке «**Дополнительно**»).
- **Операция со значениями**
    - **Заменить** — установка в атрибуте значения, указанного в столбце «**Значение**».
    - **Удалить** — удаление всех значений из атрибута.
    - **Добавить** — добавление в атрибут значения, указанного в столбце «**Значение**» (этот пункт отображается для атрибутов типа «**Запись**», «**Аккаунт**», «**Роль**», «**Организационная единица**», «**Документ**», «**Изображение**» с установленным флажком «**Хранить несколько значений**»).
    - **Исключить** — удаление из атрибута ссылок на объекты, указанные в столбце «**Значение**»  (этот пункт отображается для атрибутов типа «**Запись**», «**Аккаунт**», «**Роль**», «**Организационная единица**»,  «**Документ**», «**Изображение**» с установленным флажком «**Хранить несколько значений**»). Сами связанные объекты при этом удалены не будут.
    - **Создать** — нажмите эту кнопку, чтобы добавить атрибут.
    - **Удалить** — установите флажки выбора для подлежащих удалению атрибутов и нажмите эту кнопку, чтобы удалить их.
- **Значение** — задайте одно или несколько значений атрибута посредством другого **атрибута**, **формулы**, выражения **N3** или таблицы **DMN**.

    _![Свойства действия «Изменить значения атрибутов»](scenario_actions_change attribute_values.png)_

#### Создать документ по шаблону

Это действие формирует файл посредством [шаблона экспорта][шаблоны-экспорта] и помещает ссылку на него в переменную.

**Свойства**

- **Поместить документ в переменную**
    - **Операция со значением переменной**
        - **Добавить** — добавление ссылки на сформированный файл в переменную.
        - **Заменить** — замена ссылок на все файлы, хранящиеся в переменной, ссылкой на сформированный файл (сами файлы заменены при этом не будут).
        - **Удалить** — удаление из переменной всех ссылок на файлы (сами файлы удалены при этом не будут).
    - **Переменная** — укажите имя переменной, в которую будет помещена ссылка на сформированный файл.

    _![Настройка переменной для действия «Создать документ по шаблону»](scenario_actions_create_document_variable.png)_

- **Шаблон экспорта**
    - **Создать** — создайте шаблон экспорта для формирования файла.
        - **Название** — наглядное название шаблона экспорта.
        - **Системное имя** — уникальное имя шаблона экспорта, формируется автоматически посредством транслитерации названия шаблона.
        - **Файл шаблона** — загрузите файл шаблона экспорта (выбрав пункт «**Значение**»), выберите **атрибут** с типом данных «**Документ**», содержащий файл шаблона экспорта, либо введите **формулу**, выражение **N3** или таблицу **DMN**, возвращающую такой атрибут.
        - **Имя выходного файла** — укажите **атрибут**, **формулу**, выражение **N3** или таблицу **DMN**, возвращающую имя сформированного файла.
        - **Экспортировать как PDF** — установите этот флажок, чтобы сформировать файл в формате PDF.

    _![Создание нового шаблона экспорта для действия «Создать документ по шаблону»](scenario_actions_create_document_using_new_template.png)_

    - **Выбрать существующий**
        - **Выберите шаблон экспорта** — укажите шаблон экспорта, по которому будет создан новый файл.

    _![Выбор имеющегося шаблона экспорта для действия «Создать документ по шаблону»](scenario_actions_create_document_using_existing_template.png)_

#### Прикрепить документ к атрибуту

Это действие помещает в атрибуты ссылки на файлы из указанных атрибутов или переменных.

**Свойства**

- **Атрибут** — атрибут, в который будут помещены ссылки на файлы, указанные в столбце «**Значение**».
- **Операция со значениями**
    - **Добавить** — добавление ссылки на файл в атрибут.
    - **Заменить** — замена всех ссылок на файлы в атрибуте ссылками, указанными в столбце «**Значение**» (при этом сами файлы заменены не будут).
    - **Создать**— создание в атрибуте новых ссылок на файлы.
- **Значение** — задайте значение атрибута (ссылку на файл) посредством другого **атрибута**, **формулы**, выражения **N3** или таблицы **DMN**.
- **Создать** — нажмите эту кнопку, чтобы добавить атрибут.
- **Удалить** — установите флажки выбора для подлежащих удалению атрибутов и нажмите эту кнопку, чтобы удалить их.

_![Свойства действия «Прикрепить документ к атрибуту»](scenario_actions_attach_document_to_attribute.png)_

#### Проверить результат выражения {: #scenario_actions_validate_expression}

Это действие проверяет выполнение заданного условия в контекстном шаблоне (указан на вкладке «**Дополнительно**»). Если условие не будет выполнено, отобразится сообщение об ошибке с заданным текстом.

**Свойства**

- **Сообщение об ошибке** — текст, который отобразится для пользователя, если выражение вернёт значение `false`.
- **Выражение** — условие проверки. Действие сработает, если заданное выражение (формула, N3 или DMN) вернёт значение `false`.

С помощью этого действия можно осуществлять отладку сценариев и устанавливать запрет на редактирование записей. См. _[«Отладка формул, выражений N3, сценариев и C#-скриптов»][expression_debug]_ и [пример](#пример-использования-действия-проверить-результат-выражения).

_![Свойства действия «Проверить результат выражения»](scenario_actions_validate_expression_result.png)_

##### Пример использования действия «Проверить результат выражения»

1. Создайте новый сценарий.
2. В начальном событии «**Нажата кнопка**» выберите контекстный шаблон записи и кнопку «**Сохранить**».
3. Добавьте действие «**Проверить результат выражения**» со следующими значениями:

    - **Сообщение об ошибке:** _Ошибка сохранения_
    - **Выражение: формула**

        ``` cs
        false
        ```

4. Перейдите к любой записи в контекстном шаблоне, внесите в неё изменения и нажмите кнопку «**Сохранить**».
5. На экране отобразится уведомление об ошибке сохранения записи.

_![Сценарий отмены сохранения записи по действию «Проверить результат выражения»](scenario_actions_save_cancel.png)_

#### Проверить результат скрипта {: #scenario_actions_validate_csharp}

Это действие проверяет выполнение заданного C#-скрипта. Если условие не будет выполнено, отобразится сообщение об ошибке с заданным текстом.

**Свойства**

- **Сообщение об ошибке** — текст, который отобразится для пользователя, если выражение вернёт значение `false`.
- **Выражение** — условие проверки. Действие сработает, если заданный C#-скрипт вернёт значение `false`.

Скрипт должен возвращать логическое значение и выполнен по следующему образцу:

``` cs
class Script
{
    public static bool Main()
    {
      var result = true; // или false
    // Добавьте код, который будет влиять на возвращаемое значение.
        return result;
    }
}
```

!!! note "Примечание"

    Если метод `Main()` будет возвращать значение не типа `bool`, то система считает, что результат выражения равен значению `false`.

_![Свойства действия «Проверить результат скрипта»](scenario_actions_check_script_result.png)_

##### Пример использования действия «Проверить результат скрипта»

1. Создайте новый сценарий.
2. В начальном событии «**Нажата кнопка**» выберите контекстный шаблон записи и кнопку «**Сохранить**».
3. Добавьте действие «**Проверить результат скрипта**» со следующими значениями:

    - **Сообщение об ошибке:** _Ошибка сохранения_
    - **Выражение: N3**

        ``` cs
        class Script
        {
            public static bool Main()
            {
                return false;
            }
        }
        ```

4. Перейдите к любой записи в контекстном шаблоне, внесите в неё изменения и нажмите кнопку «**Сохранить**».
5. На экране отобразится уведомление об ошибке сохранения записи.

_![Сценарий отмены сохранения записи по действию «Проверить результат скрипта»](img/scenario_event_scenario_script_cancel.png)_

#### Выполнить по условиям

Это действие выполняет вложенные в него блоки действий по заданным условиям.

- Возможно применение нескольких условий.
- Блок вложенных действий выполняется, если выражение для условия возвращает значение `true`.
- Блоки вложенных действий выполняются последовательно по порядку условий в списке.
- Если ни одно из условий не вернёт `true`, действие «**Выполнить по условиям**» и вложенные в него блоки действий будут пропущены.

На вкладке «**Основные**» предусмотрены перечисленные ниже свойства и кнопки.

- **Название условия** — краткое описание условия.
- **Выражение** — **атрибут**, **формула**, выражение **N3** или таблица **DMN**, задающая условие выполнения вложенного действия. Для каждого условия внутри действия «**Выполнить по условиям**» создаётся дорожка для вложенных действий, которые выполняются, если выражение возвращает `true`.
- **Создать** — нажмите эту кнопку, чтобы добавить условие.
- **Удалить** — установите флажки выбора для подлежащих удалению условий и нажмите эту кнопку, чтобы удалить их.

_![Свойства действия «Выполнить по условиям»](scenario_actions_execute_on_conditions.png)_

#### Повторять по числовому счётчику

Это действие выполняет вложенные в него действия заданное количество раз.

**Свойства**

- **Переменная** — переменная-счётчик, по которой будет выполняться цикл, аналогичная счётчику цикла `for`. Значение этой переменной будет увеличиваться **от 0** до значения, заданного в поле «**Количество итераций**», минус 1.
- **Количество итераций** — задайте количество повторений цикла посредством числового **значения**, **атрибута**, **формулы**, выражения **N3** или таблицы **DMN**.

_![Свойства действия «Повторять по числовому счётчику»](scenario_actions_counter_loop.png)_

#### Повторять по количеству объектов

Это действие выполняет вложенные в него действия над объектами, возвращёнными заданным **атрибутом**, **формулой**, выражением **N3** или таблицей **DMN**.

**Свойства**

- **Переменная** — переменная-итератор, по которой будет выполняться цикл, аналогичная итератору цикла `for each`. Этой переменной будет присваиваться значение заданного атрибута или выражения.
- **Атрибут или выражение для поиска объектов** — задайте **атрибут**, **формулу**, выражении **N3** или таблицу **DMN**, возвращающую ссылки на объекты, по которым требуется выполнить цикл.

_![Свойства действия «Повторять по количеству объектов»](scenario_actions_object_loop.png)_

#### Запустить процесс

Это действие создаёт экземпляр выбранного шаблона процесса.

**Свойства**

- **Шаблон процесса** — шаблон процесса, в котором будет создан новый экземпляр по текущей записи контекстного шаблона (указан на вкладке «**Дополнительно**»). Чтобы запустить процесс по новой записи, перед этим действием необходимо выполнить действие «**Создать запись**».

_![Свойства действия «Запустить процесс»](scenario_actions_execute_process.png)_

#### Отправить сообщение

Это действие отправляет сообщение посредством указанных подключения и пути передачи данных.

**Свойства**

- **Подключение** — подключение, которое будет использоваться для отправки сообщения.
- **Путь передачи данных** — путь передачи данных, который будет использоваться для формирования сообщения.
- **Переменная с сообщением** — имя переменой, в которой хранится содержимое сообщения. Эта переменная должна быть инициализирована до вызова действия «**Отправить сообщение**» (с помощью действия [«**Изменить значения переменных**»](#изменить-значения-переменных)). Это словарь типа ключ-значение, который указанный путь передачи данных преобразует в сообщение. Результирующее сообщение будет отправлено посредством указанного подключения.
- **Переменная для успешного ответа** — имя переменной, в которую будет помещён ответ сервера в случае успешной отправки сообщения.
- **Переменная для ответа с ошибкой** — имя переменной, в которую будет помещён ответ сервера в случае сбоя отправки сообщения.

_![Свойства действия «Отправить сообщение»](scenario_actions_send_message.png)_

#### Изменить значения переменных

Это действие изменяет значение структурированного набора переменных указанным способом.

**Свойства**

- **Операция со значениями переменных**
    - **Добавить** — добавление в набор переменных и значений, указанных в таблице переменных.
    - **Заменить** — установка в наборе переменных и значений, указанных в таблице переменных.
    - **Исключить** — удаление из набора  всех переменных и значений.
- **Набор переменных** — имя набора переменных, подлежащего изменению. Набор переменных представляет собой словарь типа ключ-значение.
- Таблица переменных
    - **Имя переменной** — переменная, подлежащая изменению.
    - **Значение** — атрибут или выражение (формулу, N3 или DMN), задающее одно или несколько значений переменной.
    - **Создать** — нажмите эту кнопку, чтобы добавить переменную.
    - **Удалить** — установите флажки выбора для подлежащих удалению переменных и нажмите эту кнопку, чтобы удалить их.

--8<-- "variable_object.md"

_![Свойства действия «Изменить значения переменных»](scenario_actions_change_variable_values.png)_

#### Изменить значения скриптом

Это действие изменяет значение указанных атрибутов определённым способом в записи контекстного шаблона (указан на вкладке «**Дополнительно**»).

На вкладке «**Основные**» предусмотрены перечисленные ниже свойства и кнопки.

- **Атрибут** — подлежащий изменению атрибут контекстного шаблона записи (указан на вкладке «**Дополнительно**»).
- **Операция со значениями**
    - **Заменить** — установка в атрибуте значения, указанного в столбце «**Значение**».
    - **Удалить** — удаление всех значений из атрибута.
    - **Добавить** — добавление в атрибут значения, указанного в столбце «**Значение**» (этот пункт отображается для атрибутов типа «**Запись**», «**Аккаунт**», «**Роль**», «**Организационная единица**», «**Документ**», «**Изображение**» с установленным флажком «**Хранить несколько значений**»).
    - **Исключить** — удаление из атрибута ссылок на объекты, указанные в столбце «**Значение**»  (этот пункт отображается для атрибутов типа «**Запись**», «**Аккаунт**», «**Роль**», «**Организационная единица**»,  «**Документ**», «**Изображение**» с установленным флажком «**Хранить несколько значений**»). Сами связанные объекты при этом удалены не будут.
    - **Создать** — нажмите эту кнопку, чтобы добавить атрибут.
    - **Удалить** — установите флажки выбора для подлежащих удалению атрибутов и нажмите эту кнопку, чтобы удалить их.
- **Значение** — задайте одно или несколько значений атрибута посредством C#-скрипта.

Чтобы использовать действие «Изменить значения скриптом», используйте скрипт по следующему образцу:

``` cs
public class Script {
    // Выберите тип метода Main() в зависимости от типа атрибута:
    // string — «Текст», int, decimal — «Число», dateTime — «Дата и время»,
    // bool — «Логический», TimeSpan — «Длительность», IEnumerable<string> — «Список значений».
    // ObjectID — переменная, в которой хранится ID экземпляра шаблона записи,
    // в контексте которого выполняется скрипт.
    public static string Main(string ObjectID) {         
        var result = "Пример использования действия «Изменить значения скриптом» для атрибута типа «Текст»";
        return result;
    }
}
```

_![Свойства действия «Изменить значения скриптом»](scenario_actions_change_value_script.png)_

--8<-- "related_topics_heading.md"

**[Сценарии. Определение, создание, настройка, использование][scenarios]**

**[Использование переменных в сценарии][scenario_variables]**

{%
include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md"
%}
