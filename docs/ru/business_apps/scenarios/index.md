---
title: Сценарии
tags:
  - сценарии
  - сценарий
  - триггеры
  - события
  - событие сценария
  - сценарий
  - триггер
  - действия сценария
  - действие сценария
  - элементы сценария
  - шаги сценария
  - проверка сценария
  - удаление сценария
  - очистка сценария
  - свойства сценария
hide:
  - tags
kbId: 2151
---

# Сценарии. Определения, создание, настройка, использование {: #scenarios}

<div class="admonition question" markdown="block">
## Определения {: .admonition-title #definitions}

**Сценарий** представляет собой алгоритм обработки данных, который запускается при наступлении заданного [события][scenario_event] и выполняет настроенную последовательность [действий][scenario_actions].

Сценарий составляется из блоков с помощью [визуального конструктора](#настройка-элемента-сценария).

Сценарий может запускаться по следующим событиям:

- нажатие кнопки;
- создание или изменение записи;
- запуск процесса;
- получение сообщения;
- вход или выход токена из элемента диаграммы процесса.

В сценариях можно выполнять действия следующих типов:

- создание и дублирование записей;
- изменение и проверка значений переменных и атрибутов с помощью выражений и скриптов.
- проверка выражений, выполнение действий по условиям и в циклах;
- запуск процессов;
- отправка сообщений;
- создание документов.

См. [_«Событие и действия сценария. Определения, типы, свойства, настройка»_][scenario_elements] и [_«Использование переменных в сценарии»_][scenario_variables].

</div>

## Особенности работы сценариев

Сценарии являются удобным инструментом автоматизации в приложениях. Они дополняют бизнес-процессы, однако не являются их альтернативой, так как не позволяют реализовать логику BPMN.

<!-- Рассказать в каких случаях следует применять сценарии, а в каких — процессы. Этот запрос есть в изначальной заявке -->

Сценарии имеют ряд особенностей:

- Сценарий выполняется один раз при каждом наступлении события.
- Сценарий позволяет переключаться между шаблонами и манипулировать данными в них.
- При запуске для нескольких записей (например, выбранных в таблице) сценарий выполняется отдельно каждой записи. То есть в контексте сценария доступна только одна запись, по которой он запущен.
- При составлении последовательности действий сценария следует избегать появления бесконечных циклов.
- Если при выполнении сценария происходит ошибка, то его действия отменяются полностью, как если бы сценарий не запускался вообще. Если ошибка сценария произошла в процессе, то процесс будет остановлен.

## Примеры использования сценариев

Сценарии позволяют решать различные задачи, например:

- Создание, дублирование и изменение записей:
    - _[Копирование записи вместе с прикреплённым документом][attribute_document_clone_scenario]_.
- Получение и отправка электронной почты:
    - _[Отправка эл. почты из сценариев через SMTP и Exchange][scenario_send_email]_
    - _[Получение эл. почты из сценариев через SMTP и Exchange][imap_receiving_connection]_
    - _[Согласование заявлений по эл. почте][process_email_configure]_
- Обмен данными с внешними системами:
    - _[Отправка SQL-запроса SELECT во внешнюю СУБД][sql_send_connection]_
    - _[Получение данных по таймеру из внешней СУБД][sql_receive_connection]_
    - _[Получение сообщений через Kafka][kafka_connection]_
- Получение и отправка HTTP-запросов:
    - _[Отправка HTTP-запросов типа GET и обработка запросов в формате JSON][send_http_example]_
    - _[Отправка уведомлений с помощью Telegram-бота][telegram_send_notification]_
- Настройка бизнес-процессов:
    - _[Настройка универсального процесса согласования][business_approval_process]_
    - _[Визуализация этапов процесса с помощью шевронов][chevron_stage_render]_
- Изменение данных без учёта роли и разрешений текущего пользователя:
    - [Выполнение сценария от имени системы](#scenario_context)
- Использование электронной подписи и подготовка документов по образцу:
    - _[Обработка документов с электронной подписью][document_digital_signature]_;
    - _[Экспорт документов по шаблонам][шаблоны-экспорта]_
- Принудительная остановка бизнес-процессов и запрет на внесение изменений в записи:
    - _[Проверка результата выражения в сценарии][scenario_actions_validate_expression]_
    - _[Проверка результата скрипта в сценарии][scenario_actions_validate_csharp]_

## Использование списка сценариев и создание сценария

1. Откройте страницу [«**Администрирование**» — «**Сценарии**»][administration].
2. Отобразится список сценариев.
3. Выполните требуемые действия со сценариями:

	- **Создать** — чтобы [настроить свойства](#настройка-свойств-сценария) нового сценария и перейти к настройке [его события и действий](#конструктор-сценария), нажмите кнопку «**Создать**».
	- **Настроить свойства** — выберите сценарий с помощью флажка и нажмите кнопку «**Свойства**», чтобы [настроить его свойства](#настройка-свойств-сценария).
    - **Открыть** — дважды нажмите строку сценария, чтобы настроить [его событие и действия](#конструктор-сценария).
	- **Удалить** — установите флажки выбора для сценариев, нажмите кнопку «**Удалить**» и подтвердите удаление.

_![Список сценариев в приложении](scenarios_list.png)_

## Настройка свойств сценария

1. Откройте список сценариев.
2. Нажмите кнопку «**Создать**». Либо выберите или откройте сценарий и нажмите кнопку «**Свойства**».
3. Настройте и сохраните свойства сценария:

    - **Название** — наглядное наименование сценария.
    - **Системное имя** — уникальное имя.
    --8<-- "system_name_requrements.md"

    !!! note "Примечание"

        Для сценариев на входе и выходе из элементов диаграммы процесса название и системное имя сценария формируются автоматически.

    - **Контекст выполнения** — аккаунт, от имени которого должен выполняться сценарий:
    {: #scenario_context}
        - **От имени системы** — сценарий будет выполняться с полными правами аккаунта «**Система**», без учёта роли и разрешений пользователя, инициировавшего событие, по которому запускается сценарий. То есть сценарий сможет выполнять _любые действия_.
        - **От инициатора** — сценарий будет выполняться при наличии необходимых разрешений у пользователя, инициировавшего событие, по которому выполняется сценарий. В случае отсутствия у пользователя разрешений система выдаст ошибку.
    - **Статус**:
        - **Активен** — сценарий будет выполняться при каждом наступлении заданного события.
        - **Приостановлен** — сценарий не будет выполняться при наступлении заданного события.

4. Если вы создали сценарий, откроется его конструктор. [Настройте событие и действия сценария](#конструктор-сценария).

_![Настройка свойств нового сценария](scenario_create_properties.png)_

## Настройка события и действий сценария

Для настройки сценария предусмотрен удобный визуальный конструктор.

Перейти к конструктору сценария можно двумя способами:

- Дважды нажмите строку сценария в [списке сценариев](#использование-списка-сценариев-в-приложении).
- Нажмите кнопку «**Сценарий на входе**» <i class="fa-light fa-arrow-right-to-bracket"></i> или «**Сценарий на выходе**» <i class="fa-light fa-arrow-right-from-bracket"></i> в меню элемента [диаграммы бизнес-процесса][process_diagram].

_![Кнопки создания сценария на входе и выходе из элемента диаграммы процесса](scenario_exit_enter_process_element.png)_

В конструкторе сценария предусмотрены следующие кнопки:

- **Свойства** — настройка [свойств сценария](#настройка-свойств-сценария).
- **Очистить** — безвозвратное удаление всех элементов сценария. После нажатия этой кнопки в сценарий будет помещено пустое начальное событие «**Нажатие кнопки**», как если бы сценарий был создан заново. Требуется подтверждение.
- **Удалить** — удаление сценария. Требуется подтверждение.
- **Проверить** — проверка целостности и работоспособности сценария. При нажатии этой кнопки отобразится панель «**Результат проверки**» с перечнем выявленных ошибок в сценарии. Элементы сценария с ошибкой будут выделены красным цветом.

_![Конструктор сценария](scenario_designer.png)_

## Настройка элемента сценария

!!! warning "Внимание!"

    При настройке сценария изменения сохраняются и применяются автоматически.

1. Наведите указателя мыши на элемент сценария или выберите его.
2. Отобразятся кнопки настройки:

   - **Название элемента сценария** — нажмите, чтобы перейти к настройке свойств элемента.
   - **Изменить** — нажмите <i class="fa-light  fa-edit"></i>, чтобы перейти к настройке свойств элемента.
   - **Перейти к контекстному шаблону** — нажмите кнопку <i class="fa-light  fa-external-link"></i>, чтобы перейти к [шаблону][templates], в контексте которого выполняется элемент сценария.
   - **Удалить** — нажмите кнопку <i class="fa-light  fa-trash-alt"></i>, чтобы безвозвратно [удалить действие сценария](#удаление-действия). Подтвердите удаление.
   - **Добавить действие** — нажмите кнопку <i class="fa-light  fa-plus-circle"></i>, чтобы [создать действия](#создание-действия) после текущего элемента или внутри него.

_![Кнопки настройки элемента сценария](scenario_element_buttons.png)_

### Создание действия

!!! note "Примечание"

	Внутрь действий «**Создать запись**», «**Дублировать запись**», «**Сменить контекст**», «**Выполнить по условиям**», «**Повторять по числовому счётчику**», «**Повторять по количеству объектов**» можно поместить другие действия.

1. Наведите указатель мыши на элемент сценария, после или внутрь которого требуется добавить действие.
2. Нажмите кнопку «**Добавить действие**» <i class="fa-light  fa-plus-circle"></i>.
3. Выберите необходимое действие в раскрывающемся меню.
4. В конструкторе сценария появится новое действие.
5. [Настройте действие](#настройка-элемента-сценария).

    _![Создание действия в сценарии](scenario_create_action.png)_

### Удаление действия

1. Наведите указатель мыши на подлежащее удалению действие.
2. Нажмите кнопку «**Удалить**» <i class="fa-light  fa-trash-alt"></i>.
3. Подтвердите удаление.

_![Удаление действия из сценария](scenario_delete_action.png)_

--8<-- "related_topics_heading.md"

**[Событие и действия сценария. Определения, типы, свойства, настройка][scenario_elements]**

**[Использование переменных в сценарии][scenario_variables]**

{%
include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md"
%}
