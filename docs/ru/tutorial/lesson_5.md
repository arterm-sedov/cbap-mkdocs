---
title: Урок 5. Структуры данных
kbId: 4869
---

# Урок 5. Структуры данных {: #lesson_5 }

## Введение

В ходе этого урока вы научитесь использовать **диаграмму «сущность-связь»** для визуальной настройки модели данных приложения, создания шаблонов записей различных типов (для справочников, мастер-данных и транзакционных данных) и установления связей между ними.

**Предусловия:** пройден [Урок 2. Мой первый реестр данных][lesson_2].

**Расчётная продолжительность:** 30 мин.

{% include-markdown ".snippets/tutorial_version_notice.md" %}

<div class="admonition question" markdown="block">

## Определения {: .admonition-title #definitions}

- В **{{ productName }}** для визуализации и проектирования модели данных приложения используются диаграммы «сущность-связь» (ER-диаграммы).
- Диаграмма «сущность-связь» наглядно показывает шаблоны записей, их атрибуты и связи друг с другом.
- Непосредственно в ходе создания и редактирования диаграммы можно создавать и настраивать новые шаблоны записей (реестры данных) и добавлять атрибуты.
- Это позволяет настраивать приложение и при этом видеть его модель данных в целом.

</div>

## Создание диаграммы модели данных

1. На панели навигации слева выберите пункты «**Настройки**» — «**Диаграммы**».
2. Отобразится список диаграмм всех приложений.

    !!! note "Примечание"

        - По умолчанию список диаграмм содержит **диаграммы процессов** и **диаграммы классов**:
            - **диаграмма классов** создается автоматически для каждого приложения;
            - **диаграмма процесса** создается автоматически для каждого **шаблона процесса**.

3. Создайте диаграмму, нажав кнопку «**Создать**».
4. В отобразившемся окне настройте **новую диаграмму**:

    - **Название:** _Модель данных — заказ автотранспорта_
    - **Тип:**  **диаграмма модели данных**
    - **приложение**  _Управление автопарком_

5. Нажмите кнопку «**Сохранить**».

    _![Создание новой диаграммы модели данных](https://kb.comindware.ru/assets/img_62433315d3acc.png)_

6. Отобразится конструктор диаграммы модели данных.

    !!! question "Конструктор диаграммы модели данных"

        **Конструктор диаграммы модели данных** содержит следующие области:
        
        (1) **Панель элементов** — содержит имеющиеся шаблоны и кнопки для создания новых.
 
        (2) **Диаграмма** — отображает шаблоны, атрибуты и связи между ними.
 
        (3) **Кнопки**

        - **Выбрать версию** — загрузить одну из ранее сохраненных версий диаграммы.
        - **Создать новую версию** — сохранить текущую диаграмму как новую версию.
        - **Клонировать** — создать новую диаграмму путем копирования текущей.
        - **Настройки** — переименовать диаграмму.
        - **Обновить данные** — вывести актуальную модель данных приложения на диаграмму.
        - **Экспортировать** — сохранить диаграмму как файл в формате SVG.
        - **Отображать системные имена** — показать для шаблонов и атрибутов системные имена вместо отображаемых названий.
        - **Очистить** — скрыть все элементы диаграммы, при этом соответствующие сущности из приложения не удаляются.
  
    !!! note "Примечание"

        Изменения диаграммы модели данных автоматически сохраняются в текущей версии диаграммы.

    _![Конструктор диаграммы модели данных](https://kb.comindware.ru/assets/img_624333f52be92.png)_

7. Перетащите на диаграмму шаблон записи _«Заявки на автомобили»_ с панели элементов слева.

    _![Добавление шаблона на диаграмму модели данных](https://kb.comindware.ru/assets/img_624334607fe65.png)_

## Настройка шаблона записи для справочных данных

!!! warning "Бизнес-логика"

    Добавим справочник типов автомобилей, чтобы _Заказчик_ мог указать тип автомобиля в заявке.

    Сначала мы создадим реестр данных (**шаблон записи**) _«Типы автомобилей»_, затем настроим для него экранную форму, список и заполним его значениями.

    Создавать и настраивать реестр данных мы будем с помощью конструктора диаграмм.

### Создание шаблона записи «Типы автомобилей»

1. Перетащите на диаграмму элемент «**Новый шаблон записи**» с панели элементов.

    _![Элемент для создания шаблона записи на диаграмме модели данных](https://kb.comindware.ru/assets/img_624334b3e271d.png)_

2. В отобразившемся окне настройте **Новый шаблон**

    - Введите **название** _«Типы автомобилей»_, **системное имя** будет заполнено автоматически.
    - Не изменяйте другие поля и флажки.
    - Нажмите кнопку «**Создать**».

    _![Настройка шаблона записи с помощью диаграммы модели данных](https://kb.comindware.ru/assets/img_6243355e063a0.png)_

### Настройка текстового атрибута в качестве заголовка записи

!!! warning "Бизнес-логика"

    По умолчанию в качестве заголовка записи используется её **идентификатор** (**ID**). Поэтому при выборе типа автомобиля пользователь видит его цифровой **ID**, который неинформативен. 
    
    Дадим возможность пользователям выбирать тип автомобиля по названию. Для этого создадим текстовый атрибут в шаблоне записи _«Типы автомобилей»_  и установим его в качестве заголовка записей. 
    
    Рекомендуем задать атрибут-заголовок записей в каждом шаблоне, чтобы улучшить удобство пользования приложением.

!!! question "Атрибут-заголовок записей"

    Шаблон записи имеет заголовок, который отображается в формах и таблицах. По умолчанию в качестве заголовка используется системный цифровой идентификатор.

    Чтобы выводить наглядный заголовок записи, используйте значение атрибута: установите  флажок «**Использовать как заголовок записей**» в свойствах атрибута.

    В качестве заголовка записи можно использовать атрибуты следующих типов: **Аккаунт**, **Дата и время**, **Длительность**, **Text**, **Число**.

    В качестве заголовка записи можно использовать только один атрибут шаблона.

1. Выберите шаблон _«Типы автомобилей»_ на диаграмме.
2. В меню элемента нажмите кнопку «**Добавить новый атрибут**» <i class="fa-light fa-circle-plus"></i>.

    _![Переход к созданию атрибута шаблона записи на диаграмме модели данных](https://kb.comindware.ru/assets/img_624335a2049c9.png)_

3. В отобразившемся окне настройте и сохраните **новый атрибут**:

    - **Тип данных:** **текст**
    - **Название:** _Тип автомобиля_
    - **Использовать как заголовок записей**: установите флажок

    _![Настройка нового атрибута с помощью диаграммы модели данных](https://kb.comindware.ru/assets/img_63107f7da1fdd.png)_

!!! note "Примечание"

    Когда установлен флажок «**Использовать как заголовок записей**», что значение этого атрибута будет отображаться как заголовок записей этого шаблона на формах и в таблицах. Если в качестве заголовка записей не выбран ни один атрибут, заголовком будет ID записи — служебный числовой идентификатор. Это будет неинформативно, поэтому атрибут-заголовок записей следует задать.

Настроим форму, с помощью которой мы будем заполнять справочник типов автомобилей…

1. Выберите шаблон «Типы автомобилей» на диаграмме. В меню элемента выберите пункт «**Перейти к шаблону**» — «**Формы**».

    _![Переход к вкладке «Формы» шаблона записи с диаграммы модели данных](https://kb.comindware.ru/assets/img_6243374d6f32e.png)_

2. В отобразившемся списке форм дважды нажмите форму «Типы автомобилей — Основная форма», чтобы открыть её.
3. Перетащите на форму новую **область** и переименуйте её в _«Тип автомобиля»._
4. Перетащите атрибут _«Тип автомобиля»_ с панели элементов на область _«Тип автомобиля»._
5. Нажмите кнопку «**Сохранить**».
6. Нажмите кнопку «**Настроить шаблон**» <i class="fa-light fa-gear">‌</i>.

    _![Добавление атрибута на форму](https://kb.comindware.ru/assets/img_6243382e160d6.png)_

Создадим таблицу _«Типы автомобилей»…_

1. Перейдите на вкладку «**Таблицы**» шаблона записи _«Типы автомобилей» ._
2. Дважды нажмите строку «**Все записи**», чтобы перейти к конструктору таблицы.

    _![Вкладка «Таблицы» шаблона записи](https://kb.comindware.ru/assets/img_6243389f77110.png)_

3. В конструкторе таблицы нажмите кнопку «**Очистить**», чтобы удалить все атрибуты из макета таблицы. В отобразившемся диалоговом окне подтвердите очистку.

4. Перетащите атрибут _«Тип автомобиля»_ на форму.

5. Нажмите кнопку «**Сохранить**».

6. Нажмите кнопку «**Настроить шаблон**» для возврата к вкладке «**Свойства**» шаблона записи _«Тип автомобиля»._

_![Добавление в список атрибута «Тип автомобиля»](https://kb.comindware.ru/assets/img_631085eb1eff4.png)_

Заполним справочник типов автомобилей…

1. На вкладке «**Свойства**» шаблона записи _«Типы автомобилей»_ нажмите кнопку «**Перейти к экземплярам**».

2.  В списке записей «Типы автомобилей» нажмите кнопку «**Создать**».

3. В поле «Тип автомобиля» укажите значение _«Легковой»_ и нажмите кнопку «**Сохранить**».

4. Нажмите ссылку «_Типы автомобилей_» над формой, чтобы вернуться к списку записей _«Типы автомобилей»._

5. Аналогичным образом создайте ещё два типа автомобилей — _«Представительский» и «Автобус»._

_![Создание записи с типом автомобиля и переход к списку записей](https://kb.comindware.ru/assets/img_631081080a0bd.png)_

Справочник типов автомобилей готов:

_![Справочник «Типы автомобилей»](https://kb.comindware.ru/assets/img_62433b6f93a3a.png)_

Теперь следует добавить на экранную форму заявки поле _«Тип автомобиля»_, в котором _Заказчик_ будет выбирать значение из справочника. Для этого установим связь между реестром данных заявок и справочником типов автомобилей с помощью атрибута типа «**Запись**».

!!! question "Определения"

- Атрибут типа «Запись» используется для создания связи между реестрами вида M:1 (многие к одному).
- Это означает, что несколько записей реестра могут ссылаться на одну запись реестра.
- Такой реестр называется связанным шаблоном.
- Связанный шаблон всегда указывается при создании атрибута типа «**Запись**».

1. В модели данных заказа автотранспорта выберите шаблон _«Заявки на автомобили»_ и в меню элемента нажмите кнопку «**Добавить новый атрибут**» _‌_.

_![Добавление атрибута шаблона записи с помощью диаграммы модели данных](https://kb.comindware.ru/assets/img_62433e63da67b.png)_

2. В окне «**Новый атрибут**» выберите **тип данных** «**Запись**» и укажите **название** _«Типы автомобилей»._

3. Выберите **связанный шаблон***«Типы автомобилей».*

4.Остальные поля оставьте неизменными.

5. Нажмите кнопку «**Сохранить**».

_![Настройка атрибута типа «Запись»](https://kb.comindware.ru/assets/img_631082a57bf73.png)_

6. На диаграмме отобразится связь между шаблонами.

_![Отображение связи между шаблонами](https://kb.comindware.ru/assets/img_624340bfb62f1.png)_

!!! note "Примечание"



Соединительная линия показывает, что для одной заявки на автомобиль может быть указан только один тип автомобиля, и разные заявки могут ссылаться на один и тот же тип автомобиля.

!!! note "Примечание"



Если связь не отобразилась автоматически, выберите любой шаблон и нажмите кнопку «**Показать связанные элементы**».
## Мастер-данные «Автомобили»

!!! question "Определения"

**Мастер-данные** — это объекты учета, например автомобили, клиенты, товарная номенклатура.
_Сотрудникам Гаража_ необходимо вести учет автомобилей и видеть, какие автомобили на данный момент свободны. Для этого создадим реестр данных (шаблон записи), где будут храниться данные конкретного автомобиля.

1. В модели данных заказа автотранспорта перетащите на диаграмму элемент «**Новый шаблон** **записи**». В окне свойств нового шаблона введите **название** _«Автомобили»_ и сохраните шаблон.

2. Выберите добавленный шаблон и перейдите на его вкладку «**Атрибуты**».

_![Добавление нового шаблона записи с помощью диаграммы модели данных](https://kb.comindware.ru/assets/img_624341506920c.png)_

3. Добавьте три атрибута **типа «Текст»**:

- _Марка_
- _Модель_
- _Регистрационный номер_ — для этого атрибута выберите  **формат отображения** «**Регистрационный номер ТС (РФ)**» и установите флажок «**Использовать как заголовок записей**»

4. Добавьте атрибут типа «**Запись**» — _«Тип»_ и укажите **связанный шаблон** — _«Типы автомобилей»._

_![Атрибуты шаблона записи «Автомобили»](https://kb.comindware.ru/assets/img_6243425951e2b.png)_

5. Перейдите на вкладку «**Формы**» и откройте конструктор формы _«Автомобили — Основная форма»._

 **6**  . Для _новой_ **области**на макете формы укажите **отображаемое название** _«Автомобиль»._

7. Перетащите только что созданные атрибуты на область _«Автомобиль»_ в конструкторе формы.

!!! note "Примечание"



Для удобства конечного пользователя можно использовать элементы «**Колонки**» и «**Вкладки**»,  позволяющие упорядочить поля формы. Вы можете поэкспериментировать с макетом формы.
8.Нажмите кнопку «**Сохранить**».

_![Создание основной формы «Автомобиль»](https://kb.comindware.ru/assets/img_6243433a2469b.png)_

Настроим таблицу, чтобы в ней отображались нужные нам атрибуты…

1. Нажмите кнопку «**Настроить шаблон**» _‌_ и перейдите на вкладку «**Таблицы**».

2. Откройте конструктор таблицы «**Все записи**».

3. Нажмите кнопку «**Очистить**».

4. Перетащите на макет таблицы атрибуты: _«Марка», «Модель», «Регистрационный номер»_ и _«Тип»._

5. Нажмите кнопку «**Сохранить**».

6. Нажмите кнопку «**Настроить шаблон**», чтобы перейти к свойствам шаблона записи _«Автомобили»._

_![Создание списка](https://kb.comindware.ru/assets/img_6310853815a6a.png)_

## Тестирование: справочники и мастер-данные

Протестируем созданные справочники и мастер-данные:

1. На вкладке «**Свойства**» шаблона записи _«Автомобиль»_ нажмите кнопку «**Перейти к экземплярам**».

2. Нажмите кнопку «**Создать**». Отобразится форма «Автомобиль».

3. Заполните экранную форму, в поле _«Тип»_ выберите тип автомобиля.

4. Нажмите кнопку «**Сохранить**»

5. Нажмите ссылку «_Автомобили_» над формой, чтобы вернуться к списку записей.

_![Заполнение формы новой записи «Автомобили»](https://kb.comindware.ru/assets/img_631086cee50f6.png)_

6. Создайте ещё несколько записей в реестре _«Автомобили»_, указав при этом разные типы автомобилей, как показано на следующей иллюстрации.

_![Список записей «Автомобили»](https://kb.comindware.ru/assets/img_62434925df356.png)_

Теперь настроим список с группировкой по типу автомобиля…

1. Щелкните значок воронки в столбце _«Тип»._

2. Установите флажок «**Группировать**» в раскрывшемся меню.

3. Нажмите кнопку «**Сохранить**».

Пункты в списке будут сгруппированы по значению атрибута _«Тип»._

_![Группировка записей по значению атрибута «Тип»](https://kb.comindware.ru/assets/img_62434abbc53b0.png)_

## Атрибуты типа «Запись»

Добавим в реестр данных _«Автомобили»_ информацию о выполненных заявках, в которых использовался этот автомобиль.

Нам понадобится атрибут, который свяжет реестры _«Автомобили»_ и _«Заявки на автомобили»_ связью вида 1:M (один к многим) — когда на один автомобиль может быть несколько заявок. Такую связь позволяет установить атрибут типа «**Запись**» с **взаимной связью и несколькими значениями**.

!!! question "Определения"

- Атрибут типа «Запись» с взаимной связью позволяет хранить, отображать и изменять набор связанных записей в другом реестре данных.
- При изменении значения в любом из взаимосвязанных атрибутов во второй атрибут автоматически записывается обратная ссылка на запись в связанном шаблоне.
- **Пример**
    - В реестре автомобилей атрибут _«Заявки на автомобили»_ взаимосвязан с атрибутом _«Автомобили»_ из реестра заявок.
    - При выборе в заявке автомобиля в соответствующей записи из реестра автомобилей автоматически появится обратная ссылка на заявку.

1. Создайте атрибут типа «**Запись**» в шаблоне _«Автомобиль»:_

- укажите **название** _«Заявки на автомобили»;_
- выберите **связанный шаблон** _«Заявки на автомобили»;_
- в списке «**Взаимная связь с атрибутом**» выберите пункт «**С новым**»;
- введите **название нового атрибута** _«Автомобиль»;_
- для атрибута _«Заявки на автомобили»_ установите флажок «**Хранить несколько значений**»;
- нажмите кнопку «**Сохранить**».

_![Создание атрибута «Заявки на автомобили», взаимосвязанного с атрибутом «Автомобили»](https://kb.comindware.ru/assets/img_6310a144096fe.png)_

2. Откройте конструктор формы _«Автомобили — Основная форма»_ и перетащите атрибут _«Заявки на автомобили»_ на область _«Автомобиль»._

3. Выберите **представление**«**Таблица**» с помощью панели свойств.

_![Добавление коллекции в форму](https://kb.comindware.ru/assets/img_62434eceb082c.png)_

!!! note "Примечание"



На форме атрибут типа «**Запись**» может отображаться в виде таблицы, в столбцах которой расположены атрибуты связанного реестра (шаблона). Какие именно атрибуты должны отображаться, мы указываем с помощью конструктора формы.
4. Раскройте атрибут _«Заявки на автомобили»_ на панели элементов и перетащите в таблицу на форме атрибуты _«Время подачи», «Маршрут»_ и _«Создатель»._

_![Добавление в форму столбцов коллекции](https://kb.comindware.ru/assets/img_6243504618b3b.png)_

5. Выберите область кнопок таблицы и перетащите на нее кнопки «**Добавить**» и «**Перейти**». Это позволит привязывать имеющиеся заявки к автомобилю и переходить к связанным с ним заявкам.

6. Нажмите кнопку «**Сохранить**».

_![Настройка кнопок для работы с записями в связанном шаблоне](https://kb.comindware.ru/assets/img_624351615fe96.png)_

## Транзакционные данные: затраты

Мы научились работать со справочниками и мастер-данными. Помимо этого, нам могут понадобиться транзакционные данные, дополняющие исходные данные нашего процесса (заявку на автомобиль).

Например, мы можем захотеть сохранить список пассажиров или список точек маршрута, помимо конечного пункта назначения.

Или можно дать возможность водителю отчитаться о затратах, сделанных в ходе рейса.

Для этого нам потребуются два новых реестра данных (шаблона записей): затраты на поездку (транзакционные данные) и типы затрат (справочник). Эти реестры мы свяжем с заявкой: заявки — с затратами, а затраты — с типами затрат.

Сначала создадим справочник типов затрат. Для этого вернемся к диаграмме модели данных…

1. Выберите на панели навигации слева раздел «**Настройки**» — «**Приложения**».

2. Перейдите в приложение — _«Управление автопарком»_.

3. Выберите раздел «**Диаграммы**» и перейдите к диаграмме _«Модель данных — Заказ автотранспорта»._

4. Создайте новый шаблон записи _«Типы затрат»._

5. Выберите созданный шаблон и в меню элемента нажмите кнопку «**Добавить новый атрибут**» _‌_.

_![Создание нового шаблона записи и создание атрибута на диаграмме модели данных](https://kb.comindware.ru/assets/img_6243552de3c5a.png)_

6. Создайте текстовый атрибут _«Название»_ и установите в его свойствах флажок «**Использовать как заголовок записей**».

7. С помощью меню элемента перейдите на вкладку «**Формы**» шаблона записи «**Типы затрат**».

_![Переход на вкладку «Формы» шаблона записи с диаграммы модели данных](https://kb.comindware.ru/assets/img_624355c4c23ee.png)_

8. Откройте форму _«Типы затрат — Основная форма»._

9. Создайте область _«Укажите тип затрат»_ и перетащите на нее атрибут _«Название»._

10. Нажмите кнопку «**Сохранить**» и кнопку «**Настроить шаблон**» _‌_, чтобы перейти к свойствам шаблона.

_![Настройка формы «Тип затрат»](https://kb.comindware.ru/assets/img_624356bc20331.png)_

11. Перейдите на вкладку «**Таблицы**» шаблона _«Типы затрат»_ и настройте таблицу _«Все записи»_ так, чтобы в ней отображался только атрибут _«Название»_. Нажмите кнопку «**Сохранить**» и кнопку «**Настроить шаблон**», чтобы перейти к свойствам шаблона.

_![Настройка списка «Типы затрат»](https://kb.comindware.ru/assets/img_63109faf6b2d6.png)_

12. Перейдите к списку экземпляров шаблона записи _«Типы затрат»_ и создайте следующие типы затрат: _«Топливо», «Сервис», «Прочее»._

_![Экземпляры шаблона записи «Типы затрат»](https://kb.comindware.ru/assets/img_6243578c96194.png)_

Теперь создадим реестр данных (шаблон записи) для затрат…

1. Вернитесь к диаграмме модели данных и создайте шаблон записи _«Затраты»._

2. Выберите созданный шаблон и создайте следующие атрибуты:

- **название** _— Сумма_, **тип данных** — **Число**, **количество знаков после запятой** — **2**;
- **название** _—**Тип затрат_, **тип данных**— **Запись**, **связанный шаблон** — _Тип затрат._

3. Перейдите на вкладку «**Формы**» через меню элемента _«Затраты»._

4. Откройте конструктор формы _«Затраты — Основная форма»._

5. Создайте на форме **область** «Затраты».

6. Перетащите на область _«Затраты» атрибуты «Сумма»_ и _«Тип затрат»._

7. Нажмите кнопку «**Сохранить**».

_![Настройка формы «Затраты»](https://kb.comindware.ru/assets/img_624359690fd4c.png)_

8. Вернитесь к диаграмме модели данных. На диаграмме должна отображаться связь между шаблонами _«Типы затрат»_ и _«Затраты»_. Если связь не отображается, в меню элемента нажмите кнопку «**Показать связанные элементы**».

_![Отображение связей шаблона «Типы затрат»](https://kb.comindware.ru/assets/img_62435a3fbe0a2.png)_

Теперь свяжем реестр данных _«Заявки на автомобили»_ с _«Затратами»_ с помощью взаимной связи атрибутов типа «**Запись**»…

1. Выберите шаблон _«Заявки на автомобили»_ и нажмите кнопку _‌_ ( **Добавить новый атрибут**) в меню элемента.

2. Создайте атрибут со следующими свойствами:

    - **тип данных**— **Запись**;
    - **название**— _Затраты_;
    - **связанный шаблон**— _Затраты_;
    - **взаимная связь с атрибутом** — **С новым**;
    - **название нового атрибута** — _Заявка_;
    - **хранить несколько значений** — флажок установлен для атрибута _«Затраты»_.

    ![Создание атрибута «Затраты» типа «Запись» для шаблона «Заявки на автомобили», взаимно связанного с шаблоном «Затраты»](https://kb.comindware.ru/assets/img_6310a11c1a8ce.png)

3. На диаграмме должна отображаться связь между шаблонами _«Заявки на автомобили»_ и _«Затраты»_. Если связь не отображается, в меню элемента нажмите кнопку «**Показать связанные элементы**».

    _![Отображение связей шаблона записи «Заявки на автомобили»](https://kb.comindware.ru/assets/img_62435dabb2301.png)_

Настроим отображение реестра данных…

4. Перейдите на вкладку «**Таблицы**» шаблона _«Затраты»_, нажав кнопку «**Таблицы**» в его меню элемента.

    _![Переход к таблицам шаблона записи «Затраты» с диаграммы модели данных](https://kb.comindware.ru/assets/img_62435e603ac71.png)_

5. Настройте таблицу «**Все записи**» шаблона _«Затраты»_ так, чтобы в ней отображались атрибуты: _«Заявка», «Тип затрат», «Сумма»._
6. Нажмите кнопку «**Сохранить**».

    _![Настройка таблицы «Все записи» шаблона «Затраты»](https://kb.comindware.ru/assets/img_6310a2677c532.png)_

## Результаты

В ходе этого урока вы познакомились с новым типом атрибутов — «**Запись**» и узнали, как с его помощью установить связь между реестрами.

Мы улучшили наше приложение — добавили в него справочник _«Типы автомобилей»_ и мастер-данные для учета автомобилей.

В  [следующем уроке][lesson_6]  мы усовершенствуем наш процесс — используем созданный справочник, мастер-данные и транзакционные данные.

{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
