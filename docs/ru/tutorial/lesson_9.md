---
title: Урок 9.  Формирование документов
kbId: 4868
---

# Урок 9. Формирование документов {: #lesson_9 }

## Введение

В ходе этого урока вы настроите автоматический экспорт отчета о затратах на основе данных процесса и по шаблону, созданному с помощью Microsoft Excel.

**Предусловие:** пройден [Урок 6. Усовершенствованный процесс][lesson_6].

**Расчётная продолжительность:** 15 мин.

{% include-markdown ".snippets/tutorial_version_notice.md" %}

## Формирование авансового отчета

Настроим генерацию отчета по затратам по кнопке в задаче _«Выполнение рейса»_.

!!! note "Примечание"

    Настройка экспорта данных состоит из следующих этапов: сначала мы создадим файл Excel с шаблоном, по которому будет формироваться отчет (также можно создать шаблон в формате Word), затем загрузим этот файл в систему и настроим операцию, которая будет выполняться при нажатии кнопки.

Создадим файл для шаблона экспорта…

1. Создайте файл Excel (в формате XLSX).

2. Заполните лист Excel, как показано на следующей иллюстрации.

!!! warning "Внимание!"

    В файле шаблона экспорта необходимо указывать те системные имена, которые вы фактически использовали в своём приложении.

    Например, если вы присвоили атрибуту _«Номер заявки»_ системное имя `Номерзаявки123`, то именно это имя следует использовать в файле шаблона экспорта.

    То есть, если системные имена, приведённые в уроках, не совпадают с фактическими системными именами в вашем приложении, используйте фактические системные имена, а не копируйте их из текста уроков.

_![Шаблон авансового отчета в формате Excel](https://kb.comindware.ru/assets/img_624594abce6ec.png)_

## Синтаксис файла шаблона экспорта

Подробные сведения об использовании шаблонов экспорта см. в разделе _«[Шаблоны экспорта](https://kb.comindware.ru/category.php?id=849)»_.

В файле шаблона экспорта в фигурных скобках `{ }` указывайте системные имена **атрибутов**, значения которых должны отображаться в отчете.

Текст без фигурных скобок будет отображаться как обычный текст.

Для вывода значений из шаблона, связанного с атрибутом типа «**Запись***»*, используйте оператор `foreach`:

- в начале строки в фигурных скобках указываются оператор `foreach` и системное имя атрибута типа «**Запись**» — `{foreach:Затраты}`;
- затем перечисляются системные имена атрибутов из связанного с этим атрибутом шаблона записи, также в фигурных скобках — `{Типзатрат.Название}` `{Сумма}`;
- в конце строки указывается оператор `end` и системное имя атрибута типа «**Запись**» — `{end:Затраты}`;
- `Затраты` — системное имя атрибута типа «**Запись***» шаблона _«Заявки на автомобили»_, связанного с шаблоном _«Затраты»_.*
- `Сумма` и `Типзатрат` — системные имена атрибутов шаблона _«Затраты»_.
- `Типзатрат` — атрибут типа «**Запись**» в шаблоне _«Затраты»_, связанный с шаблоном _«Типы затрат»_. С помощью символа точки мы обращаемся к атрибуту `Название` шаблона _«Типы затрат»_.

Кроме того, мы используем системные имена следующих атрибутов шаблона _«Заявки на автомобили»_:

- `Итоговаясуммазатрат`  — итоговая сумма затрат;
- `Номерзаявки`  — номер заявки;
- `Времяподачи`  — время подачи.

## Настройка шаблона экспорта

1. Перейдите на вкладку «**Шаблоны экспорта**» шаблона записи _«Заявки на автомобили»_.
2. Нажмите кнопку «**Создать**».

    _![Создание шаблона экспорта для шаблона записи «<i>Заявки на автомобили</i>»](https://kb.comindware.ru/assets/img_63175c2c30b3d.png)_

3. Отобразится окно «**Новый шаблон экспорта**».
4. Укажите **название** шаблона экспорта _«Авансовый отчет»_.
5. В поле «**Файл шаблона**» выберите пункт «****Значение****  »  и загрузите созданный ранее файл шаблона в формате XLSX.
6. В поле «**Имя выходного файла**» выберите пункт «**Значение**» и укажите требуемое имя экспортируемого файла с данными.
7. Установите флажок «**Экспортировать как PDF**».
8. Нажмите кнопку «**Сохранить**».

_![Настройка свойств шаблона экспорта](https://kb.comindware.ru/assets/img_63175def9edd8.png)_

## Настройка кнопки экспорта отчета

При создании шаблона экспорта автоматически создается кнопка экспорта. Удостоверимся, что эта кнопка экспорта соответствует нашим требованиям…

1. Перейдите на вкладку «**Кнопки***» шаблона _«Заявки на автомобили»_.*

    _![Список кнопок шаблона записи](https://kb.comindware.ru/assets/img_6317c3362c2cf.png)_

2. Откройте кнопку _«Авансовый отчет»_. Проверьте корректность её свойств:

    - **отображаемое название** — Авансовый отчет;
    - **контекст операции**— **Запись**;
    - **операция —** **Экспорт записи**;
    - **результат выполнения** — **Скачать документ**;
    - **шаблон экспорта** — Авансовый отчет.

    _![Свойства кнопки экспорта документа, сформированному по шаблону экспорта](https://kb.comindware.ru/assets/img_6475e53906e3b.png)_

Добавим кнопку для экспорта данных на экранную форму. Для этого создадим новую форму…

1. Перейдите на вкладку «**Формы**» шаблона _«Заявки на автомобили»_.
2. Нажмите кнопку «**Создать**».
3. Введите **отображаемое название** формы — _«Выгрузка отчета»_.
4. Измените **отображаемое название** автоматически созданной **новой области** на _«Выгрузка отчета»_.
5. Выделите область кнопок _«Выгрузка отчета»_ и перетащите на неё кнопку _«Авансовый отчет»_.
6. Сохраните форму.

_![Добавление кнопки на форму выгрузки отчета](https://kb.comindware.ru/assets/img_6317c544eb9bd.png)_

Теперь добавим созданную форму на форму задачи _«Выполнить рейс»_…

1. Перейдите на вкладку «**Диаграмма***» шаблона процесса _«Заказ автотранспорта»_ и нажмите кнопку* «**Редактировать**».
2. Выберите задачу _«Выполнить рейс»_ и в меню элемента нажмите кнопку «**Форма**».
3. Разверните в панели элементов шаблон _«Заявки на автомобили»_ и перетащите форму _«Выгрузка отчета»_ под область _«Выполнить рейс»_.
4. Сохраните форму.

    _![Добавление вложенной формы с кнопкой выгрузки отчета на форму задачи «<i>Выполнить рейс</i>»](https://kb.comindware.ru/assets/img_6317c6a560b8b.png)_

5. Опубликуйте диаграмму бизнес-процесса _«Заказ автотранспорта»_.

## Настройка разрешения на использование кнопки

Для того, чтобы водитель мог воспользоваться кнопкой _«Авансовый отчет»_, необходимо предоставить ему соответствующее разрешение с помощью роли _«Водитель»_.

1. Откройте раздел «**Роли***» приложения _«Управление автопарком»_.
2. Откройте роль _«Водитель»_ и перейдите на вкладку «**Разрешения**».
3. Раскройте в панели ресурсов шаблон _«Заявки на автомобили»_ и перетащите из него на таблицу разрешений кнопку _«Авансовый отчет»_.
4. Установите для кнопки _«Авансовый отчет»_ разрешение «**Использование кнопки**»*.
5. Сохраните роль.

    _![Добавление для роли «<i>Водитель</i>» разрешения на использование кнопки «<i>Авансовый отчет</i>»](https://kb.comindware.ru/assets/img_6317c77750dd6.png)_

## Тестирование

!!! note "Примечание"

    Если вы проходите этот урок после прохождения [Урока 8 _«Аккаунты»_][lesson_8], то для тестирования работы приложения вы можете выполнять пользовательские задачи одним из трех способов:

    - войти в систему несколько раз с разными учетными записями: заказчик, секретарь, водитель, диспетчер;
    - создать заявку на автомобиль, затем открыть диаграмму запущенного бизнес-процесса _«Заказ автотранспорта»_ и переходить к задачам с помощью кнопки «**Перейти***»  ![Перейти](https://kb.comindware.ru/assets/img_6317c8a89172d.png)  в панели «***Токены****  »;
    - назначить себя исполнителем всех пользовательских задач.

1. Перейдите к списку экземпляров шаблона _«Заказ автотранспорта»_ и создайте новую заявку.
2. С помощью раздела «**Мои задачи**» пройдите бизнес-процесс до задачи _«Выполнение рейса»_.
3. Откройте форму задачи _«Выполнить рейс»_ и заполните коллекцию затрат.
4. Нажмите кнопку «**Сохранить**».
5. Нажмите кнопку _«Авансовый отчет»_ и дождитесь экспорта (скачивания) сформированного PDF-документа.

    _![Выгрузка сформированного по шаблону экспорта документа с помощью кнопки на форме](https://kb.comindware.ru/assets/img_6317ca7944c7f.png)_

6. Откройте экспортированный документ.
7. Завершите задачу.

    _![PDF-документ авансового отчета, экспортированный по шаблону в формате Excel из {{ productName }}](https://kb.comindware.ru/assets/img_6245b16fd7334.png)_

## Результаты

Вы научились автоматически формировать и экспортировать документы по шаблонам, подставляя в них фактические данные из бизнес-приложения.

В [следующем уроке][lesson_10] вы научитесь работать с контентом.

{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
