<h1>Правила для формы. Определения, логика работы и настройка</h1><div class="mce-toc">
<h2 class="toc-heading">Содержание</h2>
<ul>
<li><a href="#mcetoc_1hjnb1fi81">Определения</a></li>
<li><a href="#mcetoc_1hk63g2uu0">Переход к конструктору правил для формы</a></li>
<li><a href="#mcetoc_1hk63sqh52">Элементы конструктора правил для формы</a></li>
<li><a href="#mcetoc_1hjnb45nq2">Настройка правил для формы</a>
<ul>
<li><a href="#rules3">Настройка правила</a>
<ul>
<li><a href="#mcetoc_1hk67lo0p1">Свойства правила</a></li>
</ul>
</li>
<li><a href="#rules4">Настройка действия</a></li>
<li><a href="#mcetoc_1hk696snl2">Типы и свойства действий</a>
<ul>
<li><a href="#mcetoc_1hk6cgc0s0">Общие свойства действий</a></li>
<li><a href="#rules5">Свойства действия «Изменить доступ» </a></li>
<li><a href="#rules6">Свойства действия «Установить значение» </a></li>
<li><a href="#rules7">Свойства действия «Показать ошибку»</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#mcetoc_1hjnb5cfi3">Удаление правил и действий</a></li>
<li><a href="#mcetoc_1hk66302k3">Связанные статьи</a></li>
</ul>
</div>
<div class="notice notice-success">
<h3 class="admonition-title" id="mcetoc_1hjnb1fi81">Определения</h3>
<ul>
<li><strong>Правила для формы</strong> предназначены для реализации трех сценариев работы конечного пользователя:
<ul>
<li>автоматическое условное и безусловное заполнение данными полей формы (значения по умолчанию, зависимости полей и т.д.);</li>
<li>динамическое изменение внешнего вида формы (изменение доступности и видимости полей и областей);</li>
<li>проверка значений, введенных в поля формы.</li>
</ul>
</li>
<li>Каждое <a href="#rules3">правило</a> состоит из одного или нескольких действий над <a href="https://kb.comindware.ru/article.php?id=2271#mcetoc_1gk3dol904">элементами формы</a> и задаёт условие их выполнения.</li>
<li>Каждое <a href="#rules4">действие</a> выполняется над одним элементом формы.</li>
<li>Действие входит в состав правила.</li>
<li>Для каждого действия можно задать отдельное условие выполнения.</li>
<li>Правила и действия выполняются независимо друг от друга и последовательно, сверху вниз по порядку их расположения в конструкторе.</li>
</ul>
</div>
<h2 id="mcetoc_1hk63g2uu0">Переход к конструктору правил для формы</h2>
<p>Для настройки правил для формы используется визуальный конструктор. Чтобы перейти к нему, выполните указанные ниже действия.</p>
<ol class="colored_numbers_list">
<li>Откройте <a href="https://kb.comindware.ru/article.php?id=2271#mcetoc_1gk3dol901">конструктор формы</a>.</li>
<li>
<p>Нажмите кнопку <em class="js-default-anchor fal fa-angle-down anchor">‌</em> рядом с названием формы и выберите пункт «<strong>Правила для формы</strong>» в раскрывающемся меню. </p>
</li>
<li>Отобразится редактор правил для формы.</li>
<li>
<p><a href="#mcetoc_1hjnb45nq2">Настройте правила</a>.</p>
<div class="screenshot_with_caption">
<p><img alt="Переход к конструктору правил для формы" class="img-responsive" height="184" src="https://kb.comindware.ru/assets/img_65a4e9ae0479b.png" width="999"/></p>
<p class="caption">Переход к конструктору правил для формы</p>
</div>
</li>
</ol>
<h2 id="mcetoc_1hk63sqh52">Элементы конструктора правил для формы</h2>
<ol>
<li>Панель элементов — содержит элементы, которые можно перетащить в рабочую область.
<ul>
<li><a href="#rules3"><strong>Правило</strong></a> — набор действий, выполняющихся последовательно при соблюдении заданного условия.</li>
<li><a href="#rules4"><strong>Действие</strong></a> — действие над <a href="https://kb.comindware.ru/article.php?id=2271#mcetoc_1gk3dol904">элементом формы</a>, которое будет выполняться при соблюдении условий, заданных в правиле и действии.</li>
</ul>
</li>
<li>Рабочая область — содержит правила и действия для формы.</li>
<li>Панель свойств— позволяет настроить правила и действия для формы.</li>
<li>Кнопки:
<ul>
<li><strong>Сохранить</strong> — сохранение правил для формы.</li>
<li><strong>Очистить</strong> — удаление всех правил для формы.</li>
<li><strong>Настроить шаблон</strong> <em aria-hidden="true" class="fal fa-cog">‌</em> —  Свойства » шаблона.
<div class="screenshot_with_caption">
<p><img alt="Конструктор правил для формы" class="img-responsive" height="314" src="https://kb.comindware.ru/assets/img_65a4ef1eecb58.png" width="979"/></p>
<p class="caption">Конструктор правил для формы</p>
</div>
</li>
</ul>
</li>
</ol>
<h2 id="mcetoc_1hjnb45nq2">Настройка правил для формы</h2>
<p>Настройка правил для формы выполняется путем перетаскивания правил и действий с панели элементов в рабочую область конструктора правил и настройки их свойств.</p>
<h3 id="rules3">Настройка правила</h3>
<p><strong>Правило</strong> является контейнером для действий и задаёт базовое условие их выполнения.</p>
<div class="notice notice-warning">
<p class="admonition-title">Логика работы правил</p>
<p>Правила выполняются независимо друг от друга, последовательно по порядку следования в конструкторе — сверху вниз.</p>
<p>Это важно понимать, так как если в разных правилах есть действия, выполняющие действия над одним и тем же элементом формы и при этом условия выполнения этих правил вернули <code>true</code>, в итоге над этим элементом формы будут выполнены действия из правила, которое находится ниже в конструкторе, т. е. выполнится последним.</p>
</div>
<ol class="colored_numbers_list">
<li>Перетащите правило из панели элементов на рабочую область или выберите имеющееся правило.</li>
<li>Отобразится панель «<strong>Свойства правила</strong>».</li>
<li>Настройте <a href="#mcetoc_1hk67lo0p1">свойства правила</a>.</li>
<li>Чтобы изменить порядок выполнения правил, перетаскивайте их в рабочей области.</li>
</ol>
<div class="screenshot_with_caption">
<p><img class="img-responsive" src="https://kb.comindware.ru/assets/img_65a4fcfe81fe4.png"/></p>
<p class="caption">Свойства правила</p>
</div>
<h4 id="mcetoc_1hk67lo0p1">Свойства правила</h4>
<ul>
<li><strong>Название</strong> — наглядное наименование правила.</li>
<li><strong>Условие выполнения </strong>— формула или выражение на языке N3, которое должно возвращать <code>true</code> или  <code>false</code>.
<ul>
<li>Если выражение вернёт <code>true</code>, то будут последовательно выполнены действия внутри правила (сверху вниз по порядку их расположения в конструкторе).</li>
<li>Если выражение вернёт <code>false</code> или пустое значение, действия внутри правила не будут выполняться.</li>
<li>Проверка условий выполнения правил происходит после внесения изменений в любое поле на форме, а также при открытии формы.</li>
</ul>
<div class="notice notice-info">
<p class="admonition-title"><a id="ConditionContext"></a>Контекст условия выполнения правила</p>
<ul>
<li>Условие выполнения правила для формы вычисляется в контексте записи, для которой открыта форма.</li>
<li>Если форма с правилами вложена в другую форму, то контекстом для условий выполнения правил вложенной формы является запись, которая выводится о вложенной форме:
<ul>
<li>если вложенная форма относится к текущей записи, то контекстом является текущая запись;</li>
<li>если вложенная форма относится к шаблону, связанному с <a href="https://kb.comindware.ru/article.php?id=2243">атрибутом типа «<strong>Запись</strong>»</a>, то контекстом является запись, указанная в этом атрибуте.</li>
</ul>
</li>
</ul>
</div>
</li>
</ul>
<h3 id="rules4">Настройка действия</h3>
<p><strong>Действие</strong> определяет изменение, которое необходимо произвести с элементом формы или данными в поле при соблюдении условия выполнения действия и его родительского правила.</p>
<div class="notice notice-warning">
<p class="admonition-title">Логика работы действий</p>
<p>Действия выполняются независимо друг от друга, последовательно по порядку следования в правиле — сверху вниз.</p>
<p>Если в правиле есть действия над одним и тем же элементом формы, будут последовательно выполнены все эти действия с учётом их условий выполнения.</p>
</div>
<ol class="colored_numbers_list">
<li>Перетащите действие из панели элементов в правило или выберите имеющееся действие.</li>
<li>Отобразится панель «<strong>Свойства действия</strong>».</li>
<li>Настройте <a href="#mcetoc_1hk6cgc0s0">свойства действия</a>.</li>
<li>Чтобы изменить порядок выполнения действий, перетаскивайте их в правилах.</li>
</ol>
<h3 id="mcetoc_1hk696snl2">Типы и свойства действий</h3>
<p>Предусмотрены действия трех типов, применимые к различным элементам формы:</p>
<ul>
<li><a href="#rules5"><strong>Изменить доступ</strong></a> — позволяет определить доступность элемента формы для конечного пользователя;</li>
<li><a href="#rules6"><strong>Установить значение</strong></a> — позволяет задать новое значение полей атрибутов;</li>
<li><a href="#rules7"><strong>Показать ошибку</strong></a> — позволяет вывести на форме сообщение, привязанное к указанному элементу.</li>
</ul>
<p><strong>Доступные действия для элементов формы различных типов</strong></p>
<table style="width: 100%;">
<tbody>
<tr>
<th>Тип элемента формы</th>
<th>Изменить доступ</th>
<th>Установить значение</th>
<th>Показать ошибку</th>
</tr>
<tr>
<td>Статические элементы </td>
<td><strong>+</strong></td>
<td><strong>−</strong></td>
<td><strong>−</strong></td>
</tr>
<tr>
<td>Поля атрибутов</td>
<td><strong>+</strong></td>
<td><strong>+</strong></td>
<td><strong>+</strong></td>
</tr>
<tr>
<td>Столбцы таблиц</td>
<td><strong>+</strong></td>
<td><strong>+</strong></td>
<td><strong>+</strong></td>
</tr>
<tr>
<td>Вложенные формы </td>
<td><strong>+</strong></td>
<td><strong>−</strong></td>
<td><strong>−</strong></td>
</tr>
</tbody>
</table>
<h4 id="mcetoc_1hk6cgc0s0">Общие свойства действий</h4>
<p>У действий всех типов предусмотрены перечисленные ниже свойства.</p>
<ul>
<li><strong>Элемент формы</strong> — элемент, над которым необходимо выполнить действие: статический элемент, поле, столбец таблицы или вложенная форма.</li>
<li><strong>Действие</strong> — <a href="#mcetoc_1hk696snl2">тип действия</a>, которое необходимо выполнить над выбранным элементом. Появляется после выбора элемента формы.</li>
<li><strong>Условие выполнения</strong> — условие, которое применяется дополнительно к <a href="#mcetoc_1hk67lo0p1">условию выполнения правила</a>.
<ul>
<li>Действие «<a href="#rules5"><strong>Изменить доступ</strong></a>» или «<a href="#rules6"><strong>Установить значение</strong></a>» будет выполнено, если выражение вернёт <code>true</code>.</li>
<li>Действие «<a href="#rules7"><strong>Показать ошибку</strong></a>» будет выполнено, если выражение вернёт <code>false</code> или пустое значение.</li>
<li>Проверка условий выполнения и выполнение действий происходят после внесения изменений в любое поле на форме, а также при открытии формы. </li>
</ul>
<div class="notice notice-info">
<p class="admonition-title">Контекст условия выполнения действия</p>
<p>Контекст вычисления условия выполнения действия зависит от того, к какому элементу формы применяется действие: </p>
<ul>
<li>
<p><span style="box-sizing: border-box; color: #545764; font-family: 'Open Sans', sans-serif; font-size: 15px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 300; letter-spacing: 0.2px; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: #e5f5fa; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;">если элемент не является столбцом таблицы</span>, то контекстом является текущая запись, для которой открыта форма;</p>
</li>
<li>
<p>если элемент является столбцом таблицы, то контекстом является запись, которая относится к строке таблицы атрибута типа «<strong>Запись</strong>».</p>
</li>
</ul>
</div>
</li>
</ul>
<div class="screenshot_with_caption">
<p><img alt="Свойства действия" class="img-responsive" height="611" src="https://kb.comindware.ru/assets/img_65a6321aca381.png" width="979"/></p>
<p class="caption">Свойства действия</p>
</div>
<p>Свойства действий каждого типа представлены в ниже. </p>
<h4 id="rules5">Свойства действия «Изменить доступ» </h4>
<p>Это действие предназначено для смены режима доступа и видимости элемента на форме.</p>
<p>Действие «<strong>Изменить доступ</strong>» выполняется при открытии формы и после внесения изменений в любое поле формы, если условия выполнения правила и действия возвращают <code>true</code>.</p>
<p>Помимо <a href="#mcetoc_1hk6cgc0s0">общих свойств</a> у этого действия предусмотрено свойство «<strong>Новое значение</strong>».</p>
<p>В этом поле следует выбрать режим доступа для указанного элемента формы:</p>
<ul>
<li><strong>Требовать ввод </strong>— значение поля должно быть обязательно заполнено на момент сохранения формы;</li>
<li><strong>Разрешить ввод</strong> — в поля внутри выбранного элемента можно вводить значения;</li>
<li><strong>Только чтение</strong> — элемент отображается, но поля внутри него нельзя вводить значения;</li>
<li><strong>Скрыть</strong> — элемент не отображается на форме.</li>
</ul>
<div class="notice notice-warning">
<p class="admonition-title">Логика работы действия «Изменить доступ»</p>
<p>Изменение режима доступа к элементу формы применяется только до следующего изменения данных на форме:</p>
<ul>
<li>При изменении данных на форме для элемента устанавливается исходный режим доступа, заданный в конструкторе формы.</li>
<li>Все правила и действия выполняются заново.</li>
<li>Если для новых данных условия выполнения правил и действий больше не выполняются, устанавливается исходный режим доступа, заданный в конструкторе формы.</li>
</ul>
</div>
<p><strong>Доступные режимы доступа для элементов формы различных типов</strong></p>
<table style="width: 100%;">
<tbody>
<tr>
<th style="width: 0px; height: 0px;">Тип элемента формы</th>
<th style="width: 0px; height: 0px;">Требовать ввод</th>
<th style="width: 0px; height: 0px;">Разрешить ввод</th>
<th style="width: 0px; height: 0px;">Только чтение</th>
<th style="width: 0px; height: 0px;">Скрыть</th>
</tr>
<tr>
<td style="width: 0px; height: 0px;">Статические элементы</td>
<td style="width: 0px; height: 0px;"><strong>−</strong></td>
<td style="width: 0px; height: 0px;"><strong>+</strong></td>
<td style="width: 0px; height: 0px;"><strong>+</strong></td>
<td style="width: 0px; height: 0px;"><strong>+</strong></td>
</tr>
<tr>
<td style="width: 0px; height: 0px;">Поля атрибутов</td>
<td style="width: 0px; height: 0px;"><strong>+</strong></td>
<td style="width: 0px; height: 0px;"><strong>+</strong></td>
<td style="width: 0px; height: 0px;"><strong>+</strong></td>
<td style="width: 0px; height: 0px;"><strong>+</strong></td>
</tr>
<tr>
<td style="width: 0px;">Столбцы таблиц</td>
<td style="width: 0px;"><strong>+</strong></td>
<td style="width: 0px;"><strong>+</strong></td>
<td style="width: 0px;"><strong>+</strong></td>
<td style="width: 0px;"><strong>+</strong></td>
</tr>
<tr>
<td style="width: 0px; height: 0px;">Поля вычисляемых атрибутов</td>
<td style="width: 0px; height: 0px;"><strong>−</strong></td>
<td style="width: 0px; height: 0px;"><strong>−</strong></td>
<td style="width: 0px; height: 0px;"><strong>+</strong></td>
<td style="width: 0px; height: 0px;"><strong>+</strong></td>
</tr>
<tr>
<td style="width: 0px; height: 0px;">Вложенные формы</td>
<td style="width: 0px; height: 0px;"><strong>−</strong></td>
<td style="width: 0px; height: 0px;"><strong>+</strong></td>
<td style="width: 0px; height: 0px;"><strong>+</strong></td>
<td style="width: 0px; height: 0px;"><strong>+</strong></td>
</tr>
</tbody>
</table>
<p> </p>
<h4 id="rules6">Свойства действия «Установить значение» </h4>
<p>Это действие предназначено для изменения данных в полях атрибутов и столбцов таблиц на форме.</p>
<p>Действие «<strong>Установить значения</strong>» выполняется при открытии формы и после внесения изменений в любое поле формы, если условия выполнения правила и действия возвращают <code>true</code>.</p>
<p>Помимо <a href="#mcetoc_1hk6cgc0s0">общих свойств</a> у этого действия предусмотрено свойство «<strong>Новое значение</strong>».</p>
<p>В это поле следует вести <strong>формулу</strong>, выражение на языке <strong>N3 </strong>или <strong>значение.</strong></p>
<p>Тип <strong>нового значения </strong>должен соответствовать типу данных атрибута, с которым связано поле на форме:</p>
<ul>
<li><strong>Аккаунт</strong> — один или несколько идентификаторов аккаунтов;</li>
<li><strong>Гиперссылка</strong> — строка с URL-адресом;</li>
<li><strong>Дата и время </strong>— <code>DATE()</code>;</li>
<li><strong>Длительность</strong> — <code>DURATION()</code>;</li>
<li><strong>Документ</strong> — один или несколько идентификаторов документов;</li>
<li><strong>Запись</strong> — один или несколько идентификаторов записей из связанного шаблона.</li>
<li><strong>Изображение</strong> — один или несколько идентификаторов изображений;</li>
<li><strong>Логический</strong> — <code>true</code> или <code>false</code>;</li>
<li><strong>Организационная единица</strong> — один или несколько идентификаторов оргединиц;</li>
<li><strong>Роль</strong> — один или несколько идентификаторов ролей;</li>
<li><strong>Список значений</strong> — идентификатор значения из списка;</li>
<li><strong>Текст</strong> — строковое значение;</li>
<li><strong>Чертёж</strong> — идентификаторы записей, привязанных к чертежу;</li>
<li><strong>Число</strong> — <code>DECIMAL()</code>;</li>
<li><strong>Штрихкод</strong> — строка, которая будет закодирована в штрихкоде.</li>
</ul>
<div class="notice notice-info">
<p class="admonition-title">Контекст вычисления нового значения</p>
<p>Контекст вычисления <strong>нового значения</strong> поля зависит от того, к какому элементу формы применяется действие: </p>
<ul>
<li>
<p><span style="box-sizing: border-box; color: #545764; font-family: 'Open Sans', sans-serif; font-size: 15px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 300; letter-spacing: 0.2px; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: #e5f5fa; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;">если элемент не является столбцом таблицы</span>, то контекстом является текущая запись, для которой открыта форма;</p>
</li>
<li>
<p>если элемент является столбцом таблицы, то контекстом является запись, которая относится к строке таблицы атрибута типа «<strong>Запись</strong>».</p>
</li>
</ul>
</div>
<p>Если <strong>новое значение</strong> будет пустым, то при выполнении действия поле на форме будет очищено.</p>
<p>Значение поля на форме может изменить другое действие или конечный пользователь.</p>
<h4 id="rules7">Свойства действия «Показать ошибку»</h4>
<p>Это действие предназначено для проверки значений полей атрибутов и столбцов таблиц и вывода сообщения у поля на форме.</p>
<p>Действие «<strong>Показать ошибку</strong>» выполняется только при попытке сохранения экранной формы, если условие выполнения правила возвращает <code>true</code> и условие выполнения действия возвращает <code>false</code>.</p>
<p>Помимо <a href="#mcetoc_1hk6cgc0s0">общих свойств</a> у этого действия предусмотрены перечисленные ниже свойства.</p>
<ul>
<li><strong>Тип сообщения</strong>:
<ul>
<li><strong>Предупреждение</strong> — при сохранении формы выводит предупреждение на указанном поле формы, при этом данные на форме будут сохранены.</li>
<li><strong>Ошибка</strong> — при сохранении формы выводит ошибку на указанном поле формы, при этом данные на форме нельзя будет сохранить, пока ошибка не будет устранена.</li>
</ul>
</li>
<li><strong>Сообщение</strong> — введите строковое <strong>значение</strong> с текстом сообщения либо <strong>формулу</strong> или выражение на языке <strong>N3</strong>, возвращающие текст сообщения.</li>
</ul>
<div class="screenshot_with_caption">
<p><img align="" alt="Внешний вид сообщения об ошибке на поле " class="img-responsive" height="413" src="https://kb.comindware.ru/assets/u122.png" width="1395"/></p>
<p class="caption">Внешний вид сообщения об ошибке на поле </p>
</div>
<h2 id="mcetoc_1hjnb5cfi3">Удаление правил и действий</h2>
<ol class="colored_numbers_list">
<li>Откройте <a href="https://kb.comindware.ru/article.php?id=2537#mcetoc_1hk63g2uu0">конструктор правил для формы</a>.</li>
<li>Выберите правило или действие и перетащите его на панель элементов.</li>
<li>Подтвердите удаление удаления правила или действия.</li>
<li>Для очистки всех настроенных правил и действий можно нажать кнопку «Очистить».</li>
<li>Чтобы сохранить изменения, нажмите кнопку «Сохранить».</li>
</ol>
<figure class="screenshot_with_caption">
<p><img alt="Удаление правила для формы" class="img-responsive" height="321" src="https://kb.comindware.ru/assets/img_65a4f86f84ee9.png" width="976"/></p>
<figcaption class="caption">Удаление правил для формы</figcaption>
</figure>
<h2 id="mcetoc_1hk66302k3">Связанные статьи</h2>
<p><strong><samp data-name="aid" data-title="" data-value="2271">Редактирование формы {Article-ID:2271}</samp> </strong></p>
<p><strong><samp data-name="aid" data-title="" data-value="2531"><span style="color: #0066bc; font-family: Tahoma;"><img src="https://kb.comindware.ru/images/marker.png" style="vertical-align: middle;"/> Динамические элементы форм {Article-ID:2531}</span></samp> </strong></p>
<p><strong><samp data-name="aid" data-title="" data-value="2530"><span style="color: #0066bc; font-family: Tahoma;"><img src="https://kb.comindware.ru/images/marker.png" style="vertical-align: middle;"/> Статические элементы формы {Article-ID:2530}</span></samp> </strong></p>
<p><strong><samp data-name="aid" data-title="" data-value="2252"><span style="color: #0066bc; font-family: Tahoma;"><img src="https://kb.comindware.ru/images/marker.png" style="vertical-align: middle;"/> Типы и свойства атрибутов {Article-ID:2252}</span></samp> </strong></p>
<p><a class="md-top md-icon mkdocs_imported_link" href="#"> <em class="fa-light fa-arrow-up">‌</em> К началу </a></p>
<p> </p><h1>Правила для формы. Определения, логика работы и настройка</h1><div class="mce-toc">
<h2 class="toc-heading">Содержание</h2>
<ul>
<li><a href="#mcetoc_1hjnb1fi81">Определения</a></li>
<li><a href="#mcetoc_1hk63g2uu0">Переход к конструктору правил для формы</a></li>
<li><a href="#mcetoc_1hk63sqh52">Элементы конструктора правил для формы</a></li>
<li><a href="#mcetoc_1hjnb45nq2">Настройка правил для формы</a>
<ul>
<li><a href="#rules3">Настройка правила</a>
<ul>
<li><a href="#mcetoc_1hk67lo0p1">Свойства правила</a></li>
</ul>
</li>
<li><a href="#rules4">Настройка действия</a></li>
<li><a href="#mcetoc_1hk696snl2">Типы и свойства действий</a>
<ul>
<li><a href="#mcetoc_1hk6cgc0s0">Общие свойства действий</a></li>
<li><a href="#rules5">Свойства действия «Изменить доступ» </a></li>
<li><a href="#rules6">Свойства действия «Установить значение» </a></li>
<li><a href="#rules7">Свойства действия «Показать ошибку»</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#mcetoc_1hjnb5cfi3">Удаление правил и действий</a></li>
<li><a href="#mcetoc_1hk66302k3">Связанные статьи</a></li>
</ul>
</div>
<div class="notice notice-success">
<h3 class="admonition-title" id="mcetoc_1hjnb1fi81">Определения</h3>
<ul>
<li><strong>Правила для формы</strong> предназначены для реализации трех сценариев работы конечного пользователя:
<ul>
<li>автоматическое условное и безусловное заполнение данными полей формы (значения по умолчанию, зависимости полей и т.д.);</li>
<li>динамическое изменение внешнего вида формы (изменение доступности и видимости полей и областей);</li>
<li>проверка значений, введенных в поля формы.</li>
</ul>
</li>
<li>Каждое <a href="#rules3">правило</a> состоит из одного или нескольких действий над <a href="https://kb.comindware.ru/article.php?id=2271#mcetoc_1gk3dol904">элементами формы</a> и задаёт условие их выполнения.</li>
<li>Каждое <a href="#rules4">действие</a> выполняется над одним элементом формы.</li>
<li>Действие входит в состав правила.</li>
<li>Для каждого действия можно задать отдельное условие выполнения.</li>
<li>Правила и действия выполняются независимо друг от друга и последовательно, сверху вниз по порядку их расположения в конструкторе.</li>
</ul>
</div>
<h2 id="mcetoc_1hk63g2uu0">Переход к конструктору правил для формы</h2>
<p>Для настройки правил для формы используется визуальный конструктор. Чтобы перейти к нему, выполните указанные ниже действия.</p>
<ol class="colored_numbers_list">
<li>Откройте <a href="https://kb.comindware.ru/article.php?id=2271#mcetoc_1gk3dol901">конструктор формы</a>.</li>
<li>
<p>Нажмите кнопку <em class="js-default-anchor fal fa-angle-down anchor">‌</em> рядом с названием формы и выберите пункт «<strong>Правила для формы</strong>» в раскрывающемся меню. </p>
</li>
<li>Отобразится редактор правил для формы.</li>
<li>
<p><a href="#mcetoc_1hjnb45nq2">Настройте правила</a>.</p>
<div class="screenshot_with_caption">
<p><img alt="Переход к конструктору правил для формы" class="img-responsive" height="184" src="https://kb.comindware.ru/assets/img_65a4e9ae0479b.png" width="999"/></p>
<p class="caption">Переход к конструктору правил для формы</p>
</div>
</li>
</ol>
<h2 id="mcetoc_1hk63sqh52">Элементы конструктора правил для формы</h2>
<ol>
<li>Панель элементов — содержит элементы, которые можно перетащить в рабочую область.
<ul>
<li><a href="#rules3"><strong>Правило</strong></a> — набор действий, выполняющихся последовательно при соблюдении заданного условия.</li>
<li><a href="#rules4"><strong>Действие</strong></a> — действие над <a href="https://kb.comindware.ru/article.php?id=2271#mcetoc_1gk3dol904">элементом формы</a>, которое будет выполняться при соблюдении условий, заданных в правиле и действии.</li>
</ul>
</li>
<li>Рабочая область — содержит правила и действия для формы.</li>
<li>Панель свойств— позволяет настроить правила и действия для формы.</li>
<li>Кнопки:
<ul>
<li><strong>Сохранить</strong> — сохранение правил для формы.</li>
<li><strong>Очистить</strong> — удаление всех правил для формы.</li>
<li><strong>Настроить шаблон</strong> <em aria-hidden="true" class="fal fa-cog">‌</em> —  Свойства » шаблона.
<div class="screenshot_with_caption">
<p><img alt="Конструктор правил для формы" class="img-responsive" height="314" src="https://kb.comindware.ru/assets/img_65a4ef1eecb58.png" width="979"/></p>
<p class="caption">Конструктор правил для формы</p>
</div>
</li>
</ul>
</li>
</ol>
<h2 id="mcetoc_1hjnb45nq2">Настройка правил для формы</h2>
<p>Настройка правил для формы выполняется путем перетаскивания правил и действий с панели элементов в рабочую область конструктора правил и настройки их свойств.</p>
<h3 id="rules3">Настройка правила</h3>
<p><strong>Правило</strong> является контейнером для действий и задаёт базовое условие их выполнения.</p>
<div class="notice notice-warning">
<p class="admonition-title">Логика работы правил</p>
<p>Правила выполняются независимо друг от друга, последовательно по порядку следования в конструкторе — сверху вниз.</p>
<p>Это важно понимать, так как если в разных правилах есть действия, выполняющие действия над одним и тем же элементом формы и при этом условия выполнения этих правил вернули <code>true</code>, в итоге над этим элементом формы будут выполнены действия из правила, которое находится ниже в конструкторе, т. е. выполнится последним.</p>
</div>
<ol class="colored_numbers_list">
<li>Перетащите правило из панели элементов на рабочую область или выберите имеющееся правило.</li>
<li>Отобразится панель «<strong>Свойства правила</strong>».</li>
<li>Настройте <a href="#mcetoc_1hk67lo0p1">свойства правила</a>.</li>
<li>Чтобы изменить порядок выполнения правил, перетаскивайте их в рабочей области.</li>
</ol>
<div class="screenshot_with_caption">
<p><img class="img-responsive" src="https://kb.comindware.ru/assets/img_65a4fcfe81fe4.png"/></p>
<p class="caption">Свойства правила</p>
</div>
<h4 id="mcetoc_1hk67lo0p1">Свойства правила</h4>
<ul>
<li><strong>Название</strong> — наглядное наименование правила.</li>
<li><strong>Условие выполнения </strong>— формула или выражение на языке N3, которое должно возвращать <code>true</code> или  <code>false</code>.
<ul>
<li>Если выражение вернёт <code>true</code>, то будут последовательно выполнены действия внутри правила (сверху вниз по порядку их расположения в конструкторе).</li>
<li>Если выражение вернёт <code>false</code> или пустое значение, действия внутри правила не будут выполняться.</li>
<li>Проверка условий выполнения правил происходит после внесения изменений в любое поле на форме, а также при открытии формы.</li>
</ul>
<div class="notice notice-info">
<p class="admonition-title"><a id="ConditionContext"></a>Контекст условия выполнения правила</p>
<ul>
<li>Условие выполнения правила для формы вычисляется в контексте записи, для которой открыта форма.</li>
<li>Если форма с правилами вложена в другую форму, то контекстом для условий выполнения правил вложенной формы является запись, которая выводится о вложенной форме:
<ul>
<li>если вложенная форма относится к текущей записи, то контекстом является текущая запись;</li>
<li>если вложенная форма относится к шаблону, связанному с <a href="https://kb.comindware.ru/article.php?id=2243">атрибутом типа «<strong>Запись</strong>»</a>, то контекстом является запись, указанная в этом атрибуте.</li>
</ul>
</li>
</ul>
</div>
</li>
</ul>
<h3 id="rules4">Настройка действия</h3>
<p><strong>Действие</strong> определяет изменение, которое необходимо произвести с элементом формы или данными в поле при соблюдении условия выполнения действия и его родительского правила.</p>
<div class="notice notice-warning">
<p class="admonition-title">Логика работы действий</p>
<p>Действия выполняются независимо друг от друга, последовательно по порядку следования в правиле — сверху вниз.</p>
<p>Если в правиле есть действия над одним и тем же элементом формы, будут последовательно выполнены все эти действия с учётом их условий выполнения.</p>
</div>
<ol class="colored_numbers_list">
<li>Перетащите действие из панели элементов в правило или выберите имеющееся действие.</li>
<li>Отобразится панель «<strong>Свойства действия</strong>».</li>
<li>Настройте <a href="#mcetoc_1hk6cgc0s0">свойства действия</a>.</li>
<li>Чтобы изменить порядок выполнения действий, перетаскивайте их в правилах.</li>
</ol>
<h3 id="mcetoc_1hk696snl2">Типы и свойства действий</h3>
<p>Предусмотрены действия трех типов, применимые к различным элементам формы:</p>
<ul>
<li><a href="#rules5"><strong>Изменить доступ</strong></a> — позволяет определить доступность элемента формы для конечного пользователя;</li>
<li><a href="#rules6"><strong>Установить значение</strong></a> — позволяет задать новое значение полей атрибутов;</li>
<li><a href="#rules7"><strong>Показать ошибку</strong></a> — позволяет вывести на форме сообщение, привязанное к указанному элементу.</li>
</ul>
<p><strong>Доступные действия для элементов формы различных типов</strong></p>
<table style="width: 100%;">
<tbody>
<tr>
<th>Тип элемента формы</th>
<th>Изменить доступ</th>
<th>Установить значение</th>
<th>Показать ошибку</th>
</tr>
<tr>
<td>Статические элементы </td>
<td><strong>+</strong></td>
<td><strong>−</strong></td>
<td><strong>−</strong></td>
</tr>
<tr>
<td>Поля атрибутов</td>
<td><strong>+</strong></td>
<td><strong>+</strong></td>
<td><strong>+</strong></td>
</tr>
<tr>
<td>Столбцы таблиц</td>
<td><strong>+</strong></td>
<td><strong>+</strong></td>
<td><strong>+</strong></td>
</tr>
<tr>
<td>Вложенные формы </td>
<td><strong>+</strong></td>
<td><strong>−</strong></td>
<td><strong>−</strong></td>
</tr>
</tbody>
</table>
<h4 id="mcetoc_1hk6cgc0s0">Общие свойства действий</h4>
<p>У действий всех типов предусмотрены перечисленные ниже свойства.</p>
<ul>
<li><strong>Элемент формы</strong> — элемент, над которым необходимо выполнить действие: статический элемент, поле, столбец таблицы или вложенная форма.</li>
<li><strong>Действие</strong> — <a href="#mcetoc_1hk696snl2">тип действия</a>, которое необходимо выполнить над выбранным элементом. Появляется после выбора элемента формы.</li>
<li><strong>Условие выполнения</strong> — условие, которое применяется дополнительно к <a href="#mcetoc_1hk67lo0p1">условию выполнения правила</a>.
<ul>
<li>Действие «<a href="#rules5"><strong>Изменить доступ</strong></a>» или «<a href="#rules6"><strong>Установить значение</strong></a>» будет выполнено, если выражение вернёт <code>true</code>.</li>
<li>Действие «<a href="#rules7"><strong>Показать ошибку</strong></a>» будет выполнено, если выражение вернёт <code>false</code> или пустое значение.</li>
<li>Проверка условий выполнения и выполнение действий происходят после внесения изменений в любое поле на форме, а также при открытии формы. </li>
</ul>
<div class="notice notice-info">
<p class="admonition-title">Контекст условия выполнения действия</p>
<p>Контекст вычисления условия выполнения действия зависит от того, к какому элементу формы применяется действие: </p>
<ul>
<li>
<p><span style="box-sizing: border-box; color: #545764; font-family: 'Open Sans', sans-serif; font-size: 15px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 300; letter-spacing: 0.2px; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: #e5f5fa; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;">если элемент не является столбцом таблицы</span>, то контекстом является текущая запись, для которой открыта форма;</p>
</li>
<li>
<p>если элемент является столбцом таблицы, то контекстом является запись, которая относится к строке таблицы атрибута типа «<strong>Запись</strong>».</p>
</li>
</ul>
</div>
</li>
</ul>
<div class="screenshot_with_caption">
<p><img alt="Свойства действия" class="img-responsive" height="611" src="https://kb.comindware.ru/assets/img_65a6321aca381.png" width="979"/></p>
<p class="caption">Свойства действия</p>
</div>
<p>Свойства действий каждого типа представлены в ниже. </p>
<h4 id="rules5">Свойства действия «Изменить доступ» </h4>
<p>Это действие предназначено для смены режима доступа и видимости элемента на форме.</p>
<p>Действие «<strong>Изменить доступ</strong>» выполняется при открытии формы и после внесения изменений в любое поле формы, если условия выполнения правила и действия возвращают <code>true</code>.</p>
<p>Помимо <a href="#mcetoc_1hk6cgc0s0">общих свойств</a> у этого действия предусмотрено свойство «<strong>Новое значение</strong>».</p>
<p>В этом поле следует выбрать режим доступа для указанного элемента формы:</p>
<ul>
<li><strong>Требовать ввод </strong>— значение поля должно быть обязательно заполнено на момент сохранения формы;</li>
<li><strong>Разрешить ввод</strong> — в поля внутри выбранного элемента можно вводить значения;</li>
<li><strong>Только чтение</strong> — элемент отображается, но поля внутри него нельзя вводить значения;</li>
<li><strong>Скрыть</strong> — элемент не отображается на форме.</li>
</ul>
<div class="notice notice-warning">
<p class="admonition-title">Логика работы действия «Изменить доступ»</p>
<p>Изменение режима доступа к элементу формы применяется только до следующего изменения данных на форме:</p>
<ul>
<li>При изменении данных на форме для элемента устанавливается исходный режим доступа, заданный в конструкторе формы.</li>
<li>Все правила и действия выполняются заново.</li>
<li>Если для новых данных условия выполнения правил и действий больше не выполняются, устанавливается исходный режим доступа, заданный в конструкторе формы.</li>
</ul>
</div>
<p><strong>Доступные режимы доступа для элементов формы различных типов</strong></p>
<table style="width: 100%;">
<tbody>
<tr>
<th style="width: 0px; height: 0px;">Тип элемента формы</th>
<th style="width: 0px; height: 0px;">Требовать ввод</th>
<th style="width: 0px; height: 0px;">Разрешить ввод</th>
<th style="width: 0px; height: 0px;">Только чтение</th>
<th style="width: 0px; height: 0px;">Скрыть</th>
</tr>
<tr>
<td style="width: 0px; height: 0px;">Статические элементы</td>
<td style="width: 0px; height: 0px;"><strong>−</strong></td>
<td style="width: 0px; height: 0px;"><strong>+</strong></td>
<td style="width: 0px; height: 0px;"><strong>+</strong></td>
<td style="width: 0px; height: 0px;"><strong>+</strong></td>
</tr>
<tr>
<td style="width: 0px; height: 0px;">Поля атрибутов</td>
<td style="width: 0px; height: 0px;"><strong>+</strong></td>
<td style="width: 0px; height: 0px;"><strong>+</strong></td>
<td style="width: 0px; height: 0px;"><strong>+</strong></td>
<td style="width: 0px; height: 0px;"><strong>+</strong></td>
</tr>
<tr>
<td style="width: 0px;">Столбцы таблиц</td>
<td style="width: 0px;"><strong>+</strong></td>
<td style="width: 0px;"><strong>+</strong></td>
<td style="width: 0px;"><strong>+</strong></td>
<td style="width: 0px;"><strong>+</strong></td>
</tr>
<tr>
<td style="width: 0px; height: 0px;">Поля вычисляемых атрибутов</td>
<td style="width: 0px; height: 0px;"><strong>−</strong></td>
<td style="width: 0px; height: 0px;"><strong>−</strong></td>
<td style="width: 0px; height: 0px;"><strong>+</strong></td>
<td style="width: 0px; height: 0px;"><strong>+</strong></td>
</tr>
<tr>
<td style="width: 0px; height: 0px;">Вложенные формы</td>
<td style="width: 0px; height: 0px;"><strong>−</strong></td>
<td style="width: 0px; height: 0px;"><strong>+</strong></td>
<td style="width: 0px; height: 0px;"><strong>+</strong></td>
<td style="width: 0px; height: 0px;"><strong>+</strong></td>
</tr>
</tbody>
</table>
<p> </p>
<h4 id="rules6">Свойства действия «Установить значение» </h4>
<p>Это действие предназначено для изменения данных в полях атрибутов и столбцов таблиц на форме.</p>
<p>Действие «<strong>Установить значения</strong>» выполняется при открытии формы и после внесения изменений в любое поле формы, если условия выполнения правила и действия возвращают <code>true</code>.</p>
<p>Помимо <a href="#mcetoc_1hk6cgc0s0">общих свойств</a> у этого действия предусмотрено свойство «<strong>Новое значение</strong>».</p>
<p>В это поле следует вести <strong>формулу</strong>, выражение на языке <strong>N3 </strong>или <strong>значение.</strong></p>
<p>Тип <strong>нового значения </strong>должен соответствовать типу данных атрибута, с которым связано поле на форме:</p>
<ul>
<li><strong>Аккаунт</strong> — один или несколько идентификаторов аккаунтов;</li>
<li><strong>Гиперссылка</strong> — строка с URL-адресом;</li>
<li><strong>Дата и время </strong>— <code>DATE()</code>;</li>
<li><strong>Длительность</strong> — <code>DURATION()</code>;</li>
<li><strong>Документ</strong> — один или несколько идентификаторов документов;</li>
<li><strong>Запись</strong> — один или несколько идентификаторов записей из связанного шаблона.</li>
<li><strong>Изображение</strong> — один или несколько идентификаторов изображений;</li>
<li><strong>Логический</strong> — <code>true</code> или <code>false</code>;</li>
<li><strong>Организационная единица</strong> — один или несколько идентификаторов оргединиц;</li>
<li><strong>Роль</strong> — один или несколько идентификаторов ролей;</li>
<li><strong>Список значений</strong> — идентификатор значения из списка;</li>
<li><strong>Текст</strong> — строковое значение;</li>
<li><strong>Чертёж</strong> — идентификаторы записей, привязанных к чертежу;</li>
<li><strong>Число</strong> — <code>DECIMAL()</code>;</li>
<li><strong>Штрихкод</strong> — строка, которая будет закодирована в штрихкоде.</li>
</ul>
<div class="notice notice-info">
<p class="admonition-title">Контекст вычисления нового значения</p>
<p>Контекст вычисления <strong>нового значения</strong> поля зависит от того, к какому элементу формы применяется действие: </p>
<ul>
<li>
<p><span style="box-sizing: border-box; color: #545764; font-family: 'Open Sans', sans-serif; font-size: 15px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 300; letter-spacing: 0.2px; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: #e5f5fa; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;">если элемент не является столбцом таблицы</span>, то контекстом является текущая запись, для которой открыта форма;</p>
</li>
<li>
<p>если элемент является столбцом таблицы, то контекстом является запись, которая относится к строке таблицы атрибута типа «<strong>Запись</strong>».</p>
</li>
</ul>
</div>
<p>Если <strong>новое значение</strong> будет пустым, то при выполнении действия поле на форме будет очищено.</p>
<p>Значение поля на форме может изменить другое действие или конечный пользователь.</p>
<h4 id="rules7">Свойства действия «Показать ошибку»</h4>
<p>Это действие предназначено для проверки значений полей атрибутов и столбцов таблиц и вывода сообщения у поля на форме.</p>
<p>Действие «<strong>Показать ошибку</strong>» выполняется только при попытке сохранения экранной формы, если условие выполнения правила возвращает <code>true</code> и условие выполнения действия возвращает <code>false</code>.</p>
<p>Помимо <a href="#mcetoc_1hk6cgc0s0">общих свойств</a> у этого действия предусмотрены перечисленные ниже свойства.</p>
<ul>
<li><strong>Тип сообщения</strong>:
<ul>
<li><strong>Предупреждение</strong> — при сохранении формы выводит предупреждение на указанном поле формы, при этом данные на форме будут сохранены.</li>
<li><strong>Ошибка</strong> — при сохранении формы выводит ошибку на указанном поле формы, при этом данные на форме нельзя будет сохранить, пока ошибка не будет устранена.</li>
</ul>
</li>
<li><strong>Сообщение</strong> — введите строковое <strong>значение</strong> с текстом сообщения либо <strong>формулу</strong> или выражение на языке <strong>N3</strong>, возвращающие текст сообщения.</li>
</ul>
<div class="screenshot_with_caption">
<p><img align="" alt="Внешний вид сообщения об ошибке на поле " class="img-responsive" height="413" src="https://kb.comindware.ru/assets/u122.png" width="1395"/></p>
<p class="caption">Внешний вид сообщения об ошибке на поле </p>
</div>
<h2 id="mcetoc_1hjnb5cfi3">Удаление правил и действий</h2>
<ol class="colored_numbers_list">
<li>Откройте <a href="https://kb.comindware.ru/article.php?id=2537#mcetoc_1hk63g2uu0">конструктор правил для формы</a>.</li>
<li>Выберите правило или действие и перетащите его на панель элементов.</li>
<li>Подтвердите удаление удаления правила или действия.</li>
<li>Для очистки всех настроенных правил и действий можно нажать кнопку «Очистить».</li>
<li>Чтобы сохранить изменения, нажмите кнопку «Сохранить».</li>
</ol>
<figure class="screenshot_with_caption">
<p><img alt="Удаление правила для формы" class="img-responsive" height="321" src="https://kb.comindware.ru/assets/img_65a4f86f84ee9.png" width="976"/></p>
<figcaption class="caption">Удаление правил для формы</figcaption>
</figure>
<h2 id="mcetoc_1hk66302k3">Связанные статьи</h2>
<p><strong><samp data-name="aid" data-title="" data-value="2271">Редактирование формы {Article-ID:2271}</samp> </strong></p>
<p><strong><samp data-name="aid" data-title="" data-value="2531"><span style="color: #0066bc; font-family: Tahoma;"><img src="https://kb.comindware.ru/images/marker.png" style="vertical-align: middle;"/> Динамические элементы форм {Article-ID:2531}</span></samp> </strong></p>
<p><strong><samp data-name="aid" data-title="" data-value="2530"><span style="color: #0066bc; font-family: Tahoma;"><img src="https://kb.comindware.ru/images/marker.png" style="vertical-align: middle;"/> Статические элементы формы {Article-ID:2530}</span></samp> </strong></p>
<p><strong><samp data-name="aid" data-title="" data-value="2252"><span style="color: #0066bc; font-family: Tahoma;"><img src="https://kb.comindware.ru/images/marker.png" style="vertical-align: middle;"/> Типы и свойства атрибутов {Article-ID:2252}</span></samp> </strong></p>
<p><a class="md-top md-icon mkdocs_imported_link" href="#"> <em class="fa-light fa-arrow-up">‌</em> К началу </a></p>
<p> </p>