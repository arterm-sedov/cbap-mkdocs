<h1>Кнопки. Определение, настройка, удаление</h1><div class="md-container">
<div class="md-main__inner md-grid">
<div class="mce-toc">
<p class="toc-heading">Содержание</p>
<ul>
<li><a href="#mcetoc_1hilcpjoa0">Определения</a></li>
<li><a href="#mcetoc_1hpqmq0cr0">Настройка кнопки</a>
<ul>
<li><a href="#mcetoc_1gk3dof773">Свойства</a></li>
<li><a href="#mcetoc_1gk3dof774">Скрипт</a>
<ul>
<li><a href="#mcetoc_1hjn1lht80">Заготовка скрипта</a></li>
<li><a href="#mcetoc_1hjn1lsnf1">Входные данные</a></li>
<li><a href="#mcetoc_1hjn1m2562">Выходные данные</a></li>
</ul>
</li>
<li><a href="#mcetoc_1gk3dof775">Условие отображения</a>
<ul>
<li><a href="#mcetoc_1hr96faql0">Примеры условий отображения кнопки</a></li>
</ul>
</li>
<li><a href="#mcetoc_1gk3dof776">Локальные переменные</a></li>
<li><a href="#mcetoc_1gk3dof787">Связи</a></li>
</ul>
</li>
<li><a href="#mcetoc_1gk3dogfs0">Удаление кнопки</a></li>
<li><a href="#mcetoc_1gk3dof788">Связанные статьи</a></li>
</ul>
</div>
<div class="md-content">
<div class="admonition question">
<div class="notice notice-success">
<h3 class="admonition-title" id="mcetoc_1hilcpjoa0">Определения</h3>
<ul>
<li><strong>Кнопка</strong> представляет собой визуальный элемент на форме, при нажатии которого выполняется предварительно настроенная операция.</li>
<li>Для каждого шаблона предусмотрен отдельный набор кнопок.</li>
<li>Названия, цвета и значки кнопок <a href="https://kb.comindware.ru/article.php?id=2545">настраиваются в <strong>области кнопок</strong></a>.</li>
<li>Для каждой формы или таблицы можно настроить особые названия, значки и цвета кнопок.</li>
</ul>
</div>
</div>
<div class="md-container">
<div class="md-main__inner md-grid">
<h2 class="md-content" id="mcetoc_1hpqmq0cr0"><span style="font-size: 2rem; letter-spacing: 0.2px;">Настройка кнопки</span></h2>
</div>
</div>
<p>Конструктор кнопки позволяет настроить её внешний вид, поведение и операцию, выполняющуюся при её нажатии.</p>
<p>Цвет и значок кнопки <a href="https://kb.comindware.ru/article.php?id=2545">настраиваются в <strong>области кнопок</strong></a>.</p>
<ol class="colored_numbers_list">
<li>Откройте шаблон.</li>
<li>Выберите вкладку «<strong>Кнопки</strong>».</li>
<li>Отобразится список кнопок в составе шаблона. <br/>
<figure class="screenshot_with_caption" style="font-size: 15px !important;">
<p><img alt="Список кнопок в составе шаблона" class="img-responsive" height="273" src="https://kb.comindware.ru/assets/img_659d0f1337b3f.png" width="1189"/></p>
<figcaption class="caption" style="font-size: 15px !important;">Список кнопок в составе шаблона</figcaption>
</figure>
</li>
<li>Нажмите кнопку «<strong>Создать</strong>» или дважды нажмите кнопку в списке.</li>
<li>Отобразится конструктор кнопки.</li>
<li>Настройте параметры кнопки на следующих вкладках:
<ul>
<li><a href="#mcetoc_1gk3dof773">Свойства</a></li>
<li><a href="#mcetoc_1gk3dof774">Скрипт</a></li>
<li><a href="#mcetoc_1gk3dof775">Условие отображения</a></li>
<li><a href="#mcetoc_1gk3dof776">Локальные переменные</a></li>
<li><a href="#mcetoc_1gk3dof787">Связи</a></li>
</ul>
</li>
<li>Нажмите кнопку «<strong>Сохранить</strong>».</li>
</ol>
<h3 id="mcetoc_1gk3dof773">Свойства</h3>
<p>На вкладке «<strong>Свойства</strong>» можно настроить основные параметры кнопки.</p>
<div class="screenshot_with_caption">
<p><img alt="Конструктор кнопки — вкладка «Свойства»" src="https://kb.comindware.ru/assets/button_designer_copy1.png"/></p>
<p class="caption">Конструктор кнопки — вкладка «Свойства»</p>
</div>
<ul>
<li><strong>Отображаемое название</strong> — подпись, которая будет отображаться на кнопке. Изменение отображаемого названия кнопки в <a href="https://kb.comindware.ru/article.php?id=2545">области кнопок</a>, на форме или в таблице не повлияет на название исходной кнопки в шаблоне.</li>
<li><strong>Системное имя</strong> — уникальное имя кнопки для использования в сценариях, выражениях и скриптах.</li>
<li><strong>Описание</strong> — наглядное описание назначения кнопки. Описание кнопки отображается как подсказка при наведении указателя мыши на кнопку. Изменение описания кнопки в <a href="https://kb.comindware.ru/article.php?id=2545">области кнопок</a>, на форме или в таблице не повлияет на описание исходной кнопки в шаблоне.</li>
<li><strong><a id="operationContext"></a>Контекст операции</strong> — определяет набор доступных операций, контекст выполнения операции и возможность использования кнопки на соответствующих формах и таблицах.
<ul>
<li><strong>Аккаунт</strong> — запись в <strong><a href="https://kb.comindware.ru/article.php?id=2223">шаблоне аккаунта</a></strong>.</li>
<li><strong>Диаграмма</strong> — диаграмма процесса.</li>
<li><strong>Запись</strong> в <strong>шаблоне <a href="https://kb.comindware.ru/article.php?id=2221">записи</a></strong>,<strong> <a href="https://kb.comindware.ru/article.php?id=2223">аккаунта</a></strong>, <strong><a href="https://kb.comindware.ru/article.php?id=2220">роли</a></strong> или <strong><a href="https://kb.comindware.ru/article.php?id=2226">организационной единицы</a></strong>.</li>
<li><strong>Пользовательская задача</strong> — элемент диаграммы процесса.</li>
<li><strong>Процесс</strong> — экземпляр или <strong><a href="https://kb.comindware.ru/article.php?id=2222">шаблон процесса</a></strong>.</li>
</ul>
</li>
<li><strong>Операция</strong> — набор доступных операций зависит от выбранного <a href="#operationContext"><strong>контекста операции</strong></a>. Операции выполняются с <strong>записями</strong> в <strong>шаблонах <a href="https://kb.comindware.ru/article.php?id=2221">записей</a></strong>, <strong><a href="https://kb.comindware.ru/article.php?id=2223">аккаунтов</a></strong>, <strong><a href="https://kb.comindware.ru/article.php?id=2220">ролей</a></strong> и <strong><a href="https://kb.comindware.ru/article.php?id=2226">организационных единиц</a></strong>, а также с <strong>экземплярами процессов</strong> в <strong><a href="https://kb.comindware.ru/article.php?id=2222">шаблонах процессов</a></strong>. Предусмотрены следующие операции:
<ul>
<li><strong>Архивировать</strong> — архивирование выбранных записей или экземпляров процесса: установка для <span style="color: #545764; font-family: ’Open Sans’, sans-serif; font-size: 15px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 300; letter-spacing: 0.2px; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: #ffffff; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;">системного атрибута <strong>_isDisabled </strong>значения </span><code>true</code>.</li>
<li><strong>Вызвать событие «Нажата кнопка»</strong> — при нажатии кнопки сработает событие «<strong>Нажата кнопка</strong>», по которому может быть запущен сценарий в приложении.</li>
<li><strong><a id="launchProcess"></a>Запустить процесс</strong> — запуск экземпляра выбранного шаблона процесса по текущей записи или по новой записи.</li>
<li><strong><a id="launchLinkedProcess"></a>Запустить процесс по связанному шаблону</strong> — запуск экземпляра процесса по выбранному шаблону записи, связанному с текущим шаблоном записи посредством атрибута типа «<strong>Запись</strong>». В отличие от операции «<strong>Запустить процесс</strong>», после запуска процесса в указанный атрибут будет помещена ссылка на созданную запись. После выбора шаблона становится доступно поле выбора формы для создания записи.</li>
<li><strong>Мигрировать</strong> — обновление экземпляра процесса до последней версии диаграммы процесса. (Эта операция работает не во всех версиях <strong>Comindware Business Application Platform</strong>.)</li>
<li><strong><a id="csharpScript"></a>Скрипт C#</strong> — выполнение скрипта C#. Скрипт <span style="color: #545764; font-family: ’Open Sans’, sans-serif; font-size: 15px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 300; letter-spacing: 0.2px; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: #ffffff; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;">может выполнять любые действия с использованием API и библиотек, доступных в <strong>Comindware Business Application Platform</strong>. См. <em>«<a href="https://kb.comindware.ru/article.php?id=2400#mcetoc_1h7a35ah1t">Написание скриптов на языке C#. Скрипт операции</a>»</em>.</span></li>
<li><strong><a id="createRecord"></a>Создать</strong> — создание записи в выбранном шаблоне. После выбора шаблона становится доступно поле выбора формы для создания записи.</li>
<li><strong><a id="createLinkedRecord"></a>Создать связанную запись</strong> — создание записи в шаблоне записи, связанном с текущим шаблоном посредством атрибута типа «<strong>Запись</strong>». В отличие от операции «<strong>Создать</strong>», после создания записи ссылка в указанный атрибут будет помещена ссылка на созданную запись. После выбора шаблона становится доступно поле выбора формы для создания записи.</li>
<li><strong>Создать токен</strong> — создание нового токена на выбранном элементе диаграммы экземпляра процесса.</li>
<li><strong>Сохранить</strong> — сохранение текущей записи.</li>
<li><strong>Остановить процесс</strong> — остановка текущего экземпляра процесса.</li>
<li><strong>Открыть заново</strong> — назначение задаче статуса «<strong>Выполняется</strong>».</li>
<li><strong>Завершить задачу</strong> — завершение текущей задачи бизнес-процесса.</li>
<li><strong>Отвязать от шаблона</strong> — исключение выбранного аккаунта из текущего шаблона аккаунта.</li>
<li><strong>Отложить выполнение</strong> — эта операция будет реализована в последующих версиях продукта.</li>
<li><strong>Привязать к шаблону</strong> — добавление выбранных аккаунтов в текущий шаблон аккаунта.</li>
<li><strong>Принять</strong> — назначение текущего аккаунта исполнителем задачи.</li>
<li><strong>Разархивировать</strong> — разархивирование выбранных записей или экземпляров процесса: установка для <span style="color: #545764; font-family: ’Open Sans’, sans-serif; font-size: 15px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 300; letter-spacing: 0.2px; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: #ffffff; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;">системного атрибута <strong>_isDisabled </strong>значения <code>false</code></span>.</li>
<li><strong>Редактировать</strong> — изменение диаграммы процесса.</li>
<li><strong>Удалить</strong> — безвозвратное удаление записи или экземпляра процесса.</li>
<li><strong><a id="exportRecord"></a>Экспорт записи</strong> — экспорт записи посредством<a href="https://kb.comindware.ru/article.php?id=2349"> шаблона экспорта</a> в формате DOCX, XLSX или PDF.</li>
<li><strong><a id="exportTable"></a>Экспорт таблицы</strong> — экспорт данных из таблицы в формате XLSX <span style="color: #545764; font-family: ’Open Sans’, sans-serif; font-size: 15px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 300; letter-spacing: 0.2px; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: #ffffff; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;">с использованием текущих параметров фильтрации, сортировки, группировки и агрегации</span>.</li>
</ul>
</li>
</ul>
<ul>
<li><strong>Сохранять запись после выполнения</strong> — установите этот флажок, чтобы сохранять текущую запись после выполнения операции по нажатию кнопки.</li>
<li><strong>Пропускать проверки</strong> — установите этот флажок, чтобы вводе и сохранении данных записи не выполнялись проверки данных и не выводились сообщения об ошибках проверки.</li>
<li><strong>Результат выполнения</strong> — выберите действие, которое необходимо осуществить после выполнения операции:
<ul>
<li><strong>Обновить данные</strong> — перезагрузка данных формы или таблицы.</li>
<li><strong>Скачать документ</strong> — браузер загрузит файл, сформированный операцией «<a href="#exportRecord"><strong>Экспорт записи</strong></a>», «<a href="#exportTable"><strong>Экспорт таблицы</strong></a>» или «<a href="#csharpScript"><strong>Скрипт C#</strong></a>». 
<div class="notice notice-info">
<p class="admonition-title">Примечание</p>
<p>Для операции «<strong>Скрипт C#</strong>» файл задаётся выходным параметром <code>File</code> скрипта. См. <em>«<a href="https://kb.comindware.ru/article.php?id=2400#mcetoc_1h7a35ah1t">Написание скриптов на языке C#. Скрипт операции</a>»</em>.</p>
</div>
</li>
<li><strong>Навигация</strong> — переход к объекту, указанному в поле «<strong>Переход к</strong>»:
<ul>
<li><strong>Диаграмма</strong> — переход к диаграмме экземпляра процесса.</li>
<li><strong>Задача запущенного процесса</strong> — переход к текущей <strong><a href="https://kb.comindware.ru/article.php?id=2392">пользовательской задаче</a></strong> экземпляра процесса (для операций «<a href="#launchProcess"><strong>Запустить процесс</strong></a>» и «<strong><a href="#launchLinkedProcess">Запустить процесс по связанному шаблону</a></strong>»).</li>
<li><strong>Предыдущая страница</strong> — переход к предыдущей странице, открытой в браузере.</li>
<li><strong>Рабочий стол </strong>— переход <strong><a href="https://kb.comindware.ru/article.php?id=2215">рабочему столу</a></strong> для текущего аккаунта.</li>
<li><strong>Связанная запись</strong> — переход к созданной записи (для операций «<a href="#createRecord"><strong>Создать запись</strong></a>» и «<a href="#createLinkedRecord"><strong>Создать связанную запись</strong></a>»).</li>
<li><strong>Следующая задача в списке</strong> — переход к следующей (по ID) <strong><a href="https://kb.comindware.ru/article.php?id=2392">пользовательской задаче</a> </strong>экземпляра процесса, назначенной текущему аккаунту.</li>
<li><strong>Список задач</strong> — переход к странице «<strong><a href="https://kb.comindware.ru/article.php?id=2411">Мои задачи</a></strong>» для текущего аккаунта.</li>
<li><strong>Таблица</strong> — переход к таблице с записями шаблона или экземплярами процесса.</li>
<li><strong>Экземпляр процесса</strong> — переход к <a href="https://kb.comindware.ru/article.php?id=2355">диаграмме экземпляра процесса</a>.</li>
</ul>
<div class="notice notice-info">
<p class="admonition-title">Примечание</p>
<p>Для операции «<a href="#csharpScript"><strong>Скрипт C#</strong></a>» объект навигации задаётся выходным параметром <code>NavigationResult</code> скрипта. См. <em>«<a href="https://kb.comindware.ru/article.php?id=2400#mcetoc_1h7a35ah1t">Написание скриптов на языке C#. Скрипт операции</a>»</em>.</p>
</div>
</li>
</ul>
</li>
<li><strong><a id="setAccessMode"></a>Установить режим доступа к форме</strong> — задайте режим доступа
<ul>
<li><strong>Чтение</strong> — при нажатии кнопки форма станет доступна только для чтения. При этом на форме обязательно должна быть кнопка, устанавливающая режим доступа к форме «<strong>Редактирование</strong>», в противном случае переключение режима переходить не будет. Кроме того, при такой настройке форма по умолчанию будет отображаться в режиме «<strong>Чтение</strong>».</li>
<li><strong>Редактирование</strong> — нажав кнопку, пользователь сможет вводить данные в форму (при наличии соответствующих разрешений).</li>
<li><strong>Не изменять</strong> — использование исходного режима доступа к форме.</li>
</ul>
</li>
<li><strong>Показывать кнопку</strong> — задайте видимость кнопки на форме (этот пункт следует использовать в сочетании с пунктом «<a href="#setAccessMode"><strong>Установить режим доступа к форме</strong></a>»).
<ul>
<li><strong>В режиме редактирования</strong> — кнопка будет отображаться только в режиме ввода данных в форму.</li>
<li><strong>В режиме чтения</strong> — кнопка будет отображаться, когда форма доступна только для чтения (в том числе, запрещено одновременное редактирование формы несколькими пользователями).</li>
<li><strong>Всегда</strong> — кнопка будет отображаться в режиме ввода данных и только чтения.</li>
</ul>
</li>
<li><strong>Отображать диалоговое окно</strong> — если установлен этот флажок, при нажатии кнопки откроется предварительно настроенное окно подтверждения операции.
<ul>
<li><strong>Настроить диалоговое окно</strong> — переход к <a href="https://kb.comindware.ru/article.php?id=2271">конструктору формы</a> подтверждения операции. В этом конструкторе на панели элементов будут отображаться <strong><a href="https://kb.comindware.ru/article.php?id=2276#mcetoc_1gk3dof776">локальные переменные</a></strong> операции, которые можно перетащить на диалоговое окно.</li>
</ul>
</li>
</ul>
<div class="screenshot_with_caption">
<p><img alt="Конструктор диалогового окна операции с локальной переменной" src="https://kb.comindware.ru/assets/button_designer_dialogue_designer_copy1.png"/></p>
<p class="caption">Конструктор диалогового окна операции с локальной переменной</p>
</div>
<h3 id="mcetoc_1gk3dof774">Скрипт</h3>
<p>На вкладке «<strong>Скрипт</strong>» можно ввести скрипт на языке C#, который будет выполняться при нажатии кнопки.</p>
<p>Скрипт на C# может выполнять любые действия для контроля, чтения, изменения и удаления данных внутри системы, а также для вызова внешних сервисов в ограниченном пространстве подключаемых библиотек.</p>
<p>Скрипт на С# можно использовать для операции «<strong>Экспорт записи</strong>» с целью подготовки данных для шаблона экспорта (подробные сведения см. статьях <em>«<a href="https://kb.comindware.ru/article.php?id=1942" title="Настройка шаблона экспорта с использованием C#">Настройка шаблона экспорта с использованием C#</a>»</em> и <em>«<a href="https://kb.comindware.ru/article.php?id=2352#mcetoc_1h1p7o4cm4">Подготовка файла шаблона экспорта</a>»</em>).</p>
<p>Чтобы сформировать заготовку скрипта C# нажмите кнопку «<strong>Сформировать шаблон C#</strong>».</p>
<h4 id="mcetoc_1hjn1lht80">Заготовка скрипта</h4>
<pre><code><span style="color: #0000ff;">public </span><span style="color: #0000ff;">class </span><span style="color: #a31515;">Script </span>{<br/>  <span style="color: #0000ff;">public </span><span style="color: #a31515;">static </span>UserCommandResult <span style="color: #a31515;">Main </span>(UserCommandContext userCommandContext, Comindware.Entities entities) {            <br/><span style="color: #008000;">    // Тело скрипта<br/></span>  }<br/>}</code><code></code></pre>
<h4 id="mcetoc_1hjn1lsnf1">Входные данные</h4>
<p>Скрипт получает на вход в данные контекста в объектах <code>userCommandContext</code> и <code>entities</code>:<code></code><code></code><code></code></p>
<pre><code>UserCommandContext userCommandContext {<br/><span style="color: #0000ff;">  string</span>[] ObjectIds, <span style="color: #008000;">// массив ID выбранных записей в списке <br/>           // (пустой массив, если записи не выбраны) <br/>           // или массив из одного элемента с ID записи на форме<br/></span><span style="color: #0000ff;">  string</span>[] SelectedIds, <span style="color: #008000;">// массив ID записей, выбранных в таблице на форме <br/>           // (пустой массив, если записи не выбраны)<br/></span><span style="color: #0000ff;">  string </span>CurrentUserId, <span style="color: #008000;">// ID аккаунта текущего пользователя<br/>  </span><span style="color: #0000ff;">string </span>DocumentTemplateId, <span style="color: #008000;">// ID шаблона, к которому относится команда<br/>  </span><span class="HTMLCodeSmallNoBackground"><span style="border: none;">dateTime </span></span>CurrentRequestTime, <span style="color: #008000;">// дата и время текущего запроса<br/>  </span><span style="color: #0000ff;">bool </span>ExportAsPdf, <span style="color: #008000;">// флаг экспорта в PDF<br/>  </span><span style="color: #0000ff;">string </span>FileName, <span style="color: #008000;">// имя файла при выгрузке данных по шаблону экспорта<br/></span>  DatasetQuery Query <span style="color: #008000;">// список, с которого произошел запуск операции<br/></span>},<br/>Comindware.Entities entities <span style="color: #008000;">// используется для доступа к данным шаблонов записей</span></code></pre>
<h4 id="mcetoc_1hjn1m2562">Выходные данные</h4>
<p>Метод <code>Main</code> должен возвращать объект <code>UserCommandResult</code>:</p>
<pre><code>UserCommandResult {<br/><span style="color: #0000ff;">  bool </span>Success, <span style="color: #008000;">// флаг успешного завершения операции <br/></span><span style="color: #0000ff;">  bool </span>Commited, <span style="color: #008000;">// флаг необходимости сохранения результатов работы операции<br/></span><span style="color: #0000ff;">  enum </span>UserCommandResultType ResultType, <span style="color: #008000;">// тип возвращаемого результата. <br/>  // В зависимости от значения производятся действия:<br/></span><span style="color: #008000;">      // DataChange — обновление данных<br/></span><span style="color: #008000;">      // Notificate — сообщение пользователю<br/>      </span><span style="color: #008000;">// Navigate — переход на страницу <br/>      </span><span style="color: #008000;">// File — скачивание файла<br/></span><span style="color: #008000;"><br/>  // набор данных для перехода на другую страницу </span>  <br/>  UserCommandNavigationResult NavigationResult {<br/><span style="color: #0000ff;">    string </span>Title, <span style="color: #008000;">// заголовок                   <br/></span><span style="color: #0000ff;">    string </span>ObjectId, <span style="color: #008000;">// ID объекта <br/></span><span style="color: #0000ff;">    string </span>ContainerId, <span style="color: #008000;">// ID контейнера <br/></span>    ContextType Context <span style="color: #008000;">// тип отображения <br/>      // Undefined, Void, Any, Task, Case, Record, Process, List, Form, Page, Container<br/></span>  },<br/><span style="color: #008000;"><br/>  // объект выгружаемого файла</span><br/>  UserCommandFileResult File {<br/><span style="color: #0000ff;">    string </span>Name, <span style="color: #008000;">// имя файла<br/></span><span style="color: #0000ff;">    string </span>Type,<br/><span style="color: #0000ff;">    byte</span>[] Content <span style="color: #008000;">// тело файла    <br/></span>  },<br/><br/><span style="color: #008000;">  // сообщение для пользователя об окончании операции</span><br/>  UserCommandMessage[] Messages { <span style="color: #008000;"><br/>    </span></code><code><span style="color: #0000ff;">enum </span>Severity, <span style="color: #008000;">// уровень важности сообщения <br/>      // SeverityLevel (Critical, Fatal, Low, Major, None, Normal)</span><br/><span style="color: #0000ff;">    string </span>Text<br/>  }<br/>}           </code></pre>
<div class="screenshot_with_caption">
<p><img alt="Конструктор кнопки — вкладка «Скрипт» с заготовкой скрипта C#" src="https://kb.comindware.ru/assets/button_designer_script_copy1.png"/></p>
<p class="caption">Конструктор кнопки — вкладка «Скрипт» с заготовкой скрипта C#</p>
</div>
<h3 id="mcetoc_1gk3dof775">Условие отображения</h3>
<p>На вкладке «<strong>Условие отображения</strong>» можно задать формулу или выражение на N3. Кнопка будет отображаться, если формула или выражение на N3 вернёт <code>true</code>. В противном случае кнопка будет скрыта.</p>
<p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 1rem; font-size: 15px; font-weight: 300; letter-spacing: 0.2px; line-height: 25px; color: #545764; font-family: ’Open Sans’, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: #ffffff; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;">Если задано <strong>условие отображения</strong>, то для отображения кнопки в таблице должна быть выбрана хотя бы одна запись и <strong>условие отображения</strong> должно возвращать <code>true</code> для всех выбранных записей. То есть кнопка не будет отображаться в таблице, если в ней не выбрана ни одна запись или для любой из выбранных записей <strong>условие отображения</strong> возвращает <code>false</code>.</p>
<div class="screenshot_with_caption">
<p><img alt="Конструктор кнопки — вкладка «Условие отображение» с формулой" src="https://kb.comindware.ru/assets/button_designer_display_condition_copy1.png"/></p>
<p class="caption">Конструктор кнопки — вкладка «Условие отображение» с формулой</p>
</div>
<h4 id="mcetoc_1hr96faql0">Примеры условий отображения кнопки</h4>
<p>Ниже представлены примеры условий отображения кнопки на <a href="https://kb.comindware.ru/article.php?id=2590">языке формул Comindware</a>.</p>
<div class="notice notice-info">
<p class="admonition-title">Примечание</p>
<p>При составлении выражений учитывайте <a href="https://kb.comindware.ru/article.php?id=2104">контекст</a> их вычисления.</p>
</div>
<ol class="colored_numbers_list">
<li>
<p>Формула для отображения кнопки на форме или в таблице шаблона записи при условии, что <a href="https://kb.comindware.ru/article.php?id=2245">логический атрибут</a> имеет значение <code>true</code>:</p>
<pre class="source_code_container"><code>$LogicAttributeSystemName == true</code></pre>
<div><strong>Здесь:</strong> <code>LogicAttributeSystemName</code> — системное имя логического атрибута.</div>
</li>
<li>Формула для отображения кнопки в таблице любого шаблона при условии, что в таблице выбрана хотя бы одна запись (то есть установлены флажки выбора в первом столбце таблицы):
<pre class="source_code_container"><code>true</code></pre>
</li>
<li>Формула для отображения кнопки на <a href="https://kb.comindware.ru/article.php?id=2363">стартовой форме или форме пользовательской задачи</a> при условии, что логический атрибут записи, связанной с экземпляром процесса, имеет значение <code>true</code>:
<pre class="source_code_container"><code>$cmw.task.objectId -&gt; op.1 == true</code></pre>
<strong>Здесь:</strong>
<ul>
<li><code>$cmw.task.objectId</code> — идентификатор связанной с экземпляром процессом записи, где хранится логический атрибут;</li>
<li><code>op.1</code> — идентификатор логического атрибута в шаблоне записи, связанном с шаблоном процесса.</li>
</ul>
</li>
</ol>
<h3 id="mcetoc_1gk3dof776">Локальные переменные</h3>
<p>На вкладке «<strong>Локальные переменные</strong>» можно создать переменные для использования в скрипте C# или сценарии, выполняемом при нажатии кнопки.</p>
<p>В сценарии по нажатию кнопки локальные переменные будут доступны в объекте <code style="letter-spacing: 0.2px;">dialogVariables</code><span style="letter-spacing: 0.2px;">. См. </span><a href="https://kb.comindware.ru/article.php?id=2399#mcetoc_1h6ofccs00" style="background-color: #ffffff; letter-spacing: 0.2px;">пример</a><span style="letter-spacing: 0.2px;">.</span></p>
<p>Локальные переменные представляют собой <a href="https://kb.comindware.ru/article.php?id=2252">атрибуты</a>.</p>
<p>Пример использования локальной переменной см. в статье «<a href="https://kb.comindware.ru/article.php?id=2140">Использование локальной переменной для массовой обработки записей</a>».</p>
<p>Для каждой переменной можно задать:</p>
<ul>
<li><strong>Отображаемое название</strong> — наглядное название переменной;</li>
<li><strong>Тип данных</strong> — для переменных предусмотрены <a href="https://kb.comindware.ru/article.php?id=2252">такие же типы, как для атрибутов</a>;</li>
<li><strong>Формат отображения</strong> — для переменных предусмотрены <a href="https://kb.comindware.ru/article.php?id=2252">такие же форматы отображения, как для атрибутов</a>;</li>
<li><strong>Системное имя</strong> — уникальное имя переменной для использования в сценариях, выражениях и скриптах;</li>
<li><strong>Описание</strong> — наглядное описание назначения переменной;</li>
<li><strong>Шаблон</strong> — можно задать для переменных следующих типов: «<strong><a href="https://kb.comindware.ru/article.php?id=2221">Запись</a></strong>», «<strong><a href="https://kb.comindware.ru/article.php?id=2223">Аккаунт</a></strong>», «<strong><a href="https://kb.comindware.ru/article.php?id=2220">Роль</a></strong>», «<strong><a href="https://kb.comindware.ru/article.php?id=2226">Организационная единица</a></strong>»;</li>
<li><strong>Хранить несколько значений</strong> — этот флажок можно установить для переменных следующих типов: «<strong>Файл</strong>» (см. типы атрибутов «<strong><a href="https://kb.comindware.ru/article.php?id=2241">Документ</a></strong>» и «<strong><a href="https://kb.comindware.ru/article.php?id=2253">Изображение</a></strong>»), «<strong><a href="https://kb.comindware.ru/article.php?id=2243">Запись</a></strong>», «<strong><a href="https://kb.comindware.ru/article.php?id=2249">Аккаунт</a></strong>», «<strong><a href="https://kb.comindware.ru/article.php?id=2240">Роль</a></strong>», «<strong><a href="https://kb.comindware.ru/article.php?id=2258">Организационная единица</a></strong>».</li>
</ul>
<div class="screenshot_with_caption">
<p><img alt="Конструктор кнопки — вкладка «Локальные переменные»" src="https://kb.comindware.ru/assets/button_designer_local_variables_copy1.png"/></p>
<p class="caption">Конструктор кнопки — вкладка «Локальные переменные»</p>
</div>
<h3 id="mcetoc_1gk3dof787">Связи</h3>
<p>На вкладке «<strong>Связи</strong>» отображается список всех объектов и ресурсов приложения, связанных с кнопкой.</p>
<div class="screenshot_with_caption">
<p><img alt="Конструктор кнопки — вкладка «Связи»" src="https://kb.comindware.ru/assets/button_designer_relations_copy1.png"/></p>
<p class="caption">Конструктор кнопки — вкладка «Связи»</p>
</div>
<h2 id="mcetoc_1gk3dogfs0">Удаление кнопки</h2>
<ol class="colored_numbers_list">
<li>Откройте шаблон.</li>
<li>Выберите вкладку «<strong>Кнопки</strong>».</li>
<li>Отобразится список кнопок в составе шаблона.</li>
<li>Выберите одну кнопку, установив для неё флажок в первом столбце списка.</li>
<li>Нажмите кнопку «<strong>Удалить</strong>».</li>
<li>Подтвердите удаление.</li>
</ol>
<h2 id="mcetoc_1gk3dof788">Связанные статьи</h2>
<p><strong><samp data-name="aid" data-title="" data-value="2545"><span style="color: #0066bc; font-family: Tahoma;"><img src="https://kb.comindware.ru/images/marker.png" style="vertical-align: middle;"/>Настройка области кнопок {Article-ID:2545}</span></samp></strong></p>
</div>
</div>
<p><a class="md-top md-icon mkdocs_imported_link" href="#"> <em class="fa-light fa-arrow-up">‌</em> К началу</a></p>
</div>
<div class="md-dialog">
<div class="md-dialog__inner md-typeset"> </div>
</div><h1>Кнопки. Определение, настройка, удаление</h1><div class="md-container">
<div class="md-main__inner md-grid">
<div class="mce-toc">
<p class="toc-heading">Содержание</p>
<ul>
<li><a href="#mcetoc_1hilcpjoa0">Определения</a></li>
<li><a href="#mcetoc_1hpqmq0cr0">Настройка кнопки</a>
<ul>
<li><a href="#mcetoc_1gk3dof773">Свойства</a></li>
<li><a href="#mcetoc_1gk3dof774">Скрипт</a>
<ul>
<li><a href="#mcetoc_1hjn1lht80">Заготовка скрипта</a></li>
<li><a href="#mcetoc_1hjn1lsnf1">Входные данные</a></li>
<li><a href="#mcetoc_1hjn1m2562">Выходные данные</a></li>
</ul>
</li>
<li><a href="#mcetoc_1gk3dof775">Условие отображения</a>
<ul>
<li><a href="#mcetoc_1hr96faql0">Примеры условий отображения кнопки</a></li>
</ul>
</li>
<li><a href="#mcetoc_1gk3dof776">Локальные переменные</a></li>
<li><a href="#mcetoc_1gk3dof787">Связи</a></li>
</ul>
</li>
<li><a href="#mcetoc_1gk3dogfs0">Удаление кнопки</a></li>
<li><a href="#mcetoc_1gk3dof788">Связанные статьи</a></li>
</ul>
</div>
<div class="md-content">
<div class="admonition question">
<div class="notice notice-success">
<h3 class="admonition-title" id="mcetoc_1hilcpjoa0">Определения</h3>
<ul>
<li><strong>Кнопка</strong> представляет собой визуальный элемент на форме, при нажатии которого выполняется предварительно настроенная операция.</li>
<li>Для каждого шаблона предусмотрен отдельный набор кнопок.</li>
<li>Названия, цвета и значки кнопок <a href="https://kb.comindware.ru/article.php?id=2545">настраиваются в <strong>области кнопок</strong></a>.</li>
<li>Для каждой формы или таблицы можно настроить особые названия, значки и цвета кнопок.</li>
</ul>
</div>
</div>
<div class="md-container">
<div class="md-main__inner md-grid">
<h2 class="md-content" id="mcetoc_1hpqmq0cr0"><span style="font-size: 2rem; letter-spacing: 0.2px;">Настройка кнопки</span></h2>
</div>
</div>
<p>Конструктор кнопки позволяет настроить её внешний вид, поведение и операцию, выполняющуюся при её нажатии.</p>
<p>Цвет и значок кнопки <a href="https://kb.comindware.ru/article.php?id=2545">настраиваются в <strong>области кнопок</strong></a>.</p>
<ol class="colored_numbers_list">
<li>Откройте шаблон.</li>
<li>Выберите вкладку «<strong>Кнопки</strong>».</li>
<li>Отобразится список кнопок в составе шаблона. <br/>
<figure class="screenshot_with_caption" style="font-size: 15px !important;">
<p><img alt="Список кнопок в составе шаблона" class="img-responsive" height="273" src="https://kb.comindware.ru/assets/img_659d0f1337b3f.png" width="1189"/></p>
<figcaption class="caption" style="font-size: 15px !important;">Список кнопок в составе шаблона</figcaption>
</figure>
</li>
<li>Нажмите кнопку «<strong>Создать</strong>» или дважды нажмите кнопку в списке.</li>
<li>Отобразится конструктор кнопки.</li>
<li>Настройте параметры кнопки на следующих вкладках:
<ul>
<li><a href="#mcetoc_1gk3dof773">Свойства</a></li>
<li><a href="#mcetoc_1gk3dof774">Скрипт</a></li>
<li><a href="#mcetoc_1gk3dof775">Условие отображения</a></li>
<li><a href="#mcetoc_1gk3dof776">Локальные переменные</a></li>
<li><a href="#mcetoc_1gk3dof787">Связи</a></li>
</ul>
</li>
<li>Нажмите кнопку «<strong>Сохранить</strong>».</li>
</ol>
<h3 id="mcetoc_1gk3dof773">Свойства</h3>
<p>На вкладке «<strong>Свойства</strong>» можно настроить основные параметры кнопки.</p>
<div class="screenshot_with_caption">
<p><img alt="Конструктор кнопки — вкладка «Свойства»" src="https://kb.comindware.ru/assets/button_designer_copy1.png"/></p>
<p class="caption">Конструктор кнопки — вкладка «Свойства»</p>
</div>
<ul>
<li><strong>Отображаемое название</strong> — подпись, которая будет отображаться на кнопке. Изменение отображаемого названия кнопки в <a href="https://kb.comindware.ru/article.php?id=2545">области кнопок</a>, на форме или в таблице не повлияет на название исходной кнопки в шаблоне.</li>
<li><strong>Системное имя</strong> — уникальное имя кнопки для использования в сценариях, выражениях и скриптах.</li>
<li><strong>Описание</strong> — наглядное описание назначения кнопки. Описание кнопки отображается как подсказка при наведении указателя мыши на кнопку. Изменение описания кнопки в <a href="https://kb.comindware.ru/article.php?id=2545">области кнопок</a>, на форме или в таблице не повлияет на описание исходной кнопки в шаблоне.</li>
<li><strong><a id="operationContext"></a>Контекст операции</strong> — определяет набор доступных операций, контекст выполнения операции и возможность использования кнопки на соответствующих формах и таблицах.
<ul>
<li><strong>Аккаунт</strong> — запись в <strong><a href="https://kb.comindware.ru/article.php?id=2223">шаблоне аккаунта</a></strong>.</li>
<li><strong>Диаграмма</strong> — диаграмма процесса.</li>
<li><strong>Запись</strong> в <strong>шаблоне <a href="https://kb.comindware.ru/article.php?id=2221">записи</a></strong>,<strong> <a href="https://kb.comindware.ru/article.php?id=2223">аккаунта</a></strong>, <strong><a href="https://kb.comindware.ru/article.php?id=2220">роли</a></strong> или <strong><a href="https://kb.comindware.ru/article.php?id=2226">организационной единицы</a></strong>.</li>
<li><strong>Пользовательская задача</strong> — элемент диаграммы процесса.</li>
<li><strong>Процесс</strong> — экземпляр или <strong><a href="https://kb.comindware.ru/article.php?id=2222">шаблон процесса</a></strong>.</li>
</ul>
</li>
<li><strong>Операция</strong> — набор доступных операций зависит от выбранного <a href="#operationContext"><strong>контекста операции</strong></a>. Операции выполняются с <strong>записями</strong> в <strong>шаблонах <a href="https://kb.comindware.ru/article.php?id=2221">записей</a></strong>, <strong><a href="https://kb.comindware.ru/article.php?id=2223">аккаунтов</a></strong>, <strong><a href="https://kb.comindware.ru/article.php?id=2220">ролей</a></strong> и <strong><a href="https://kb.comindware.ru/article.php?id=2226">организационных единиц</a></strong>, а также с <strong>экземплярами процессов</strong> в <strong><a href="https://kb.comindware.ru/article.php?id=2222">шаблонах процессов</a></strong>. Предусмотрены следующие операции:
<ul>
<li><strong>Архивировать</strong> — архивирование выбранных записей или экземпляров процесса: установка для <span style="color: #545764; font-family: ’Open Sans’, sans-serif; font-size: 15px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 300; letter-spacing: 0.2px; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: #ffffff; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;">системного атрибута <strong>_isDisabled </strong>значения </span><code>true</code>.</li>
<li><strong>Вызвать событие «Нажата кнопка»</strong> — при нажатии кнопки сработает событие «<strong>Нажата кнопка</strong>», по которому может быть запущен сценарий в приложении.</li>
<li><strong><a id="launchProcess"></a>Запустить процесс</strong> — запуск экземпляра выбранного шаблона процесса по текущей записи или по новой записи.</li>
<li><strong><a id="launchLinkedProcess"></a>Запустить процесс по связанному шаблону</strong> — запуск экземпляра процесса по выбранному шаблону записи, связанному с текущим шаблоном записи посредством атрибута типа «<strong>Запись</strong>». В отличие от операции «<strong>Запустить процесс</strong>», после запуска процесса в указанный атрибут будет помещена ссылка на созданную запись. После выбора шаблона становится доступно поле выбора формы для создания записи.</li>
<li><strong>Мигрировать</strong> — обновление экземпляра процесса до последней версии диаграммы процесса. (Эта операция работает не во всех версиях <strong>Comindware Business Application Platform</strong>.)</li>
<li><strong><a id="csharpScript"></a>Скрипт C#</strong> — выполнение скрипта C#. Скрипт <span style="color: #545764; font-family: ’Open Sans’, sans-serif; font-size: 15px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 300; letter-spacing: 0.2px; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: #ffffff; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;">может выполнять любые действия с использованием API и библиотек, доступных в <strong>Comindware Business Application Platform</strong>. См. <em>«<a href="https://kb.comindware.ru/article.php?id=2400#mcetoc_1h7a35ah1t">Написание скриптов на языке C#. Скрипт операции</a>»</em>.</span></li>
<li><strong><a id="createRecord"></a>Создать</strong> — создание записи в выбранном шаблоне. После выбора шаблона становится доступно поле выбора формы для создания записи.</li>
<li><strong><a id="createLinkedRecord"></a>Создать связанную запись</strong> — создание записи в шаблоне записи, связанном с текущим шаблоном посредством атрибута типа «<strong>Запись</strong>». В отличие от операции «<strong>Создать</strong>», после создания записи ссылка в указанный атрибут будет помещена ссылка на созданную запись. После выбора шаблона становится доступно поле выбора формы для создания записи.</li>
<li><strong>Создать токен</strong> — создание нового токена на выбранном элементе диаграммы экземпляра процесса.</li>
<li><strong>Сохранить</strong> — сохранение текущей записи.</li>
<li><strong>Остановить процесс</strong> — остановка текущего экземпляра процесса.</li>
<li><strong>Открыть заново</strong> — назначение задаче статуса «<strong>Выполняется</strong>».</li>
<li><strong>Завершить задачу</strong> — завершение текущей задачи бизнес-процесса.</li>
<li><strong>Отвязать от шаблона</strong> — исключение выбранного аккаунта из текущего шаблона аккаунта.</li>
<li><strong>Отложить выполнение</strong> — эта операция будет реализована в последующих версиях продукта.</li>
<li><strong>Привязать к шаблону</strong> — добавление выбранных аккаунтов в текущий шаблон аккаунта.</li>
<li><strong>Принять</strong> — назначение текущего аккаунта исполнителем задачи.</li>
<li><strong>Разархивировать</strong> — разархивирование выбранных записей или экземпляров процесса: установка для <span style="color: #545764; font-family: ’Open Sans’, sans-serif; font-size: 15px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 300; letter-spacing: 0.2px; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: #ffffff; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;">системного атрибута <strong>_isDisabled </strong>значения <code>false</code></span>.</li>
<li><strong>Редактировать</strong> — изменение диаграммы процесса.</li>
<li><strong>Удалить</strong> — безвозвратное удаление записи или экземпляра процесса.</li>
<li><strong><a id="exportRecord"></a>Экспорт записи</strong> — экспорт записи посредством<a href="https://kb.comindware.ru/article.php?id=2349"> шаблона экспорта</a> в формате DOCX, XLSX или PDF.</li>
<li><strong><a id="exportTable"></a>Экспорт таблицы</strong> — экспорт данных из таблицы в формате XLSX <span style="color: #545764; font-family: ’Open Sans’, sans-serif; font-size: 15px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 300; letter-spacing: 0.2px; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: #ffffff; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;">с использованием текущих параметров фильтрации, сортировки, группировки и агрегации</span>.</li>
</ul>
</li>
</ul>
<ul>
<li><strong>Сохранять запись после выполнения</strong> — установите этот флажок, чтобы сохранять текущую запись после выполнения операции по нажатию кнопки.</li>
<li><strong>Пропускать проверки</strong> — установите этот флажок, чтобы вводе и сохранении данных записи не выполнялись проверки данных и не выводились сообщения об ошибках проверки.</li>
<li><strong>Результат выполнения</strong> — выберите действие, которое необходимо осуществить после выполнения операции:
<ul>
<li><strong>Обновить данные</strong> — перезагрузка данных формы или таблицы.</li>
<li><strong>Скачать документ</strong> — браузер загрузит файл, сформированный операцией «<a href="#exportRecord"><strong>Экспорт записи</strong></a>», «<a href="#exportTable"><strong>Экспорт таблицы</strong></a>» или «<a href="#csharpScript"><strong>Скрипт C#</strong></a>». 
<div class="notice notice-info">
<p class="admonition-title">Примечание</p>
<p>Для операции «<strong>Скрипт C#</strong>» файл задаётся выходным параметром <code>File</code> скрипта. См. <em>«<a href="https://kb.comindware.ru/article.php?id=2400#mcetoc_1h7a35ah1t">Написание скриптов на языке C#. Скрипт операции</a>»</em>.</p>
</div>
</li>
<li><strong>Навигация</strong> — переход к объекту, указанному в поле «<strong>Переход к</strong>»:
<ul>
<li><strong>Диаграмма</strong> — переход к диаграмме экземпляра процесса.</li>
<li><strong>Задача запущенного процесса</strong> — переход к текущей <strong><a href="https://kb.comindware.ru/article.php?id=2392">пользовательской задаче</a></strong> экземпляра процесса (для операций «<a href="#launchProcess"><strong>Запустить процесс</strong></a>» и «<strong><a href="#launchLinkedProcess">Запустить процесс по связанному шаблону</a></strong>»).</li>
<li><strong>Предыдущая страница</strong> — переход к предыдущей странице, открытой в браузере.</li>
<li><strong>Рабочий стол </strong>— переход <strong><a href="https://kb.comindware.ru/article.php?id=2215">рабочему столу</a></strong> для текущего аккаунта.</li>
<li><strong>Связанная запись</strong> — переход к созданной записи (для операций «<a href="#createRecord"><strong>Создать запись</strong></a>» и «<a href="#createLinkedRecord"><strong>Создать связанную запись</strong></a>»).</li>
<li><strong>Следующая задача в списке</strong> — переход к следующей (по ID) <strong><a href="https://kb.comindware.ru/article.php?id=2392">пользовательской задаче</a> </strong>экземпляра процесса, назначенной текущему аккаунту.</li>
<li><strong>Список задач</strong> — переход к странице «<strong><a href="https://kb.comindware.ru/article.php?id=2411">Мои задачи</a></strong>» для текущего аккаунта.</li>
<li><strong>Таблица</strong> — переход к таблице с записями шаблона или экземплярами процесса.</li>
<li><strong>Экземпляр процесса</strong> — переход к <a href="https://kb.comindware.ru/article.php?id=2355">диаграмме экземпляра процесса</a>.</li>
</ul>
<div class="notice notice-info">
<p class="admonition-title">Примечание</p>
<p>Для операции «<a href="#csharpScript"><strong>Скрипт C#</strong></a>» объект навигации задаётся выходным параметром <code>NavigationResult</code> скрипта. См. <em>«<a href="https://kb.comindware.ru/article.php?id=2400#mcetoc_1h7a35ah1t">Написание скриптов на языке C#. Скрипт операции</a>»</em>.</p>
</div>
</li>
</ul>
</li>
<li><strong><a id="setAccessMode"></a>Установить режим доступа к форме</strong> — задайте режим доступа
<ul>
<li><strong>Чтение</strong> — при нажатии кнопки форма станет доступна только для чтения. При этом на форме обязательно должна быть кнопка, устанавливающая режим доступа к форме «<strong>Редактирование</strong>», в противном случае переключение режима переходить не будет. Кроме того, при такой настройке форма по умолчанию будет отображаться в режиме «<strong>Чтение</strong>».</li>
<li><strong>Редактирование</strong> — нажав кнопку, пользователь сможет вводить данные в форму (при наличии соответствующих разрешений).</li>
<li><strong>Не изменять</strong> — использование исходного режима доступа к форме.</li>
</ul>
</li>
<li><strong>Показывать кнопку</strong> — задайте видимость кнопки на форме (этот пункт следует использовать в сочетании с пунктом «<a href="#setAccessMode"><strong>Установить режим доступа к форме</strong></a>»).
<ul>
<li><strong>В режиме редактирования</strong> — кнопка будет отображаться только в режиме ввода данных в форму.</li>
<li><strong>В режиме чтения</strong> — кнопка будет отображаться, когда форма доступна только для чтения (в том числе, запрещено одновременное редактирование формы несколькими пользователями).</li>
<li><strong>Всегда</strong> — кнопка будет отображаться в режиме ввода данных и только чтения.</li>
</ul>
</li>
<li><strong>Отображать диалоговое окно</strong> — если установлен этот флажок, при нажатии кнопки откроется предварительно настроенное окно подтверждения операции.
<ul>
<li><strong>Настроить диалоговое окно</strong> — переход к <a href="https://kb.comindware.ru/article.php?id=2271">конструктору формы</a> подтверждения операции. В этом конструкторе на панели элементов будут отображаться <strong><a href="https://kb.comindware.ru/article.php?id=2276#mcetoc_1gk3dof776">локальные переменные</a></strong> операции, которые можно перетащить на диалоговое окно.</li>
</ul>
</li>
</ul>
<div class="screenshot_with_caption">
<p><img alt="Конструктор диалогового окна операции с локальной переменной" src="https://kb.comindware.ru/assets/button_designer_dialogue_designer_copy1.png"/></p>
<p class="caption">Конструктор диалогового окна операции с локальной переменной</p>
</div>
<h3 id="mcetoc_1gk3dof774">Скрипт</h3>
<p>На вкладке «<strong>Скрипт</strong>» можно ввести скрипт на языке C#, который будет выполняться при нажатии кнопки.</p>
<p>Скрипт на C# может выполнять любые действия для контроля, чтения, изменения и удаления данных внутри системы, а также для вызова внешних сервисов в ограниченном пространстве подключаемых библиотек.</p>
<p>Скрипт на С# можно использовать для операции «<strong>Экспорт записи</strong>» с целью подготовки данных для шаблона экспорта (подробные сведения см. статьях <em>«<a href="https://kb.comindware.ru/article.php?id=1942" title="Настройка шаблона экспорта с использованием C#">Настройка шаблона экспорта с использованием C#</a>»</em> и <em>«<a href="https://kb.comindware.ru/article.php?id=2352#mcetoc_1h1p7o4cm4">Подготовка файла шаблона экспорта</a>»</em>).</p>
<p>Чтобы сформировать заготовку скрипта C# нажмите кнопку «<strong>Сформировать шаблон C#</strong>».</p>
<h4 id="mcetoc_1hjn1lht80">Заготовка скрипта</h4>
<pre><code><span style="color: #0000ff;">public </span><span style="color: #0000ff;">class </span><span style="color: #a31515;">Script </span>{<br/>  <span style="color: #0000ff;">public </span><span style="color: #a31515;">static </span>UserCommandResult <span style="color: #a31515;">Main </span>(UserCommandContext userCommandContext, Comindware.Entities entities) {            <br/><span style="color: #008000;">    // Тело скрипта<br/></span>  }<br/>}</code><code></code></pre>
<h4 id="mcetoc_1hjn1lsnf1">Входные данные</h4>
<p>Скрипт получает на вход в данные контекста в объектах <code>userCommandContext</code> и <code>entities</code>:<code></code><code></code><code></code></p>
<pre><code>UserCommandContext userCommandContext {<br/><span style="color: #0000ff;">  string</span>[] ObjectIds, <span style="color: #008000;">// массив ID выбранных записей в списке <br/>           // (пустой массив, если записи не выбраны) <br/>           // или массив из одного элемента с ID записи на форме<br/></span><span style="color: #0000ff;">  string</span>[] SelectedIds, <span style="color: #008000;">// массив ID записей, выбранных в таблице на форме <br/>           // (пустой массив, если записи не выбраны)<br/></span><span style="color: #0000ff;">  string </span>CurrentUserId, <span style="color: #008000;">// ID аккаунта текущего пользователя<br/>  </span><span style="color: #0000ff;">string </span>DocumentTemplateId, <span style="color: #008000;">// ID шаблона, к которому относится команда<br/>  </span><span class="HTMLCodeSmallNoBackground"><span style="border: none;">dateTime </span></span>CurrentRequestTime, <span style="color: #008000;">// дата и время текущего запроса<br/>  </span><span style="color: #0000ff;">bool </span>ExportAsPdf, <span style="color: #008000;">// флаг экспорта в PDF<br/>  </span><span style="color: #0000ff;">string </span>FileName, <span style="color: #008000;">// имя файла при выгрузке данных по шаблону экспорта<br/></span>  DatasetQuery Query <span style="color: #008000;">// список, с которого произошел запуск операции<br/></span>},<br/>Comindware.Entities entities <span style="color: #008000;">// используется для доступа к данным шаблонов записей</span></code></pre>
<h4 id="mcetoc_1hjn1m2562">Выходные данные</h4>
<p>Метод <code>Main</code> должен возвращать объект <code>UserCommandResult</code>:</p>
<pre><code>UserCommandResult {<br/><span style="color: #0000ff;">  bool </span>Success, <span style="color: #008000;">// флаг успешного завершения операции <br/></span><span style="color: #0000ff;">  bool </span>Commited, <span style="color: #008000;">// флаг необходимости сохранения результатов работы операции<br/></span><span style="color: #0000ff;">  enum </span>UserCommandResultType ResultType, <span style="color: #008000;">// тип возвращаемого результата. <br/>  // В зависимости от значения производятся действия:<br/></span><span style="color: #008000;">      // DataChange — обновление данных<br/></span><span style="color: #008000;">      // Notificate — сообщение пользователю<br/>      </span><span style="color: #008000;">// Navigate — переход на страницу <br/>      </span><span style="color: #008000;">// File — скачивание файла<br/></span><span style="color: #008000;"><br/>  // набор данных для перехода на другую страницу </span>  <br/>  UserCommandNavigationResult NavigationResult {<br/><span style="color: #0000ff;">    string </span>Title, <span style="color: #008000;">// заголовок                   <br/></span><span style="color: #0000ff;">    string </span>ObjectId, <span style="color: #008000;">// ID объекта <br/></span><span style="color: #0000ff;">    string </span>ContainerId, <span style="color: #008000;">// ID контейнера <br/></span>    ContextType Context <span style="color: #008000;">// тип отображения <br/>      // Undefined, Void, Any, Task, Case, Record, Process, List, Form, Page, Container<br/></span>  },<br/><span style="color: #008000;"><br/>  // объект выгружаемого файла</span><br/>  UserCommandFileResult File {<br/><span style="color: #0000ff;">    string </span>Name, <span style="color: #008000;">// имя файла<br/></span><span style="color: #0000ff;">    string </span>Type,<br/><span style="color: #0000ff;">    byte</span>[] Content <span style="color: #008000;">// тело файла    <br/></span>  },<br/><br/><span style="color: #008000;">  // сообщение для пользователя об окончании операции</span><br/>  UserCommandMessage[] Messages { <span style="color: #008000;"><br/>    </span></code><code><span style="color: #0000ff;">enum </span>Severity, <span style="color: #008000;">// уровень важности сообщения <br/>      // SeverityLevel (Critical, Fatal, Low, Major, None, Normal)</span><br/><span style="color: #0000ff;">    string </span>Text<br/>  }<br/>}           </code></pre>
<div class="screenshot_with_caption">
<p><img alt="Конструктор кнопки — вкладка «Скрипт» с заготовкой скрипта C#" src="https://kb.comindware.ru/assets/button_designer_script_copy1.png"/></p>
<p class="caption">Конструктор кнопки — вкладка «Скрипт» с заготовкой скрипта C#</p>
</div>
<h3 id="mcetoc_1gk3dof775">Условие отображения</h3>
<p>На вкладке «<strong>Условие отображения</strong>» можно задать формулу или выражение на N3. Кнопка будет отображаться, если формула или выражение на N3 вернёт <code>true</code>. В противном случае кнопка будет скрыта.</p>
<p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 1rem; font-size: 15px; font-weight: 300; letter-spacing: 0.2px; line-height: 25px; color: #545764; font-family: ’Open Sans’, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: #ffffff; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;">Если задано <strong>условие отображения</strong>, то для отображения кнопки в таблице должна быть выбрана хотя бы одна запись и <strong>условие отображения</strong> должно возвращать <code>true</code> для всех выбранных записей. То есть кнопка не будет отображаться в таблице, если в ней не выбрана ни одна запись или для любой из выбранных записей <strong>условие отображения</strong> возвращает <code>false</code>.</p>
<div class="screenshot_with_caption">
<p><img alt="Конструктор кнопки — вкладка «Условие отображение» с формулой" src="https://kb.comindware.ru/assets/button_designer_display_condition_copy1.png"/></p>
<p class="caption">Конструктор кнопки — вкладка «Условие отображение» с формулой</p>
</div>
<h4 id="mcetoc_1hr96faql0">Примеры условий отображения кнопки</h4>
<p>Ниже представлены примеры условий отображения кнопки на <a href="https://kb.comindware.ru/article.php?id=2590">языке формул Comindware</a>.</p>
<div class="notice notice-info">
<p class="admonition-title">Примечание</p>
<p>При составлении выражений учитывайте <a href="https://kb.comindware.ru/article.php?id=2104">контекст</a> их вычисления.</p>
</div>
<ol class="colored_numbers_list">
<li>
<p>Формула для отображения кнопки на форме или в таблице шаблона записи при условии, что <a href="https://kb.comindware.ru/article.php?id=2245">логический атрибут</a> имеет значение <code>true</code>:</p>
<pre class="source_code_container"><code>$LogicAttributeSystemName == true</code></pre>
<div><strong>Здесь:</strong> <code>LogicAttributeSystemName</code> — системное имя логического атрибута.</div>
</li>
<li>Формула для отображения кнопки в таблице любого шаблона при условии, что в таблице выбрана хотя бы одна запись (то есть установлены флажки выбора в первом столбце таблицы):
<pre class="source_code_container"><code>true</code></pre>
</li>
<li>Формула для отображения кнопки на <a href="https://kb.comindware.ru/article.php?id=2363">стартовой форме или форме пользовательской задачи</a> при условии, что логический атрибут записи, связанной с экземпляром процесса, имеет значение <code>true</code>:
<pre class="source_code_container"><code>$cmw.task.objectId -&gt; op.1 == true</code></pre>
<strong>Здесь:</strong>
<ul>
<li><code>$cmw.task.objectId</code> — идентификатор связанной с экземпляром процессом записи, где хранится логический атрибут;</li>
<li><code>op.1</code> — идентификатор логического атрибута в шаблоне записи, связанном с шаблоном процесса.</li>
</ul>
</li>
</ol>
<h3 id="mcetoc_1gk3dof776">Локальные переменные</h3>
<p>На вкладке «<strong>Локальные переменные</strong>» можно создать переменные для использования в скрипте C# или сценарии, выполняемом при нажатии кнопки.</p>
<p>В сценарии по нажатию кнопки локальные переменные будут доступны в объекте <code style="letter-spacing: 0.2px;">dialogVariables</code><span style="letter-spacing: 0.2px;">. См. </span><a href="https://kb.comindware.ru/article.php?id=2399#mcetoc_1h6ofccs00" style="background-color: #ffffff; letter-spacing: 0.2px;">пример</a><span style="letter-spacing: 0.2px;">.</span></p>
<p>Локальные переменные представляют собой <a href="https://kb.comindware.ru/article.php?id=2252">атрибуты</a>.</p>
<p>Пример использования локальной переменной см. в статье «<a href="https://kb.comindware.ru/article.php?id=2140">Использование локальной переменной для массовой обработки записей</a>».</p>
<p>Для каждой переменной можно задать:</p>
<ul>
<li><strong>Отображаемое название</strong> — наглядное название переменной;</li>
<li><strong>Тип данных</strong> — для переменных предусмотрены <a href="https://kb.comindware.ru/article.php?id=2252">такие же типы, как для атрибутов</a>;</li>
<li><strong>Формат отображения</strong> — для переменных предусмотрены <a href="https://kb.comindware.ru/article.php?id=2252">такие же форматы отображения, как для атрибутов</a>;</li>
<li><strong>Системное имя</strong> — уникальное имя переменной для использования в сценариях, выражениях и скриптах;</li>
<li><strong>Описание</strong> — наглядное описание назначения переменной;</li>
<li><strong>Шаблон</strong> — можно задать для переменных следующих типов: «<strong><a href="https://kb.comindware.ru/article.php?id=2221">Запись</a></strong>», «<strong><a href="https://kb.comindware.ru/article.php?id=2223">Аккаунт</a></strong>», «<strong><a href="https://kb.comindware.ru/article.php?id=2220">Роль</a></strong>», «<strong><a href="https://kb.comindware.ru/article.php?id=2226">Организационная единица</a></strong>»;</li>
<li><strong>Хранить несколько значений</strong> — этот флажок можно установить для переменных следующих типов: «<strong>Файл</strong>» (см. типы атрибутов «<strong><a href="https://kb.comindware.ru/article.php?id=2241">Документ</a></strong>» и «<strong><a href="https://kb.comindware.ru/article.php?id=2253">Изображение</a></strong>»), «<strong><a href="https://kb.comindware.ru/article.php?id=2243">Запись</a></strong>», «<strong><a href="https://kb.comindware.ru/article.php?id=2249">Аккаунт</a></strong>», «<strong><a href="https://kb.comindware.ru/article.php?id=2240">Роль</a></strong>», «<strong><a href="https://kb.comindware.ru/article.php?id=2258">Организационная единица</a></strong>».</li>
</ul>
<div class="screenshot_with_caption">
<p><img alt="Конструктор кнопки — вкладка «Локальные переменные»" src="https://kb.comindware.ru/assets/button_designer_local_variables_copy1.png"/></p>
<p class="caption">Конструктор кнопки — вкладка «Локальные переменные»</p>
</div>
<h3 id="mcetoc_1gk3dof787">Связи</h3>
<p>На вкладке «<strong>Связи</strong>» отображается список всех объектов и ресурсов приложения, связанных с кнопкой.</p>
<div class="screenshot_with_caption">
<p><img alt="Конструктор кнопки — вкладка «Связи»" src="https://kb.comindware.ru/assets/button_designer_relations_copy1.png"/></p>
<p class="caption">Конструктор кнопки — вкладка «Связи»</p>
</div>
<h2 id="mcetoc_1gk3dogfs0">Удаление кнопки</h2>
<ol class="colored_numbers_list">
<li>Откройте шаблон.</li>
<li>Выберите вкладку «<strong>Кнопки</strong>».</li>
<li>Отобразится список кнопок в составе шаблона.</li>
<li>Выберите одну кнопку, установив для неё флажок в первом столбце списка.</li>
<li>Нажмите кнопку «<strong>Удалить</strong>».</li>
<li>Подтвердите удаление.</li>
</ol>
<h2 id="mcetoc_1gk3dof788">Связанные статьи</h2>
<p><strong><samp data-name="aid" data-title="" data-value="2545"><span style="color: #0066bc; font-family: Tahoma;"><img src="https://kb.comindware.ru/images/marker.png" style="vertical-align: middle;"/>Настройка области кнопок {Article-ID:2545}</span></samp></strong></p>
</div>
</div>
<p><a class="md-top md-icon mkdocs_imported_link" href="#"> <em class="fa-light fa-arrow-up">‌</em> К началу</a></p>
</div>
<div class="md-dialog">
<div class="md-dialog__inner md-typeset"> </div>
</div>